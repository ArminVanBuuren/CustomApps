<Command Name="SC.SyncService">
  <Description>Команда добавления/удаления услуг</Description>
  <Author Name="Victor Kosonogov" Date="2017-05-01+01:01"/>
  <Properties GenerationType="DataSetXml" />
  <Request>
    <RequestTemplate>
      <![CDATA[<DataSet Name="UpdateTDCDataSet" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <Attributes>
    <Attribute Name="Label" Type="System.String" Value="UpdateTDC;##datetime##;[SCP_MARKER]"/>
    <Attribute Name="Protocol" Type="System.String" Value="Msmq"/>
  </Attributes>
  <DataTable Name="UpdateTDCDataTable">
    <Columns>
      <Column Name="REQUEST_ID" Type="System.String"/>
      <Column Name="TERMINAL_DEVICE_CONTRACT_ID" Type="System.Int64"/>
      <Column Name="PERSONAL_ACCOUNT_ID" Type="System.Int64"/>
      <Column Name="MSISDN" Type="System.String"/>
      <Column Name="CLIENT_ID" Type="System.String"/>
    </Columns>
    <Rows>
      <Row REQUEST_ID="##ASYNC_REQUEST_ID##" TERMINAL_DEVICE_CONTRACT_ID="##TerminalDeviceID##" PERSONAL_ACCOUNT_ID="##PersonalAccount##" MSISDN="##msisdn##" CLIENT_ID="[SCP_MARKER]"/>
    </Rows>
  </DataTable>
  <DataTable Name="ServiceCodeDataTable">
    <Columns>
      <Column Name="SERVICE_ROW_ID" Type="System.Int64"/>
      <Column Name="REQUEST_ID" Type="System.String"/>
      <Column Name="TERMINAL_DEVICE_CONTRACT_ID" Type="System.Int64"/>
      <Column Name="SERVICE_CODE" Type="System.String"/>
      <Column Name="DATE_FROM" Type="System.DateTime"/>
      <Column Name="COUNTER_COEFFICIENT" Type="System.Decimal"/>
      <Column Name="DISCOUNT_TYPE" Type="System.Int32"/>
      <Column Name="DISCOUNT_VALUE" Type="System.Decimal"/>
      <Column Name="SERVICE_ACTION" Type="System.String"/>
    </Columns>
    <Rows>##Services##</Rows>
  </DataTable>
  <DataTable Name="ServiceParameters">
    <Columns>
      <Column Name="SERVICE_ROW_ID" Type="System.Int64"/>
      <Column Name="PARAM_CODE" Type="System.String"/>
      <Column Name="PARAM_VALUE" Type="System.String"/>
      <Column Name="NEW_PARAM_VALUE" Type="System.String"/>
    </Columns>
    <Rows>##ServicesParams##</Rows>
  </DataTable>
  ##TDCIdentitiesStart##
  ##AdditionalNumbers##
  ##TDCIdentitiesEnd##
</DataSet>]]>
    </RequestTemplate>
    <EmulationPrintoutTemplate><![CDATA[]]></EmulationPrintoutTemplate>
    <Item Name="datetime" Type="Wellknown"/>
    <Item Name="TerminalDeviceID" Type="Wellknown"/>
    <Item Name="PersonalAccount" Type="Wellknown"/>
    <Item Name="msisdn" Type="Wellknown"/>
    <Item Name="Services" Type="LocalDynamicParameter"/>
    <Item Name="ServicesParams" Type="LocalDynamicParameter"/>
    <Item Name="TDCIdentitiesStart" Type="LocalParameter"/>
    <Item Name="AdditionalNumbers" Type="LocalDynamicParameter"/>
    <Item Name="TDCIdentitiesEnd" Type="LocalParameter"/>
  </Request>
  <ParametersList>
    <Parameter Name="TDCIdentitiesStart">
      <Source Path="//AdditionalData/EndList/RFS_FP_SERVICE_ADDITIONAL_NUMBER" SelectMode="NodeName" AbsenceValue="" PresenceValue="  &lt;DataTable Name=&quot;TDCIdentitiesDataTable&quot;&gt;
    &lt;Columns&gt;
      &lt;Column Name=&quot;REQUEST_ID&quot; Type=&quot;System.String&quot;/&gt;
      &lt;Column Name=&quot;TERMINAL_DEVICE_CONTRACT_ID&quot; Type=&quot;System.Int64&quot;/&gt;
      &lt;Column Name=&quot;IDENTITY_TYPE&quot; Type=&quot;System.Int32&quot;/&gt;
      &lt;Column Name=&quot;IDENTITY_VALUE&quot; Type=&quot;System.String&quot;/&gt;
    &lt;/Columns&gt;
    &lt;Rows&gt;"/>
    </Parameter>
    <Parameter Name="TDCIdentitiesEnd">
      <Source Path="//AdditionalData/EndList/RFS_FP_SERVICE_ADDITIONAL_NUMBER" SelectMode="NodeName" AbsenceValue="" PresenceValue="&lt;/Rows&gt;
  &lt;/DataTable&gt;"/>
    </Parameter>
  </ParametersList>
  <DynamicParametersList>
    <DynamicParameter Name="Services">
      <Source Path="//string"/>
      <DynamicObject Name="Services" SkipMissed="True"/>
    </DynamicParameter>
    <DynamicParameter Name="ServicesParams">
      <Source Path="//string"/>
      <DynamicObject Name="ServicesParams" SkipMissed="True"/>
    </DynamicParameter>
    <DynamicParameter Name="AdditionalNumbers">
      <Source Path="//string"/>
      <DynamicObject Name="AdditionalNumbers" SkipMissed="True"/>
    </DynamicParameter>
  </DynamicParametersList>
  <ErrorsList CodePage="ascii">
    <Error Name="Not found" Value="InvalidRequest"/>
    <Error Name="parameter must be returned" Value="InvalidRequest"/>
    <Error Name="-151014" Value="SUCCESS"/>
    <Error Name="If the service is present in expired state, it will be deactivated later internally" Value="SUCCESS"/>
  </ErrorsList>
</Command>
