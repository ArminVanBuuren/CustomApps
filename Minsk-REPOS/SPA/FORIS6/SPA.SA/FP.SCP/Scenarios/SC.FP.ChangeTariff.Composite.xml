<scenario name="SC.FP.ChangeTariff.Composite">
  <objectList>
    <object name="BySubscriberCutter" class="FORIS.ServiceProvisioning.MmlProcessing.SPF.RequestCutterBySubscribers" assembly="FORIS.SPA.MmlProcessing.dll" />
    <object name="Commander" class="FORIS.ServiceProvisioning.MmlProcessing.SPF.Processors.RequestProcessor" assembly="FORIS.SPA.MmlProcessing.dll" />
    <object name="ResponseAssembler" class="FORIS.ServiceProvisioning.MmlProcessing.SPF.ResponseAssembler" assembly="FORIS.SPA.MmlProcessing.dll" />
    <object name="FPCommandDataConstructor" class="FORIS.ServiceProvisioning.MmlProcessing.SPF.FPProcessingUnits.FPCommandDataConstructor" assembly="FORIS.SPA.MmlProcessing.dll" />
    <object name="IdentifiersGenerator" class="FORIS.ServiceProvisioning.MmlProcessing.SPF.IdentifiersGenerator" assembly="FORIS.SPA.MmlProcessing.dll" />
    <object name="ConditionsResolver" class="FORIS.ScenarioProcessing.CommonUnits.IfMultipleXmlConditionsResolver" assembly="FORIS.SPA.SPF.dll" />
  </objectList>
  <automat>
    <node name="BySubscriberCutter-Node" object="BySubscriberCutter">
      <resultlist>
        <result value="0" node="IdentifiersGenerator" />
        <result value="1" node="" />
      </resultlist>
    </node>
    <node name="IdentifiersGenerator" object="IdentifiersGenerator">
      <parameterslist>
        <param name="WellknownName" value="GlobalUid" />
      </parameterslist>
      <resultlist>
        <result value="0" node="CommandDataConstructor-Limits-Node" />
      </resultlist>
    </node>
    <node name="CommandDataConstructor-Limits-Node" object="FPCommandDataConstructor">
      <resultlist>
        <result value="0" node="CommandDataConstructor-InitialServices-Node" />
        <result value="1538" node="CommandDataConstructor-InitialServices-Node" />
        <result value="" node="FinalResponseAssembler-Node" />
      </resultlist>
      <parameterslist>
        <param name="ServicesDynamicObject" value="Limits" />
        <param name="ServicesCommand" value="SC.CreatePA.LowBalanceLimitsRow" />
        <param name="XmlPath" value="//AdditionalData/AddList/RFS_FP_CHANGE_TARIFF_NEW_TD//BalanceLimits/NotificationLimits/*" />
      </parameterslist>
    </node>
    <node name="CommandDataConstructor-InitialServices-Node" object="FPCommandDataConstructor">
      <resultlist>
        <result value="0" node="CommandDataConstructor-RegisteredServices-Node"/>
        <result value="1538" node="CommandDataConstructor-RegisteredServices-Node"/>
        <result value="" node="FinalResponseAssembler-Node"/>
      </resultlist>
      <parameterslist>
        <param name="ServicesDynamicObject" value="InitialServices"/>
        <param name="ParametersDynamicObject" value="InitialServicesParams"/>
        <param name="ServicesCommand" value="SC.CreateTDC.ServiceRow"/>
        <param name="ParametersCommand" value="SC.Service.ParameterRow"/>
        <param name="XmlPath" value="//AdditionalData/StartList/RFS_FP_SERVICE_GENERAL" />
      </parameterslist>
    </node>
    <node name="CommandDataConstructor-RegisteredServices-Node" object="FPCommandDataConstructor">
      <resultlist>
        <result value="0" node="CommandDataConstructor-PAServices-Node"/>
        <result value="1538" node="CommandDataConstructor-PAServices-Node"/>
        <result value="" node="FinalResponseAssembler-Node"/>
      </resultlist>
      <parameterslist>
        <param name="ServicesDynamicObject" value="RegisteredServices"/>
        <param name="ParametersDynamicObject" value="RegisteredServicesParams"/>
        <param name="ServicesCommand" value="SC.CreateTDC.ServiceRow"/>
        <param name="ParametersCommand" value="SC.Service.ParameterRow"/>
        <param name="XmlPath" value="//AdditionalData/EndList/RFS_FP_SERVICE_GENERAL" />
      </parameterslist>
    </node>
    <node name="CommandDataConstructor-PAServices-Node" object="FPCommandDataConstructor">
      <resultlist>
        <result value="0" node="CommandDataConstructor-AdditionalNumbers-Node"/>
        <result value="1538" node="CommandDataConstructor-AdditionalNumbers-Node"/>
        <result value="" node="FinalResponseAssembler-Node"/>
      </resultlist>
      <parameterslist>
        <param name="ServicesDynamicObject" value="PAServices"/>
        <param name="ParametersDynamicObject" value="PAServicesParams" />
        <param name="ServicesCommand" value="SC.CreatePA.ServiceTable"/>
        <param name="ParametersCommand" value="SC.Service.ParameterRow" />
        <param name="XmlPath" value="//AdditionalData/EndList/RFS_FP_SERVICE_GENERAL[./ServiceLevel/Value[text()='PersonalAccount']]"/>
        <param name="IgnoreServiceSkip" value="true" />
      </parameterslist>
    </node>
    <node name="CommandDataConstructor-AdditionalNumbers-Node" object="FPCommandDataConstructor">
      <resultlist>
        <result value="0" node="CommandDataConstructor-FavoriteNumbers-Node" />
        <result value="1538" node="CommandDataConstructor-FavoriteNumbers-Node" />
        <result value="" node=""/>
      </resultlist>
      <parameterslist>
        <param name="ServicesDynamicObject" value="AdditionalNumbers" />
        <param name="ServicesCommand" value="SC.AdditionalNumber.ServiceRow" />
        <param name="XmlPath" value="//AdditionalData/EndList/RFS_FP_SERVICE_ADDITIONAL_NUMBER" />
      </parameterslist>
    </node>
    <node name="CommandDataConstructor-FavoriteNumbers-Node" object="FPCommandDataConstructor">
      <resultlist>
        <result value="0" node="CommandDataConstructor-RegisteredFavoriteNumbersServices-Create" />
        <result value="1538" node="CommandDataConstructor-RegisteredFavoriteNumbersServices-Create" />
        <result value="" node="FinalResponseAssembler-Node" />
      </resultlist>
      <parameterslist>
        <param name="ServicesDynamicObject" value="FavoriteNumbers" />
        <param name="ServicesCommand" value="SC.ChangeTariff.FavoriteNumberRow" />
        <param name="XmlPath" value="//AdditionalData/EndList/RFS_FP_SERVICE_FAVORITE_NUMBER" />
      </parameterslist>
    </node>
    <node name="CommandDataConstructor-RegisteredFavoriteNumbersServices-Create" object="FPCommandDataConstructor">
      <resultlist>
        <result value="0" node="CommandDataConstructor-InitialFavoriteNumbersServices-Create" />
        <result value="1538" node="CommandDataConstructor-InitialFavoriteNumbersServices-Create" />
        <result value="" node="FinalResponseAssembler-Node" />
      </resultlist>
      <parameterslist>
        <param name="ServicesDynamicObject" value="RegisteredFavoriteNumbersServices" />
        <param name="ServicesCommand" value="SC.CreateTDC.ServiceRow" />
        <param name="XmlPath" value="//AdditionalData/EndList/RFS_FP_SERVICE_FAVORITE_NUMBER" />
      </parameterslist>
    </node>
    <node name="CommandDataConstructor-InitialFavoriteNumbersServices-Create" object="FPCommandDataConstructor">
      <resultlist>
        <result value="0" node="CheckForeignSubscriber" />
        <result value="1538" node="CheckForeignSubscriber" />
        <result value="" node="FinalResponseAssembler-Node" />
      </resultlist>
      <parameterslist>
        <param name="ServicesDynamicObject" value="InitialFavoriteNumbersServices" />
        <param name="ServicesCommand" value="SC.CreateTDC.ServiceRow" />
        <param name="XmlPath" value="//AdditionalData/StartList/RFS_FP_SERVICE_FAVORITE_NUMBER" />
      </parameterslist>
    </node>
    <node name="CheckForeignSubscriber" object="ConditionsResolver">
      <resultlist>
        <result value="0" node="CheckHostTypeCode" />
        <result value="" node="CommandDataConstructor-CugServices-Node" />
      </resultlist>
      <parameterslist>
        <param name="MultiLevelCondition" value="(//IdentifiersList/Identifier//IMSI[text()!='0']) AND NOT (//SkipFP/Value[text()='1'])" />
      </parameterslist>
    </node>
    <node name="CheckHostTypeCode" object="ConditionsResolver">
      <resultlist>
        <result value="0" node="CommandDataConstructor-CugServices-Node" />
        <result value="1" node="CompositeChangeTariff-Node" />
      </resultlist>
      <parameterslist>
        <param name="OrXmlPath:0" value="//BalanceStorage/HostCode[text()='[HOST_CODE_SCP1]']" />
        <param name="OrXmlPath:1" value="//BalanceStorage/HostCode[text()='[HOST_CODE_SCP2]']" />
        <param name="OrXmlPath:2" value="//BalanceStorage/HostCode[text()='[HOST_CODE_SCP3]']" />
        <param name="OrXmlPath:3" value="//BalanceStorage/HostCode[text()='[HOST_CODE_SCP4]']" />
        <param name="OrXmlPath:4" value="//BalanceStorage/HostCode[text()='[HOST_CODE_SCP5]']" />
      </parameterslist>
    </node>
    <node name="CommandDataConstructor-CugServices-Node" object="FPCommandDataConstructor">
      <resultlist>
        <result value="0" node="CompositeChangeTariff-Node" />
        <result value="1538" node="CompositeChangeTariff-Node" />
        <result value="" node="FinalResponseAssembler-Node" />
      </resultlist>
      <parameterslist>
        <param name="ServicesDynamicObject" value="CugServices" />
        <param name="ServicesCommand" value="SC.CugService.ServiceRow" />
        <param name="XmlPath" value="//AdditionalData/*/RFS_FP_SERVICE_CUG | //AdditionalData/*/RFS_FP_SERVICE_VUG" />
      </parameterslist>
    </node>
    <node name="CompositeChangeTariff-Node" object="Commander">
      <parameterslist>
        <param name="AppendSubscribersData" value="true" />
        <param name="OverwriteDetailedResult" value="true" />
        <param name="Command" value="SC.ChangeTariff.Composite" />
        <param name="Asynchronous" value="true" />
      </parameterslist>
      <resultlist>
        <result value="0" node="ResponseAssembler-Node" />
        <result value="" node="FinalResponseAssembler-Node" />
      </resultlist>
    </node>
    <node name="ResponseAssembler-Node" object="ResponseAssembler">
      <resultlist>
        <result value="" node="BySubscriberCutter-Node" />
      </resultlist>
    </node>
    <node name="FinalResponseAssembler-Node" object="ResponseAssembler">
      <parameterslist>
        <param name="FinalStepCheck" value="true" />
      </parameterslist>
      <resultlist>
        <result value="" node="" />
      </resultlist>
    </node>
  </automat>
</scenario>