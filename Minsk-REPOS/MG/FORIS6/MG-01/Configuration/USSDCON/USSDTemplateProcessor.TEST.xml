<templates connector="SMS">
  <template procedureName="rassrochka_passport_z" persistent="true" sessionStorage="Memory" sessionLifetime="60" handler="DBCON_01">
    <condition>
      <test item="${Recipient}" matches="^839$" />
      <test item="${Token0}" matches="^[0-9]{1,7}$" />
      <test item="${Token1}" matches="^[0-9]{1,12}$" />
    </condition>
    <receiveTemplate>
      <Message type="rassrochka_pasport_z" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="BILLING.billing.lll_rassrochka_pasport_116">
          <Attribute name="num" type="STRING" value="${Sender}" />
          <Attribute name="passp_num" type="INT" value="${Token0}" />
          <Attribute name="pa_num" type="STRING" value="${Token1}" />
          <Attribute name="rez" type="STRING" />
          <Attribute name="msg" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value=" Информация недоступна." />
      <set item="Content" condition="//Item/@dbresult=0" value="${msg}" />
      <set item="Sender" value="839" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- Cancel Guaranteed payment-->
  <template procedureName="GuaranteedPayment_" handler="DBCON_01">
    <condition>
      <test item="${Recipient}" matches="^(839)$" />
      <test item="${Content}" matches="^(([1-9]{1})|10)$" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="BILLING.mg_pack.PersonalGuaranteedPayment">
          <Attribute name="i_msisdn" type="STRING" value="${Sender}" />
          <Attribute name="i_summa" type="INT" value="${Content}" />
          <Attribute name="i_source" type="STRING" value="15" />
          <Attribute name="o_rez" type="STRING" />
          <Attribute name="o_dbresult" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="Извините. Информация временно недоступна." />
      <set item="Content" condition="//Item/@dbresult=0" value="${o_rez}" />
      <set item="Content" condition="//Item/@dbresult=-1" value="Произошла ошибка обратитесь в справочно-информационный центр." />
      <set item="Encoding" value="unicodefffe" />
      <set item="Sender" value="839" />
      <set item="Recipient" value="${customer}" />
    </deliveryTemplate>
  </template>
  <template procedureName="GuaranteedPayment_cancel" handler="DBCON_01">
    <condition>
      <test item="${Recipient}" matches="^(839)$" />
      <test item="${Content}" matches="^(0)$" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="BILLING.mg_pack.GuaranteedPayment">
          <Attribute name="i_msisdn" type="STRING" value="${Sender}" />
          <Attribute name="i_summa" type="INT" value="${Content}" />
          <Attribute name="i_source" type="STRING" value="15" />
          <Attribute name="o_rez" type="STRING" />
          <Attribute name="o_dbresult" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="Извините. Информация временно недоступна." />
      <set item="Content" condition="//Item/@dbresult=0" value="${o_rez}" />
      <set item="Content" condition="//Item/@dbresult=-1" value="Произошла ошибка обратитесь в справочно-информационный центр." />
      <set item="Encoding" value="unicodefffe" />
      <set item="Sender" value="839" />
      <set item="Recipient" value="${customer}" />
    </deliveryTemplate>
  </template>
  <template procedureName="GuaranteedPayment_SyntaxError">
    <condition>
      <test item="${Recipient}" matches="^839$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Произошла ошибка!" />
      <set item="Sender" value="839" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
</templates>