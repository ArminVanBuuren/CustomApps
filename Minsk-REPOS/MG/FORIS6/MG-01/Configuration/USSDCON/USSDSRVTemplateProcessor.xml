<templates connector="SMS">
  <template procedureName="KEO_PtP" persistent="true" sessionStorage="Memory" sessionLifetime="60">
    <condition>
      <test item="${Recipient}" matches="^115$" />
      <test item="${token0}" matches="^\d{14}$" />
      <test item="${token1}" matches="^\d{12}$" />
    </condition>
    <receiveTemplate>
      <Message type="verificationrequest" initiator="ussd" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item customer="${token1}" tdc="1" datasource="state">
          <Attribute name="checkblocks" value="1" />
        </Item>
        @{store(storedCustomer,${Sender})}
        @{store(sContent,${Content})}
      </Message>
    </receiveTemplate>
    <retry delay="1" attempts="0" />
    <deliveryTemplate conditionEx="#{('${dbresult}' = 0 or '${dbresult}'= 320343 ) }" call="KEO_PtP_2">
      <set item="Sender" value="${storedCustomer}" />
      <set item="Content" value="${sContent}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="Content" value="K sozhaleniyu, proizoshla oshibka. Obratites v abonentskiy otdel." />
      <set item="Content" condition="//Item/@dbresult=320341" value="Nevernii nomer poluchatelia platezha." />
      <set item="Content" condition="//Item/@dbresult=-1" value="Zapros ne mojet bit' obrabotan." />
      <set item="Encoding" value="ascii" />
      <set item="Sender" value="115" />
      <set item="Recipient" value="${Sender}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
  </template>
  <template procedureName="KEO_PtP_2" persistent="true" sessionStorage="Memory" sessionLifetime="60">
    <condition>
      <test item="0" matches="1" />
    </condition>
    <receiveTemplate>
      <Message type="vmaspayment" id="${guid}" initiator="SMS" session_id="@{newGuid}">
        <Item>
          <Attribute name="payer" value="${Sender}" />
          <Attribute name="receiver" value="${token1}" />
          <Attribute name="pin" value="${token0}" />
          <Attribute name="network_operator_code" value="BELORUSSIA" />
          <Attribute name="operator_id" value="15" />
        </Item>
      </Message>
    </receiveTemplate>
    <retry delay="1" attempts="0" />
    <deliveryTemplate>
      <set item="Content" value="K sozhaleniyu, proizoshla oshibka. Obratites v abonentskiy otdel." />
      <set item="Content" condition="//Item/@dbresult='AUTH_FAILED'" value="Vveden nepravilniy PIN-kod. Povtorite popitku." />
      <set item="Content" condition="//Item/@dbresult='AUTH_DEVICE_BLACKLISTED'" value="Activacija nevozmozhna. Obratites v Kontaktniy centr po tel. 0890." />
      <set item="Content" condition="//Item/@dbresult='AUTH_GENERAL_COUNTER_MAX'" value="Activacija nevozmozhna. Obratites v Kontaktniy centr po tel. 0890." />
      <set item="Content" condition="//Item/@dbresult='AUTH_SESSION_COUNTER_MAX'" value="Activacija nevozmozhna. Obratites v Kontaktniy centr po tel. 0890." />
      <set item="Content" condition="//Item/@dbresult='AUTH_DEVICE_NOT_FOUND_IN_RI'" value="Activacija nevozmozhna. Obratites v Kontaktniy centr po tel. 0890." />
      <set item="Content" condition="//Item/@dbresult='AUTH_CARD_BLOCKED'" value="Karta zablokirovana. Obratites v Kontaktniy centr po tel. 0890." />
      <set item="Content" condition="//Item/@dbresult='AUTH_CARD_EXPIRED'" value="Istek srok deystviya karti. Obratites v Kontaktniy centr po tel. 0890." />
      <set item="Content" condition="//Item/@dbresult='AUTH_CARD_NOT_AVAILABLE'" value="Karta nedostupna. Obratites v Kontaktniy centr po tel. 0890." />
      <set item="Content" condition="//Item/@dbresult='AUTH_CARD_NOT_FOUND'" value="Karta ne naydena. Obratites v Kontaktniy centr po tel. 0890." />
      <set item="Content" condition="//Item/@dbresult='OK'" value="Platezh na summu #{/Message/Item/Attribute[@name='amount']/@value} rublej prinyat dlia abonenta #{/Message/Item/Attribute[@name='receiver']/@value}." />
      <set item="Sender" value="115" />
      <set item="Recipient" value="${payer}" />
      <set item="Encoding" value="ascii" />
    </deliveryTemplate>
  </template>
  <template procedureName="VMASPayment">
    <condition>
      <test item="${Recipient}" matches="^115$" />
      <test item="${Content}" matches="^\d{14}$" />
    </condition>
    <receiveTemplate>
      <Message type="vmaspayment" id="${guid}" initiator="SMS" session_id="@{newGuid}">
        <Item>
          <Attribute name="payer" value="${Sender}" />
          <Attribute name="receiver" value="${Sender}" />
          <Attribute name="pin" value="${Content}" />
          <Attribute name="network_operator_code" value="BELORUSSIA" />
          <Attribute name="operator_id" value="15" />
        </Item>
      </Message>
    </receiveTemplate>
    <retry delay="1" attempts="0" />
    <deliveryTemplate>
      <set item="Content" value="K sozhaleniyu, proizoshla oshibka. Obratites v abonentskiy otdel." />
      <set item="Content" condition="//Item/@dbresult='AUTH_FAILED'" value="Vveden nepravilniy PIN-kod. Povtorite popitku." />
      <set item="Content" condition="//Item/@dbresult='AUTH_DEVICE_BLACKLISTED'" value="Activacija nevozmozhna. Obratites v Kontaktniy centr po tel. 0890." />
      <set item="Content" condition="//Item/@dbresult='AUTH_GENERAL_COUNTER_MAX'" value="Activacija nevozmozhna. Obratites v Kontaktniy centr po tel. 0890." />
      <set item="Content" condition="//Item/@dbresult='AUTH_SESSION_COUNTER_MAX'" value="Activacija nevozmozhna. Obratites v Kontaktniy centr po tel. 0890." />
      <set item="Content" condition="//Item/@dbresult='AUTH_DEVICE_NOT_FOUND_IN_RI'" value="Activacija nevozmozhna. Obratites v Kontaktniy centr po tel. 0890." />
      <set item="Content" condition="//Item/@dbresult='AUTH_CARD_BLOCKED'" value="Karta zablokirovana. Obratites v Kontaktniy centr po tel. 0890." />
      <set item="Content" condition="//Item/@dbresult='AUTH_CARD_EXPIRED'" value="Istek srok deystviya karti. Obratites v Kontaktniy centr po tel. 0890." />
      <set item="Content" condition="//Item/@dbresult='AUTH_CARD_NOT_AVAILABLE'" value="Karta nedostupna. Obratites v Kontaktniy centr po tel. 0890." />
      <set item="Content" condition="//Item/@dbresult='AUTH_CARD_NOT_FOUND'" value="Karta ne naydena. Obratites v Kontaktniy centr po tel. 0890." />
      <set item="Content" condition="//Item/@dbresult='OK'" value="Platezh na summu #{/Message/Item/Attribute[@name='amount']/@value} rublej prinyat." />
      <set item="Sender" value="115" />
      <set item="Recipient" value="${receiver}" />
      <set item="Encoding" value="ascii" />
    </deliveryTemplate>
  </template>
  <template procedureName="VMASPayment_bad">
    <condition>
      <test item="${Recipient}" matches="^115$" />
    </condition>
    <receiveTemplate>
      <Message type="vmaspayment" id="${guid}" initiator="ussd" session_id="@{newGuid}">
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Pozhaluysta, vvodite 14 cifr!" />
      <set item="Sender" value="115" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="ascii" />
    </deliveryTemplate>
  </template>
  <!-- Personal Guaranteed payment-->
  <template procedureName="SMS_Check_PersonalGuaranteedPayment" sessionLifetime="60">
    <condition>
      <test item="${Recipient}" matches="^(114)$" />
      <test item="${Content}" matches="^(1|2|3|4|5|6|7|8|9|10){1,2}$" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="ussd" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item customer="${Sender}">
          <Service id="guaranteedpayment" action="6" />
        </Item>
        @{store(sContent,#{number(${Content} * 100)})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'${dbresult}'='0'}" call="SMS_PersonalGuaranteedPayment">
      <set item="Sender" value="${customer}" />
      <set item="Content" value="${sContent}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <retry delay="1" attempts="0" />
    <deliveryTemplate>
      <set item="Content" value="Извините. Информация временно недоступна." />
      <set item="Content" conditionEx="#{${dbresult}=320341}" value="Номер Вашего телефона не зарегистрирован" />
      <set item="Content" conditionEx="#{${dbresult}=320347}" value="Услуга не может быть предоставлена, потому что номер заблокирован" />
      <set item="Content" conditionEx="#{${dbresult}=320191}" value="Данный сервис недоступен. Ваш баланс #{number('${balance}') div 100} р." />
      <set item="Content" conditionEx="#{${dbresult}=320203}" value="Услуга не может быть предоставлена, предыдущий обещанный платеж не погашен или в процессе регистрации" />
      <set item="Content" conditionEx="#{${dbresult}=320111}" value="Указывайте сумму не превышающую #{${maximumusd} div 100} р." />
      <set item="Content" conditionEx="#{${dbresult}=320121}" value="Невозможно установить обещанный платеж" />
      <set item="Content" conditionEx="#{${dbresult}=320113}" value="Сумма обещанного платежа меньше минимально возможной" />
      <set item="Content" conditionEx="#{${dbresult}=330140}" value="Обратитесь к персональному менеджеру" />
      <set item="Content" conditionEx="#{${dbresult}=330141}" value="Превышено допустимое кол-во обещанных платежей" />
      <set item="Content" conditionEx="#{${dbresult}=330142}" value="Исчерпан лимит средств для ввода обещанного платежа" />
      <set item="Content" conditionEx="#{${dbresult}=330132}" value="Данный сервис недоступен. Ваш баланс #{number('${balance}') div 100} р." />
      <set item="Content" condition="//Item/@dbresult=-1" value="Срочный кредит не может быть принят." />
      <set item="Encoding" value="unicodefffe" />
      <set item="Sender" value="114" />
      <set item="Recipient" value="${customer}" />
    </deliveryTemplate>
  </template>
  <template procedureName="SMS_PersonalGuaranteedPayment">
    <condition>
      <test item="0" matches="1" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="ussd" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}">
          <Service id="guaranteedpayment" action="7">
            <Attribute name="amount" value="${Content}" />
            <Attribute name="currency" value="933" />
          </Service>
        </Item>
      </Message>
    </receiveTemplate>
    <retry delay="1" attempts="0" />
    <deliveryTemplate>
      <set item="Content" value="Извините. Информация временно недоступна." />
      <set item="Content" condition="//Item/@dbresult=0" value="Срочный кредит на сумму ${amount} р. принят." />
      <set item="Content" condition="//Item/@dbresult=320203" value="Регистрация запрещена - предыдущий обещанный платеж не оплачен." />
      <set item="Content" condition="//Item/@dbresult=320111" value="Превышена разрешенная сумма обещанного платежа." />
      <set item="Content" condition="//Item/@dbresult=320112" value="Срочный кредит недоступен." />
      <set item="Content" conditionEx="#{('${amount}' &gt; 0 and '${dbresult}'= 320113) }" value="Макс. сумма - ${amount} р. Для ввода наберите *114*сумма#." />
      <set item="Content" conditionEx="#{('${amount}' = 0 and '${dbresult}'= 320113) }" value="Услуга Вам недоступна.Воспользуйтесь ОП *113*сумма# (до 5 р.)" />
      <set item="Content" condition="//Item/@dbresult=320121" value="Платеж не может быть зарегистрирован." />
      <set item="Content" condition="//Item/@dbresult=320341" value="Нельзя ввести срочный кредит на Вашем тарифном плане." />
      <set item="Content" condition="//Item/@dbresult=320110" value="Минимальная сумма обещанного платежа 1 руб.Введите большую сумму." />
      <set item="Content" condition="//Item/@dbresult=-1" value="Срочный кредит не может быть принят." />
      <set item="Content" conditionEx="#{${dbresult}=320347}" value="Услуга не может быть предоставлена, потому что номер заблокирован" />
      <set item="Content" conditionEx="#{${dbresult}=320191}" value="Услуга не может быть предоставлена, недостаточно средств" />
      <set item="Encoding" value="unicodefffe" />
      <set item="Sender" value="114" />
      <set item="Recipient" value="${customer}" />
    </deliveryTemplate>
  </template>
  <template procedureName="PersonalGuaranteedPayment_moresumm">
    <condition>
      <test item="${Recipient}" matches="^114$" />
      <test item="${Content}" matches="^[0-9]{3,6}$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Превышена разрешенная сумма." />
      <set item="Sender" value="114" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="PersonalGuaranteedPayment_CheckMaxSumm_" handler="DBCON_01">
    <condition>
      <test item="${Recipient}" matches="^(114)$" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.mg_add_pay_claimed">
          <Attribute name="p_msisdn" type="STRING" value="${Sender}" />
          <Attribute name="p_sum" type="STRING" value="99" />
          <Attribute name="p_curr" type="STRING" value="933" />
          <Attribute name="p_source" type="STRING" value="15" />
          <Attribute name="p_addon" type="STRING" value="1" />
          <Attribute name="dbresult" type="STRING" />
          <Attribute name="p_Allowed" type="STRING" />
          <Attribute name="p_Amount" type="STRING" />
          <Attribute name="p_Currency" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <!-- <set item="Content" condition="//Item/@dbresult='0'" value="${p_Amount}" /> -->
      <set item="Content" conditionEx="#{('${p_Amount}' &gt; 0 and '${dbresult}'= 320113)}" value="Макс. сумма - ${p_Amount} р. Для ввода наберите *114*сумма#." />
      <set item="Content" conditionEx="#{('${p_Amount}' = 0 and '${dbresult}'= 320113)}" value="Услуга Вам недоступна.Воспользуйтесь ОП *113*сумма# (до 5 р.)" />
      <set item="Content" condition="//Item/@dbresult!='0'" value="Ошибка выполнения запроса." />
      <set item="Sender" value="${Recipient}" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!--    <template procedureName="PersonalGuaranteedPayment_SyntaxError">
    <condition>
        <test item="${Recipient}" matches="^(114)$" />
    </condition>
    <receiveTemplate>
		<Message> <Item customer="${Sender}" /> </Message>
	</receiveTemplate>
    <deliveryTemplate direction="input">
		<set item="Content" value="Pozhaluista, posylaite tol'ko tsifry!"/>
		<set item="Sender" value="114" />
		<set item="Recipient" value="${customer}"/>
		<set item="Encoding" value="ascii" />
    </deliveryTemplate>
	</template>  -->
  <!-- Cancel Guaranteed payment-->
  <template procedureName="SMS_Cancel_GuaranteedPayment" sessionLifetime="60">
    <condition>
      <test item="${Recipient}" matches="^113$" />
      <test item="${Content}" matches="^0$" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="ussd" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}">
          <Service id="guaranteedpayment" action="9" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="Извините. Информация временно недоступна." />
      <set item="Content" condition="//Item/@dbresult=0" value="Заявка на отмену обещанного платежа принята." />
      <set item="Content" condition="//Item/@dbresult=-1" value="Произошла ошибка обратитесь в справочно-информационный центр." />
      <set item="Encoding" value="unicodefffe" />
      <set item="Sender" value="113" />
      <set item="Recipient" value="${customer}" />
    </deliveryTemplate>
  </template>
  <!-- Guaranteed payment WORK-->
  <template procedureName="SMS_Check_GuaranteedPayment" sessionLifetime="60">
    <condition>
      <test item="${Recipient}" matches="^113$" />
      <test item="${Content}" matches="^[1-5]{1}$" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="ussd" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item customer="${Sender}">
          <Service id="guaranteedpayment" action="6" />
        </Item>
        @{store(sContent,#{number(${Content} * 100)})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'${dbresult}'='0'}" call="SMS_GuaranteedPayment">
      <set item="Sender" value="${customer}" />
      <set item="Content" value="${sContent}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <retry delay="1" attempts="0" />
    <deliveryTemplate>
      <set item="Content" value="Извините. Информация временно недоступна." />
      <set item="Content" conditionEx="#{${dbresult}=320341}" value="Номер Вашего телефона не зарегистрирован" />
      <set item="Content" conditionEx="#{${dbresult}=320347}" value="Услуга не может быть предоставлена, потому что номер заблокирован" />
      <set item="Content" conditionEx="#{${dbresult}=320191}" value="Данный сервис недоступен. Ваш баланс #{number('${balance}') div 100} р." />
      <set item="Content" conditionEx="#{${dbresult}=320203}" value="Услуга не может быть предоставлена, предыдущий обещанный платеж не погашен или в процессе регистрации" />
      <set item="Content" conditionEx="#{${dbresult}=320111}" value="Указывайте сумму не превышающую #{${maximumusd} div 100} р." />
      <set item="Content" conditionEx="#{${dbresult}=320121}" value="Невозможно установить обещанный платеж" />
      <set item="Content" conditionEx="#{${dbresult}=320113}" value="Сумма обещанного платежа меньше минимально возможной" />
      <set item="Content" conditionEx="#{${dbresult}=330140}" value="Обратитесь к персональному менеджеру" />
      <set item="Content" conditionEx="#{${dbresult}=330141}" value="Превышено допустимое кол-во обещанных платежей" />
      <set item="Content" conditionEx="#{${dbresult}=330142}" value="Исчерпан лимит средств для ввода обещанного платежа" />
      <set item="Content" conditionEx="#{${dbresult}=330132}" value="Данный сервис недоступен. Ваш баланс #{number('${balance}') div 100} р." />
      <set item="Content" condition="//Item/@dbresult=-1" value="Срочный кредит не может быть принят." />
      <set item="Encoding" value="unicodefffe" />
      <set item="Sender" value="113" />
      <set item="Recipient" value="${customer}" />
    </deliveryTemplate>
  </template>
  <template procedureName="SMS_GuaranteedPayment">
    <condition>
      <test item="0" matches="1" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="ussd" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}">
          <Service id="guaranteedpayment" action="7">
            <Attribute name="amount" value="${Content}" />
            <Attribute name="currency" value="933" />
          </Service>
        </Item>
      </Message>
    </receiveTemplate>
    <retry delay="1" attempts="0" />
    <deliveryTemplate>
      <set item="Content" value="Извините. Информация временно недоступна." />
      <set item="Content" condition="//Item/@dbresult=0" value="Срочный кредит на сумму ${amount} р. принят." />
      <set item="Content" condition="//Item/@dbresult=320203" value="Регистрация запрещена - предыдущий обещанный платеж не оплачен." />
      <set item="Content" condition="//Item/@dbresult=320111" value="Превышена разрешенная сумма обещанного платежа." />
      <set item="Content" condition="//Item/@dbresult=320112" value="Срочный кредит недоступен." />
      <set item="Content" conditionEx="#{('${amount}' &gt; 0 and '${dbresult}'= 320113) }" value="Макс. сумма - ${amount} р. Для ввода наберите *114*сумма#." />
      <set item="Content" conditionEx="#{('${amount}' = 0 and '${dbresult}'= 320113) }" value="Услуга Вам недоступна.Воспользуйтесь ОП *113*сумма# (до 5 р.)" />
      <set item="Content" condition="//Item/@dbresult=320121" value="Платеж не может быть зарегистрирован." />
      <set item="Content" condition="//Item/@dbresult=320341" value="Нельзя ввести срочный кредит на Вашем тарифном плане." />
      <set item="Content" condition="//Item/@dbresult=320110" value="Минимальная сумма обещанного платежа 1 руб.Введите большую сумму." />
      <set item="Content" condition="//Item/@dbresult=-1" value="Срочный кредит не может быть принят." />
      <set item="Content" conditionEx="#{${dbresult}=320347}" value="Услуга не может быть предоставлена, потому что номер заблокирован" />
      <set item="Content" conditionEx="#{${dbresult}=320191}" value="Услуга не может быть предоставлена, недостаточно средств" />
      <set item="Encoding" value="unicodefffe" />
      <set item="Sender" value="113" />
      <set item="Recipient" value="${customer}" />
    </deliveryTemplate>
  </template>
  <template procedureName="GuaranteedPayment_moresumm">
    <condition>
      <test item="${Recipient}" matches="^113$" />
      <test item="${Content}" matches="^(([0-9]{3,5})|([4-9]{1}))$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Превышена разрешенная сумма обещанного платежа в 3 руб." />
      <set item="Sender" value="113" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="GuaranteedPayment_SyntaxError">
    <condition>
      <test item="${Recipient}" matches="^113$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Pozhaluista, posylaite tol'ko tsifry!" />
      <set item="Sender" value="113" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="ascii" />
    </deliveryTemplate>
  </template>
  <template procedureName="SMS_Check_GuaranteedPaymenttest" sessionLifetime="60">
    <condition>
      <test item="${Sender}" matches="^(375297776010)$" />
      <test item="${Recipient}" matches="^113$" />
      <test item="${Content}" matches="^[1-5]{1}$" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="ussd" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item customer="${Sender}">
          <Service id="guaranteedpayment" action="6" />
        </Item>
        @{store(sContent,#{number(${Content} * 100)})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'${dbresult}'='0'}" call="SMS_GuaranteedPaymenttest">
      <set item="Sender" value="${customer}" />
      <set item="Content" value="${sContent}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <retry delay="1" attempts="0" />
    <deliveryTemplate>
      <set item="Content" value="Услуга не предоставляется для тарифного плана." />
      <set item="Content" conditionEx="#{${dbresult}=320341}" value="Номер Вашего телефона не зарегистрирован" />
      <set item="Content" conditionEx="#{${dbresult}=320347}" value="Услуга не может быть предоставлена, потому что номер заблокирован" />
      <set item="Content" conditionEx="#{${dbresult}=320191}" value="Данный сервис недоступен. Ваш баланс #{number('${balance}') div 100} р." />
      <set item="Content" conditionEx="#{${dbresult}=320203}" value="Услуга не может быть предоставлена, предыдущий обещанный платеж не погашен или в процессе регистрации" />
      <set item="Content" conditionEx="#{${dbresult}=320111}" value="Указывайте сумму не превышающую #{${maximumusd} div 100} р." />
      <set item="Content" conditionEx="#{${dbresult}=320121}" value="Невозможно установить обещанный платеж" />
      <set item="Content" conditionEx="#{${dbresult}=320113}" value="Сумма обещанного платежа меньше минимально возможной" />
      <set item="Content" conditionEx="#{${dbresult}=330140}" value="Обратитесь к персональному менеджеру" />
      <set item="Content" conditionEx="#{${dbresult}=330141}" value="Превышено допустимое кол-во обещанных платежей" />
      <set item="Content" conditionEx="#{${dbresult}=330142}" value="Исчерпан лимит средств для ввода обещанного платежа" />
      <set item="Content" conditionEx="#{${dbresult}=330132}" value="Данный сервис недоступен. Ваш баланс #{number('${balance}') div 100} р." />
      <set item="Content" condition="//Item/@dbresult=-1" value="Срочный кредит не может быть принят." />
      <set item="Encoding" value="unicodefffe" />
      <set item="Sender" value="113" />
      <set item="Recipient" value="${customer}" />
    </deliveryTemplate>
  </template>
  <template procedureName="SMS_GuaranteedPaymenttest">
    <condition>
      <test item="0" matches="1" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="ussd" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}">
          <Service id="guaranteedpayment" action="7">
            <Attribute name="amount" value="${Content}" />
            <Attribute name="currency" value="933" />
          </Service>
        </Item>
      </Message>
    </receiveTemplate>
    <retry delay="1" attempts="0" />
    <deliveryTemplate>
      <set item="Content" value="Извините. Информация временно недоступна." />
      <set item="Content" condition="//Item/@dbresult=0" value="Срочный кредит на сумму ${amount} р. принят." />
      <set item="Content" condition="//Item/@dbresult=320203" value="Регистрация запрещена - предыдущий обещанный платеж не оплачен." />
      <set item="Content" condition="//Item/@dbresult=320111" value="Превышена разрешенная сумма обещанного платежа." />
      <set item="Content" condition="//Item/@dbresult=320112" value="Срочный кредит недоступен." />
      <set item="Content" conditionEx="#{('${amount}' &gt; 0 and '${dbresult}'= 320113) }" value="Макс. сумма - ${amount} р. Для ввода наберите *114*сумма#." />
      <set item="Content" conditionEx="#{('${amount}' = 0 and '${dbresult}'= 320113) }" value="Услуга Вам недоступна.Воспользуйтесь ОП *113*сумма# (до 5 р.)" />
      <set item="Content" condition="//Item/@dbresult=320121" value="Платеж не может быть зарегистрирован." />
      <set item="Content" condition="//Item/@dbresult=320341" value="Нельзя ввести срочный кредит на Вашем тарифном плане." />
      <set item="Content" condition="//Item/@dbresult=320110" value="Минимальная сумма обещанного платежа 1 руб.Введите большую сумму." />
      <set item="Content" condition="//Item/@dbresult=-1" value="Срочный кредит не может быть принят." />
      <set item="Content" conditionEx="#{${dbresult}=320347}" value="Услуга не может быть предоставлена, потому что номер заблокирован" />
      <set item="Content" conditionEx="#{${dbresult}=320191}" value="Услуга не может быть предоставлена, недостаточно средств" />
      <set item="Encoding" value="unicodefffe" />
      <set item="Sender" value="113" />
      <set item="Recipient" value="${customer}" />
    </deliveryTemplate>
  </template>
  <template procedureName="GuaranteedPayment_SyntaxErrortest">
    <condition>
      <test item="${Recipient}" matches="^839$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Произошла ошибка!" />
      <set item="Sender" value="113" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- ACHTUNG P-t-P -->
  <template procedureName="check_p2p">
    <condition>
      <test item="${Recipient}" matches="^363$" />
      <test item="${token0}" matches="^375(00|25|29|33|44)\d{7}$" />
      <test item="${token1}" matches="^[1-5]{1}$" />
      <!-- <test item="${token1}" matches="^[1-2]{1}$" /> -->
      <!-- <test item="${token1}" matches="^[0-9]{1,4}$" /> -->
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="ussd" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}">
          <Service id="movepaymentrequest" action="5">
            <Attribute name="receiver" value="${token0}" />
            <Attribute name="amount" value="${token1}" />
          </Service>
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="dbresult #{//Item/@dbresult}" />
      <set item="Content" condition="//Item/@dbresult='0'" value="Dlya podtwerjdeniya perevoda #{/Message/Item/Service/Attribute[@name='amount']/@value div 100} r. abonentu ${receiver} naberite *363*#{/Message/Item/Service/Attribute[@name='code']/@value}#" />
      <set item="Content" condition="//Item/@dbresult='-1'" value="Perevod nevozmojen, povtorite pozje" />
      <set item="Content" condition="//Item/@dbresult='320060'" value="U Vas net prav dlya obrabotki zaprosa." />
      <set item="Content" condition="//Item/@dbresult='320705'" value="Takaya zajavka ne budet obrabotana" />
      <set item="Content" condition="//Item/@dbresult='320704'" value="Prediduschaja zajavka ne obrabotana, povtorite pozje" />
      <set item="Content" condition="//Item/@dbresult='320999'" value="Srok dejstvija koda avtorizatsii istek" />
      <set item="Content" condition="//Item/@dbresult='320362'" value="U abonenta #{/Message/Item/Service/Attribute[@name='receiver']/@value} otkljuchena vozmozhnost priema P-t-P" />
      <set item="Content" condition="//Item/@dbresult='320703'" value="Nepravilno ukazan nomer poluchatelya" />
      <set item="Content" condition="//Item/@dbresult='320361'" value="Usluga zablokirovana, obratites v slujbu podderzhki" />
      <set item="Content" condition="//Item/@dbresult='320702'" value="Usluga zablokirovana, obratites v slujbu podderzhki" />
      <set item="Content" condition="//Item/@dbresult='320101'" value="Povtornij vvod informatsii, pojalujsta, sledujte instruktsii" />
      <set item="Content" condition="//Item/@dbresult='320714'" value="Dostignut predel chisla poluchatelej" />
      <set item="Content" condition="//Item/@dbresult='320710'" value="Slishkom malenkaja summa perevoda" />
      <set item="Content" condition="//Item/@dbresult='320701'" value="Slishkom bolshaja summa perevoda" />
      <set item="Content" condition="//Item/@dbresult='320711'" value="Ukazannaja summa previshaet limit perevodimih sredstv na segodnja" />
      <set item="Content" condition="//Item/@dbresult='320712'" value="Prevyshen limit dlya poluchatelya za sutki" />
      <set item="Content" condition="//Item/@dbresult='320713'" value="Nomer poluchatelja sovpadaet s Vashim nomerom, pojalujsta, povtorite vvod" />
      <set item="Content" condition="//Item/@dbresult='320709'" value="Usluga zablokirovana, obratites w slujbu podderzhki" />
      <set item="Content" condition="//Item/@dbresult='320191'" value="Na vashem schetu nedostatochno sredstv dlja perevoda abonentu #{/Message/Item/Service/Attribute[@name='receiver']/@value}" />
      <set item="Sender" value="363" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="iso-8859-1" />
    </deliveryTemplate>
  </template>
  <template procedureName="confirm_p2p">
    <condition>
      <test item="${Recipient}" matches="^363$" />
      <test item="${Content}" matches="^[0-9]{4}$" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="ussd" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}">
          <Service id="movepaymentacceptance" action="5">
            <Attribute name="code" value="${Content}" />
          </Service>
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="dbresult #{//Item/@dbresult}" />
      <set item="Content" condition="//Item/@dbresult='-1'" value="Perevod newozmojen, povtorite pozje" />
      <set item="Content" condition="//Item/@dbresult='0'" value="S Vashego litsevogo scheta perevedeno #{/Message/Item/Service/Attribute[@name='amount']/@value div 100} r. abonentu #{/Message/Item/Service/Attribute[@name='receiver']/@value}" />
      <set item="Content" condition="//Item/@dbresult='320666'" value="Nevernij kod awtorizatsii" />
      <set item="Content" condition="//Item/@dbresult='320704'" value="Prediduschaja zajavka ne obrabotana, povtorite pozje" />
      <set item="Content" condition="//Item/@dbresult='320999'" value="Srok dejstwija koda awtorizatsii istek" />
      <set item="Content" condition="//Item/@dbresult='320362'" value="U abonenta #{/Message/Item/Service/Attribute[@name='receiver']/@value} otkljuchena vozmozhnost priema P-t-P" />
      <set item="Content" condition="//Item/@dbresult='320361'" value="Usluga zablokirovana, obratites w slujbu podderzhki" />
      <set item="Content" condition="//Item/@dbresult='320101'" value="Powtornij vvod informatsii, pojalujsta, sledujte instruktsii" />
      <set item="Content" condition="//Item/@dbresult='320714'" value="Dostignut predel chisla poluchatelej" />
      <set item="Content" condition="//Item/@dbresult='320710'" value="Slishkom malenkaja summa perevoda" />
      <set item="Content" condition="//Item/@dbresult='320701'" value="Slishkom bolshaja summa perevoda" />
      <set item="Content" condition="//Item/@dbresult='320711'" value="Ukazannaja summa previshaet limit perevodimih sredstv na segodnja" />
      <set item="Content" condition="//Item/@dbresult='320712'" value="Prevyshen limit dlya poluchatelya za sutki" />
      <set item="Content" condition="//Item/@dbresult='320191'" value="Na vashem schetu nedostatochno sredstv dlja perevoda abonentu #{/Message/Item/Service/Attribute[@name='receiver']/@value}" />
      <set item="Content" condition="//Item/@dbresult='320713'" value="Nomer poluchatelja sovpadaet s Vashim nomerom, pojalujsta, povtorite vvod" />
      <set item="Content" condition="//Item/@dbresult='320709'" value="Usluga zablokirovana, obratites w slujbu podderzhki" />
      <set item="Sender" value="363" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="iso-8859-1" />
    </deliveryTemplate>
  </template>
  <template procedureName="rej_p2p">
    <condition>
      <test item="${Recipient}" matches="^363$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <!--<set item="Content" value="Oshibka v zaprose. Proverte i sozdayte zapros snova v formate:*363*375xxxxxxxxx*summa#"/> -->
      <set item="Content" value="korrektnyi format: *363*375xxxxxxxxx*summa(1-5 rub)#" />
      <set item="Recipient" value="${customer}" />
      <set item="Sender" value="363" />
      <set item="Encoding" value="iso-8859-1" />
    </deliveryTemplate>
  </template>
  <!-- ACHTUNG SPONSOR -->
  <template procedureName="add_sponsor">
    <condition>
      <test item="${Recipient}" matches="^373$" />
      <test item="${token0}" matches="^1$" />
      <test item="${token1}" matches="^\d{12}$" />
      <test item="${token2}" matches="^[0-9]{1,3}$" />
      <test item="${token3}" matches="^[0-9]{1,3}$" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="ussd" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}">
          <Service id="sponsorrequest" action="5">
            <Attribute name="receiver" value="${token1}" />
            <Attribute name="amount" value="${token2}" />
            <Attribute name="period" value="${token3}" />
            <Attribute name="metric" value="DAY" />
            <Attribute name="operation" value="${token0}" />
          </Service>
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="dbresult #{//Item/@dbresult}" />
      <set item="Content" condition="//Item/@dbresult='0'" value="Dlya podtwerjdeniya perevoda #{/Message/Item/Service/Attribute[@name='amount']/@value div 100} r. abonentu ${receiver} kajdie #{/Message/Item/Service/Attribute[@name='period']/@value} dn. prishlite kod #{/Message/Item/Service/Attribute[@name='code']/@value} na nomer 373" />
      <set item="Content" condition="//Item/@dbresult='-1'" value="Perevod nevozmojen, povtorite pozje" />
      <set item="Content" condition="//Item/@dbresult='320666'" value="Nevernij kod awtorizatsii" />
      <set item="Content" condition="//Item/@dbresult='320704'" value="Prediduschaja zajavka ne obrabotana, povtorite pozje" />
      <set item="Content" condition="//Item/@dbresult='320999'" value="Srok dejstvija koda avtorizatsii istek" />
      <set item="Content" condition="//Item/@dbresult='320362'" value="U abonenta #{/Message/Item/Service/Attribute[@name='receiver']/@value} otkljuchena vozmozhnost priema P-t-P" />
      <set item="Content" condition="//Item/@dbresult='320703'" value="U abonenta #{/Message/Item/Service/Attribute[@name='receiver']/@value} otkljuchena vozmozhnost priema P-t-P" />
      <set item="Content" condition="//Item/@dbresult='320361'" value="Usluga zablokirovana, obratites v slujbu podderzhki" />
      <set item="Content" condition="//Item/@dbresult='320702'" value="Usluga zablokirovana, obratites v slujbu podderzhki" />
      <set item="Content" condition="//Item/@dbresult='320101'" value="Povtornij vvod informatsii, pojalujsta, sledujte instruktsii" />
      <set item="Content" condition="//Item/@dbresult='320714'" value="Dostignut predel chisla poluchatelej" />
      <set item="Content" condition="//Item/@dbresult='320710'" value="Slishkom malenkaja summa perevoda" />
      <set item="Content" condition="//Item/@dbresult='320701'" value="Slishkom bolshaja summa perevoda" />
      <set item="Content" condition="//Item/@dbresult='320711'" value="Ukazannaja summa previshaet limit perevodimih sredstv na segodnja" />
      <set item="Content" condition="//Item/@dbresult='320712'" value="Prevyshen limit dlya poluchatelya za sutki" />
      <set item="Content" condition="//Item/@dbresult='320713'" value="Nomer poluchatelja sovpadaet s Vashim nomerom, pojalujsta, povtorite vvod" />
      <set item="Content" condition="//Item/@dbresult='320709'" value="Usluga zablokirovana, obratites w slujbu podderzhki" />
      <set item="Content" condition="//Item/@dbresult='320191'" value="Na vashem schetu nedostatochno sredstv dlja perevoda #{/Message/Item/Service/Attribute[@name='amount']/@value div 100} r. abonentu #{/Message/Item/Service/Attribute[@name='receiver']/@value}" />
      <set item="Sender" value="373" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="iso-8859-1" />
    </deliveryTemplate>
  </template>
  <template procedureName="del_sponsor">
    <condition>
      <test item="${Recipient}" matches="^373$" />
      <test item="${token0}" matches="^2$" />
      <test item="${token1}" matches="^\d{12}$" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="ussd" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}">
          <Service id="sponsorrequest" action="5">
            <Attribute name="receiver" value="${token1}" />
            <Attribute name="amount" value="0" />
            <Attribute name="period" value="0" />
            <Attribute name="metric" value="DAY" />
            <Attribute name="operation" value="${token0}" />
          </Service>
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="dbresult #{//Item/@dbresult}" />
      <set item="Content" condition="//Item/@dbresult='0'" value="Dlya otmeny perevodov abonentu ${receiver} prishlite kod #{/Message/Item/Service/Attribute[@name='code']/@value} na nomer 373" />
      <set item="Content" condition="//Item/@dbresult='-1'" value="Otmena perevoda nevozmojna, povtorite pozje" />
      <set item="Content" condition="//Item/@dbresult='320666'" value="Nevernij kod awtorizatsii" />
      <set item="Content" condition="//Item/@dbresult='320704'" value="Prediduschaja zajavka ne obrabotana, povtorite pozje" />
      <set item="Content" condition="//Item/@dbresult='320999'" value="Srok dejstvija koda avtorizatsii istek" />
      <set item="Content" condition="//Item/@dbresult='320362'" value="U abonenta #{/Message/Item/Service/Attribute[@name='receiver']/@value} otkljuchena vozmozhnost priema P-t-P" />
      <set item="Content" condition="//Item/@dbresult='320703'" value="U abonenta #{/Message/Item/Service/Attribute[@name='receiver']/@value} otkljuchena vozmozhnost priema P-t-P" />
      <set item="Content" condition="//Item/@dbresult='320361'" value="Usluga zablokirovana, obratites v slujbu podderzhki" />
      <set item="Content" condition="//Item/@dbresult='320702'" value="Usluga zablokirovana, obratites v slujbu podderzhki" />
      <set item="Content" condition="//Item/@dbresult='320101'" value="Povtornij vvod informatsii, pojalujsta, sledujte instruktsii" />
      <set item="Content" condition="//Item/@dbresult='320714'" value="Dostignut predel chisla poluchatelej" />
      <set item="Content" condition="//Item/@dbresult='320710'" value="Slishkom malenkaja summa perevoda" />
      <set item="Content" condition="//Item/@dbresult='320701'" value="Slishkom bolshaja summa perevoda" />
      <set item="Content" condition="//Item/@dbresult='320711'" value="Ukazannaja summa previshaet limit perevodimih sredstv na segodnja" />
      <set item="Content" condition="//Item/@dbresult='320712'" value="Prevyshen limit dlya poluchatelya za sutki" />
      <set item="Content" condition="//Item/@dbresult='320713'" value="Nomer poluchatelja sovpadaet s Vashim nomerom, pojalujsta, povtorite vvod" />
      <set item="Content" condition="//Item/@dbresult='320709'" value="Usluga zablokirovana, obratites w slujbu podderzhki" />
      <set item="Content" condition="//Item/@dbresult='320191'" value="Na vashem schetu nedostatochno sredstv dlja perevoda #{/Message/Item/Service/Attribute[@name='amount']/@value div 100} r. abonentu #{/Message/Item/Service/Attribute[@name='receiver']/@value}" />
      <set item="Sender" value="373" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="iso-8859-1" />
    </deliveryTemplate>
  </template>
  <template procedureName="confirm_sponsor">
    <condition>
      <test item="${Recipient}" matches="^373$" />
      <test item="${Content}" matches="^[0-9]{4}$" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="ussd" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}">
          <Service id="sponsoracceptance" action="5">
            <Attribute name="code" value="${Content}" />
          </Service>
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="dbresult #{//Item/@dbresult}" />
      <set item="Content" condition="//Item/@dbresult='-1'" value="Perevod newozmojen, povtorite pozje" />
      <set item="Content" condition="//Item/@dbresult='0'" value="Operacija dlja abonenta #{/Message/Item/Service/Attribute[@name='receiver']/@value} zaregistrirovana" />
      <set item="Content" condition="//Item/@dbresult='320666'" value="Nevernij kod awtorizatsii" />
      <set item="Content" condition="//Item/@dbresult='320704'" value="Prediduschaja zajavka ne obrabotana, povtorite pozje" />
      <set item="Content" condition="//Item/@dbresult='320999'" value="Srok dejstwija koda awtorizatsii istek" />
      <set item="Content" condition="//Item/@dbresult='320362'" value="U abonenta #{/Message/Item/Service/Attribute[@name='receiver']/@value} otkljuchena vozmozhnost priema P-t-P" />
      <set item="Content" condition="//Item/@dbresult='320361'" value="Usluga zablokirovana, obratites w slujbu podderzhki" />
      <set item="Content" condition="//Item/@dbresult='320101'" value="Powtornij vvod informatsii, pojalujsta, sledujte instruktsii" />
      <set item="Content" condition="//Item/@dbresult='320714'" value="Dostignut predel chisla poluchatelej" />
      <set item="Content" condition="//Item/@dbresult='320710'" value="Slishkom malenkaja summa perevoda" />
      <set item="Content" condition="//Item/@dbresult='320701'" value="Slishkom bolshaja summa perevoda" />
      <set item="Content" condition="//Item/@dbresult='320711'" value="Ukazannaja summa previshaet limit perevodimih sredstv na segodnja" />
      <set item="Content" condition="//Item/@dbresult='320712'" value="Prevyshen limit dlya poluchatelya za sutki" />
      <set item="Content" condition="//Item/@dbresult='320191'" value="Na vashem schetu nedostatochno sredstv dlja perevoda #{/Message/Item/Service/Attribute[@name='amount']/@value div 100} r. abonentu #{/Message/Item/Service/Attribute[@name='receiver']/@value}" />
      <set item="Content" condition="//Item/@dbresult='320713'" value="Nomer poluchatelja sovpadaet s Vashim nomerom, pojalujsta, povtorite vvod" />
      <set item="Content" condition="//Item/@dbresult='320709'" value="Usluga zablokirovana, obratites w slujbu podderzhki" />
      <set item="Sender" value="373" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="iso-8859-1" />
    </deliveryTemplate>
  </template>
  <template procedureName="rej_sponsor">
    <condition>
      <test item="${Recipient}" matches="^373$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Oshibka v zaprose - proverte i sozdayte zapros snova v formate:373*operacija*nomer*summa*period#" />
      <set item="Recipient" value="${customer}" />
      <set item="Sender" value="373" />
      <set item="Encoding" value="iso-8859-1" />
    </deliveryTemplate>
  </template>
  <template procedureName="CCP_canselreg">
    <condition>
      <test item="${Recipient}" matches="^297$" />
      <test item="${token0}" matches="^0$" />
    </condition>
    <receiveTemplate>
      <Message type="bankcardpayments" initiator="ussd" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}" subject="canselreg" datasource="cust">
          <Attribute name="pMSISDN" value="${Sender}" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="CRASH" />
      <set item="Content" condition="//Item/@dbresult='0'" value="DONE" />
      <set item="Content" condition="//Item/@dbresult='-20000'" value="param_invalid" />
      <set item="Content" condition="//Item/@dbresult='-20001'" value="msisdn_invalid" />
      <set item="Content" condition="//Item/@dbresult='-20002'" value="not_registered" />
      <set item="Content" condition="//Item/@dbresult='-20003'" value="only_one_msisdn_on_pa_available" />
      <set item="Content" condition="//Item/@dbresult='-20004'" value="pa_unknown" />
      <set item="Content" condition="//Item/@dbresult='-20005'" value="balance_storage_unknown" />
      <set item="Content" condition="//Item/@dbresult='-20006'" value="cannot_call_AM_BALANCE.UPDATE_BALANCE_LIMITS" />
      <set item="Content" condition="//Item/@dbresult='-20007'" value="service_closed" />
      <set item="Content" condition="//Item/@dbresult='-20008'" value="already_registered" />
      <set item="Content" condition="//Item/@dbresult='-20009'" value="already_registered" />
      <set item="Sender" value="297" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="CCP_changeatt">
    <condition>
      <test item="${Recipient}" matches="^297$" />
      <test item="${token0}" matches="^1$" />
      <test item="${token1}" matches="^[0-9]{1,3}$" />
    </condition>
    <receiveTemplate>
      <Message type="bankcardpayments" initiator="ussd" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}" subject="change" datasource="cust">
          <Attribute name="pMSISDN" value="${Sender}" />
          <Attribute name="pThreshold_Value" value="${token1}" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="CRASH" />
      <set item="Content" condition="//Item/@dbresult='0'" value="DONE" />
      <set item="Content" condition="//Item/@dbresult='-20000'" value="param_invalid" />
      <set item="Content" condition="//Item/@dbresult='-20001'" value="msisdn_invalid" />
      <set item="Content" condition="//Item/@dbresult='-20002'" value="not_registered" />
      <set item="Content" condition="//Item/@dbresult='-20003'" value="only_one_msisdn_on_pa_available" />
      <set item="Content" condition="//Item/@dbresult='-20004'" value="pa_unknown" />
      <set item="Content" condition="//Item/@dbresult='-20005'" value="balance_storage_unknown" />
      <set item="Content" condition="//Item/@dbresult='-20006'" value="cannot_call_AM_BALANCE.UPDATE_BALANCE_LIMITS" />
      <set item="Content" condition="//Item/@dbresult='-20007'" value="service_closed" />
      <set item="Content" condition="//Item/@dbresult='-20008'" value="already_registered" />
      <set item="Content" condition="//Item/@dbresult='-20009'" value="already_registered" />
      <set item="Sender" value="297" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="CCP_onepayment">
    <condition>
      <test item="${Recipient}" matches="^297$" />
      <test item="${token0}" matches="^[0-9]{1,3}$" />
    </condition>
    <receiveTemplate>
      <Message type="bankcardpayments" initiator="ussd" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}" subject="payment" datasource="cust">
          <Attribute name="pMSISDN" value="${Sender}" />
          <Attribute name="pAmount" value="${token0}" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="CRASH" />
      <set item="Content" condition="//Item/@dbresult='0'" value="DONE" />
      <set item="Content" condition="//Item/@dbresult='-20000'" value="param_invalid" />
      <set item="Content" condition="//Item/@dbresult='-20001'" value="msisdn_invalid" />
      <set item="Content" condition="//Item/@dbresult='-20002'" value="not_registered" />
      <set item="Content" condition="//Item/@dbresult='-20003'" value="only_one_msisdn_on_pa_available" />
      <set item="Content" condition="//Item/@dbresult='-20004'" value="pa_unknown" />
      <set item="Content" condition="//Item/@dbresult='-20005'" value="balance_storage_unknown" />
      <set item="Content" condition="//Item/@dbresult='-20006'" value="cannot_call_AM_BALANCE.UPDATE_BALANCE_LIMITS" />
      <set item="Content" condition="//Item/@dbresult='-20007'" value="service_closed" />
      <set item="Content" condition="//Item/@dbresult='-20008'" value="already_registered" />
      <set item="Content" condition="//Item/@dbresult='-20009'" value="already_registered" />
      <set item="Sender" value="297" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="CCP_wrongformat">
    <condition>
      <test item="${Recipient}" matches="^297$" />
    </condition>
    <receiveTemplate>
      <Message initiator="ussd" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="wrong format" />
      <set item="Sender" value="297" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- <template procedureName="personal_trash">
  	<condition>
		<test item="${Recipient}" matches="^839$" />
	</condition>
		<receiveTemplate>
		<Message> <Item customer="${Sender}" /> </Message>
       		</receiveTemplate>
	<deliveryTemplate direction="input">
		<set item="Content" value="ТЕСТ" />
		<set item="Recipient" value="${customer}" />
		<set item="Sender" value="839" />
		<set item="Encoding" value="unicodefffe" />
	</deliveryTemplate>
</template> -->
</templates>