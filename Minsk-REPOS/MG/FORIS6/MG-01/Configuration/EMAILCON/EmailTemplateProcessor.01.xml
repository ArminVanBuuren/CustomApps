<templates connector="Email">
  <template procedureName="SplittingPattern">
    <condition>
      <test item="${IsSplitted}" matches="1" />
    </condition>
    <receiveTemplate>
      <Message type="deliveryrequest" id="${id}" session_id="${sessionId}">
        <Package package_id="${PackageId}" template_id="email -2">
          <Item customer="${recipient}">
            <Content encoding="${MailEncoding}" charset="${MailCharSet}" contenttype="${ContentType}" subject="${Subject}" disposition="body">${BodyText}</Content>
            ${no-escape:attachmentBlock}
          </Item>
        </Package>
      </Message>
    </receiveTemplate>
    <deliveryTemplate />
  </template>
  <template procedureName="IncomingContent">
    <receiveTemplate>
      <Message type="incomingcontent" initiator="emailcon" id="${guid}">
        <Channel id="email" />
        <Item recipient="mgtw@mts.by" sender="${From}" senderaddress="${FromAddress}" timestamp="@{now}">
          <Content encoding="${MailEncoding}" charset="${MailCharSet}" contenttype="${ContentType}" subject="${Subject}" disposition="body">${BodyText}</Content>
          ${no-escape:attachmentBlock}
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate />
  </template>
  <template procedureName="DeliveryRequest" reportDelivery="true">
    <retry delay="14400" attempts="6" />
    <deliveryTemplate>
      <set item="BodyText" value="#{//Content[@disposition='body']}" />
      <set item="From" value="@{switch(${Sender}|${Sender},|mgtw@mts.by)}" />
      <set item="To" value="${Customer}" />
      <set item="ContentType" value="#{//Content[@disposition='body']/@type}" />
      <set item="MailEncoding" value="#{//Content[@disposition='body']/@encoding}" />
      <set item="MailCharSet" value="#{//Content[@disposition='body']/@charset}" />
      <set item="Subject" value="#{//Content[@disposition='body']/@subject}" />
    </deliveryTemplate>
  </template>
  <!-- sms email -->
  <template procedureName="SMS_email">
    <condition>
      <test item="0" matches="1" />
    </condition>
    <retry delay="14400" attempts="6" />
    <deliveryTemplate>
      <set item="BodyText" value="#{//Content[@disposition='body']}" />
      <set item="From" value="mgtw@mts.by" />
      <set item="To" value="${Customer}" />
      <set item="ContentType" value="#{//Content[@disposition='body']/@type}" />
      <set item="MailEncoding" value="8bit" />
      <set item="MailCharSet" value="#{//Content[@disposition='body']/@charset}" />
      <set item="Subject" value="#{//Content[@disposition='body']/@subject}" />
    </deliveryTemplate>
  </template>
  <template procedureName="SMS_email_08900">
    <condition>
      <test item="0" matches="1" />
    </condition>
    <retry delay="14400" attempts="6" />
    <deliveryTemplate>
      <set item="BodyText" value="#{//Content[@disposition='body']}" />
      <set item="From" value="mgtw@mts.by" />
      <set item="To" value="${Customer}" />
      <set item="ContentType" value="#{//Content[@disposition='body']/@type}" />
      <set item="MailEncoding" value="8bit" />
      <set item="MailCharSet" value="#{//Content[@disposition='body']/@charset}" />
      <set item="Subject" value="#{//Content[@disposition='body']/@subject}" />
    </deliveryTemplate>
  </template>
</templates>