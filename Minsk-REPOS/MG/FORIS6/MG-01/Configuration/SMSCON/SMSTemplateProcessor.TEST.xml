<templates connector="SMS">
  <macros>
    <define name="_mob_msisdn" value="^(375(25|29|33|44)\d{7})$" />
    <define name="_pass_num" value="^(\d{4,8})$" />
  </macros>
  <template procedureName="Get_PinPuk_OtherMSISDN_" handler="DBCON_01">
    <condition>
      <test item="${Recipient}" matches="^(839)$" />
      <test item="${Content}" matches="^(\s*375(25|29|33|44)\d{7}\s*\d{4,}\s*)$" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.ttt_get_pinpuk_othermsisdn_v2">
          <Attribute name="i_msisdn" type="STRING" value="${Sender}" />
          <Attribute name="i_content" type="STRING" value="${Content}" />
          <Attribute name="rez" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" condition="//Item/@dbresult='0'" value="${rez}" />
      <set item="Content" condition="//Item/@dbresult!='0'" value="Ошибка выполнения запроса." />
      <set item="Sender" value="839" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!--- Добавление технологического. НЕ удалять -->
  <!--- Добавление технологического. НЕ удалять -->
  <template procedureName="Add_srv_tech_" handler="DBCON_01">
    <condition>
      <test item="${Sender}" matches="^(375297776242|375297776319)$" />
      <test item="${Recipient}" matches="^(839)$" />
      <test item="${Token0}" matches="^(111)$" />
      <test item="${Token1}" matches="^\d{12}$" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="rep.addsrv_sychro_tech">
          <Attribute name="i_msisdn" type="STRING" value="${Token1}" />
          <Attribute name="o_rez" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" condition="//Item/@dbresult='0'" value="${o_rez}" />
      <set item="Content" condition="//Item/@dbresult!='0'" value="Ошибка выполнения запроса." />
      <set item="Sender" value="839" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!--- Добавление технологического. НЕ удалять -->
  <!--- Добавление технологического. НЕ удалять -->
  <!-- ############################  1982 TUT BY Testing  ####################### -->
</templates>