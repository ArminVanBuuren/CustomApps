<templates connector="SMS">
  #include "..\..\config\closed_user_group\cug_sms.xml"
  #include "..\..\config\get_bms_counters\sms.xml"
  <!-- #########################################    mts_3g_lite              ####################### -->
  <!-- #########################################    Unlim 710                ####################### -->
  <!-- #########################################    Unlim 720                ####################### -->
  <!-- #########################################    SmartBit 730             ####################### -->
  <!-- #########################################    530		               ####################### -->
  <!-- #########################################    510       			   ####################### -->
  <!-- #########################################    3000 Unlim Toning		   ####################### -->
  <!-- #########################################    714	turbo button	   ####################### -->
  <template procedureName="Add_Services_SMS_" handler="DBCON_01">
    <condition>
      <test item="${Recipient}" matches="^(2080|22371|372|373|374|375|376|790|710|720|730|740|530|510|3000|714|2020|2030|2200|7040|7050|7270)$" />
      <test item="${Token0}" matches="^(A|a)$" />
    </condition>
    <receiveTemplate conditionEx="#{('${Token0}' = A or '${Token0}'= a)}">
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.add_close_srv_req.add_srv_req">
          <Attribute name="p_msisdn" type="STRING" value="${Sender}" />
          <Attribute name="srv_del_str" type="STRING" value="@{switch(${Recipient}|FR10998,371|FR11607,372|FR11608,373|FR11609,374|FR11610,375|FR11648,376|FR11649,790|FR7476,710|FR5595,720|FR5596,730|FR8798,740|FR10361,530|FR15573,510|FR8765,3000|FR7783,714|FR5614,2020|FR9389,2030|FR9388,2200|FR11873,7040|FR11095,7050|FR10757,7270|FR12194)}" />
          <Attribute name="source" type="STRING" value="6" />
          <Attribute name="dbresult" type="STRING" />
          <Attribute name="reply" type="STRING" />
          <Attribute name="ret_code" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" condition="//Item/@dbresult='0'" value="${reply}" />
      <set item="Content" condition="//Item/@dbresult!='0'" value="Ошибка выполнения запроса." />
      <set item="Sender" value="${Recipient}" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="Rem_Services_SMS_" handler="DBCON_01">
    <condition>
      <test item="${Recipient}" matches="^(2080|371|372|373|374|375|376|790|710|720|730|740|530|510|1901|3000|2020|2030|2200|7040|7050|7270)$" />
      <test item="${Token0}" matches="^(R|r)$" />
    </condition>
    <receiveTemplate conditionEx="#{('${Token0}' = R or '${Token0}'= r)}">
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="BILLING.add_close_srv_req.del_srv_req">
          <Attribute name="p_msisdn" type="STRING" value="${Sender}" />
          <Attribute name="srv_del_str" type="STRING" value="@{switch(${Recipient}|FR10998,371|FR11607,372|FR11608,373|FR11609,374|FR11610,375|FR11648,376|FR11649,790|FR7476,710|FR5595,720|FR5596,730|FR8798,740|FR10361,530|FR15573,510|FR8765,1901|FR634,3000|FR7783,2020|FR9389,2030|FR9388,2200|FR11873,7040|FR11095,7050|FR10757,7270|FR12194)}" />
          <Attribute name="source" type="STRING" value="6" />
          <Attribute name="d_end" type="STRING" value="0" />
          <Attribute name="dbresult" type="STRING" />
          <Attribute name="reply" type="STRING" />
          <Attribute name="ret_code" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" condition="//Item/@dbresult='0'" value="${reply}" />
      <set item="Content" condition="//Item/@dbresult!='0'" value="Ошибка выполнения запроса." />
      <set item="Sender" value="${Recipient}" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="err-Add_Rem_Services_SMS" persistent="true" sessionStorage="Memory" sessionLifetime="60">
    <condition>
      <test item="${Recipient}" matches="^(2080|371|372|373|374|375|376|790|710|720|730|740|530|510|1901|3000|2020|2200|2030)$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Неверный формат запроса.Попробуйте еще раз." />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- ############################  Add Rem FR11841 (lesson english)  ####################### -->
  <template procedureName="Add_Lesson_English_SMS_" handler="DBCON_01">
    <condition>
      <test item="${Recipient}" matches="^(7090)$" />
      <test item="${Token0}" matches="^(A|a)$" />
    </condition>
    <receiveTemplate conditionEx="#{('${Token0}' = A or '${Token0}'= a)}">
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.mg_manageserviceenglish">
          <Attribute name="i_customer" type="STRING" value="${Sender}" />
          <Attribute name="i_servicecode" type="STRING" value="FR11841" />
          <Attribute name="i_operation" type="STRING" value="1" />
          <Attribute name="i_source" type="STRING" value="6" />
          <Attribute name="reply" type="STRING" />
          <Attribute name="dbresult" type="STRING" />
          <Attribute name="ret_code" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" condition="//Item/@dbresult='0'" value="${reply}" />
      <set item="Content" condition="//Item/@dbresult!='0'" value="Ошибка выполнения запроса." />
      <set item="Sender" value="${Recipient}" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="Rem_Lesson_English_SMS_" handler="DBCON_01">
    <condition>
      <test item="${Recipient}" matches="^(7090)$" />
      <test item="${Token0}" matches="^(R|r)$" />
    </condition>
    <receiveTemplate conditionEx="#{('${Token0}' = R or '${Token0}'= r)}">
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.mg_manageserviceenglish">
          <Attribute name="i_customer" type="STRING" value="${Sender}" />
          <Attribute name="i_servicecode" type="STRING" value="FR11841" />
          <Attribute name="i_operation" type="STRING" value="0" />
          <Attribute name="i_source" type="STRING" value="6" />
          <Attribute name="reply" type="STRING" />
          <Attribute name="dbresult" type="STRING" />
          <Attribute name="ret_code" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" condition="//Item/@dbresult='0'" value="${reply}" />
      <set item="Content" condition="//Item/@dbresult!='0'" value="Ошибка выполнения запроса." />
      <set item="Sender" value="${Recipient}" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="err-Add_Rem_Lesson_English_SMS_" persistent="true" sessionStorage="Memory" sessionLifetime="60">
    <condition>
      <test item="${Recipient}" matches="^(7090)$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Неверный формат запроса.Попробуйте еще раз." />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- ############################  VK 500Mb ####################### -->
  <template procedureName="VK_500MB_" handler="DBCON_02">
    <condition>
      <test item="${Recipient}" matches="^(3876)$" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="oms.adapters_in.create_synch_order">
          <Attribute name="i_ident" type="STRING" value="${Sender}" />
          <Attribute name="i_product" type="STRING" value="28" />
          <Attribute name="i_action" type="STRING" value="1" />
          <Attribute name="i_source_id" type="STRING" value="3" />
          <Attribute name="i_add_param" type="STRING" value="INPUTNUM=${Recipient};CODE=${Content}" />
          <Attribute name="o_order_id" type="STRING" />
          <Attribute name="o_result_code" type="STRING" />
          <Attribute name="o_result_msg" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{${dbresult}=0}">
      <set item="Content" condition="//Item/Attribute[@name='o_result_code']/@value='0'" value="${o_result_msg}" />
      <set item="Content" condition="//Item/Attribute[@name='o_result_code']/@value='1'" value="Заявка принята" />
      <set item="Content" condition="//Item/Attribute[@name='o_result_code']/@value='-1'" value="Услуга не доступна" />
      <set item="Sender" value="${Recipient}" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
    <deliveryTemplate conditionEx="#{${dbresult}!=0}">
      <set item="Content" condition="//Item/@dbresult!='0'" value="Ошибка выполнения запроса." />
      <set item="Sender" value="${Recipient}" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- ############################  WifiRequest ####################### -->
  <template procedureName="WifiRequest" handler="DBCON_02">
    <condition>
      <test item="${Recipient}" matches="^(9101|9103|9111|9112|9113|9114)$" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="wifi_alc.WiFiDispatcherTools.Wifi_Request">
          <Attribute name="p_msisdn" type="STRING" value="${Sender}" />
          <Attribute name="p_smstext" type="STRING" value="wifi" />
          <Attribute name="p_req_num" type="STRING" value="${Recipient}" />
          <Attribute name="p_source_id" type="STRING" value="6" />
          <Attribute name="o_rez" type="STRING" />
          <Attribute name="o_rez_txt" type="STRING" />
          <Attribute name="o_user" type="STRING" />
          <Attribute name="o_pass" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_rez']/@value}'='0'}">
      <set item="Content" condition="//Item/@dbresult='0'" value="${o_rez_txt}" />
      <set item="Content" condition="//Item/@dbresult!='0'" value="Данный запрос не может быть выполнен." />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="ascii" />
    </deliveryTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_rez']/@value}'='1'}">
      <set item="Content" condition="//Item/@dbresult='0'" value="${o_rez_txt}" />
      <set item="Content" condition="//Item/@dbresult!='0'" value="Данный запрос не может быть выполнен." />
      <set item="Sender" value="${Recipient}" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="ascii" />
    </deliveryTemplate>
  </template>
  <!-- ############################  Hei_Code ####################### закрылся -->
  <!--<template procedureName="Hei_Code_" handler="DBCON_01">
	<condition>
		<test item="${Recipient}" matches="^(6600)$" />
    </condition>
       <receiveTemplate>
		<Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{newGuid}">
				<Item procedureName="billing.MG_Hei_Code_Func" >
					<Attribute name="customer" type="STRING" value="${Sender}" />
					<Attribute name="rez" type="STRING" /> 
				</Item>
    	</Message>
		</receiveTemplate>
       <deliveryTemplate>
		<set item="Content" condition="//Item/@dbresult='0'" value="${rez}" />
		<set item="Content" condition="//Item/@dbresult!='0'" value="Ошибка выполнения запроса." />
		<set item="Sender" value="${Recipient}" />
		<set item="Recipient" value="${customer}" />
		<set item="Encoding" value="unicodefffe" />
       </deliveryTemplate>
   </template> 
  -->
  <!-- ############################  HR-BRAND-2014 ####################### -->
  <template procedureName="HR-BRAND-2014_" handler="DBCON_02">
    <condition>
      <test item="${Recipient}" matches="^(7271)$" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="oms.adapters_in.create_synch_order">
          <Attribute name="i_ident" type="STRING" value="${Sender}" />
          <Attribute name="i_product" type="STRING" value="28" />
          <Attribute name="i_action" type="STRING" value="1" />
          <Attribute name="i_source_id" type="STRING" value="3" />
          <Attribute name="i_add_param" type="STRING" value="CODE=${Content}" />
          <Attribute name="o_order_id" type="STRING" />
          <Attribute name="o_result_code" type="STRING" />
          <Attribute name="o_result_msg" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{${dbresult}=0}">
      <set item="Content" condition="//Item/Attribute[@name='o_result_code']/@value='0'" value="${o_result_msg}" />
      <set item="Content" condition="//Item/Attribute[@name='o_result_code']/@value='1'" value="Заявка принята" />
      <set item="Content" condition="//Item/Attribute[@name='o_result_code']/@value='-1'" value="Услуга не доступна" />
      <set item="Sender" value="${Recipient}" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
    <deliveryTemplate conditionEx="#{${dbresult}!=0}">
      <set item="Content" condition="//Item/@dbresult!='0'" value="Ошибка выполнения запроса." />
      <set item="Sender" value="${Recipient}" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- ############################  Action 50MB ####################### -->
  <template procedureName="Test_drive_mts_" handler="DBCON_02">
    <condition>
      <test item="${Recipient}" matches="^(7777)$" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="oms.adapters_in.create_synch_order">
          <Attribute name="i_ident" type="STRING" value="${Sender}" />
          <Attribute name="i_product" type="STRING" value="27" />
          <Attribute name="i_action" type="STRING" value="1" />
          <Attribute name="i_source_id" type="STRING" value="3" />
          <Attribute name="i_add_param" type="STRING" value="CODE=${Content}" />
          <Attribute name="o_order_id" type="STRING" />
          <Attribute name="o_result_code" type="STRING" />
          <Attribute name="o_result_msg" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{${dbresult}=0}">
      <set item="Content" condition="//Item/Attribute[@name='o_result_code']/@value='0'" value="${o_result_msg}" />
      <set item="Content" condition="//Item/Attribute[@name='o_result_code']/@value='1'" value="Заявка принята" />
      <set item="Content" condition="//Item/Attribute[@name='o_result_code']/@value='-1'" value="Услуга не доступна" />
      <set item="Sender" value="${Recipient}" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
    <deliveryTemplate conditionEx="#{${dbresult}!=0}">
      <set item="Content" condition="//Item/@dbresult!='0'" value="Ошибка выполнения запроса." />
      <set item="Sender" value="${Recipient}" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- ############################  2 line wait ####################### -->
  <template procedureName="2LineWait_" handler="DBCON_02">
    <condition>
      <test item="${Recipient}" matches="^(0861)$" />
      <test item="${Token0}" matches="^37500[0-9]{7}$" />
      <test item="${Token1}" matches="^[0-9]{1,7}$" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="oms.adapters_in.create_synch_order">
          <Attribute name="i_ident" type="STRING" value="${Sender}" />
          <Attribute name="i_product" type="STRING" value="115" />
          <Attribute name="i_action" type="STRING" value="1" />
          <Attribute name="i_source_id" type="STRING" value="3" />
          <Attribute name="i_add_param" type="STRING" value="IN_FTTX_MSISDN=${Token0};IN_FTTX_PWD=${Token1}" />
          <Attribute name="o_order_id" type="STRING" />
          <Attribute name="o_result_code" type="STRING" />
          <Attribute name="o_result_msg" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{${dbresult}=0}">
      <set item="Content" condition="//Item/Attribute[@name='o_result_code']/@value='0'" value="${o_result_msg}" />
      <set item="Content" condition="//Item/Attribute[@name='o_result_code']/@value='1'" value="Заявка принята" />
      <set item="Content" condition="//Item/Attribute[@name='o_result_code']/@value='-1'" value="Услуга не доступна" />
      <set item="Sender" value="${Recipient}" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
    <deliveryTemplate conditionEx="#{${dbresult}!=0}">
      <set item="Content" condition="//Item/@dbresult!='0'" value="Ошибка выполнения запроса." />
      <set item="Sender" value="${Recipient}" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="Err_2LineWait_" persistent="true" sessionStorage="Memory" sessionLifetime="60">
    <condition>
      <test item="${Recipient}" matches="^(0861)$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Неверный формат запроса. Попробуйте еще раз." />
      <set item="Sender" value="0861" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- ############################  Bonus_for_writer_ ####################### -->
  <template procedureName="Bonus_for_writer_" handler="DBCON_02">
    <condition>
      <test item="${Recipient}" matches="^(7575)$" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="oms.adapters_in.create_synch_order">
          <Attribute name="i_ident" type="STRING" value="${Sender}" />
          <Attribute name="i_product" type="STRING" value="27" />
          <Attribute name="i_action" type="STRING" value="1" />
          <Attribute name="i_source_id" type="STRING" value="3" />
          <Attribute name="i_add_param" type="STRING" value="INPUTNUM=${Recipient};CODE=${Content}" />
          <Attribute name="o_order_id" type="STRING" />
          <Attribute name="o_result_code" type="STRING" />
          <Attribute name="o_result_msg" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{${dbresult}=0}">
      <set item="Content" condition="//Item/Attribute[@name='o_result_code']/@value='0'" value="${o_result_msg}" />
      <set item="Content" condition="//Item/Attribute[@name='o_result_code']/@value='1'" value="Заявка принята" />
      <set item="Content" condition="//Item/Attribute[@name='o_result_code']/@value='-1'" value="Услуга не доступна" />
      <set item="Sender" value="${Recipient}" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
    <deliveryTemplate conditionEx="#{${dbresult}!=0}">
      <set item="Content" condition="//Item/@dbresult!='0'" value="Ошибка выполнения запроса." />
      <set item="Sender" value="${Recipient}" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- ############################  TP Internet Mini Midi Maxi ####################### -->
  <!--<template procedureName="Add_on_TP_Internet" handler="DBCON_01">
	<condition>
		<test item="${Recipient}" matches="^(317|318|319)$" />
		<test item="${Token0}" matches="^(A|a)$" />
    </condition>
       <receiveTemplate conditionEx="#{('${Content}' = A or '${Content}'= a)}" >
		<Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{newGuid}">
				<Item procedureName="billing.add_close_srv_req.add_srv_req" >
					<Attribute name="p_msisdn" type="STRING" value="${Sender}" />
					<Attribute name="srv_del_str" type="STRING" value="@{switch(${Recipient}|FR8280,318|FR8281,319|FR8282)}" /> 
					<Attribute name="source" type="STRING" value="6"/> 
					<Attribute name="dbresult" type="STRING" /> 
					<Attribute name="reply" type="STRING" /> 
					<Attribute name="ret_code" type="STRING" /> 					
				</Item>
    	</Message>
	</receiveTemplate>
       <deliveryTemplate>
		<set item="Content" condition="//Item/@dbresult='0'" value="${reply}" />
		<set item="Content" condition="//Item/@dbresult!='0'" value="Ошибка выполнения запроса." />
		<set item="Sender" value="${Recipient}" />
		<set item="Recipient" value="${customer}" />
		<set item="Encoding" value="unicodefffe" />
       </deliveryTemplate>
   </template>  -->
  <template procedureName="Del_on_TP_Internet" handler="DBCON_01">
    <condition>
      <test item="${Recipient}" matches="^(317|318|319)$" />
      <test item="${Token0}" matches="^(R|r)$" />
    </condition>
    <receiveTemplate conditionEx="#{('${Content}' = R or '${Content}'= r)}">
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="BILLING.add_close_srv_req.del_srv_req">
          <Attribute name="p_msisdn" type="STRING" value="${Sender}" />
          <Attribute name="srv_del_str" type="STRING" value="@{switch(${Recipient}|FR8280,318|FR8281,319|FR8282)}" />
          <Attribute name="source" type="STRING" value="6" />
          <Attribute name="d_end" type="STRING" value="0" />
          <Attribute name="dbresult" type="STRING" />
          <Attribute name="reply" type="STRING" />
          <Attribute name="ret_code" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" condition="//Item/@dbresult='0'" value="${reply}" />
      <set item="Content" condition="//Item/@dbresult!='0'" value="Ошибка выполнения запроса." />
      <set item="Sender" value="${Recipient}" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="err-TP_Internet_Services_SMS" persistent="true" sessionStorage="Memory" sessionLifetime="60">
    <condition>
      <test item="${Recipient}" matches="^(317|318|319)$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Неверный формат запроса.Попробуйте еще раз." />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- ############################  send_url ####################### -->
  <template procedureName="send_url">    - 		
    <condition>
      <test item="0" matches="1" />
    </condition>    - 	
    <receiveTemplate>
      <Message />
    </receiveTemplate>    - 	
    <deliveryTemplate>
      <set item="Content" value="${rez}" />
      <set item="Recipient" value="${Sender}" />
      <set item="Sender" value="0884" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="send_url_715_android">
    <condition>
      <test item="0" matches="1" />
    </condition>
    <receiveTemplate>
      <Message />
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="${rez}" />
      <set item="Recipient" value="${Sender}" />
      <set item="Sender" value="0884" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="send_url_717_tutby">
    <condition>
      <test item="0" matches="1" />
    </condition>
    <receiveTemplate>
      <Message />
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="${rez}" />
      <set item="Recipient" value="${Sender}" />
      <set item="Sender" value="0884" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="send_url_221_mts_tv">
    <condition>
      <test item="0" matches="1" />
    </condition>
    <receiveTemplate>
      <Message />
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="${rez}" />
      <set item="Recipient" value="${Sender}" />
      <set item="Sender" value="0884" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="My_MTS">
    <condition>
      <test item="0" matches="1" />
    </condition>
    <receiveTemplate>
      <Message />
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="${rez}" />
      <set item="Recipient" value="${Sender}" />
      <set item="Sender" value="0884" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="Send_sms_BOOKMATE">
    <condition>
      <test item="0" matches="1" />
    </condition>
    <receiveTemplate>
      <Message />
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="${rez}" />
      <set item="Recipient" value="${Sender}" />
      <set item="Sender" value="0884" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- ############################  send sms 34300 ####################### -->
  <template procedureName="send_url_34300_books">
    <condition>
      <test item="${Recipient}" matches="^34300$" />
      <test item="${Token0}" matches="^(books)$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" rez="Найдите книгу по душе! Михаил Булгаков, Джордж Мартин, Борис Акунин, Стивен Кинг, Макс Фрай и многие другие авторы в “Мобильной библиотеке МТС”. 3 дня бесплатно, далее — 0.2 р/сутки. Установите приложение: bm.gg/app" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input" terminating="true">
      <set item="Content" value="${rez}" />
      <set item="Sender" value="34300" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="send_url_34300_video">
    <condition>
      <test item="${Recipient}" matches="^34300$" />
      <test item="${Token0}" matches="^(video)$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" rez="Смотри любимые фильмы сутки напролет всего за 0.3 руб! БЕСПЛАТНЫЙ интернет-трафик! Набери *202# и пользуйся услугой Мобильное Кино уже сейчас! Подробнее на www.kino.mts.by" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input" terminating="true">
      <set item="Content" value="${rez}" />
      <set item="Sender" value="34300" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="send_url_34300_kino">
    <condition>
      <test item="${Recipient}" matches="^34300$" />
      <test item="${Token0}" matches="^(kino|kiosk)$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" rez="Читайте любимые журналы от ведущих издательств! Бесплатный интернет-трафик! Мода, стиль, бизнес, путешествия, дизайн и многое другое в вашем мобильном телефоне. 3 дня – бесплатно, далее - 0.25 р./ в стуки. Подключить: *565#" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input" terminating="true">
      <set item="Content" value="${rez}" />
      <set item="Sender" value="34300" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="err_send_url_34300">
    <condition>
      <test item="${Recipient}" matches="^34300$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Неверный формат запроса." />
      <set item="Sender" value="34300" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- ##################################################################### -->
  <!-- ############################  diler_bonus ####################### -->
  <template procedureName="diler_bonus_3545" handler="DBCON_01">
    <condition>
      <test item="${Recipient}" matches="^3545$" />
      <test item="${token0}" matches="^\d{20}$" />
    </condition>
    <receiveTemplate>
      <Message type="diler_bonus" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.dealer_bonus.mg_diler_bonus">
          <Attribute name="num" type="STRING" value="${Sender}" />
          <Attribute name="v_sim" type="STRING" value="${Token0}" />
          <Attribute name="msg" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" condition="//Item/@dbresult='0'" value="${msg}" />
      <set item="Content" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="Sender" value="3545" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="err_diler_bonus_3545">
    <condition>
      <test item="${Recipient}" matches="^3545$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Неверный формат запроса.Попробуйте еще раз." />
      <set item="Sender" value="3545" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- ############################  IP Fraud ####################### -->
  <template procedureName="IP_fraud_7776" handler="DBCON_01">
    <condition>
      <test item="${Recipient}" matches="^7776$" />
    </condition>
    <receiveTemplate>
      <Message type="is_fraud" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.tlk_add_msisdn_list_fraud">
          <Attribute name="customer" type="STRING" value="${Sender}" />
          <Attribute name="MSG" type="STRING" value="${Content}" />
          <Attribute name="SRC" type="STRING" value="6" />
          <Attribute name="rez" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" condition="//Item/@dbresult='0'" value="${rez}" />
      <set item="Content" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="Sender" value="7776" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- ############################  Is Fraud ####################### -->
  <template procedureName="is_fraud_2999" handler="DBCON_01">
    <condition>
      <test item="${Recipient}" matches="^2999$" />
    </condition>
    <receiveTemplate>
      <Message type="is_fraud" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.lll_is_frod">
          <Attribute name="num_0" type="STRING" value="${Sender}" />
          <Attribute name="passp_num" type="STRING" value="${Content}" />
          <Attribute name="msg" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" condition="//Item/@dbresult='0'" value="${msg}" />
      <set item="Content" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="Sender" value="2999" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- ############################  9999 zapros PUK ####################### -->
  <template procedureName="zapros_PUK" persistent="true" sessionStorage="Memory" sessionLifetime="60">
    <condition>
      <test item="${Recipient}" matches="^9999$" />
      <test item="${token0}" matches="^\d{12}$" />
    </condition>
    <receiveTemplate>
      <Message type="zapros_PUK" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}" str_in="${Content}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="${reply}" />
      <set item="Sender" value="9999" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="err-zapros_PUK" persistent="true" sessionStorage="Memory" sessionLifetime="60">
    <condition>
      <test item="${Recipient}" matches="^9999$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Неверный формат запроса.Попробуйте еще раз." />
      <set item="Sender" value="9999" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- ############################  9999 END ####################### -->
  <template procedureName="ussd_839_lopatov">    - 		
    <condition>
      <test item="0" matches="1" />
    </condition>    - 	
    <receiveTemplate>
      <Message />
    </receiveTemplate>    - 	
    <deliveryTemplate>
      <set item="Content" value="${reply}" />
      <set item="Recipient" value="${Sender}" />
      <set item="Sender" value="0884" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- ############################  1902 MObile TV ####################### -->
  <template procedureName="Add_Del_mobileTV_1">
    <condition>
      <test item="${Recipient}" matches="^(1902)$" />
      <test item="${Token0}" matches="^(1)$" />
      <test item="${Token1}" matches="^(M|m|N|n|D|d)" />
      <test item="${Token2}" matches="^(A|a|R|r)" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}">
          <Service id="@{switch(${Token1}|FR2643,m|FR2643,N|FR2644,n|FR2644,D|FR2645,d|FR2645)}" service_id="@{switch(${Token1}|FR2643,m|FR2643,N|FR2644,n|FR2644,D|FR2645,d|FR2645)}" action="@{switch(${Token2}|2,a|2,R|3,r|3)}" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="К сожалению, произошла ошибка. Попробуйте еще раз." />
      <set item="Content" condition="//Item/@dbresult=0" value="${msg}" />
      <set item="Content" condition="//Item/@dbresult=1" value="${msg}" />
      <set item="Content" condition="//Item/@dbresult=320191" value="На балансе недостаточно средств для проведения операции." />
      <set item="Content" condition="//Item/@dbresult=320174" value="Неверно задана операция." />
      <set item="Content" condition="//Item/@dbresult=320172" value="Неверно задана услуга." />
      <set item="Content" condition="//Item/@dbresult=320173" value="На тарифном плане нет данной услуги." />
      <set item="Content" condition="//Item/@dbresult=320203" value="Существует заявка на удаление услуги." />
      <set item="Content" condition="//Item/@dbresult=320204" value="Существует заявка на добавление услуги." />
      <set item="Content" condition="//Item/@dbresult=320205" value="услуга уже существует." />
      <set item="Content" condition="//Item/@dbresult=-1" value="Данный запрос не может быть выполнен." />
      <set item="Sender" value="1902" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="Add_Del_mobileTV_2">
    <condition>
      <test item="${Recipient}" matches="^(1902)$" />
      <test item="${Token0}" matches="^(2)$" />
      <test item="${Token1}" matches="^(M|m|N|n|D|d)" />
      <test item="${Token2}" matches="^(A|a|R|r)" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}">
          <Service id="@{switch(${Token1}|FR2646,m|FR2646,N|FR2647,n|FR2647,D|FR2648,d|FR2648)}" service_id="@{switch(${Token1}|FR2646,m|FR2646,N|FR2647,n|FR2647,D|FR2648,d|FR2648)}" action="@{switch(${Token2}|2,a|2,R|3,r|3)}" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="К сожалению, произошла ошибка. Попробуйте еще раз." />
      <set item="Content" condition="//Item/@dbresult=0" value="${msg}" />
      <set item="Content" condition="//Item/@dbresult=1" value="${msg}" />
      <set item="Content" condition="//Item/@dbresult=320191" value="На балансе недостаточно средств для проведения операции." />
      <set item="Content" condition="//Item/@dbresult=320174" value="Неверно задана операция." />
      <set item="Content" condition="//Item/@dbresult=320172" value="Неверно задана услуга." />
      <set item="Content" condition="//Item/@dbresult=320173" value="На тарифном плане нет данной услуги." />
      <set item="Content" condition="//Item/@dbresult=320203" value="Существует заявка на удаление услуги." />
      <set item="Content" condition="//Item/@dbresult=320204" value="Существует заявка на добавление услуги." />
      <set item="Content" condition="//Item/@dbresult=320205" value="услуга уже существует." />
      <set item="Content" condition="//Item/@dbresult=-1" value="Данный запрос не может быть выполнен." />
      <set item="Sender" value="1902" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- ############################  1982 TUT BY Testing  ####################### -->
  <template procedureName="Add_Del_tut_by">
    <condition>
      <test item="${Recipient}" matches="^(1982)$" />
      <test item="${Token0}" matches="^(M|m|N|n|D|d|A30|a30|A7|a7|A1|a1)" />
      <test item="${Token1}" matches="^(A|a|R|r)" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item customer="${Sender}">
          <Service id="@{switch(${Token0}|FR6628,m|FR6628,N|FR6627,n|FR6627,D|FR6626,d|FR6626,A30|FR6628,a30|FR6628,A7|FR6627,a7|FR6627,A1|FR6626,a1|FR6626)}" service_id="@{switch(${Token0}|FR6628,m|FR6628,N|FR6627,n|FR6627,D|FR6626,d|FR6626,A30|FR6628,a30|FR6628,A7|FR6627,a7|FR6627,A1|FR6626,a1|FR6626)}" action="@{switch(${Token1}|2,a|2,R|3,r|3)}" />
          @{store(sContent,${Content})}
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="${customer} @{now()} ${sContent} ${ret_code}" />
      <set item="Sender" value="1982" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="Add_Del_tut_by_subscriber">
    <condition>
      <test item="${Recipient}" matches="^(1982)$" />
      <test item="${Token0}" matches="^(A30|a30|A7|a7|A1|a1|R|r)" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item customer="${Sender}">
          <Service id="@{switch(${Token0}|FR6628,a30|FR6628,A7|FR6627,a7|FR6627,A1|FR6626,a1|FR6626,R|FR6628,r|FR6628)}" service_id="@{switch(${Token0}|FR6628,a30|FR6628,A7|FR6627,a7|FR6627,A1|FR6626,a1|FR6626,R|FR6628,r|FR6628)}" action="@{switch(${Token0}|2,a30|2,A7|2,a7|2,A1|2,a1|2,R|3,r|3)}" />
          @{store(sContent,${Content})}
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="${customer} @{now()} ${sContent} ${ret_code}" />
      <set item="Sender" value="1982" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- ############################  9851 3GTV mobile telecommunication  ####################### -->
  <template procedureName="Add_Del_3GTV">
    <condition>
      <test item="${Recipient}" matches="^(9851)$" />
      <test item="${Token0}" matches="^(D|d)" />
      <test item="${Token1}" matches="^(A|a|R|r)" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item customer="${Sender}">
          <Service id="FR6102" service_id="FR6102" action="@{switch(${Token1}|2,a|2,R|3,r|3)}" />
          @{store(sContent,${Content})}
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="${customer} @{now()} ${sContent} ${ret_code}" />
      <set item="Sender" value="9851" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="Add_Del_3GTV_subscriber">
    <condition>
      <test item="${Recipient}" matches="^(9851)$" />
      <test item="${Token0}" matches="^(A|a|R|r)" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item customer="${Sender}">
          <Service id="FR6102" service_id="FR6102" action="@{switch(${Token0}|2,a|2,R|3,r|3)}" />
          @{store(sContent,${Content})}
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="${customer} @{now()} ${sContent} ${ret_code}" />
      <set item="Sender" value="9851" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="SyntaxError_Add_Del_mobileTV">
    <condition>
      <test item="${Recipient}" matches="^(1982|9851)$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Отправляйте корректый шаблон" />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- WAP BF KINO MIX ITV BY -->
  <template procedureName="SMS_Serviceorder__ITV" sessionStorage="Memory" sessionLifetime="120">
    <condition>
      <test item="${Recipient}" matches="^(1902|1904)$" />
      <test item="${Content}" matches="^(A|a|R|r)$" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        @{store(sCnt,${Content})}
        @{store(sSrv,@{switch(${Recipient}|FR7343,1904|FR2035)})}
        <Item customer="${Sender}">
          <Service id="@{switch(${Recipient}|FR7343,1904|FR2035)}" service_id="@{switch(${Recipient}|FR7343,1904|FR2035)}" source="6" action="@{switch(${Content}|2,a|2,R|3,r|3)}" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="Ошибка при обработке услуги &quot;#{document('services.xml')/items/item[@id='${sSrv}']/@text}&quot;." />
      <set item="Content" condition="//Item/@dbresult=1" value="${msg}" />
      <set item="Content" condition="//Item/@dbresult=-1" value="Данный запрос не может быть выполнен." />
      <set item="Encoding" value="unicodefffe" />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="Content" value="Ошибка сервиса!" />
      <set item="Encoding" value="unicodefffe" />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
  </template>
  <!-- Типа обработчик ошибки 1902 1903 1904-->
  <template procedureName="WAP_ITV_SyntaxError">
    <condition>
      <test item="${Recipient}" matches="^(1902|1903|1904)$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Добавление или удаление услуги - латинская буква A или R." />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- ############################  125 kredit dov ####################### -->
  <template procedureName="kredit_dov" persistent="true" sessionStorage="Memory" sessionLifetime="60">
    <condition>
      <test item="${Recipient}" matches="^125$" />
      <test item="${Token0}" matches="^((A|a|R|r))$" />
    </condition>
    <receiveTemplate>
      <Message type="kredit_dov" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}" ac="@{switch(${Content}|1,a|1,R|0,r|0)}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value=" Информация недоступна." />
      <set item="Content" condition="//Item/@dbresult=0" value="${reply}" />
      <set item="Sender" value="125" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="err-kredit_dov" persistent="true" sessionStorage="Memory" sessionLifetime="60">
    <condition>
      <test item="${Recipient}" matches="^125$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Неверный формат запроса.Попробуйте еще раз." />
      <set item="Sender" value="125" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- ############################  1160 zadoljennost ####################### -->
  <template procedureName="rassrochka_passport_z" persistent="true" sessionStorage="Memory" sessionLifetime="60">
    <condition>
      <test item="${Recipient}" matches="^1160$" />
      <test item="${Token0}" matches="^[0-9]{1,7}$" />
      <test item="${Token1}" matches="^[0-9]{1,12}$" />
    </condition>
    <receiveTemplate>
      <Message type="rassrochka_pasport_z" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}" pass_n="${Token0}" pa_n="${Token1}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value=" Информация недоступна." />
      <set item="Content" condition="//Item/@dbresult=0" value="${reply}" />
      <set item="Sender" value="1160" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="err-rassrochka_pasport_z" persistent="true" sessionStorage="Memory" sessionLifetime="60">
    <condition>
      <test item="${Recipient}" matches="^1160$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Неверный запрос!Формат:Νпаспорта*Νлицевого счета" />
      <set item="Sender" value="1160" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- ############################  0877 balance_other_num ####################### -->
  <template procedureName="balance_other_num" persistent="true" sessionStorage="Memory" sessionLifetime="60">
    <condition>
      <test item="${Recipient}" matches="^0877$" />
      <test item="${token0}" matches="^\d{12}$" />
    </condition>
    <receiveTemplate>
      <Message type="bal_other_num" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}" str_in="${Content}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="${reply}" />
      <set item="Sender" value="0877" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="err-balance_other_num" persistent="true" sessionStorage="Memory" sessionLifetime="60">
    <condition>
      <test item="${Recipient}" matches="^0877$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Неверный формат запроса.Попробуйте еще раз." />
      <set item="Sender" value="0877" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- ############################  0877 END ####################### -->
  <!-- ############################  721 ####################### -->
  <!--  <template procedureName="Check_Change_TP_skidka" sessionLifetime="60" >
	<condition>
		<test item="${Recipient}" matches="^(721)$" />
	</condition>
        <receiveTemplate>
          <Message type="serviceinterrogation" initiator="smscon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
            <Item customer="${Sender}" datasource="state">
                <Service id="FR2507" Service_id="FR2507" action="interrogation"/>
            </Item>
          </Message>
       </receiveTemplate>
	<deliveryTemplate conditionEx="#{('${subscription}' = 1 and '${dbresult}'= 0) }" call="Check_Tariff_Plan">
		<set item="Sender" value="${customer}" />
		<set conditionEx="0@{freeSession}" />
	</deliveryTemplate>
   <retry delay="1" attempts="0" />
	<deliveryTemplate>
			<set item="Content" value="К сожалению, произошла ошибка. Попробуйте еще раз." /> 
			<set item="Content" condition="//Item/@dbresult='320341'" value="Вам не доступна льготная смена ТП" /> 
			<set item="Content" condition="//Item/@dbresult='320191'" value="Вам не доступна льготная смена ТП" /> 
			<set item="Content" condition="//Item/@dbresult='320204'" value="Вам не доступна льготная смена ТП" />
			<set item="Content" condition="//Item/@dbresult='320282'" value="Вам не доступна льготная смена ТП" /> 
			<set item="Content" condition="//Item/@dbresult='0'" value="Вам не доступна льготная смена ТП" /> 
            <set item="Encoding" value="unicodefffe" />
            <set item="Sender" value="721" />
            <set item="Recipient" value="${customer}" />
       </deliveryTemplate>
    </template> -->
  <template procedureName="PreCheck_Change_TP_" sessionLifetime="60">
    <condition>
      <test item="${Recipient}" matches="^(721)$" />
    </condition>
    <receiveTemplate>
      <Message type="TP_prechange_check" initiator="smscon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item customer="${Sender}" datasource="state" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{('${dbresult}'= 0) }" call="Check_Tariff_Plan">
      <set item="Sender" value="${customer}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <retry delay="1" attempts="0" />
    <deliveryTemplate>
      <set item="Content" value="К сожалению, произошла ошибка. Попробуйте еще раз." />
      <set item="Content" condition="//Item/@dbresult='15'" value="Есть незавершенные заявки на смену ТП" />
      <set item="Content" condition="//Item/@dbresult='20'" value="К сожалению, произошла ошибка. Попробуйте еще раз." />
      <set item="Encoding" value="unicodefffe" />
      <set item="Sender" value="721" />
      <set item="Recipient" value="${customer}" />
    </deliveryTemplate>
  </template>
  <template procedureName="Check_Tariff_Plan">
    <condition>
      <test item="0" matches="1" />
    </condition>
    <receiveTemplate>
      <Message type="verificationrequest" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}" datasource="state">
          <Attribute name="checkblocks" value="1" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{('${tariffplan}' &lt; '100' )}" call="Change_TP_ST">
      <set item="Sender" value="${customer}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate conditionEx="#{('${tariffplan}' &gt; '100' )}" call="Change_TP_IN">
      <set item="Sender" value="${customer}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="Content" value="К сожалению, произошла ошибка. Попробуйте еще раз." />
      <set item="Content" condition="//Item/@dbresult='320341'" value="Произошла ошибка. Попробуйте через 10 минут." />
      <set item="Content" condition="//Item/@dbresult='320191'" value="Произошла ошибка. Попробуйте через 10 минут." />
      <set item="Content" condition="//Item/@dbresult='320204'" value="Произошла ошибка. Попробуйте через 10 минут." />
      <set item="Content" condition="//Item/@dbresult='320282'" value="Произошла ошибка. Попробуйте через 10 минут." />
      <set item="Content" condition="//Item/@dbresult='0'" value="Произошла ошибка. Попробуйте через 10 минут." />
      <set item="Encoding" value="unicodefffe" />
      <set item="Sender" value="721" />
      <set item="Recipient" value="${customer}" />
    </deliveryTemplate>
  </template>
  <template procedureName="Change_TP_ST">
    <condition>
      <test item="0" matches="1" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}" datasource="state">
          <Service id="changetariffplan" service_id="changetariffplan" action="0" class="74" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate dropReply="true" />
  </template>
  <template procedureName="Change_TP_IN">
    <condition>
      <test item="0" matches="1" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}" datasource="state">
          <Service id="changetariffplan" service_id="changetariffplan" action="0" class="174" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate dropReply="true" />
  </template>
  <!--  ################### END  ########### -->
  <!-- #########################################    ADD_DEL_SERVICE            ######################################## -->
  <!-- #########################################    510 - unlim from phone     ######################################## -->
  <!-- #########################################    MTS Connect 0.1, 0.5, 1, 2, 3, 5 Gb add/del/syntax  ############### -->
  <!-- #########################################    Jivoi balans sms 500     ########################################## -->
  <!-- #########################################    Roaming 0870246 ################################################### -->
  <!-- #########################################    HyperNet 330      ################################################# -->
  <!-- #########################################    InterNight 320    ################################################# -->
  <!-- #########################################    SMS_roaming 0870249           ##################################### -->
  <template procedureName="Add_Del_service">
    <condition>
      <test item="${Recipient}" matches="^(311|312|313|314|315|316|500|0870246|330|320|0870249)$" />
      <test item="${Token0}" matches="^(A|a|R|r)$" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}">
          <Service id="@{switch(${Recipient}|FR1949,312|FR1950,313|FR1951,314|FR1952,315|FR1953,316|FR1954,500|SCP1006,0870246|CB123,330|FR511001,320|FR107700,0870249|CB403864)}" service_id="@{switch(${Recipient}|FR1949,312|FR1950,313|FR1951,314|FR1952,315|FR1953,316|FR1954,500|SCP1006,0870246|CB123,330|FR511001,320|FR107700,0870249|CB403864)}" action="@{switch(${Token0}|2,a|2,R|3,r|3)}" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="К сожалению, произошла ошибка. Попробуйте еще раз." />
      <set item="Content" condition="//Item/@dbresult=0" value="${msg}" />
      <set item="Content" condition="//Item/@dbresult=1" value="${msg}" />
      <set item="Content" condition="//Item/@dbresult=320191" value="На балансе недостаточно средств для проведения операции." />
      <set item="Content" condition="//Item/@dbresult=320174" value="Неверно задана операция." />
      <set item="Content" condition="//Item/@dbresult=320172" value="Неверно задана услуга." />
      <set item="Content" condition="//Item/@dbresult=320173" value="На тарифном плане нет данной услуги." />
      <set item="Content" condition="//Item/@dbresult=320203" value="Существует заявка на удаление услуги." />
      <set item="Content" condition="//Item/@dbresult=320204" value="Существует заявка на добавление услуги." />
      <set item="Content" condition="//Item/@dbresult=320205" value="услуга уже существует." />
      <set item="Content" condition="//Item/@dbresult=-1" value="Данный запрос не может быть выполнен." />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="SyntaxError_Add_Del_service">
    <condition>
      <test item="${Recipient}" matches="^(311|312|313|314|315|316|500|0870246|330|320)$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Отправляйте латинские буквы A или R" />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- #########################################    Add_Del_Service end    ######################## -->
  <!-- #########################################    ONLY_ADD_Service     ####################################### -->
  <!-- #########################################    InterNight 322     ######################################### -->
  <!-- #########################################    МТС Wi-Fi 500,1000 391,392    ############################## -->
  <!-- #########################################    MMS пакет 10,25, MMS drive 383,384,385    ################## -->
  <template procedureName="Add_Service">
    <condition>
      <test item="${Recipient}" matches="^(322|391|392|383|384|385|0870249)$" />
      <test item="${Token0}" matches="^(A|a)$" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}">
          <Service id="@{switch(${Recipient}|FR1960,391|FR892,392|FR893,383|FR882,384|FR883,385|FR884)}" service_id="@{switch(${Recipient}|FR1960,391|FR892,392|FR893,383|FR882,384|FR883,385|FR884)}" action="@{switch(${Token0}|2,a|2)}" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="К сожалению, произошла ошибка. Попробуйте еще раз." />
      <set item="Content" condition="//Item/@dbresult=1" value="${msg}" />
      <set item="Content" condition="//Item/@dbresult=0" value="${msg}" />
      <set item="Content" condition="//Item/@dbresult=-1" value="Данный запрос не может быть выполнен." />
      <set item="Content" condition="//Item/@dbresult=320191" value="На балансе недостаточно средств для проведения операции." />
      <set item="Content" condition="//Item/@dbresult=320174" value="Неверно задана операция." />
      <set item="Content" condition="//Item/@dbresult=320172" value="Неверно задана услуга." />
      <set item="Content" condition="//Item/@dbresult=320173" value="На тарифном плане нет данной услуги." />
      <set item="Content" condition="//Item/@dbresult=320203" value="Существует заявка на удаление услуги." />
      <set item="Content" condition="//Item/@dbresult=320204" value="Существует заявка на добавление услуги." />
      <set item="Content" condition="//Item/@dbresult=320205" value="услуга уже существует." />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="SyntaxError_Add_Service">
    <condition>
      <test item="${Recipient}" matches="^(322|391|392|383|384|385|0870249)$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Отправляйте латинские буквы" />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- #########################################    Add_Service end    ################################################# -->
  <!-- #########################################     sms WIFI MTS 351 353     ######################################### -->
  <template procedureName="mg_del_351_353" persistent="true" sessionStorage="Memory" sessionLifetime="60">
    <condition>
      <test item="${Recipient}" matches="^(351|353)$" />
      <test item="${Content}" matches="^0$" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item customer="${Sender}">
          <Service id="@{switch(${Recipient}|FR1871,353|FR1872)}" service_id="@{switch(${Recipient}|FR1871,353|FR1872)}" action="3" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="K sozhaleniyu, proizoshla oshibka. Poprobuyte eshe raz." />
      <set item="Content" condition="//Item/@dbresult=1" value="${msg}" />
      <set item="Sender" value="${Recipient}" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="ascii" />
    </deliveryTemplate>
  </template>
  <template procedureName="mg_add_351_353" persistent="true" sessionStorage="Memory" sessionLifetime="60">
    <condition>
      <test item="${Recipient}" matches="^(351|353)$" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item customer="${Sender}">
          <Service id="@{switch(${Recipient}|FR1871,353|FR1872)}" service_id="@{switch(${Recipient}|FR1871,353|FR1872)}" action="2" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="K sozhaleniyu, proizoshla oshibka. Poprobuyte eshe raz." />
      <set item="Content" condition="//Item/@dbresult=1" value="${msg}" />
      <set item="Sender" value="${Recipient}" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="ascii" />
    </deliveryTemplate>
  </template>
  <!-- #########################################         end           ##################################################### -->
  <!-- ######################################### Rassrochka passport 7910 ##################################################### -->
  <template procedureName="rassrochka_passport_7910" persistent="true" sessionStorage="Memory" sessionLifetime="60">
    <condition>
      <test item="${Recipient}" matches="^7910$" />
      <test item="${Token0}" matches="^[A-Za-zа-яА-Я]{2}[0-9]{7}$" />
      <test item="${Token1}" matches="^[0-9]{1,7}$" />
      <test item="${Token2}" matches="^(0|1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20)$" />
      <test item="${Token3}" matches="^[0-9]{1,4}$" />
    </condition>
    <receiveTemplate>
      <Message type="rassrochka_pasport" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}" num_pr="${Token1}" pass_n="${Token0}" cod_o="${Token2}" sum_o="${Token3}" src_con="SMS" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value=" Информация недоступна." />
      <set item="Content" condition="//Item/@dbresult=0" value="${reply}" />
      <set item="Sender" value="7910" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="err-rassrochka_pasport_7910" persistent="true" sessionStorage="Memory" sessionLifetime="60">
    <condition>
      <test item="${Recipient}" matches="^7910$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Неверный запрос!Формат:серияΝпаспорта*Νтелефона(7цифр)*код_оборудования*сумма." />
      <set item="Sender" value="7910" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- #########################################         end           ##################################################### -->
  <!-- ######################################### Fiktivnaia oplata ZHKH 5676 s 19.04 po 24.04 ############################# -->
  <template procedureName="FiktivnaiaOplataZHKH">
    <condition>
      <test item="${Recipient}" matches="^5676$" />
      <test item="${Token0}" matches="^90520$" />
      <test item="${Token1}" matches="^10104377$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Платёж в пользу ЖКХ в размере 9.05 рублей принят. Код: 4597" />
      <set item="Sender" value="5676" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="FiktivnaiaOplataZHKH_syntaxError">
    <condition>
      <test item="${Recipient}" matches="^5676$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Неверный SMS-запрос. Платёж не может быть проведён." />
      <set item="Sender" value="5676" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- #################################################################################################################### -->
  <!-- Отправка смс на емэйл   -->
  <template procedureName="SMS_email_08900">
    <condition>
      <test item="${Recipient}" matches="^(08900)$" />
    </condition>
    <receiveTemplate>
      <Message type="deliveryrequest" id="${guid}" session_id="@{newGuid}">
        <Package package_id="@{newGuid}" template_id="email -2">
          <Item customer="0890@mts.by" recipient="${Sender}">
            <Content disposition="body" type="text/plain" encoding="Base64" charset="Windows-1251" subject="08900 SMS from number ${Sender}.">${Sender} ${Content}</Content>
          </Item>
        </Package>
      </Message>
    </receiveTemplate>
    <deliveryTemplate terminating="true">
      <set item="Content" value="Vasha zajavka prinjata." />
      <set item="Recipient" value="${recipient}" />
      <set item="Sender" value="08900" />
      <set item="Encoding" value="iso-8859-1" />
    </deliveryTemplate>
    <deliveryTemplate direction="input" connector="EMAILCON_01" />
  </template>
  <template procedureName="SMS_email">
    <condition>
      <test item="${Recipient}" matches="^(08901)$" />
    </condition>
    <receiveTemplate>
      <Message type="deliveryrequest" id="${guid}" session_id="@{newGuid}">
        <Package package_id="@{newGuid}" template_id="email -2">
          <Item customer="ishop@mts.by" recipient="${Sender}">
            <Content disposition="body" type="text/plain" encoding="Base64" charset="Windows-1251" subject="SMS2EMAIL from number ${Sender}.">
              ${Sender} ${Content}
            </Content>
          </Item>
        </Package>
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input" terminating="false">
      <set item="Content" value="Vasha zajavka prinjata. Dlja utochnenija detalej sotrudnik MTS svjazhetsja s Vami s 09.00 do 21.00." />
      <set item="Recipient" value="${recipient}" />
      <set item="Sender" value="08901" />
      <set item="Encoding" value="iso-8859-1" />
    </deliveryTemplate>
    <deliveryTemplate direction="input" connector="EMAILCON_01" />
  </template>
  <!-- Добавление Рассрочка -->
  <template procedureName="rassrochka_1155" handler="DBCON_01">
    <condition>
      <test item="${Recipient}" matches="^1155$" />
      <test item="${token0}" matches="^\d{12}$" />
    </condition>
    <receiveTemplate>
      <Message type="rassrochka" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.mg_lll_rassrochka">
          <Attribute name="p_msisdn_in" type="STRING" value="${Sender}" />
          <Attribute name="pa_num" type="STRING" value="${Token0}" />
          <Attribute name="msg" type="STRING" />
          <Attribute name="dbresult" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" condition="//Item/@dbresult='0'" value="${msg}" />
      <set item="Content" condition="//Item/@dbresult!='0'" value="Данный запрос не может быть выполнен." />
      <set item="Sender" value="1155" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="rassrochka_1155_help" handler="DBCON_01">
    <condition>
      <test item="${Recipient}" matches="^1155$" />
      <test item="${token0}" matches="^{0,11}$" />
    </condition>
    <receiveTemplate>
      <Message type="rassrochka" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.mg_lll_rassrochka">
          <Attribute name="p_msisdn_in" type="STRING" value="${Sender}" />
          <Attribute name="pa_num" type="STRING" value="help" />
          <Attribute name="msg" type="STRING" />
          <Attribute name="dbresult" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" condition="//Item/@dbresult='0'" value="${msg}" />
      <set item="Content" condition="//Item/@dbresult!='0'" value="Данный запрос не может быть выполнен." />
      <set item="Sender" value="1155" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- Типа обработчик ошибки 1155 -->
  <template procedureName="rassrochka_SyntaxError">
    <condition>
      <test item="${Recipient}" matches="^(1155)$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Запрос выполнить не удалось." />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- Bonus Test   -->
  <template procedureName="Bonus_test">
    <condition>
      <test item="${Recipient}" matches="^90016$" />
    </condition>
    <receiveTemplate>
      <Message type="Bonus_test" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="К сожалению, произошла ошибка. Попробуйте еще раз." />
      <set item="Content" condition="//Item/@dbresult='0'" value="${reply}" />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- Список услуг    -->
  <template procedureName="List_service_customer">
    <condition>
      <test item="${Sender}" matches="^(375292504781|375297776227|375297776114|375297776480|375297776687|375297003002)$" />
      <test item="${Recipient}" matches="^(0870|0880|087011|900014)$" />
    </condition>
    <receiveTemplate>
      <Message type="List_service" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="К сожалению, произошла ошибка. Попробуйте еще раз." />
      <set item="Content" condition="//Item/@dbresult='0'" value="${reply}" />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!--  Активация КЭО на др. абонента  -->
  <template procedureName="KEO_PtP_1" persistent="true">
    <condition>
      <test item="${Recipient}" matches="^0850$" />
      <test item="${token0}" matches="^\d{14}$" />
      <test item="${token1}" matches="^\d{12}$" />
    </condition>
    <receiveTemplate>
      <Message type="verificationrequest" initiator="smscon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item customer="${token1}" datasource="state">
          <Attribute name="checkblocks" value="1" />
          @{store(storedCustomer,${Sender})}
          @{store(sContent,${Content})}
        </Item>
      </Message>
    </receiveTemplate>
    <retry delay="1" attempts="0" />
    <deliveryTemplate conditionEx="#{('${dbresult}' = 0 or '${dbresult}'= 320343 ) }" call="KEO_PtP_2_">
      <set item="Sender" value="${storedCustomer}" />
      <set item="Content" value="${sContent}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="Content" value="K sozhaleniyu, proizoshla oshibka. Obratites v abonentskiy otdel." />
      <set item="Content" condition="//Item/@dbresult=320341" value="Nevernii nomer poluchatelia platezha." />
      <set item="Content" condition="//Item/@dbresult=-1" value="Zapros ne mojet bit' obrabotan." />
      <set item="Encoding" value="ascii" />
      <set item="Sender" value="0850" />
      <set item="Recipient" value="${Sender}" />
    </deliveryTemplate>
  </template>
  <template procedureName="KEO_PtP_2_" persistent="true" sessionStorage="Memory" sessionLifetime="60">
    <condition>
      <test item="0" matches="1" />
    </condition>
    <receiveTemplate>
      <Message type="vmaspayment" id="${guid}" initiator="SMS" session_id="@{newGuid}">
        <Item>
          <Attribute name="payer" value="${Sender}" />
          <Attribute name="receiver" value="${token1}" />
          <Attribute name="pin" value="${token0}" />
          <Attribute name="network_operator_code" value="BELORUSSIA" />
          <Attribute name="operator_id" value="6" />
        </Item>
      </Message>
    </receiveTemplate>
    <retry delay="1" attempts="0" />
    <deliveryTemplate>
      <set item="Content" value="K sozhaleniyu, proizoshla oshibka. Obratites v abonentskiy otdel." />
      <set item="Content" condition="//Item/@dbresult='AUTH_FAILED'" value="Vveden nepravilniy PIN-kod. Povtorite popitku." />
      <set item="Content" condition="//Item/@dbresult='AUTH_DEVICE_BLACKLISTED'" value="Activacija nevozmozhna. Obratites v Kontaktniy centr po tel. 0890." />
      <set item="Content" condition="//Item/@dbresult='AUTH_GENERAL_COUNTER_MAX'" value="Activacija nevozmozhna. Obratites v Kontaktniy centr po tel. 0890." />
      <set item="Content" condition="//Item/@dbresult='AUTH_SESSION_COUNTER_MAX'" value="Activacija nevozmozhna. Obratites v Kontaktniy centr po tel. 0890." />
      <set item="Content" condition="//Item/@dbresult='AUTH_DEVICE_NOT_FOUND_IN_RI'" value="Activacija nevozmozhna. Obratites v Kontaktniy centr po tel. 0890." />
      <set item="Content" condition="//Item/@dbresult='AUTH_CARD_BLOCKED'" value="Karta zablokirovana. Obratites v Kontaktniy centr po tel. 0890." />
      <set item="Content" condition="//Item/@dbresult='AUTH_CARD_EXPIRED'" value="Istek srok deystviya karti. Obratites v Kontaktniy centr po tel. 0890." />
      <set item="Content" condition="//Item/@dbresult='AUTH_CARD_NOT_AVAILABLE'" value="Karta nedostupna. Obratites v Kontaktniy centr po tel. 0890." />
      <set item="Content" condition="//Item/@dbresult='AUTH_CARD_NOT_FOUND'" value="Karta ne naydena. Obratites v Kontaktniy centr po tel. 0890." />
      <set item="Content" condition="//Item/@dbresult='OK'" value="Platezh na summu #{/Message/Item/Attribute[@name='amount']/@value} rublej prinyat dlia abonenta #{/Message/Item/Attribute[@name='receiver']/@value}." />
      <set item="Content" condition="//Item/@dbresult=0" value="Platezh na summu #{/Message/Item/Attribute[@name='amount']/@value} rublej prinyat dlia abonenta #{/Message/Item/Attribute[@name='receiver']/@value}." />
      <set item="Sender" value="0850" />
      <set item="Recipient" value="${payer}" />
      <set item="Encoding" value="ascii" />
    </deliveryTemplate>
  </template>
  <!-- Автоответчик для 5544. -->
  <template procedureName="Serv_5544" persistent="true">
    <condition>
      <test item="${Recipient}" matches="^(5544)$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Mobil'naya versiya iPay - http://m.ipay.by" />
      <set item="Sender" value="5544" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="ascii" />
    </deliveryTemplate>
  </template>
  <!-- Запрос баланса через SMS    -->
  <template procedureName="SMS_Balans_new">
    <condition>
      <!--<test item="${Sender}" matches="^(375297001003|375297776319)$" /> -->
      <test item="${Recipient}" matches="^(087011|088011)$" />
    </condition>
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}" subject="balance" datasource="state" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="К сожалению, произошла ошибка. Попробуйте еще раз." />
      <set item="Content" condition="//Item/@dbresult='1'" value="${rez}" />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- Типа для Удаления МТС Коннект 50 и т.п. убрать после 1.09.2010  -->
  <template procedureName="Del_SMS_MTS_connect">
    <condition>
      <test item="${Recipient}" matches="^(345|346|347|348|349)$" />
      <test item="${Content}" matches="^(R|r)$" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}">
          <Service id="@{switch(${Recipient}|FR665,346|FR666,347|FR667,348|FR668,349|FR1116)}" service_id="@{switch(${Recipient}|FR664004,342|FR664005,343|FR664006,344|FR633,345|FR665,346|FR666,347|FR667,348|FR668,349|FR1116)}" action="3" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="К сожалению, произошла ошибка. Попробуйте еще раз." />
      <set item="Content" condition="//Item/@dbresult=320191" value="На балансе недостаточно средств для проведения операции." />
      <set item="Content" condition="//Item/@dbresult=320174" value="Неверно задана операция." />
      <set item="Content" condition="//Item/@dbresult=320172" value="Неверно задана услуга." />
      <set item="Content" condition="//Item/@dbresult=320173" value="На тарифном плане нет данной услуги." />
      <set item="Content" condition="//Item/@dbresult=320204" value="Существует заявка на добавление услуги." />
      <set item="Content" condition="//Item/@dbresult=320203" value="Существует заявка на удаление услуги." />
      <set item="Content" condition="//Item/@dbresult=0" value="Операция успешно выполнена." />
      <set item="Content" condition="//Item/@dbresult=-1" value="Данный запрос не может быть выполнен." />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="SMSadd_MTSConnect">
    <condition>
      <test item="${Recipient}" matches="^(341|342|343|344)$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Услуга закрыта для подключения." />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- Типа обработчик ошибки МТС Коннект 50 и т.п.  -->
  <template procedureName="SMSact_SyntaxError">
    <condition>
      <test item="${Recipient}" matches="^(345|346|347|348|349)$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" message_Content="${Content}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Удаление услуги - латинская буква R." />
      <set item="Content" condition="//Item/@message_Content=a" value="Услуга закрыта для подключения." />
      <set item="Content" condition="//Item/@message_Content=A" value="Услуга закрыта для подключения." />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- Типа для Удаления   324 325 326  -->
  <template procedureName="Del_Service">
    <condition>
      <test item="${Recipient}" matches="^(324|325|326)$" />
      <test item="${Content}" matches="^(R|r)$" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}">
          <Service id="@{switch(${Recipient}|FR669,325|FR670,326|FR671)}" service_id="@{switch(${Recipient}|FR669,325|FR670,326|FR671)}" action="3" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="К сожалению, произошла ошибка. Попробуйте еще раз." />
      <set item="Content" condition="//Item/@dbresult=320191" value="На балансе недостаточно средств для проведения операции." />
      <set item="Content" condition="//Item/@dbresult=320174" value="Неверно задана операция." />
      <set item="Content" condition="//Item/@dbresult=320172" value="Неверно задана услуга." />
      <set item="Content" condition="//Item/@dbresult=320173" value="На тарифном плане нет данной услуги." />
      <set item="Content" condition="//Item/@dbresult=320203" value="Существует заявка на удаление услуги." />
      <set item="Content" condition="//Item/@dbresult=320204" value="Существует заявка на добавление услуги." />
      <set item="Content" condition="//Item/@dbresult=320205" value="услуга уже существует." />
      <set item="Content" condition="//Item/@dbresult=0" value="Операция успешно выполнена." />
      <set item="Content" condition="//Item/@dbresult=-1" value="Данный запрос не может быть выполнен." />
      <set item="Content" condition="//Item/@dbresult=1" value="${msg}" />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- Типа обработчик ошибки 330  324 325 326 330 371 372 373 374 345 346 347 348 349 -->
  <template procedureName="Add_Del_SyntaxError">
    <condition>
      <test item="${Recipient}" matches="^(324|325|326|330|345|346|347|348|349)$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" number="${Recipient}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Добавление или удаление услуги - латинская буква A или R." />
      <set item="Content" condition="//Item/@number=324" value="Услуга закрыта для подключения." />
      <set item="Content" condition="//Item/@number=325" value="Услуга закрыта для подключения." />
      <set item="Content" condition="//Item/@number=326" value="Услуга закрыта для подключения." />
      <set item="Content" condition="//Item/@number=371" value="Добавление услуги - латинская буква A." />
      <set item="Content" condition="//Item/@number=372" value="Добавление услуги - латинская буква A." />
      <set item="Content" condition="//Item/@number=373" value="Добавление услуги - латинская буква A." />
      <set item="Content" condition="//Item/@number=374" value="Добавление услуги - латинская буква A." />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- УЗНАЙ СВОЙ НОМЕР -->
  <template procedureName="YOUR_NUMBER" persistent="true">
    <condition>
      <test item="${Recipient}" matches="^(7770887|0887)$" />
    </condition>
    <receiveTemplate>
      <Message type="verificationrequest" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${sender}" datasource="state">
          <Attribute name="checkblocks" value="0" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="Номер Вашего телефона +${customer}." />
      <set item="Content" condition="//Item/@dbresult=0" value="Номер Вашего телефона +${customer}, ТП &quot;${tp_name}&quot;" />
      <set item="Content" condition="//Item/@dbresult=320343" value="Номер Вашего телефона +${customer}, ТП &quot;${tp_name}&quot;" />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- Informing BelNeft    -->
  <template procedureName="Informing_belneft">
    <condition>
      <test item="${Recipient}" matches="^30303$" />
    </condition>
    <receiveTemplate>
      <Message type="Informing_belneft" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="К сожалению, произошла ошибка. Попробуйте еще раз." />
      <set item="Content" condition="//Item/@dbresult='1'" value="${rez}" />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- SMS ACTIVATION TEMPLATE WORKBENCH v.2.4 @ 26 Nov 2007 / Alec Sergeyev -->
  <template procedureName="AddFR511001_SyntaxError">
    <condition>
      <test item="${Recipient}" matches="^330$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Добавление или удаление услуги &quot;Гипер.Net&quot; - латинская буква A или R." />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="AddFavNumber">
    <condition>
      <test item="${Recipient}" matches="^087027$" />
      <test item="${Content}" matches="^375(29|33|44|25)\d{7}$" />
    </condition>
    <receiveTemplate>
      <Message type="setprofile" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}" action="10">
          <Attribute name="favouritenumber" value="#{substring('${Content}',1,12)}" />
          <Attribute name="favouritenumbertypeid" value="1" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="К сожалению, произошла ошибка. Попробуйте еще раз." />
      <set item="Content" condition="//Item/@dbresult=320341" value="Проведение операции невозможно - введен ошибочный номер." />
      <set item="Content" condition="//Item/@dbresult=320142" value="Достигнуто максимальное количество &quot;любимых номеров&quot;." />
      <set item="Content" condition="//Item/@dbresult=320193" value="Проведение операции невозможно. Обратитесь в контактный центр по тел. 0890." />
      <set item="Content" condition="//Item/@dbresult=320191" value="У Вас недостаточно средств для добавления &quot;любимого номера&quot;." />
      <set item="Content" condition="//Item/@dbresult=320997" value="Указанный номер уже в списке &quot;любимых номеров&quot;." />
      <set item="Content" condition="//Item/@dbresult=0" value="Заявка на добавление &quot;любимого номера&quot; +${favouritenumber} зарегистрирована." />
      <set item="Encoding" value="unicodefffe" />
      <set item="Sender" value="0870" />
    </deliveryTemplate>
  </template>
  <template procedureName="AddFavNumber_190_TPcheck" sessionStorage="Memory" sessionLifetime="300">
    <condition>
      <test item="${Recipient}" matches="^190$" />
      <test item="${Token0}" matches="^(add|Add|ADd|aDd|ADD|AdD|aDD|adD|)$" />
      <test item="${Token1}" matches="^375(29|33|44|25)\d{7}$" />
    </condition>
    <receiveTemplate>
      <Message type="setprofile" initiator="smscon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item customer="${Sender}" subject="check" datasource="cust">
          <Attribute name="pMSISDN" value="#{substring('${Token1}',1,12)}" />
          @{store(sContent,${Token1})}
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{(${dbresult}='58') or (${dbresult}='158')}" call="AddFavNumber_190">
      <set item="Sender" value="${customer}" />
      <set item="Content" value="${sContent}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate conditionEx="#{(${dbresult}!=58) and (${dbresult}!=158)}" terminating="true">
      <set item="Content" value="Vvedennij nomer imeet nevernij TP" />
      <set item="Sender" value="190" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="ascii" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
  </template>
  <!--    <condition>
     <test item="${Recipient}" matches="^190$" />
        <test item="${Token0}" matches="^(add|del|Add|Del|ADd|DEl|aDd|dEl|ADD|DEL)$" />
        <test item="${Token1}" matches="^375(292|295|297|298|336|333)\d{6}$" />
    </condition>
-->
  <!--
      <deliveryTemplate conditionEx="#{('${subscription}' = 0 and '${dbresult}'=0) or (${dbresult}='320282')}" call="SMS_TrueVM1Order">
		<set item="Sender" value="${customer}" />
       </deliveryTemplate>
-->
  <!--    <receiveTemplate>
      <Message type="setprofile" initiator="smscon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item customer="${Sender}" subject="check" datasource="cust" action="@{switch(${Token0}|10,del|11)}">
                  @{store(storedAction,${action})}
                  @{store(storedCustomer,${Sender})}
                  <Attribute name="pMSISDN" value="#{substring('${Token1}',1,12)}" />
                  @{store(storedMSISDN,${pMSISDN})}
        </Item>
      </Message>
    </receiveTemplate>
-->
  <!--    <deliveryTemplate conditionEx="#{${dbresult}!=(58|158)}" terminating="true" >
          <set item="Content" value="Vvedennij nomer imeet nevernij tarifnij plan" />
          <set item="Sender" value="190" />
          <set item="Recipient" value="${storedCustomer}" />
          <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate> -->
  <!--
10.06.2009 18:07:58 #10	Content: <Message type="setprofile" initiator="smscon" id="029a0780-bf95-44b9-8174-d01f2583b1c9" session_id="27e71edf-d85a-496a-ac0a-bf0c86c1be9f">
<Item customer="190" action=""><Attribute name="favouritenumber" value="375297026957" /><Attribute name="index" value="0" /><Attribute name="favouritenumbertypeid" value="5" /></Item></Message>
-->
  <template procedureName="AddFavNumber_190">
    <condition>
      <test item="0" matches="1" />
    </condition>
    <receiveTemplate>
      <Message type="setprofile" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}" action="10">
          <Attribute name="favouritenumber" value="#{substring('${Content}',1,12)}" />
          <Attribute name="favouritenumbertypeid" value="5" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="K sozhaleniyu, proizoshla oshibka. Poprobuyte eshe raz." />
      <set item="Content" condition="//Item/@dbresult=320341" value="Provedenie operacii nevozmozhno - vveden oshibochnii nomer" />
      <set item="Content" condition="//Item/@dbresult=320142" value="Dostignuto maxmalnoe kolichestvo &quot; nomerov&quot;." />
      <set item="Content" condition="//Item/@dbresult=320193" value="Provedenie operacii nevozmozhno.Obratites v kontaktnii centr po tel.0890." />
      <set item="Content" condition="//Item/@dbresult=320191" value="U Vas nedostatochno sredstv dlia upravleniia &quot; nomerami&quot;." />
      <set item="Content" condition="//Item/@dbresult=0" value="Zayavka na obrabotky nomera +${favouritenumber} zaregistrirovana." />
      <set item="Sender" value="190" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="ascii" />
    </deliveryTemplate>
  </template>
  <template procedureName="AddFavNumber_190_2">
    <condition>
      <test item="0" matches="1" />
    </condition>
    <receiveTemplate>
      <Message />
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="K sozhaleniyu, proizoshla oshibka. Poprobuyte eshe raz." />
      <set item="Content" condition="//Item/@dbresult=320341" value="Provedenie operacii nevozmozhno - vveden oshibochnii nomer" />
      <set item="Content" condition="//Item/@dbresult=320142" value="Dostignuto maxmalnoe kolichestvo &quot; nomerov&quot;." />
      <set item="Content" condition="//Item/@dbresult=320193" value="Provedenie operacii nevozmozhno.Obratites v kontaktnii centr po tel.0890." />
      <set item="Content" condition="//Item/@dbresult=320191" value="U Vas nedostatochno sredstv dlia upravleniia &quot; nomerami&quot;." />
      <set item="Content" condition="//Item/@dbresult=0" value="Zayavka na obrabotky nomera +${favouritenumber} zaregistrirovana." />
      <set item="Recipient" value="${Sender}" />
      <set item="Sender" value="190" />
      <set item="Encoding" value="ascii" />
    </deliveryTemplate>
  </template>
  <template procedureName="DelFavNumber_190">
    <condition>
      <test item="${Recipient}" matches="^190$" />
      <test item="${Token0}" matches="^(del|Del|DEl|dEl|DEL|deL|dEL|DeL)$" />
      <test item="${Token1}" matches="^375(29|33|44|25)\d{7}$" />
    </condition>
    <receiveTemplate>
      <Message type="setprofile" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}" action="11">
          <Attribute name="favouritenumber" value="#{substring('${Token1}',1,12)}" />
          <Attribute name="favouritenumbertypeid" value="5" />
          <Attribute name="createrequest" value="1" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="K sozhaleniyu, proizoshla oshibka. Poprobuyte eshe raz." />
      <set item="Content" condition="//Item/@dbresult=320341" value="Provedenie operacii nevozmozhno - vveden oshibochnii nomer" />
      <set item="Content" condition="//Item/@dbresult=320142" value="Dostignuto maxmalnoe kolichestvo &quot; nomerov&quot;." />
      <set item="Content" condition="//Item/@dbresult=320193" value="Provedenie operacii nevozmozhno.Obratites v kontaktnii centr po tel.0890." />
      <set item="Content" condition="//Item/@dbresult=320191" value="U Vas nedostatochno sredstv dlia upravleniia &quot; nomerami&quot;." />
      <set item="Content" condition="//Item/@dbresult=0" value="Zayavka na obrabotky nomera +${favouritenumber} zaregistrirovana." />
      <set item="Sender" value="190" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="ascii" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
  </template>
  <template procedureName="AddFavNumber_SyntaxError">
    <condition>
      <test item="${Recipient}" matches="^(087027|190)$" />
    </condition>
    <receiveTemplate>
      <Message type="setprofile" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Ошибка в номере, вводите в формате 375xxXXXXXXX." />
      <set item="Encoding" value="unicodefffe" />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
    </deliveryTemplate>
  </template>
  <template procedureName="VMASPayment">
    <condition>
      <test item="${Recipient}" matches="^0850$" />
      <test item="${Content}" matches="^\d{14}$" />
    </condition>
    <receiveTemplate>
      <Message type="vmaspayment" id="${guid}" initiator="SMS" session_id="@{newGuid}">
        <Item>
          <Attribute name="payer" value="${Sender}" />
          <Attribute name="receiver" value="${Sender}" />
          <Attribute name="pin" value="${Content}" />
          <Attribute name="network_operator_code" value="BELORUSSIA" />
          <Attribute name="operator_id" value="15" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="К сожалению, произошла ошибка. Попробуйте еще раз." />
      <set item="Content" condition="//Item/@dbresult='AUTH_FAILED'" value="Vveden nepravilniy PIN-kod. Povtorite popitku." />
      <set item="Content" condition="//Item/@dbresult='AUTH_DEVICE_BLACKLISTED'" value="Activacija nevozmozhna. Obratites v Kontaktniy centr po tel. 0890." />
      <set item="Content" condition="//Item/@dbresult='AUTH_GENERAL_COUNTER_MAX'" value="Activacija nevozmozhna. Obratites v Kontaktniy centr po tel. 0890." />
      <set item="Content" condition="//Item/@dbresult='AUTH_SESSION_COUNTER_MAX'" value="Activacija nevozmozhna. Obratites v Kontaktniy centr po tel. 0890." />
      <set item="Content" condition="//Item/@dbresult='AUTH_DEVICE_NOT_FOUND_IN_RI'" value="Activacija nevozmozhna. Obratites v Kontaktniy centr po tel. 0890." />
      <set item="Content" condition="//Item/@dbresult='AUTH_CARD_BLOCKED'" value="Karta zablokirovana. Obratites v Kontaktniy centr po tel. 0890." />
      <set item="Content" condition="//Item/@dbresult='AUTH_CARD_EXPIRED'" value="Istek srok deystviya karti. Obratites v Kontaktniy centr po tel. 0890." />
      <set item="Content" condition="//Item/@dbresult='AUTH_CARD_NOT_AVAILABLE'" value="Karta nedostupna. Obratites v Kontaktniy centr po tel. 0890." />
      <set item="Content" condition="//Item/@dbresult='AUTH_CARD_NOT_FOUND'" value="Karta ne naydena. Obratites v Kontaktniy centr po tel. 0890." />
      <set item="Content" condition="//Item/@dbresult='OK'" value="Платеж на сумму #{/Message/Item/Attribute[@name='amount']/@value} рублей принят." />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${receiver}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="VMASPayment_SyntaxError">
    <condition>
      <test item="${Recipient}" matches="^0850$" />
    </condition>
    <receiveTemplate>
      <Message type="vmaspayment" id="${guid}" initiator="SMS" session_id="@{newGuid}">
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Пожалуйста, вводите 14 цифр!" />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- ЗАЧИСЛЕННЫЕ ПЛАТЕЖИ -->
  <template procedureName="SMS_ViewPayments">
    <condition>
      <test item="${Recipient}" matches="^087012$" />
      <test item="${Content}" matches="^(L|l|P|p|Pp|PP|pp|Ppp|ppp|PPP|Pppp|pppp|PPPP|Ppppp|ppppp|PPPPP)$" />
    </condition>
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}" subject="payments">
          <Attribute name="index" value="@{switch(${Content}|0,l|0,P|1,p|1,Pp|2,PP|2,pp|2,Ppp|3,ppp|3,PPP|3,Pppp|4,pppp|4,PPPP|4,Ppppp|5,ppppp|5,PPPPP|5)}" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="Ошибка при выполнении запроса." />
      <set item="Content" condition="//Item/@dbresult=0" value="Платеж на сумму #{/Message/Item/Attribute[@name='intpartfracpart']/@value div 100} р. поступил ${day}. Всего #{/Message/Item/Attribute[@name='count']/@value} платеж(а)." />
      <set item="Content" condition="//Item/@dbresult=320203" value="Выполнение запроса невозможно до завершения предыдущей операции." />
      <set item="Content" condition="//Item/@dbresult=320191" value="На балансе недостаточно средств для проведения операции." />
      <set item="Content" condition="//Item/@dbresult=-1" value="Данный запрос не может быть выполнен." />
      <set item="Encoding" value="unicodefffe" />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
    </deliveryTemplate>
  </template>
  <template procedureName="ViewPayments_SyntaxError">
    <condition>
      <test item="${Recipient}" matches="^087012$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Отправьте лат. L для последнего платежа, P, PP и т.д. для предыдущих" />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- ИНТЕРНЕТ+ -->
  <template procedureName="SMS_AddInternet">
    <condition>
      <test item="${Recipient}" matches="^0870264$" />
      <test item="${Content}" matches="^(20|60|120)$" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}">
          <Service id="@{switch(${Content}|CB412736,60|CB412737,120|CB412738)}" action="2" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="Ошибка при добавлении услуги &quot;Интернет+&quot;." />
      <set item="Content" condition="//Item/@dbresult=0" value="Заявка на добавление &quot;Интернет+&quot; зарегистрирована." />
      <set item="Content" condition="//Item/@dbresult=320203" value="Добавление &quot;Интернет+&quot; невозможно до завершения предыдущей операции." />
      <set item="Content" condition="//Item/@dbresult=320204" value="В текущий момент пользование услугой &quot;Интернет+&quot; не разрешено." />
      <set item="Content" condition="//Item/@dbresult=320205" value="Услуга &quot;Интернет+&quot; была добавлена ранее." />
      <set item="Content" condition="//Item/@dbresult=320191" value="На балансе недостаточно средств для проведения операции." />
      <set item="Content" condition="//Item/@dbresult=-1" value="Данный запрос не может быть выполнен." />
      <set item="Content" condition="//Item/@dbresult=1" value="${msg}" />
      <set item="Encoding" value="unicodefffe" />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
    </deliveryTemplate>
  </template>
  <template procedureName="AddInternet_SyntaxError">
    <condition>
      <test item="${Recipient}" matches="^0870264$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Для добавления услуги &quot;Интернет+&quot; пошлите 20, 60 или 120." />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- ОБЕЩАНЫЙ ПЛАТЕЖ -->
  <template procedureName="SMS_Cancel_GuaranteedPayment" sessionLifetime="1800">
    <condition>
      <test item="${Recipient}" matches="^087013$" />
      <test item="${Content}" matches="^0$" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}" datasource="state">
          <Service id="guaranteedpayment" action="9" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="Извините, но данный запрос не может быть выполнен." />
      <set item="Content" condition="//Item/@dbresult=0" value="Заявка на отмену обещанного платежа принята." />
      <set item="Content" condition="//Item/@dbresult=-1" value="Произошла ошибка, обратитесь в справочно-информационный центр." />
      <set item="Encoding" value="unicodefffe" />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
    </deliveryTemplate>
  </template>
  <template procedureName="SMS_Check_GuaranteedPayment" sessionLifetime="1800">
    <condition>
      <test item="${Recipient}" matches="^087013$" />
      <test item="${Content}" matches="^[1-3]{1}$" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item customer="${Sender}">
          <Service id="guaranteedpayment" action="6" />
        </Item>
        @{store(sContent,#{number(${Content} * 100)})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'${dbresult}'='0'}" call="SMS_GuaranteedPayment">
      <set item="Sender" value="${customer}" />
      <set item="Content" value="${sContent}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="Content" value="Извините, но данный запрос не может быть выполнен." />
      <set item="Content" conditionEx="#{${dbresult}=320341}" value="Номер Вашего телефона не зарегистрирован" />
      <set item="Content" conditionEx="#{${dbresult}=320347}" value="Услуга не может быть предоставлена, потому что номер заблокирован" />
      <set item="Content" conditionEx="#{${dbresult}=320191}" value="Данный сервис недоступен. Ваш баланс #{number('${balance}') div 100} р." />
      <set item="Content" conditionEx="#{${dbresult}=320203}" value="Услуга не может быть предоставлена, предыдущий обещанный платеж не погашен или в процессе регистрации" />
      <set item="Content" conditionEx="#{${dbresult}=320111}" value="Указывайте сумму не превышающую #{${maximumusd} div 100} р." />
      <set item="Content" conditionEx="#{${dbresult}=320121}" value="Невозможно установить обещанный платеж" />
      <set item="Content" conditionEx="#{${dbresult}=320113}" value="Сумма обещанного платежа меньше минимально возможной" />
      <set item="Content" conditionEx="#{${dbresult}=330140}" value="Обратитесь к персональному менеджеру" />
      <set item="Content" conditionEx="#{${dbresult}=330141}" value="Превышено допустимое кол-во обещанных платежей" />
      <set item="Content" conditionEx="#{${dbresult}=330142}" value="Исчерпан лимит средств для ввода обещанного платежа" />
      <set item="Content" conditionEx="#{${dbresult}=330132}" value="Данный сервис недоступен. Ваш баланс #{number('${balance}') div 100} р." />
      <set item="Encoding" value="unicodefffe" />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
  </template>
  <template procedureName="SMS_GuaranteedPayment">
    <condition>
      <test item="0" matches="1" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}">
          <Service id="guaranteedpayment" action="7">
            <Attribute name="amount" value="${Content}" />
            <Attribute name="currency" value="933" />
          </Service>
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="Услуга не предоставляется для Вашего тарифного плана." />
      <set item="Content" condition="//Item/@dbresult=0" value="Обещанный платеж на сумму #{${amount} div 100} р. принят.Отображение на балансе в течение 10 минут." />
      <set item="Content" condition="//Item/@dbresult=320203" value="Регистрация запрещена - предыдущий обещанный платеж не оплачен." />
      <set item="Content" condition="//Item/@dbresult=320111" value="Превышена разрешенная сумма обещанного платежа." />
      <set item="Content" condition="//Item/@dbresult=320121" value="Платеж не может быть зарегистрирован." />
      <set item="Content" condition="//Item/@dbresult=320341" value="Нельзя ввести обещанный платеж на Вашем тарифном плане" />
      <set item="Content" condition="//Item/@dbresult=320110" value="Минимальная сумма обещанного платежа 1 руб.Введите большую сумму." />
      <set item="Content" conditionEx="#{${dbresult}=320347}" value="Услуга не может быть предоставлена, потому что номер заблокирован" />
      <set item="Content" conditionEx="#{${dbresult}=320191}" value="Услуга не может быть предоставлена, недостаточно средств" />
      <set item="Content" condition="//Item/@dbresult=-1" value="Обещанный платеж не может быть принят." />
      <set item="Encoding" value="unicodefffe" />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
    </deliveryTemplate>
  </template>
  <template procedureName="GuaranteedPayment_SyntaxError">
    <condition>
      <test item="${Recipient}" matches="^087013$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Пожалуйста, посылайте только цифры!" />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- проверка услуги КИССА-адмнистратор пока тест -->
  <template procedureName="SMS_PreChangePassword" sessionStorage="Memory" sessionLifetime="30">
    <condition>
      <test item="${Sender}" matches="^375292504781" />
      <test item="${Content}" matches="^\d{1,7}$" />
    </condition>
    <receiveTemplate>
      <Message type="serviceinterrogation" initiator="smscon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item customer="${Sender}" datasource="state">
          <Service id="FRKIS001" action="interrogation" />
        </Item>
        @{store(sContent,${Content})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{('${subscription}' = 0 or '${dbresult}'= 320282) }" call="SMS_PreChangePassword_validation">
      <set item="Content" value="${sContent}" />
      <set item="Sender" value="${customer}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="Content" value="К сожалению, произошла ошибка." />
      <set item="Content" condition="//Item/@dbresult=0" value="Смена пароля запрещена" />
      <set item="Content" condition="//Item/@dbresult=-1" value="Данный запрос не может быть выполнен." />
      <set item="Content" condition="//Item/@dbresult=320282" value="К сожалению, произошла ошибка. Обратитесь в абонентский отдел." />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
  </template>
  <!-- СМЕНА ПАРОЛЯ -->
  <template procedureName="SMS_PreChangePassword_validation" sessionStorage="Memory" sessionLifetime="30">
    <condition>
      <test item="${Recipient}" matches="^087021$" />
      <test item="${Content}" matches="^\d{1,7}$" />
    </condition>
    <receiveTemplate>
      <Message type="verificationrequest" initiator="smscon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item customer="${Sender}" datasource="state">
          <Attribute name="checkblocks" value="1" />
        </Item>
        @{store(sContent,${Content})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate condition="//Item/@check=0" call="SMS_ChangePassword">
      <set item="Content" value="${sContent}*${password}" />
      <set item="Sender" value="${customer}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="Content" value="К сожалению, произошла ошибка." />
      <set item="Content" condition="//Item/@dbresult=0" value="Активирован запрос пароля, установка пароля с помощью SMS невозможна" />
      <set item="Content" condition="//Item/@dbresult=-1" value="Данный запрос не может быть выполнен." />
      <set item="Content" condition="//Item/@dbresult=320341" value="К сожалению, произошла ошибка. Обратитесь в абонентский отдел." />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
  </template>
  <template procedureName="ChangePassword_SyntaxError">
    <condition>
      <test item="${Recipient}" matches="^087021$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Формат пароля: 4-7 цифр. Повторите запрос." />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="SMS_ChangePassword">
    <condition>
      <test item="0" matches="1" />
    </condition>
    <receiveTemplate>
      <Message type="setprofile" initiator="ivrcon" id="@{newGuid}" session_id="${SessionId}">
        <Item customer="${Sender}">
          <Attribute name="oldpassword" value="${token1}" />
          <Attribute name="newpassword" value="${token0}" />
          <Attribute name="confirmpassword" value="${token0}" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="Ошибка при смене пароля." />
      <set item="Content" condition="//Item/@dbresult=320023" value="Формат пароля: 4-7 цифр. Повторите запрос." />
      <set item="Content" condition="//Item/@dbresult=0" value="Новый пароль установлен." />
      <set item="Content" condition="//Item/@dbresult=-1" value="Данный запрос не может быть выполнен." />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- ДОБАВЛЕНИЕ ДОБРОВОЛЬНОЙ БЛОКИРОВКИ -->
  <template procedureName="SMS_BlockPhone">
    <condition>
      <test item="${Recipient}" matches="^087022$" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}">
          <Service id="blockphone" action="4">
            <Attribute name="state" value="1" />
            <Attribute name="start" value="#{Now()}" />
            <Attribute name="end" value="31.12.2099" />
          </Service>
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="Ошибка при добавлении добровольной блокировки." />
      <set item="Content" condition="//Item/@dbresult=0" value="Заявка на добавление добровольной блокировки зарегистрирована." />
      <set item="Content" condition="//Item/@dbresult=320203" value="Добавление добровольной блокировки невозможно до завершения предыдущей операции." />
      <set item="Content" condition="//Item/@dbresult=320204" value="В текущий момент пользование услугой &quot;Добровольная блокировка&quot; не разрешено." />
      <set item="Content" condition="//Item/@dbresult=320191" value="На балансе недостаточно средств для проведения операции." />
      <set item="Content" condition="//Item/@dbresult=-1" value="Данный запрос не может быть выполнен." />
      <set item="Encoding" value="unicodefffe" />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
    </deliveryTemplate>
  </template>
  <!-- Удаление SMS-роуминга  -->
  <template procedureName="DEL_SMS-Roaming_2" sessionStorage="Memory" sessionLifetime="120">
    <condition>
      <test item="${Recipient}" matches="^(0870249)$" />
      <test item="${Content}" matches="^(R|r)$" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}">
          <Service id="CB403864" action="3" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="Ошибка при обработке услуги &quot;SMS Роуминг&quot;" />
      <set item="Content" condition="//Item/@dbresult=0" value="Заявка на удаление услуги &quot;SMS Роуминг&quot; зарегистрирована." />
      <set item="Content" condition="//Item/@dbresult=320203" value="Обработка услуги &quot;SMS Роуминг&quot; невозможна до завершения предыдущей операции." />
      <set item="Content" condition="//Item/@dbresult=320204" value="В текущий момент пользование услугой &quot;SMS Роуминг&quot; не разрешено." />
      <set item="Content" condition="//Item/@dbresult=320205" value="Услуга &quot;SMS Роуминг&quot; была добавлена ранее." />
      <set item="Content" condition="//Item/@dbresult=320206" value="Услуга &quot;SMS Роуминг&quot; была удалена ранее." />
      <set item="Content" condition="//Item/@dbresult=320191" value="На балансе недостаточно средств для проведения операции." />
      <set item="Content" condition="//Item/@dbresult=-1" value="Данный запрос не может быть выполнен." />
      <set item="Encoding" value="unicodefffe" />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="Content" value="Ошибка сервиса!" />
      <set item="Encoding" value="unicodefffe" />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
    </deliveryTemplate>
  </template>
  <!-- ЗАКАЗ ОСНОВНЫХ УСЛУГ (08702441|CB211 Полная расшифровка счета - закрыто)  -->
  <template procedureName="SMS_Serviceorder" sessionStorage="Memory" sessionLifetime="120">
    <condition>
      <test item="${Recipient}" matches="^(0870241|0870243|08702442|08702443|08702444|08702445|08702446|08702447|08702448|0870250|0870253|0870261|0870258|0870259|0870260)$" />
      <test item="${Content}" matches="^(A|a|R|r)$" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        @{store(sCnt,${Content})}
        @{store(sSrv,@{switch(${Recipient}|CB108,0870243|CB532,08702442|CB264,08702443|CB534,08702444|CB9831,08702445|CB265,08702446|CB10555,08702447|CB10363,08702448|CB573,0870250|CB401555,0870253|CB403481,0870261|CB412690,0870258|CB410868,0870259|CB410153)})}
        <Item customer="${Sender}">
          <Service id="${sSrv}" action="@{switch(${Content}|2,a|2,R|3,r|3)}" class="0" needtariffication="1" informOnImpossibility="0" createrequest="1" enddate="01.01.0001 00.00.00" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="Ошибка при обработке услуги &quot;#{document('services.xml')/items/item[@id='${sSrv}']/@text}&quot;." />
      <set item="Content" condition="//Item/@dbresult=0" value="Заявка на @{switch(${sCnt}|добавление,a|добавление,R|удаление,r|удаление)} услуги &quot;#{document('services.xml')/items/item[@id='${sSrv}']/@text}&quot; зарегистрирована." />
      <set item="Content" condition="//Item/@dbresult=320203" value="Обработка услуги &quot;#{document('services.xml')/items/item[@id='${sSrv}']/@text}&quot; невозможна до завершения предыдущей операции." />
      <set item="Content" condition="//Item/@dbresult=320204" value="В текущий момент пользование услугой &quot;#{document('services.xml')/items/item[@id='${sSrv}']/@text}&quot; не разрешено." />
      <set item="Content" condition="//Item/@dbresult=320205" value="Услуга &quot;#{document('services.xml')/items/item[@id='${sSrv}']/@text}&quot; была добавлена ранее." />
      <set item="Content" condition="//Item/@dbresult=320206" value="Услуга &quot;#{document('services.xml')/items/item[@id='${sSrv}']/@text}&quot; была удалена ранее." />
      <set item="Content" condition="//Item/@dbresult=320191" value="На балансе недостаточно средств для проведения операции." />
      <set item="Content" condition="//Item/@dbresult=-1" value="Данный запрос не может быть выполнен." />
      <set item="Encoding" value="unicodefffe" />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="Content" value="Ошибка сервиса!" />
      <set item="Encoding" value="unicodefffe" />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
  </template>
  <template procedureName="Serviceorder_SyntaxError">
    <condition>
      <test item="${Recipient}" matches="^(0870241|0870242|0870243|08702442|08702443|08702444|08702445|08702446|08702447|08702448|087024497|0870249|0870250|0870253|0870261|0870258|0870259|0870260|381|382)$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Для удаления или добавления услуги пошлите соответственно латинские R или A." />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- ACHTUNG P-t-P -->
  <template procedureName="check_p2p">
    <condition>
      <test item="${Recipient}" matches="^363$" />
      <test item="${token0}" matches="^\d{12}$" />
      <test item="${token1}" matches="^[1-2]{1}$" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}">
          <Service id="movepaymentrequest" action="5">
            <Attribute name="receiver" value="${token0}" />
            <Attribute name="amount" value="${token1}" />
          </Service>
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="Perevod nevozmojen, povtorite pozje" />
      <set item="Content" condition="//Item/@dbresult='0'" value="Dlya podtwerjdeniya perevoda #{/Message/Item/Service/Attribute[@name='amount']/@value div 100} r. abonentu ${receiver} prishlite kod #{/Message/Item/Service/Attribute[@name='code']/@value} na nomer 363" />
      <set item="Content" condition="//Item/@dbresult='320060'" value="U Vas net prav dlya obrabotki zaprosa." />
      <set item="Content" condition="//Item/@dbresult='320705'" value="Takaya zajavka ne budet obrabotana" />
      <set item="Content" condition="//Item/@dbresult='320704'" value="Prediduschaja zajavka ne obrabotana, povtorite pozje" />
      <set item="Content" condition="//Item/@dbresult='320666'" value="Nevernij kod awtorizatsii" />
      <set item="Content" condition="//Item/@dbresult='320999'" value="Srok dejstvija koda avtorizatsii istek" />
      <set item="Content" condition="//Item/@dbresult='320362'" value="U abonenta #{/Message/Item/Service/Attribute[@name='receiver']/@value} otkljuchena vozmozhnost priema P-t-P" />
      <set item="Content" condition="//Item/@dbresult='320703'" value="Nepravilno ukazan nomer poluchatelya" />
      <set item="Content" condition="//Item/@dbresult='320361'" value="Usluga zablokirovana, obratites v slujbu podderzhki" />
      <set item="Content" condition="//Item/@dbresult='320702'" value="Usluga zablokirovana, obratites v slujbu podderzhki" />
      <set item="Content" condition="//Item/@dbresult='320101'" value="Povtornij vvod informatsii, pojalujsta, sledujte instruktsii" />
      <set item="Content" condition="//Item/@dbresult='320714'" value="Dostignut predel chisla poluchatelej" />
      <set item="Content" condition="//Item/@dbresult='320710'" value="Slishkom malenkaja summa perevoda" />
      <set item="Content" condition="//Item/@dbresult='320701'" value="Slishkom bolshaja summa perevoda" />
      <set item="Content" condition="//Item/@dbresult='320711'" value="Ukazannaja summa previshaet limit perevodimih sredstv na segodnja" />
      <set item="Content" condition="//Item/@dbresult='320712'" value="Prevyshen limit dlya poluchatelya za sutki" />
      <set item="Content" condition="//Item/@dbresult='320191'" value="Na vashem schetu nedostatochno sredstv dlja perevoda abonentu #{/Message/Item/Service/Attribute[@name='receiver']/@value}" />
      <set item="Content" condition="//Item/@dbresult='320713'" value="Nomer poluchatelja sovpadaet s Vashim nomerom, pojalujsta, povtorite vvod" />
      <set item="Content" condition="//Item/@dbresult='320709'" value="Usluga zablokirovana, obratites w slujbu podderzhki" />
      <set item="Sender" value="363" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="iso-8859-1" />
    </deliveryTemplate>
  </template>
  <template procedureName="confirm_p2p">
    <condition>
      <test item="${Recipient}" matches="^363$" />
      <test item="${Content}" matches="^[0-9]{4}$" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}">
          <Service id="movepaymentacceptance" action="5">
            <Attribute name="code" value="${Content}" />
          </Service>
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{${dbresult}!=0}" terminating="true">
      <set item="Content" value="Perevod newozmojen, povtorite pozje" />
      <set item="Content" condition="//Item/@dbresult='-1'" value="Perevod newozmojen, povtorite pozje" />
      <set item="Content" condition="//Item/@dbresult='0'" value="S Vashego litsevogo scheta perevedeno #{/Message/Item/Service/Attribute[@name='amount']/@value div 100} r. abonentu #{/Message/Item/Service/Attribute[@name='receiver']/@value}" />
      <set item="Content" condition="//Item/@dbresult='320666'" value="Nevernij kod awtorizatsii" />
      <set item="Content" condition="//Item/@dbresult='320704'" value="Prediduschaja zajavka ne obrabotana, povtorite pozje" />
      <set item="Content" condition="//Item/@dbresult='320999'" value="Srok dejstwija koda awtorizatsii istek" />
      <set item="Content" condition="//Item/@dbresult='320362'" value="U abonenta #{/Message/Item/Service/Attribute[@name='receiver']/@value} otkljuchena vozmozhnost priema P-t-P" />
      <set item="Content" condition="//Item/@dbresult='320361'" value="Usluga zablokirovana, obratites w slujbu podderzhki" />
      <set item="Content" condition="//Item/@dbresult='320101'" value="Powtornij vvod informatsii, pojalujsta, sledujte instruktsii" />
      <set item="Content" condition="//Item/@dbresult='320714'" value="Dostignut predel chisla poluchatelej" />
      <set item="Content" condition="//Item/@dbresult='320710'" value="Slishkom malenkaja summa perevoda" />
      <set item="Content" condition="//Item/@dbresult='320701'" value="Slishkom bolshaja summa perevoda" />
      <set item="Content" condition="//Item/@dbresult='320711'" value="Ukazannaja summa previshaet limit perevodimih sredstv na segodnja" />
      <set item="Content" condition="//Item/@dbresult='320712'" value="Prevyshen limit dlya poluchatelya za sutki" />
      <set item="Content" condition="//Item/@dbresult='320713'" value="Nomer poluchatelja sovpadaet s Vashim nomerom, pojalujsta, povtorite vvod" />
      <set item="Content" condition="//Item/@dbresult='320709'" value="Usluga zablokirovana, obratites w slujbu podderzhki" />
      <set item="Content" condition="//Item/@dbresult='320191'" value="Na vashem schetu nedostatochno sredstv dlja perevoda abonentu #{/Message/Item/Service/Attribute[@name='receiver']/@value}" />
      <set item="Content" condition="//Item/@dbresult='320713'" value="Nomer poluchatelja sovpadaet s Vashim nomerom, pojalujsta, povtorite vvod" />
      <set item="Content" condition="//Item/@dbresult='320709'" value="Usluga zablokirovana, obratites w slujbu podderzhki" />
      <set item="Sender" value="363" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="iso-8859-1" />
    </deliveryTemplate>
    <deliveryTemplate dropReply="true" />
  </template>
  <template procedureName="rej_p2p">
    <condition>
      <test item="${Recipient}" matches="^363$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Oshibka v zaprose - proverte i sozdayte zapros snowa v formate: 375xxxxxxxxx summa" />
      <set item="Recipient" value="${customer}" />
      <set item="Sender" value="363" />
      <set item="Encoding" value="iso-8859-1" />
    </deliveryTemplate>
  </template>
  <!-- ACHTUNG SPONSOR -->
  <template procedureName="add_sponsor">
    <condition>
      <test item="${Sender}" matches="^(375297776|3752925025|375297003002|375292504781)$" />
      <test item="${Recipient}" matches="^336$" />
      <test item="${token0}" matches="^1$" />
      <test item="${token1}" matches="^\d{12}$" />
      <test item="${token2}" matches="^[0-9]{1,3}$" />
      <test item="${token3}" matches="^[0-9]{1,3}$" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}">
          <Service id="sponsorrequest" action="5">
            <Attribute name="receiver" value="${token1}" />
            <Attribute name="amount" value="${token2}" />
            <Attribute name="period" value="${token3}" />
            <Attribute name="metric" value="DAY" />
            <Attribute name="operation" value="${token0}" />
          </Service>
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="dbresult #{//Item/@dbresult}" />
      <set item="Content" condition="//Item/@dbresult='0'" value="Dlya podtwerjdeniya perevoda #{/Message/Item/Service/Attribute[@name='amount']/@value div 100} r. abonentu ${receiver} kajdie #{/Message/Item/Service/Attribute[@name='period']/@value} dn. prishlite kod #{/Message/Item/Service/Attribute[@name='code']/@value} na nomer 336" />
      <set item="Content" condition="//Item/@dbresult='-1'" value="Perevod nevozmojen, povtorite pozje" />
      <set item="Content" condition="//Item/@dbresult='320666'" value="Nevernij kod awtorizatsii" />
      <set item="Content" condition="//Item/@dbresult='320704'" value="Prediduschaja zajavka ne obrabotana, povtorite pozje" />
      <set item="Content" condition="//Item/@dbresult='320999'" value="Srok dejstvija koda avtorizatsii istek" />
      <set item="Content" condition="//Item/@dbresult='320362'" value="U abonenta #{/Message/Item/Service/Attribute[@name='receiver']/@value} otkljuchena vozmozhnost priema P-t-P" />
      <set item="Content" condition="//Item/@dbresult='320703'" value="U abonenta #{/Message/Item/Service/Attribute[@name='receiver']/@value} otkljuchena vozmozhnost priema P-t-P" />
      <set item="Content" condition="//Item/@dbresult='320361'" value="Usluga zablokirovana, obratites v slujbu podderzhki" />
      <set item="Content" condition="//Item/@dbresult='320702'" value="Usluga zablokirovana, obratites v slujbu podderzhki" />
      <set item="Content" condition="//Item/@dbresult='320101'" value="Povtornij vvod informatsii, pojalujsta, sledujte instruktsii" />
      <set item="Content" condition="//Item/@dbresult='320714'" value="Dostignut predel chisla poluchatelej" />
      <set item="Content" condition="//Item/@dbresult='320710'" value="Slishkom malenkaja summa perevoda" />
      <set item="Content" condition="//Item/@dbresult='320701'" value="Slishkom bolshaja summa perevoda" />
      <set item="Content" condition="//Item/@dbresult='320711'" value="Ukazannaja summa previshaet limit perevodimih sredstv na segodnja" />
      <set item="Content" condition="//Item/@dbresult='320712'" value="Prevyshen limit dlya poluchatelya za sutki" />
      <set item="Content" condition="//Item/@dbresult='320713'" value="Nomer poluchatelja sovpadaet s Vashim nomerom, pojalujsta, povtorite vvod" />
      <set item="Content" condition="//Item/@dbresult='320709'" value="Usluga zablokirovana, obratites w slujbu podderzhki" />
      <set item="Content" condition="//Item/@dbresult='320191'" value="Na vashem schetu nedostatochno sredstv dlja perevoda #{/Message/Item/Service/Attribute[@name='amount']/@value div 100} r. abonentu #{/Message/Item/Service/Attribute[@name='receiver']/@value}" />
      <set item="Sender" value="336" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="iso-8859-1" />
    </deliveryTemplate>
  </template>
  <template procedureName="del_sponsor">
    <condition>
      <test item="${Recipient}" matches="^336$" />
      <test item="${token0}" matches="^2$" />
      <test item="${token1}" matches="^\d{12}$" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}">
          <Service id="sponsorrequest" action="5">
            <Attribute name="receiver" value="${token1}" />
            <Attribute name="amount" value="0" />
            <Attribute name="period" value="0" />
            <Attribute name="metric" value="DAY" />
            <Attribute name="operation" value="${token0}" />
          </Service>
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="dbresult #{//Item/@dbresult}" />
      <set item="Content" condition="//Item/@dbresult='0'" value="Dlya otmeny perevodov abonentu ${receiver} prishlite kod #{/Message/Item/Service/Attribute[@name='code']/@value} na nomer 336" />
      <set item="Content" condition="//Item/@dbresult='-1'" value="Otmena perevoda nevozmojna, povtorite pozje" />
      <set item="Content" condition="//Item/@dbresult='320666'" value="Nevernij kod awtorizatsii" />
      <set item="Content" condition="//Item/@dbresult='320704'" value="Prediduschaja zajavka ne obrabotana, povtorite pozje" />
      <set item="Content" condition="//Item/@dbresult='320999'" value="Srok dejstvija koda avtorizatsii istek" />
      <set item="Content" condition="//Item/@dbresult='320362'" value="U abonenta #{/Message/Item/Service/Attribute[@name='receiver']/@value} otkljuchena vozmozhnost priema P-t-P" />
      <set item="Content" condition="//Item/@dbresult='320703'" value="U abonenta #{/Message/Item/Service/Attribute[@name='receiver']/@value} otkljuchena vozmozhnost priema P-t-P" />
      <set item="Content" condition="//Item/@dbresult='320361'" value="Usluga zablokirovana, obratites v slujbu podderzhki" />
      <set item="Content" condition="//Item/@dbresult='320702'" value="Usluga zablokirovana, obratites v slujbu podderzhki" />
      <set item="Content" condition="//Item/@dbresult='320101'" value="Povtornij vvod informatsii, pojalujsta, sledujte instruktsii" />
      <set item="Content" condition="//Item/@dbresult='320714'" value="Dostignut predel chisla poluchatelej" />
      <set item="Content" condition="//Item/@dbresult='320710'" value="Slishkom malenkaja summa perevoda" />
      <set item="Content" condition="//Item/@dbresult='320701'" value="Slishkom bolshaja summa perevoda" />
      <set item="Content" condition="//Item/@dbresult='320711'" value="Ukazannaja summa previshaet limit perevodimih sredstv na segodnja" />
      <set item="Content" condition="//Item/@dbresult='320712'" value="Prevyshen limit dlya poluchatelya za sutki" />
      <set item="Content" condition="//Item/@dbresult='320713'" value="Nomer poluchatelja sovpadaet s Vashim nomerom, pojalujsta, povtorite vvod" />
      <set item="Content" condition="//Item/@dbresult='320709'" value="Usluga zablokirovana, obratites w slujbu podderzhki" />
      <set item="Content" condition="//Item/@dbresult='320191'" value="Na vashem schetu nedostatochno sredstv dlja perevoda #{/Message/Item/Service/Attribute[@name='amount']/@value div 100} r. abonentu #{/Message/Item/Service/Attribute[@name='receiver']/@value}" />
      <set item="Sender" value="336" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="iso-8859-1" />
    </deliveryTemplate>
  </template>
  <template procedureName="confirm_sponsor">
    <condition>
      <test item="${Recipient}" matches="^336$" />
      <test item="${Content}" matches="^[0-9]{4}$" />
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}">
          <Service id="sponsoracceptance" action="5">
            <Attribute name="code" value="${Content}" />
          </Service>
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="dbresult #{//Item/@dbresult}" />
      <set item="Content" condition="//Item/@dbresult='-1'" value="Perevod newozmojen, povtorite pozje" />
      <set item="Content" condition="//Item/@dbresult='0'" value="Operacija dlja abonenta #{/Message/Item/Service/Attribute[@name='receiver']/@value} zaregistrirovana" />
      <set item="Content" condition="//Item/@dbresult='320666'" value="Nevernij kod awtorizatsii" />
      <set item="Content" condition="//Item/@dbresult='320704'" value="Prediduschaja zajavka ne obrabotana, povtorite pozje" />
      <set item="Content" condition="//Item/@dbresult='320999'" value="Srok dejstwija koda awtorizatsii istek" />
      <set item="Content" condition="//Item/@dbresult='320362'" value="U abonenta #{/Message/Item/Service/Attribute[@name='receiver']/@value} otkljuchena vozmozhnost priema P-t-P" />
      <set item="Content" condition="//Item/@dbresult='320361'" value="Usluga zablokirovana, obratites w slujbu podderzhki" />
      <set item="Content" condition="//Item/@dbresult='320101'" value="Powtornij vvod informatsii, pojalujsta, sledujte instruktsii" />
      <set item="Content" condition="//Item/@dbresult='320714'" value="Dostignut predel chisla poluchatelej" />
      <set item="Content" condition="//Item/@dbresult='320710'" value="Slishkom malenkaja summa perevoda" />
      <set item="Content" condition="//Item/@dbresult='320701'" value="Slishkom bolshaja summa perevoda" />
      <set item="Content" condition="//Item/@dbresult='320711'" value="Ukazannaja summa previshaet limit perevodimih sredstv na segodnja" />
      <set item="Content" condition="//Item/@dbresult='320712'" value="Prevyshen limit dlya poluchatelya za sutki" />
      <set item="Content" condition="//Item/@dbresult='320191'" value="Na vashem schetu nedostatochno sredstv dlja perevoda #{/Message/Item/Service/Attribute[@name='amount']/@value div 100} r. abonentu #{/Message/Item/Service/Attribute[@name='receiver']/@value}" />
      <set item="Content" condition="//Item/@dbresult='320713'" value="Nomer poluchatelja sovpadaet s Vashim nomerom, pojalujsta, povtorite vvod" />
      <set item="Content" condition="//Item/@dbresult='320709'" value="Usluga zablokirovana, obratites w slujbu podderzhki" />
      <set item="Sender" value="336" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="iso-8859-1" />
    </deliveryTemplate>
  </template>
  <template procedureName="rej_sponsor">
    <condition>
      <test item="${Recipient}" matches="^336$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Oshibka v zaprose - proverte i sozdayte zapros snowa v formate:operacija nomer summa period" />
      <set item="Recipient" value="${customer}" />
      <set item="Sender" value="336" />
      <set item="Encoding" value="iso-8859-1" />
    </deliveryTemplate>
  </template>
  <template procedureName="CCP_registration">
    <condition>
      <test item="${Recipient}" matches="^297$" />
      <test item="${token0}" matches="^[0-9]{3,5}$" />
      <test item="${token1}" matches="^[0-9]{1,3}$" />
    </condition>
    <receiveTemplate>
      <Message type="bankcardpayments" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}" subject="register" datasource="cust">
          <Attribute name="pMSISDN" value="${Sender}" />
          <Attribute name="pBank_Id" value="${token0}" />
          <Attribute name="pThreshold_Value" value="${token1}" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="CRASH" />
      <set item="Content" condition="//Item/@dbresult='0'" value="DONE" />
      <set item="Content" condition="//Item/@dbresult='-20000'" value="param_invalid" />
      <set item="Content" condition="//Item/@dbresult='-20001'" value="msisdn_invalid" />
      <set item="Content" condition="//Item/@dbresult='-20002'" value="not_registered" />
      <set item="Content" condition="//Item/@dbresult='-20003'" value="only_one_msisdn_on_pa_available" />
      <set item="Content" condition="//Item/@dbresult='-20004'" value="pa_unknown" />
      <set item="Content" condition="//Item/@dbresult='-20005'" value="balance_storage_unknown" />
      <set item="Content" condition="//Item/@dbresult='-20006'" value="cannot_call_AM_BALANCE.UPDATE_BALANCE_LIMITS" />
      <set item="Content" condition="//Item/@dbresult='-20007'" value="service_closed" />
      <set item="Content" condition="//Item/@dbresult='-20008'" value="already_registered" />
      <set item="Content" condition="//Item/@dbresult='-20009'" value="already_registered" />
      <set item="Sender" value="297" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="CCP_canselreg">
    <condition>
      <test item="${Recipient}" matches="^297$" />
      <test item="${token0}" matches="^0$" />
    </condition>
    <receiveTemplate>
      <Message type="bankcardpayments" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}" subject="canselreg" datasource="cust">
          <Attribute name="pMSISDN" value="${Sender}" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="CRASH" />
      <set item="Content" condition="//Item/@dbresult='0'" value="DONE" />
      <set item="Content" condition="//Item/@dbresult='-20000'" value="param_invalid" />
      <set item="Content" condition="//Item/@dbresult='-20001'" value="msisdn_invalid" />
      <set item="Content" condition="//Item/@dbresult='-20002'" value="not_registered" />
      <set item="Content" condition="//Item/@dbresult='-20003'" value="only_one_msisdn_on_pa_available" />
      <set item="Content" condition="//Item/@dbresult='-20004'" value="pa_unknown" />
      <set item="Content" condition="//Item/@dbresult='-20005'" value="balance_storage_unknown" />
      <set item="Content" condition="//Item/@dbresult='-20006'" value="cannot_call_AM_BALANCE.UPDATE_BALANCE_LIMITS" />
      <set item="Content" condition="//Item/@dbresult='-20007'" value="service_closed" />
      <set item="Content" condition="//Item/@dbresult='-20008'" value="already_registered" />
      <set item="Content" condition="//Item/@dbresult='-20009'" value="already_registered" />
      <set item="Sender" value="297" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="CCP_changeatt">
    <condition>
      <test item="${Recipient}" matches="^297$" />
      <test item="${token0}" matches="^1$" />
      <test item="${token1}" matches="^[0-9]{1,3}$" />
    </condition>
    <receiveTemplate>
      <Message type="bankcardpayments" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}" subject="change" datasource="cust">
          <Attribute name="pMSISDN" value="${Sender}" />
          <Attribute name="pThreshold_Value" value="${token1}" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="CRASH" />
      <set item="Content" condition="//Item/@dbresult='0'" value="DONE" />
      <set item="Content" condition="//Item/@dbresult='-20000'" value="param_invalid" />
      <set item="Content" condition="//Item/@dbresult='-20001'" value="msisdn_invalid" />
      <set item="Content" condition="//Item/@dbresult='-20002'" value="not_registered" />
      <set item="Content" condition="//Item/@dbresult='-20003'" value="only_one_msisdn_on_pa_available" />
      <set item="Content" condition="//Item/@dbresult='-20004'" value="pa_unknown" />
      <set item="Content" condition="//Item/@dbresult='-20005'" value="balance_storage_unknown" />
      <set item="Content" condition="//Item/@dbresult='-20006'" value="cannot_call_AM_BALANCE.UPDATE_BALANCE_LIMITS" />
      <set item="Content" condition="//Item/@dbresult='-20007'" value="service_closed" />
      <set item="Content" condition="//Item/@dbresult='-20008'" value="already_registered" />
      <set item="Content" condition="//Item/@dbresult='-20009'" value="already_registered" />
      <set item="Sender" value="297" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="CCP_onepayment">
    <condition>
      <test item="${Recipient}" matches="^297$" />
      <test item="${token0}" matches="^[0-9]{1,3}$" />
    </condition>
    <receiveTemplate>
      <Message type="bankcardpayments" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}" subject="payment" datasource="cust">
          <Attribute name="pMSISDN" value="${Sender}" />
          <Attribute name="pAmount" value="${token0}" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="CRASH" />
      <set item="Content" condition="//Item/@dbresult='0'" value="DONE" />
      <set item="Content" condition="//Item/@dbresult='-20000'" value="param_invalid" />
      <set item="Content" condition="//Item/@dbresult='-20001'" value="msisdn_invalid" />
      <set item="Content" condition="//Item/@dbresult='-20002'" value="not_registered" />
      <set item="Content" condition="//Item/@dbresult='-20003'" value="only_one_msisdn_on_pa_available" />
      <set item="Content" condition="//Item/@dbresult='-20004'" value="pa_unknown" />
      <set item="Content" condition="//Item/@dbresult='-20005'" value="balance_storage_unknown" />
      <set item="Content" condition="//Item/@dbresult='-20006'" value="cannot_call_AM_BALANCE.UPDATE_BALANCE_LIMITS" />
      <set item="Content" condition="//Item/@dbresult='-20007'" value="service_closed" />
      <set item="Content" condition="//Item/@dbresult='-20008'" value="already_registered" />
      <set item="Content" condition="//Item/@dbresult='-20009'" value="already_registered" />
      <set item="Sender" value="297" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="CCP_wrongformat">
    <condition>
      <test item="${Recipient}" matches="^297$" />
    </condition>
    <receiveTemplate>
      <Message initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="wrong format" />
      <set item="Sender" value="297" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- РАЗНОЕ -->
  <template procedureName="ServNumRejectSMSC" persistent="false">
    <condition>
      <test item="${Sender}" matches="^375336770003$" />
    </condition>
    <receiveTemplate>
      <Message />
    </receiveTemplate>
    <deliveryTemplate dropReply="true" />
  </template>
  <template procedureName="ServNumReject" persistent="false">
    <condition>
      <test item="#{count(document('addrList.xml')//item[@addr='${Recipient}'])}" matches="^0$" />
    </condition>
    <receiveTemplate>
      <Message>
        <Item customer="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Ошибочный сервисный номер!" />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="SMSIncomingContent">
    <condition />
    <receiveTemplate>
      <Message type="incomingcontent" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Channel id="sms" />
        <Item recipient="${Recipient}" sender="${Sender}" timestamp="@{now}">
          <Content charset="${encoding}">${Content}</Content>
        </Item>
      </Message>
    </receiveTemplate>
    <retry delay="5" attempts="1" />
    <deliveryTemplate>
      <set item="Content" value="#{//Content/text()}" />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${Customer}" />
      <set item="Encoding" value="#{//Content/@charset}" />
      <set item="Encoding" condition="not(//Content/@charset)" value="unicodefffe" />
      <set item="Encoding" value="ascii" />
    </deliveryTemplate>
  </template>
  <!-- kostyl 
dropat 'Gruppa' l'gotnaia zgp ...
sms s nomera 364 ptp perevod podtverjdenie abonenty A-->
  <template procedureName="DeliveryRequest" persistent="true">
    <retry delay="300" attempts="2" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37500'}" dropReply="true" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37515'}" dropReply="true" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37516'}" dropReply="true" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37517'}" dropReply="true" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37521'}" dropReply="true" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37522'}" dropReply="true" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37523'}" dropReply="true" />
    <deliveryTemplate conditionEx="#{(substring(//Content/text(),1,6) = 'Gruppa')}" dropReply="true" />
    <deliveryTemplate conditionEx="#{(substring(//Content/text(),1,20) = 'Vypolneno popolnenie') or (substring(//Content/text(),1,20) = 'Выполнено пополнение') or (substring(//Content/text(),1,18) = 'Пополнение баланса')}">
      <set item="Content" value="#{//Content/text()}" />
      <set item="Sender" value="364" />
      <!--<set item="Encoding" value="#{//Content/@charset}" />
      		<set item="Encoding" condition="not(//Content/@charset)" value="unicodefffe" /> -->
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
      <!--<set item="ValidityPeriod" condition = "//Item/@validityPeriod" value="${validityPeriod}" />
      		<set item="ScheduleDeliveryTime" condition = "//Item/@scheduleTime" value="${scheduleTime}" /> -->
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="Content" value="#{//Content/text()}" />
      <set item="Sender" value="0870" />
      <set item="Encoding" value="unicodefffe" />
      <!--<set item="Encoding" value="#{//Content/@charset}" />
      		<set item="Encoding" condition="not(//Content/@charset)" value="unicodefffe" /> -->
      <set item="Recipient" value="${customer}" />
      <!-- <set item="ValidityPeriod" condition = "//Item/@validityPeriod" value="${validityPeriod}" />
      		<set item="ScheduleDeliveryTime" condition = "//Item/@scheduleTime" value="${scheduleTime}" /> -->
    </deliveryTemplate>
  </template>
  <template procedureName="DeliveryRequestPtP" persistent="true">
    <retry delay="300" attempts="2" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37500'}" dropReply="true" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37515'}" dropReply="true" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37516'}" dropReply="true" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37517'}" dropReply="true" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37521'}" dropReply="true" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37522'}" dropReply="true" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37523'}" dropReply="true" />
    <deliveryTemplate>
      <set item="Content" value="#{//Content/text()}" />
      <set item="Sender" value="364" />
      <!--<set item="Encoding" value="#{//Content/@charset}" />
      <set item="Encoding" condition="not(//Content/@charset)" value="unicodefffe" /> -->
      <set item="Encoding" value="unicodefffe" />
      <set item="Recipient" value="${customer}" />
      <!-- <set item="ValidityPeriod" condition = "//Item/@validityPeriod" value="${validityPeriod}" />
      <set item="ScheduleDeliveryTime" condition = "//Item/@scheduleTime" value="${scheduleTime}" /> -->
    </deliveryTemplate>
  </template>
  <template procedureName="DeliveryRequestIssa" persistent="true">
    <retry delay="300" attempts="2" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37500'}" dropReply="true" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37515'}" dropReply="true" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37516'}" dropReply="true" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37517'}" dropReply="true" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37521'}" dropReply="true" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37522'}" dropReply="true" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37523'}" dropReply="true" />
    <deliveryTemplate conditionEx="#{(substring(//Content/text(),1,18) = 'Произведен вход в ')}">
      <set item="Content" value="#{//Content/text()}" />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
      <!--set item="Encoding" value="#{if(count(/Message/Package/Item/Content/@charset)>0,/Message/Package/Item/Content/@charset,@{GetEncoding(#{translate(//Content/text(),',','.')},'unicodefffe','ascii')})}" /-->
      <set item="Encoding" value="#{//Content/@charset}" />
      <set item="Encoding" condition="not(//Content/@charset)" value="unicodefffe" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="Content" value="#{//Content/text()}" />
      <set item="Sender" value="#{if(substring('${Sender}',1,3)='375','1241${Sender}','0870')}" />
      <set item="Recipient" value="${customer}" />
      <!--set item="Encoding" value="#{if(count(/Message/Package/Item/Content/@charset)>0,/Message/Package/Item/Content/@charset,@{GetEncoding(#{translate(//Content/text(),',','.')},'unicodefffe','ascii')})}" /-->
      <set item="Encoding" value="#{//Content/@charset}" />
      <set item="Encoding" condition="not(//Content/@charset)" value="unicodefffe" />
      <!--<set item="ValidityPeriod" condition = "//Item/@validityPeriod" value="${validityPeriod}" />
      <set item="ScheduleDeliveryTime" condition = "//Item/@scheduleTime" value="${scheduleTime}" /> -->
    </deliveryTemplate>
  </template>
  <!--	
	<template procedureName="DB_AddRemoveService">
        <condition>
            <test item="0" matches="1" />
        </condition>
	<retry delay="300" attempts="2" />
        <deliveryTemplate>
            <set item="Content" value="#{//Content/text()}" />
            <set item="Sender" value="0870" />
            <set item="Recipient" value="${customer}" />
            <set item="Encoding" value="ascii" />
            <set item="ScheduleDeliveryTime" value="#{getTimeInRange('08:00','23:30')}" /> 
            <set item="ValidityPeriod" value="#{getTimeInRange('11:00','23:30')}" />  
            <set item="RegisteredDelivery" value="false" />
        </deliveryTemplate>
	 </template>

	
	<template procedureName="DeliveryRequestBMS">
        <condition>
            <test item="0" matches="1" />
        </condition>
	<retry delay="300" attempts="2" />
        <deliveryTemplate>
            <set item="Content" value="#{//Content/text()}" />
            <set item="Sender" value="0870" />
            <set item="Recipient" value="${customer}" />
            <set item="Encoding" value="ascii" />
            <set item="ScheduleDeliveryTime" value="#{getTimeInRange('08:00','23:30')}" />  
            <set item="ValidityPeriod" value="#{getTimeInRange('11:00','23:30')}" />  
            <set item="RegisteredDelivery" value="false" />
        </deliveryTemplate>
	 </template>
-->
</templates>