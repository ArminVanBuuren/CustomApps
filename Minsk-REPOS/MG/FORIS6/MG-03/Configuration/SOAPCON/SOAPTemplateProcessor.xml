<templates connector="SOAP">
  #include "..\..\config\get_bms_counters\soap.xml"
  #include "..\..\config\mobile_commerce\soap.xml"
  #include "..\..\config\MISC\misc.xml"
  #include "..\..\config\USSDP\ussdp.xml"
  #include "..\..\config\Fake\fake.xml"
  #include "..\..\config\callcenter\callcenter.xml"
  <!--  MTS_AddCountSIMLBS -->
  <template procedureName="MTS_AddCountSIMLBS" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_AddCountSIMLBS" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(CountSIMLBScustomer,${customer})}
        @{store(CountSIMLBSservicecode,${servicecode})}
        @{store(CountSIMLBSsourceid,${sourceid})}
        @{store(CountSIMLBSCountSIM,${countsim})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="AddCountSIMLBS">
      <set item="iparam:customer" value="${CountSIMLBScustomer}" />
      <set item="iparam:servicecode" value="${CountSIMLBSservicecode}" />
      <set item="iparam:sourceid" value="${CountSIMLBSsourceid}" />
      <set item="iparam:countsim" value="${CountSIMLBSCountSIM}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="servicecode" />
      <param name="customer" />
      <param name="countsim" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="AddCountSIMLBS" handler="DBCON_01">
    <receiveTemplate>
      <Message type="setprofile" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.add_close_srv_req.add_srv_req_base">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="srv_del_str" type="STRING" value="${servicecode}" />
          <Attribute name="source" type="STRING" value="${sourceid}" />
          <Attribute name="p_param" type="STRING" value="LBS_SIM_COUNT=${countsim}" />
          <Attribute name="dbresult" type="STRING" />
          <Attribute name="wf_de" type="STRING" />
          <Attribute name="reply" type="STRING" />
          <Attribute name="ret_code" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:result" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:dbresult" value="${ret_code}" />
      <set item="oparam:result" value="${reply}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="servicecode" />
      <param name="customer" />
      <param name="countsim" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <!--  MTS_CheckIDCustomerLBS -->
  <template procedureName="MTS_CheckIDCustomerLBS" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_CheckIDCustomerLBS" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(CheckIDCustomercustomer,${customer})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="CheckIDCustomerMTSLBS">
      <set item="iparam:customer" value="${CheckIDCustomercustomer}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="customer" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="CheckIDCustomerMTSLBS" handler="DBCON_01">
    <receiveTemplate>
      <Message type="setprofile" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.lll_lbs">
          <Attribute name="v_msisdn" type="STRING" value="${customer}" />
          <Attribute name="v_cust_id" type="STRING" />
          <Attribute name="v_fiz_ur" type="STRING" />
          <Attribute name="o_blk" type="STRING" />
          <Attribute name="o_admin_lbs" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:CustomerID" condition="//Item/@dbresult='0'" value="${v_cust_id}" />
      <set item="oparam:CustomerID" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:CustomerType" condition="//Item/@dbresult='0'" value="${v_fiz_ur}" />
      <set item="oparam:CustomerType" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:Blocking" condition="//Item/@dbresult='0'" value="${o_blk}" />
      <set item="oparam:Blocking" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:ServiceAdminLBS" condition="//Item/@dbresult='0'" value="${o_admin_lbs}" />
      <set item="oparam:ServiceAdminLBS" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="CustomerID" />
      <param name="CustomerType" />
      <param name="Blocking" />
      <param name="ServiceAdminLBS" />
    </output>
  </template>
  <!--    MTS_CheckPersonalDataUL            -->
  <template procedureName="MTS_CheckPersonalDataUL" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_CheckPersonalDataUL" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(CheckPersonalDataULsource_id,${source_id})}
        @{store(CheckPersonalDataULoperator_id,${operator_id})}
        @{store(CheckPersonalDataULdiler_id${diler_id})}
        @{store(CheckPersonalDataULcustomer_id${customer_id})}
        @{store(CheckPersonalDataULinn${inn})}
        @{store(CheckPersonalDataULfull_name${full_name})}
        @{store(CheckPersonalDataULshort_name${short_name})}
        @{store(CheckPersonalDataULownership_type${ownership_type})}
        @{store(CheckPersonalDataULur_address${ur_address})}
        @{store(CheckPersonalDataULcontract_number${contract_number})}
        @{store(CheckPersonalDataULlegal_category_id${legal_category_id})}
        @{store(CheckPersonalDataULmsisdn${msisdn})}
        @{store(CheckPersonalDataULtariff_plan_id${tariff_plan_id})}
        @{store(CheckPersonalDataULadd_info${add_info})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="Check_Personal_DataUL">
      <set item="iparam:source_id" value="${CheckPersonalDataULsource_id}" />
      <set item="iparam:operator_id" value="${CheckPersonalDataULoperator_id}" />
      <set item="iparam:diler_id" value="${CheckPersonalDataULdiler_id}" />
      <set item="iparam:customer_id" value="${CheckPersonalDataULcustomer_id}" />
      <set item="iparam:inn" value="${CheckPersonalDataULinn}" />
      <set item="iparam:full_name" value="${CheckPersonalDataULfull_name}" />
      <set item="iparam:short_name" value="${CheckPersonalDataULshort_name}" />
      <set item="iparam:ownership_type" value="${CheckPersonalDataULownership_type}" />
      <set item="iparam:ur_address" value="${CheckPersonalDataULur_address}" />
      <set item="iparam:contract_number" value="${CheckPersonalDataULcontract_number}" />
      <set item="iparam:legal_category_id" value="${CheckPersonalDataULlegal_category_id}" />
      <set item="iparam:msisdn" value="${CheckPersonalDataULmsisdn}" />
      <set item="iparam:tariff_plan_id" value="${CheckPersonalDataULtariff_plan_id}" />
      <set item="iparam:add_info" value="${CheckPersonalDataULadd_info}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="source_id" />
      <param name="operator_id" />
      <param name="customer_id" />
      <param name="diler_id" />
      <param name="inn" />
      <param name="full_name" />
      <param name="short_name" />
      <param name="ownership_type" />
      <param name="ur_address" />
      <param name="contract_number" />
      <param name="legal_category_id" />
      <param name="msisdn" />
      <param name="tariff_plan_id" />
      <param name="add_info" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="Check_Personal_DataUL" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="@{newGuid}" session_id="@{newGuid}">
        <Item procedureName="CUST.CUSTOMER_SITR.CHECK_PERSONAL_DATA_UL">
          <Attribute name="p_source_id" type="STRING" value="${source_id}" />
          <Attribute name="p_operator_id" type="STRING" value="${operator_id}" />
          <Attribute name="p_diler_id" type="STRING" value="${diler_id}" />
          <Attribute name="p_customer_id" type="STRING" value="${customer_id}" />
          <Attribute name="p_inn" type="STRING" value="${inn}" />
          <Attribute name="p_full_name" type="STRING" value="${full_name}" />
          <Attribute name="p_short_name" type="STRING" value="${short_name}" />
          <Attribute name="p_ownership_type" type="STRING" value="${ownership_type}" />
          <Attribute name="p_ur_address" type="STRING" value="${ur_address}" />
          <Attribute name="p_contract_number" type="STRING" value="${contract_number}" />
          <Attribute name="p_legal_category_id" type="STRING" value="${legal_category_id}" />
          <Attribute name="p_msisdn" type="STRING" value="${msisdn}" />
          <Attribute name="p_tariff_plan_id" type="STRING" value="${tariff_plan_id}" />
          <Attribute name="p_add_info" type="STRING" value="${add_info}" />
          <Attribute name="o_answer_code" type="STRING" />
          <Attribute name="o_answer_msg" type="STRING" />
          <Attribute name="o_check_id" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:answer_code" value="${o_answer_code}" />
      <set item="oparam:answer_code" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:answer_msg" value="${o_answer_msg}" />
      <set item="oparam:answer_msg" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:check_id" value="${o_check_id}" />
      <set item="oparam:check_id" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="source_id" />
      <param name="operator_id" />
      <param name="customer_id" />
      <param name="diler_id" />
      <param name="inn" />
      <param name="full_name" />
      <param name="short_name" />
      <param name="ownership_type" />
      <param name="ur_address" />
      <param name="contract_number" />
      <param name="legal_category_id" />
      <param name="msisdn" />
      <param name="tariff_plan_id" />
      <param name="add_info" />
    </input>
    <output>
      <param name="answer_code" />
      <param name="answer_msg" />
      <param name="check_id" />
    </output>
  </template>
  <!--    MTS_CheckPersonalDataUL            -->
  <template procedureName="MTS_CheckPersonalDataFL" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_CheckPersonalDataFL" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(CheckPersonalDataFLsource_id,${source_id})}
        @{store(CheckPersonalDataFLoperator_id,${operator_id})}
        @{store(CheckPersonalDataFLdiler_id${diler_id})}
        @{store(CheckPersonalDataFLcustomer_id${customer_id})}
        @{store(CheckPersonalDataFLsurname${surname})}
        @{store(CheckPersonalDataFLname${name})}
        @{store(CheckPersonalDataFLpatronymic_name${patronymic_name})}
        @{store(CheckPersonalDataFLbirthday${birthday})}
        @{store(CheckPersonalDataFLpersonal_unique_ident${personal_unique_ident})}
        @{store(CheckPersonalDataFLsex${sex})}
        @{store(CheckPersonalDataFLidentification_type_id${identification_type_id})}
        @{store(CheckPersonalDataFLident_series${ident_series})}
        @{store(CheckPersonalDataFLident_number${ident_number})}
        @{store(CheckPersonalDataFLdate_received${date_received})}
        @{store(CheckPersonalDataFLregistration_office${registration_office})}
        @{store(CheckPersonalDataFLcontract_number${contract_number})}
        @{store(CheckPersonalDataFLmsisdn${msisdn})}
        @{store(CheckPersonalDataFLtariff_plan_id${tariff_plan_id})}
        @{store(CheckPersonalDataFLadd_info${add_info})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="Check_Personal_DataFL">
      <set item="iparam:source_id" value="${CheckPersonalDataFLsource_id}" />
      <set item="iparam:operator_id" value="${CheckPersonalDataFLoperator_id}" />
      <set item="iparam:diler_id" value="${CheckPersonalDataFLdiler_id}" />
      <set item="iparam:customer_id" value="${CheckPersonalDataFLcustomer_id}" />
      <set item="iparam:surname" value="${CheckPersonalDataFLsurname}" />
      <set item="iparam:name" value="${CheckPersonalDataFLname}" />
      <set item="iparam:patronymic_name" value="${CheckPersonalDataFLpatronymic_name}" />
      <set item="iparam:birthday" value="${CheckPersonalDataFLbirthday}" />
      <set item="iparam:personal_unique_ident" value="${CheckPersonalDataFLpersonal_unique_ident}" />
      <set item="iparam:sex" value="${CheckPersonalDataFLsex}" />
      <set item="iparam:identification_type_id" value="${CheckPersonalDataFLidentification_type_id}" />
      <set item="iparam:ident_series" value="${CheckPersonalDataFLident_series}" />
      <set item="iparam:ident_number" value="${CheckPersonalDataFLident_number}" />
      <set item="iparam:date_received" value="${CheckPersonalDataFLdate_received}" />
      <set item="iparam:registration_office" value="${CheckPersonalDataFLregistration_office}" />
      <set item="iparam:contract_number" value="${CheckPersonalDataFLcontract_number}" />
      <set item="iparam:msisdn" value="${CheckPersonalDataFLmsisdn}" />
      <set item="iparam:tariff_plan_id" value="${CheckPersonalDataFLtariff_plan_id}" />
      <set item="iparam:add_info" value="${CheckPersonalDataFLadd_info}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="source_id" />
      <param name="operator_id" />
      <param name="diler_id" />
      <param name="customer_id" />
      <param name="surname" />
      <param name="name" />
      <param name="patronymic_name" />
      <param name="birthday" />
      <param name="personal_unique_ident" />
      <param name="sex" />
      <param name="identification_type_id" />
      <param name="ident_series" />
      <param name="ident_number" />
      <param name="date_received" />
      <param name="registration_office" />
      <param name="contract_number" />
      <param name="msisdn" />
      <param name="tariff_plan_id" />
      <param name="add_info" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="Check_Personal_DataFL" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="@{newGuid}" session_id="@{newGuid}">
        <Item procedureName="CUST.CUSTOMER_SITR.CHECK_PERSONAL_DATA_FL">
          <Attribute name="p_source_id" type="STRING" value="${source_id}" />
          <Attribute name="p_operator_id" type="STRING" value="${operator_id}" />
          <Attribute name="p_diler_id" type="STRING" value="${diler_id}" />
          <Attribute name="p_customer_id" type="STRING" value="${customer_id}" />
          <Attribute name="p_surname" type="STRING" value="${surname}" />
          <Attribute name="p_name" type="STRING" value="${name}" />
          <Attribute name="p_patronymic_name" type="STRING" value="${patronymic_name}" />
          <Attribute name="p_birthday" type="STRING" value="${birthday}" />
          <Attribute name="p_personal_unique_ident" type="STRING" value="${personal_unique_ident}" />
          <Attribute name="p_sex" type="STRING" value="${sex}" />
          <Attribute name="p_identification_type_id" type="STRING" value="${identification_type_id}" />
          <Attribute name="p_ident_series" type="STRING" value="${ident_series}" />
          <Attribute name="p_ident_number" type="STRING" value="${ident_number}" />
          <Attribute name="p_date_received" type="STRING" value="${date_received}" />
          <Attribute name="p_registration_office" type="STRING" value="${registration_office}" />
          <Attribute name="p_contract_number" type="STRING" value="${contract_number}" />
          <Attribute name="p_msisdn" type="STRING" value="${msisdn}" />
          <Attribute name="p_tariff_plan_id" type="STRING" value="${tariff_plan_id}" />
          <Attribute name="p_add_info" type="STRING" value="${add_info}" />
          <Attribute name="o_answer_code" type="STRING" />
          <Attribute name="o_answer_msg" type="STRING" />
          <Attribute name="o_check_id" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:answer_code" value="${o_answer_code}" />
      <set item="oparam:answer_code" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:answer_msg" value="${o_answer_msg}" />
      <set item="oparam:answer_msg" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:check_id" value="${o_check_id}" />
      <set item="oparam:check_id" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="source_id" />
      <param name="operator_id" />
      <param name="diler_id" />
      <param name="customer_id" />
      <param name="surname" />
      <param name="name" />
      <param name="patronymic_name" />
      <param name="birthday" />
      <param name="personal_unique_ident" />
      <param name="sex" />
      <param name="identification_type_id" />
      <param name="ident_series" />
      <param name="ident_number" />
      <param name="date_received" />
      <param name="registration_office" />
      <param name="contract_number" />
      <param name="msisdn" />
      <param name="tariff_plan_id" />
      <param name="add_info" />
    </input>
    <output>
      <param name="answer_code" />
      <param name="answer_msg" />
      <param name="check_id" />
    </output>
  </template>
  <!-- MTS_SendSMSMinJust-->
  <template procedureName="MTS_SendSMSAlphaNum" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_SendSMSAlphaNum" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(SendSMSAlphaNumcustomer,${customer})}
        @{store(SendSMSAlphaNumtxt,${txt})}
        @{store(SendSMSAlphasrc,${alpha})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="SendSMSAlphaNumMTS">
      <set item="iparam:customer" value="${SendSMSAlphaNumcustomer}" />
      <set item="iparam:txt" value="${SendSMSAlphaNumtxt}" />
      <set item="iparam:alpha" value="${SendSMSAlphasrc}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="customer" />
      <param name="txt" />
      <param name="alpha" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="SendSMSAlphaNumMTS">
    <receiveTemplate>
      <Message type="SendSMS" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item>
          <Attribute name="customer" type="STRING" value="${customer}" />
          <Attribute name="txt" type="STRING" value="${txt}" />
          <Attribute name="alpha" type="STRING" value="${alpha}" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input" condition="not(matches(/Message/Item/Attribute[@name='customer']/@value,&quot;^[0-9]{10,12}$&quot;))" terminating="true">
      <set item="oparam:rez" value="customer содержит только цифры" />
    </deliveryTemplate>
    <deliveryTemplate direction="input" terminating="false">
      <set item="oparam:rez" value="Сообщение отправлено в SMSC" />
    </deliveryTemplate>
    <deliveryTemplate direction="input" connector="SMSCON_03">
      <set item="Content" value="${txt}" />
      <set item="Recipient" value="${customer}" />
      <set item="Sender" value="${alpha}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="txt" />
      <param name="alpha" />
    </input>
    <output>
      <param name="rez" />
    </output>
  </template>
  <!-- Set PASS -->
  <template procedureName="MTS_SetPassword" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_SetPassword" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(SetPasswordcustomer,${customer})}
        @{store(SetPasswordpassword,${password})}
        @{store(SetPasswordsrc,${sourceid})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="MTSSetPasswordv2">
      <set item="iparam:customer" value="${SetPasswordcustomer}" />
      <set item="iparam:password" value="${SetPasswordpassword}" />
      <set item="iparam:sourceid" value="${SetPasswordsrc}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="customer" />
      <param name="password" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="MTSSetPasswordv2" handler="DBCON_01">
    <receiveTemplate>
      <Message type="setprofile" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.mg_pack.SetPassword">
          <Attribute name="customer" type="STRING" value="${customer}" />
          <Attribute name="newpassword" type="STRING" value="${password}" />
          <Attribute name="src" type="STRING" value="${sourceid}" />
          <Attribute name="dbresult" type="STRING" />
          <Attribute name="detail" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" condition="//Item/@dbresult='0'" value="${dbresult}" />
      <set item="oparam:dbresult" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:detail" condition="//Item/@dbresult='0'" value="${detail}" />
      <set item="oparam:detail" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="password" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="detail" />
    </output>
  </template>
  <!-- MTS_SendSMSMinJust-->
  <template procedureName="MTS_SendSMSMinJust" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_SendSMSMinJust" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(SendSMSMinJustcustomer,${customer})}
        @{store(SendSMSMinJustcode,${txt})}
        @{store(SendSMSMinJusttimeexpr,${time_expr})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="SendSMSMinJust">
      <set item="iparam:customer" value="${SendSMSMinJustcustomer}" />
      <set item="iparam:txt" value="${SendSMSMinJustcode}" />
      <set item="iparam:time_expr" value="${SendSMSMinJusttimeexpr}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="customer" />
      <param name="txt" />
      <param name="time_expr" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="SendSMSMinJust">
    <receiveTemplate>
      <Message type="SendSMS" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item>
          <Attribute name="customer" type="STRING" value="${customer}" />
          <Attribute name="txt" type="STRING" value="${txt}" />
          <Attribute name="time_expr" type="STRING" value="${time_expr}" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input" condition="not(matches(/Message/Item/Attribute[@name='customer']/@value,&quot;^375(29|33|44|25)[0-9]{7}$&quot;))" terminating="true">
      <set item="oparam:rez" value="customer 12 цифр и только цифры" />
    </deliveryTemplate>
    <deliveryTemplate direction="input" terminating="false">
      <set item="oparam:rez" value="Сообщение отправлено в SMSC" />
    </deliveryTemplate>
    <deliveryTemplate direction="input" connector="SMSCON_03">
      <set item="Content" value="${txt}" />
      <set item="Recipient" value="${customer}" />
      <set item="Sender" value="MinJust" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="txt" />
      <param name="time_expr" />
    </input>
    <output>
      <param name="rez" />
    </output>
  </template>
  <!-- MTS_AddRequestMinJust-->
  <template procedureName="MTS_AddRequestMinJust" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_AddRequestMinJust" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(AddRequestMinJustSmsDelReq,${SmsDeliveryRequest})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="AddRequestMinJust_">
      <set item="iparam:SmsDeliveryRequest" value="${AddRequestMinJustSmsDelReq}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="SmsDeliveryRequest" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="AddRequestMinJust_" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="@{newGuid}" session_id="@{newGuid}">
        <Item procedureName="BILLING.minjust.add_request">
          <Attribute name="SmsDeliveryRequest" type="STRING" value="${SmsDeliveryRequest}" />
          <Attribute name="SmsDeliveryRequestAnswer" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:SmsDeliveryRequestAnswer" value="${SmsDeliveryRequestAnswer}" />
      <set item="oparam:SmsDeliveryRequestAnswer" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="SmsDeliveryRequest" />
    </input>
    <output>
      <param name="SmsDeliveryRequestAnswer" />
    </output>
  </template>
  <!-- MTS_GetCodeSMSAuthentication -->
  <template procedureName="MTS_GetCodeSMSAuthentication" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_GetCodeSMSAuthentication" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(CodeSMSAuthenticationcustomer,${customer})}
        @{store(CodeSMSAuthenticationsourceid,${sourceid})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="MTSCodeSMSAuthentication_">
      <set item="iparam:customer" value="${CodeSMSAuthenticationcustomer}" />
      <set item="iparam:sourceid" value="${CodeSMSAuthenticationsourceid}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="customer" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="MTSCodeSMSAuthentication_" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="@{newGuid}" session_id="@{newGuid}">
        <Item procedureName="BILLING.MG_PACK.GenerateCodeSMSAuthentication">
          <Attribute name="i_msisdn" type="STRING" value="${customer}" />
          <Attribute name="i_SRC" type="INT" value="${sourceid}" />
          <Attribute name="o_code" type="STRING" />
          <Attribute name="o_result" type="INT" />
          <Attribute name="o_msisdn" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate terminating="false">
      <set item="oparam:dbresult" value="${o_result}" />
    </deliveryTemplate>
    <deliveryTemplate conditionEx="#{${o_result}=0}" connector="SMSCON_01">
      <set item="Content" value="${o_code}" />
      <set item="Recipient" value="${o_msisdn}" />
    </deliveryTemplate>
    <deliveryTemplate dropReply="true" />
    <input>
      <param name="customer" />
      <param name="sourceid" />
    </input>
    <output>
      <param name="dbresult" />
    </output>
  </template>
  <!--    MTS_GetAbonentAge            -->
  <template procedureName="MTS_GetAbonentAge" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_GetAbonentAge" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(GetAbonentAgeSPCODE,${sp_code})}
        @{store(GetAbonentIDSALE,${id_sale})}
        @{store(GetAbonentINN,${inn})}
        @{store(GetAbonentSURNAME,${surname})}
        @{store(GetAbonentNAME,${fistname})}
        @{store(GetAbonentPATR_NAME,${patr_name})}
        @{store(GetAbonentBIRTHDAY,${birthday})}
        @{store(GetAbonentMSISDN,${msisdn})}
        @{store(GetAbonentIMEI,${imei})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="Get_Abonent_Age_">
      <set item="iparam:sp_code" value="${GetAbonentAgeSPCODE}" />
      <set item="iparam:id_sale" value="${GetAbonentIDSALE}" />
      <set item="iparam:inn" value="${GetAbonentINN}" />
      <set item="iparam:surname" value="${GetAbonentSURNAME}" />
      <set item="iparam:fistname" value="${GetAbonentNAME}" />
      <set item="iparam:patr_name" value="${GetAbonentPATR_NAME}" />
      <set item="iparam:birthday" value="${GetAbonentBIRTHDAY}" />
      <set item="iparam:msisdn" value="${GetAbonentMSISDN}" />
      <set item="iparam:imei" value="${GetAbonentIMEI}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="sp_code" />
      <param name="id_sale" />
      <param name="inn" />
      <param name="surname" />
      <param name="fistname" />
      <param name="patr_name" />
      <param name="birthday" />
      <param name="msisdn" />
      <param name="imei" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="Get_Abonent_Age_" handler="DBCON_02">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="@{newGuid}" session_id="@{newGuid}">
        <Item procedureName="DEDUCT.PALOMA.GET_ABON_AGE">
          <Attribute name="p_sp_code" type="STRING" value="${sp_code}" />
          <Attribute name="p_id_sale" type="STRING" value="${id_sale}" />
          <Attribute name="p_inn" type="STRING" value="${inn}" />
          <Attribute name="p_surname" type="STRING" value="${surname}" />
          <Attribute name="p_name" type="STRING" value="${fistname}" />
          <Attribute name="p_patr_name" type="STRING" value="${patr_name}" />
          <Attribute name="p_birthday" type="STRING" value="${birthday}" />
          <Attribute name="p_msisdn" type="STRING" value="${msisdn}" />
          <Attribute name="p_imei" type="STRING" value="${imei}" />
          <Attribute name="o_result" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:result" value="${o_result}" />
      <set item="oparam:result" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="sp_code" />
      <param name="id_sale" />
      <param name="inn" />
      <param name="surname" />
      <param name="fistname" />
      <param name="patr_name" />
      <param name="birthday" />
      <param name="msisdn" />
      <param name="imei" />
    </input>
    <output>
      <param name="result" />
    </output>
  </template>
  <!--    MTS_MigrateServiceIS            -->
  <template procedureName="MTS_MigrateServiceIS" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_MigrateServiceIS" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(MigrateServiceISCustomer,${customer})}
        @{store(MigrateServiceISsourceid,${sourceid})}
        @{store(MigrateServiceISservicecode,${servicecode})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="Migrate_Service_IS">
      <set item="iparam:customer" value="${MigrateServiceISCustomer}" />
      <set item="iparam:sourceid" value="${MigrateServiceISsourceid}" />
      <set item="iparam:servicecode" value="${MigrateServiceISservicecode}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="customer" />
      <param name="servicecode" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="Migrate_Service_IS" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="@{newGuid}" session_id="@{newGuid}">
        <Item procedureName="billing.mg_pack.migrateserviceis">
          <Attribute name="i_msisdn" type="STRING" value="${customer}" />
          <Attribute name="i_srv_del_str" type="STRING" value="${servicecode}" />
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_add_in_block" type="INT" value="1" />
          <Attribute name="i_ismigrate" type="INT" value="1" />
          <Attribute name="o_dbresult" type="STRING" />
          <Attribute name="o_reply" type="STRING" />
          <Attribute name="o_ret_code" type="STRING" />
          <Attribute name="o_blk" type="INT" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_ret_code}" />
      <set item="oparam:dbresult" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:result" value="${o_reply}" />
      <set item="oparam:result" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:blocking" value="${o_blk}" />
      <set item="oparam:blocking" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="servicecode" />
      <param name="sourceid" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
      <param name="blocking" />
    </output>
  </template>
  <!--    MTS_AddService+Trial             -->
  <template procedureName="MTS_AddServiceTrial" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_AddServiceTrial" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(AddSerTrCustomer,${customer})}
        @{store(AddSerTrTrialDay,${trialday})}
        @{store(AddSerTrsourceid,${sourceid})}
        @{store(AddSerTrservicecode,${servicecode})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="MTSAddServiceandTrial">
      <set item="iparam:customer" value="${AddSerTrCustomer}" />
      <set item="iparam:trialday" value="${AddSerTrTrialDay}" />
      <set item="iparam:sourceid" value="${AddSerTrsourceid}" />
      <set item="iparam:servicecode" value="${AddSerTrservicecode}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="customer" />
      <param name="servicecode" />
      <param name="trialday" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="MTSAddServiceandTrial" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="@{newGuid}" session_id="@{newGuid}">
        <Item procedureName="billing.srv_req_trial">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="srv_del_str" type="STRING" value="${servicecode}" />
          <Attribute name="source" type="STRING" value="${sourceid}" />
          <Attribute name="p_action" type="INT" value="1" />
          <Attribute name="d_trial" type="INT" value="${trialday}" />
          <Attribute name="dbresult" type="STRING" />
          <Attribute name="reply" type="STRING" />
          <Attribute name="ret_code" type="STRING" />
          <Attribute name="blocking" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${ret_code}" />
      <set item="oparam:dbresult" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:result" value="${reply}" />
      <set item="oparam:result" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:blocking" value="${blocking}" />
      <set item="oparam:blocking" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="servicecode" />
      <param name="sourceid" />
      <param name="trialday" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
      <param name="blocking" />
    </output>
  </template>
  <!--    MTS_GetCounterMSISDN             -->
  <template procedureName="MTS_GetCounterMSISDN" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_GetCounterMSISDN" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(MTSGetCounterMSISDNCustomer,${customer})}
        @{store(MTSGetCounterMSISDNCounter,${counter})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="MTSGetCounterMSISDN_">
      <set item="iparam:customer" value="${MTSGetCounterMSISDNCustomer}" />
      <set item="iparam:counter" value="${MTSGetCounterMSISDNCounter}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="customer" />
      <param name="counter" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="MTSGetCounterMSISDN_" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="@{newGuid}" session_id="@{newGuid}">
        <Item procedureName="billing.mg_pack.GetCounterMSISDN">
          <Attribute name="i_msisdn" type="STRING" value="${customer}" />
          <Attribute name="i_counter" type="STRING" value="${counter}" />
          <Attribute name="o_value" type="STRING" />
          <Attribute name="o_volume" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:counter_value" condition="//Item/@dbresult='0'" value="${o_value}" />
      <set item="oparam:counter_value" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:counter_volume" condition="//Item/@dbresult='0'" value="${o_volume}" />
      <set item="oparam:counter_volume" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="counter" />
    </input>
    <output>
      <param name="counter_value" />
      <param name="counter_volume" />
    </output>
  </template>
  <!--    MTS_GetServiceCost             -->
  <template procedureName="MTS_GetServiceCost" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_GetServiceCost" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(MTSGetServiceCostCustomer,${customer})}
        @{store(MTSGetServiceCostServicecode,${servicecode})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="MTSGetServiceCost_">
      <set item="iparam:customer" value="${MTSGetServiceCostCustomer}" />
      <set item="iparam:servicecode" value="${MTSGetServiceCostServicecode}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="customer" />
      <param name="servicecode" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="MTSGetServiceCost_" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="@{newGuid}" session_id="@{newGuid}">
        <Item procedureName="billing.mg_pack.get_servicecost">
          <Attribute name="i_msisdn" type="STRING" value="${customer}" />
          <Attribute name="i_servicecode" type="STRING" value="${servicecode}" />
          <Attribute name="o_srv_code_add" type="STRING" />
          <Attribute name="o_srv_cost_add" type="STRING" />
          <Attribute name="o_srv_code_per" type="STRING" />
          <Attribute name="o_srv_cost_per" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:ServiceCodeAdd" condition="//Item/@dbresult='0'" value="${o_srv_code_add}" />
      <set item="oparam:ServiceCodeAdd" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:ServiceCostAdd" condition="//Item/@dbresult='0'" value="${o_srv_cost_add}" />
      <set item="oparam:ServiceCostAdd" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:ServiceCodePeriod" condition="//Item/@dbresult='0'" value="${o_srv_code_per}" />
      <set item="oparam:ServiceCodePeriod" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:ServiceCostPeriod" condition="//Item/@dbresult='0'" value="${o_srv_cost_per}" />
      <set item="oparam:ServiceCostPeriod" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="servicecode" />
    </input>
    <output>
      <param name="ServiceCodeAdd" />
      <param name="ServiceCostAdd" />
      <param name="ServiceCodePeriod" />
      <param name="ServiceCostPeriod" />
    </output>
  </template>
  <!--	<template procedureName="AuthPortal" handler="DBCON_01">
		<receiveTemplate>
			<Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
				<Item procedureName="billing.mg_AuthPortal" >
					<Attribute name="p_msisdn" type="STRING" value="${customer}" />
					<Attribute name="p_pass" type="STRING" value="${password}"/> 
					<Attribute name="dbresult" type="STRING" /> 
				</Item>
			</Message>
		</receiveTemplate>
		<deliveryTemplate >
			<set item="oparam:dbresult" value="Ошибка при выполнении запроса." /> 		
		</deliveryTemplate>
		<input>
			<param name="customer" />
			<param name="password" />	  
		</input>
		<output>
			<param name="dbresult" />
		</output>
	</template>  -->
  <!--    MTS_BISendResult            -->
  <template procedureName="MTS_BISendResult" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_BISendResult" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(BISndResAcc,${acc})}
        @{store(BISndResPersNum,${pers_num})}
        @{store(BISndResBankAnswer,${bank_answer})}
        @{store(BISndResCreditDog,${credit_dog})}
        @{store(BISndResCreditSumm,${credit_summ})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="MTSBISendResult_">
      <set item="iparam:acc" value="${BISndResAcc}" />
      <set item="iparam:pers_num" value="${BISndResPersNum}" />
      <set item="iparam:bank_answer" value="${BISndResBankAnswer}" />
      <set item="iparam:credit_dog" value="${BISndResCreditDog}" />
      <set item="iparam:credit_summ" value="${BISndResCreditSumm}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="acc" />
      <param name="pers_num" />
      <param name="bank_answer" />
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="credit_dog" />
      <param name="credit_summ" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="MTSBISendResult_" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="@{newGuid}" session_id="@{newGuid}">
        <Item procedureName="billing.BANK_INST.BI_SEND_RESULT">
          <Attribute name="p_acc" type="STRING" value="${acc}" />
          <Attribute name="p_pers_num" type="STRING" value="${pers_num}" />
          <Attribute name="p_bank_ans" type="STRING" value="${bank_answer}" />
          <Attribute name="p_credit_dog" type="STRING" value="${credit_dog}" />
          <Attribute name="p_credit_sum" type="STRING" value="${credit_summ}" />
          <Attribute name="dbresult" type="STRING" />
          <Attribute name="msg" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" condition="//Item/@dbresult='0'" value="${dbresult}" />
      <set item="oparam:dbresult" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:reply" condition="//Item/@dbresult='0'" value="${msg}" />
      <set item="oparam:reply" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="acc" />
      <param name="pers_num" />
      <param name="bank_answer" />
      <param name="credit_dog" />
      <param name="credit_summ" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="reply" />
    </output>
  </template>
  <!--    MTS_CheckRealisation            -->
  <template procedureName="MTS_CheckRealisation" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_CheckRealisation" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(MTS_CheckRealisationCustomer,${customer})}
        @{store(MTS_CheckRealisationAcc,${acc})}
        @{store(MTS_CheckRealisationSumm,${summ})}
        @{store(MTS_CheckRealisationDatefrom,${date_from})}
        @{store(MTS_CheckRealisationSrok,${srok})}
        @{store(MTS_CheckRealisationDaypay,${day_pay})}
        @{store(MTS_CheckRealisationUserFIO,${fio})}
        @{store(MTS_CheckRealisationOffice,${office})}
        @{store(MTS_CheckRealisationOldACC,${old_acc})}
        @{store(MTS_CheckRealisationProjectName,${project_name})}
        @{store(MTS_CheckRealisationOperType,${oper_type})}
        @{store(MTS_CheckRealisationBaseAcc,${base_acc})}
        @{store(MTS_CheckRealisationAddInfo,${add_info})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="CheckRealisation1S">
      <set item="iparam:customer" value="${MTS_CheckRealisationCustomer}" />
      <set item="iparam:acc" value="${MTS_CheckRealisationAcc}" />
      <set item="iparam:summ" value="${MTS_CheckRealisationSumm}" />
      <set item="iparam:date_from" value="${MTS_CheckRealisationDatefrom}" />
      <set item="iparam:srok" value="${MTS_CheckRealisationSrok}" />
      <set item="iparam:day_pay" value="${MTS_CheckRealisationDaypay}" />
      <set item="iparam:fio" value="${MTS_CheckRealisationUserFIO}" />
      <set item="iparam:office" value="${MTS_CheckRealisationOffice}" />
      <set item="iparam:old_acc" value="${MTS_CheckRealisationOldACC}" />
      <set item="iparam:project_name" value="${MTS_CheckRealisationProjectName}" />
      <set item="iparam:oper_type" value="${MTS_CheckRealisationOperType}" />
      <set item="iparam:base_acc" value="${MTS_CheckRealisationBaseAcc}" />
      <set item="iparam:add_info" value="${MTS_CheckRealisationAddInfo}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="acc" />
      <param name="summ" />
      <param name="date_from" />
      <param name="srok" />
      <param name="day_pay" />
      <param name="fio" />
      <param name="office" />
      <param name="old_acc" />
      <param name="project_name" />
      <param name="oper_type" />
      <param name="base_acc" />
      <param name="add_info" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="CheckRealisation1S" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="@{newGuid}" session_id="@{newGuid}">
        <Item procedureName="billing.Sales_1S.CHECK_REALISATION">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="p_acc" type="STRING" value="${acc}" />
          <Attribute name="p_summ" type="STRING" value="${summ}" />
          <Attribute name="p_date_from" type="STRING" value="${date_from}" />
          <Attribute name="p_srok" type="INT" value="${srok}" />
          <Attribute name="p_day_pay" type="STRING" value="${day_pay}" />
          <Attribute name="p_user_fio" type="STRING" value="${fio}" />
          <Attribute name="p_office" type="STRING" value="${office}" />
          <Attribute name="p_old_acc" type="STRING" value="${old_acc}" />
          <Attribute name="p_project_name" type="STRING" value="${project_name}" />
          <Attribute name="p_oper_type" type="INT" value="${oper_type}" />
          <Attribute name="p_base_acc" type="STRING" value="${base_acc}" />
          <Attribute name="p_add_info" type="STRING" value="${add_info}" />
          <Attribute name="o_rez" type="INT" />
          <Attribute name="o_msg" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:rez" condition="//Item/@dbresult='0'" value="${o_rez}" />
      <set item="oparam:rez" condition="//Item/@dbresult!='0'" value="-1" />
      <set item="oparam:reply" condition="//Item/@dbresult='0'" value="${o_msg}" />
      <set item="oparam:reply" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="acc" />
      <param name="summ" />
      <param name="date_from" />
      <param name="srok" />
      <param name="day_pay" />
      <param name="fio" />
      <param name="office" />
      <param name="old_acc" />
      <param name="project_name" />
      <param name="oper_type" />
      <param name="base_acc" />
      <param name="add_info" />
    </input>
    <output>
      <param name="rez" />
      <param name="reply" />
    </output>
  </template>
  <!--    MTS_AddParamService            -->
  <template procedureName="MTS_AddParamService" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_AddParamService" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(AddParcustomer,${customer})}
        @{store(AddParservicecode,${servicecode})}
        @{store(AddParsourceid,${sourceid})}
        @{store(AddParval,${addparamval})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="Add_Param_Service_">
      <set item="iparam:customer" value="${AddParcustomer}" />
      <set item="iparam:servicecode" value="${AddParservicecode}" />
      <set item="iparam:sourceid" value="${AddParsourceid}" />
      <set item="iparam:addparamval" value="${AddParval}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="servicecode" />
      <param name="addparamval" />
      <param name="sourceid" />
      <param name="sec_code" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="Add_Param_Service_" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="BILLING.add_service_customparam">
          <Attribute name="i_msisdn" type="STRING" value="${customer}" />
          <Attribute name="i_source_code" type="INT" value="${sourceid}" />
          <Attribute name="i_service_code" type="STRING" value="${servicecode}" />
          <Attribute name="i_param_value" type="STRING" value="${addparamval}" />
          <Attribute name="o_code" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:dbresult" value="${o_code}" />
      <set item="oparam:result" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="servicecode" />
      <param name="addparamval" />
      <param name="sourceid" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <!--    MTS_BIGetInfoBYPAANK            -->
  <template procedureName="MTS_BIGetInfoBYPAANK" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_BIGetInfoBYPAANK" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(MTS_BIGetInfoBYPAANKacc,${acc})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="MTSBIGetInfoBYPAANK_">
      <set item="iparam:acc" value="${MTS_BIGetInfoBYPAANKacc}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="acc" />
      <param name="sourceid" />
      <param name="sec_code" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="MTSBIGetInfoBYPAANK_" handler="DBCON_02">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="@{newGuid}" session_id="@{newGuid}">
        <Item procedureName="deduct.BANK_INST.BI_GET_INFO_BY_PA_ANK">
          <Attribute name="p_acc" type="STRING" value="${acc}" />
          <Attribute name="o_ank_sc" type="STRING" />
          <Attribute name="o_ank_cr" type="STRING" />
          <Attribute name="dbresult" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:ank_sc" condition="//Item/@dbresult='0'" value="${o_ank_sc}" />
      <set item="oparam:ank_sc" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:ank_cr" condition="//Item/@dbresult='0'" value="${o_ank_cr}" />
      <set item="oparam:ank_cr" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:result" condition="//Item/@dbresult='0'" value="${dbresult}" />
      <set item="oparam:result" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="acc" />
    </input>
    <output>
      <param name="ank_sc" />
      <param name="ank_cr" />
      <param name="result" />
    </output>
  </template>
  <!--    MTS_MNPRequestMSISDN            -->
  <template procedureName="MTS_MNPRequestMSISDN" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_MNPRequestMSISDN" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(MTS_MNPRequestMSISDNCustomer,${customer})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="MTSMNPRequestMSISDN_">
      <set item="iparam:customer" value="${MTS_MNPRequestMSISDNCustomer}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="sec_code" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="MTSMNPRequestMSISDN_" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="@{newGuid}" session_id="@{newGuid}">
        <Item procedureName="billing.mg_pack.mnp_request_msisdn">
          <Attribute name="i_msisdn" type="STRING" value="${customer}" />
          <Attribute name="o_res" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:result" condition="//Item/@dbresult='0'" value="${o_res}" />
      <set item="oparam:result" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="result" />
    </output>
  </template>
  <!--    MTS_GetFavoriteNums            -->
  <template procedureName="MTS_GetFavoriteNums" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_GetFavoriteNums" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(GetFavoriteNumscustomer,${customer})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="GetFavoritesNumsMTS">
      <set item="iparam:customer" value="${GetFavoriteNumscustomer}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="customer" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="GetFavoritesNumsMTS" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="@{newGuid}" session_id="@{newGuid}">
        <Item procedureName="billing.mg_pack.FavoritesMSISDN">
          <Attribute name="customer" type="STRING" value="${customer}" />
          <Attribute name="FavNum" type="CURSOR" />
          <Attribute name="outparam1" type="STRING" />
          <Attribute name="outparam2" type="INT" />
          <Attribute name="time_request" type="out:DATETIME" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:FavoritesMSISDN" value="#{NodesetToString(nodeset('${FavNum}'))}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="FavoritesMSISDN" />
    </output>
  </template>
  <!--    MTS_MigrateService            -->
  <template procedureName="MTS_MigrateService" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_MigrateService" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(MTS_MigrateServiceCustomer,${customer})}
        @{store(MTS_MigrateServiceServiceCode,${servicecode})}
        @{store(MTS_MigrateServiceSourceID,${sourceid})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="MigrateServiceMTS_">
      <set item="iparam:customer" value="${MTS_MigrateServiceCustomer}" />
      <set item="iparam:servicecode" value="${MTS_MigrateServiceServiceCode}" />
      <set item="iparam:sourceid" value="${MTS_MigrateServiceSourceID}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="servicecode" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="MigrateServiceMTS_" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="@{newGuid}" session_id="@{newGuid}">
        <Item procedureName="billing.mg_pack.MigrateService">
          <Attribute name="i_msisdn" type="STRING" value="${customer}" />
          <Attribute name="i_servicecode" type="STRING" value="${servicecode}" />
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="ret_code" type="STRING" />
          <Attribute name="reply" type="STRING" />
          <Attribute name="blocking" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" condition="//Item/@dbresult='0'" value="${ret_code}" />
      <set item="oparam:dbresult" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:result" condition="//Item/@dbresult='0'" value="${reply}" />
      <set item="oparam:result" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:blocking" condition="//Item/@dbresult='0'" value="${blocking}" />
      <set item="oparam:dbresult" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="servicecode" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
      <param name="blocking" />
    </output>
  </template>
  <!--    MTS_GetTDIbyMSISDN            -->
  <template procedureName="MTS_GetTDIbyMSISDN" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_GetTDIbyMSISDN" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(MTS_GetTDIbyMSISDNCustomer,${customer})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="MTSGetTDIDbyMSISDN">
      <set item="iparam:customer" value="${MTS_GetTDIbyMSISDNCustomer}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="sec_code" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="MTSGetTDIDbyMSISDN" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="@{newGuid}" session_id="@{newGuid}">
        <Item procedureName="billing.mg_pack.GetTDIbyMSISDN">
          <Attribute name="i_customer" type="STRING" value="${customer}" />
          <Attribute name="o_td" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:tdi" condition="//Item/@dbresult='0'" value="${o_td}" />
      <set item="oparam:tdi" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="tdi" />
    </output>
  </template>
  <!--    MTS_BonusMTS15Year            -->
  <template procedureName="MTS_BonusMTS15Year" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_BonusMTS15Year" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(MTSGetBonusMTS15YearCustomer,${customer})}
        @{store(MTSGetBonusMTS15YearOperation,${operation})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="BonusMTSovec15y">
      <set item="iparam:customer" value="${MTSGetBonusMTS15YearCustomer}" />
      <set item="iparam:operation" value="${MTSGetBonusMTS15YearOperation}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="operation" />
      <param name="sourceid" />
      <param name="sec_code" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="BonusMTSovec15y" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="@{newGuid}" session_id="@{newGuid}">
        <Item procedureName="billing.mg_lll_mts_ovec">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="p_ac" type="STRING" value="${operation}" />
          <Attribute name="p_src" type="STRING" value="web" />
          <Attribute name="msg" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:bonus" condition="//Item/@dbresult='0'" value="${msg}" />
      <set item="oparam:bonus" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="operation" />
    </input>
    <output>
      <param name="bonus" />
    </output>
  </template>
  <!--    MTS_GetSudDbtData            -->
  <template procedureName="MTS_GetSudDbtData" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_GetSudDbtData" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(MTSGetSudDbtDataAccount,${account})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="get_sud_dbt_data">
      <set item="iparam:account" value="${MTSGetSudDbtDataAccount}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="account" />
      <param name="sourceid" />
      <param name="sec_code" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="get_sud_dbt_data" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="@{newGuid}" session_id="@{newGuid}">
        <Item procedureName="mars.eud_min_ust">
          <Attribute name="in_pa" type="STRING" value="${account}" />
          <Attribute name="out_SURNAME" type="STRING" />
          <Attribute name="out_NAME" type="STRING" />
          <Attribute name="out_PATRONYMIC" type="STRING" />
          <Attribute name="out_ADDRESS" type="STRING" />
          <Attribute name="out_DEBTOR_TYPE" type="STRING" />
          <Attribute name="out_FINAL_DEBT" type="STRING" />
          <Attribute name="out_DEFINITION_DATE" type="STRING" />
          <Attribute name="out_COURT_REPAYM_DEBT_REST" type="STRING" />
          <Attribute name="out_INN" type="STRING" />
          <Attribute name="out_PASSPORT" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:Surname" condition="//Item/@dbresult='0'" value="${out_SURNAME}" />
      <set item="oparam:Surname" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:Name" condition="//Item/@dbresult='0'" value="${out_NAME}" />
      <set item="oparam:Name" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:Patronymic" condition="//Item/@dbresult='0'" value="${out_PATRONYMIC}" />
      <set item="oparam:Patronymic" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:Address" condition="//Item/@dbresult='0'" value="${out_ADDRESS}" />
      <set item="oparam:Address" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:DebType" condition="//Item/@dbresult='0'" value="${out_DEBTOR_TYPE}" />
      <set item="oparam:DebType" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:FinalDeb" condition="//Item/@dbresult='0'" value="${out_FINAL_DEBT}" />
      <set item="oparam:FinalDeb" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:DefinitionDate" condition="//Item/@dbresult='0'" value="${out_DEFINITION_DATE}" />
      <set item="oparam:DefinitionDate" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:CourtRePaymDebt" condition="//Item/@dbresult='0'" value="${out_COURT_REPAYM_DEBT_REST}" />
      <set item="oparam:CourtRePaymDebt" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:Inn" condition="//Item/@dbresult='0'" value="${out_INN}" />
      <set item="oparam:Inn" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:Passport" condition="//Item/@dbresult='0'" value="${out_PASSPORT}" />
      <set item="oparam:Passport" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="account" />
    </input>
    <output>
      <param name="Surname" />
      <param name="Name" />
      <param name="Patronymic" />
      <param name="Address" />
      <param name="DebType" />
      <param name="FinalDeb" />
      <param name="DefinitionDate" />
      <param name="CourtRePaymDebt" />
      <param name="Inn" />
      <param name="Passport" />
    </output>
  </template>
  <!--    MTS_GetBalanceExt            -->
  <template procedureName="MTS_GetBalanceExt" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_GetBalanceExt" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(MTSGetBalanceEXTCustomer,${customer})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="GetBalanceEXTInfo">
      <set item="iparam:customer" value="${MTSGetBalanceEXTCustomer}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="sec_code" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="GetBalanceEXTInfo" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="@{newGuid}" session_id="@{newGuid}">
        <Item procedureName="billing.mg_pack.rbt_balance_msisdn">
          <Attribute name="i_msisdn" type="STRING" value="${customer}" />
          <Attribute name="o_balance" type="STRING" />
          <Attribute name="o_blocking_limit" type="STRING" />
          <Attribute name="o_calcmethod" type="STRING" />
          <Attribute name="o_blocking" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:Balance" condition="//Item/@dbresult='0'" value="${o_balance}" />
      <set item="oparam:Balance" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:BlockLimit" condition="//Item/@dbresult='0'" value="${o_blocking_limit}" />
      <set item="oparam:BlockLimit" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:CalcMethod" condition="//Item/@dbresult='0'" value="${o_calcmethod}" />
      <set item="oparam:CalcMethod" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:Blocking" condition="//Item/@dbresult='0'" value="${o_blocking}" />
      <set item="oparam:Blocking" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="Balance" />
      <param name="BlockLimit" />
      <param name="CalcMethod" />
      <param name="Blocking" />
    </output>
  </template>
  <!--    MTS_DrWebDownUrl            -->
  <template procedureName="MTS_DrWebDownUrl" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_DrWebDownUrl" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(MTSDrWebDownUrlCustomer,${customer})}
        @{store(MTSDrWebDownUrlService,${service})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="MTSDrWebDownUrlInfo">
      <set item="iparam:customer" value="${MTSDrWebDownUrlCustomer}" />
      <set item="iparam:service" value="${MTSDrWebDownUrlService}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="service" />
      <param name="sourceid" />
      <param name="sec_code" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="MTSDrWebDownUrlInfo" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="@{newGuid}" session_id="@{newGuid}">
        <Item procedureName="billing.mg_pack.drweb_downurl_info">
          <Attribute name="i_msisdn" type="STRING" value="${customer}" />
          <Attribute name="i_service" type="STRING" value="${service}" />
          <Attribute name="o_rez" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:result" condition="//Item/@dbresult='0'" value="${o_rez}" />
      <set item="oparam:result" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="service" />
    </input>
    <output>
      <param name="result" />
    </output>
  </template>
  <!--    MTS_CHECKOPSCTrade            -->
  <template procedureName="MTS_CHECKOPSCTrade" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_CHECKOPSCTrade" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(MTSCHECKOPSCTradeCustomer,${customer})}
        @{store(MTSCHECKOPSCTradeOperCode,${opercode})}
        @{store(MTSCHECKOPSCTradeSumma,${summa})}
        @{store(MTSCHECKOPSCTradeSourceID,${sourceid})}
        @{store(MTSCHECKOPSCTradeLogin,${login})}
        @{store(MTSCHECKOPSCTradePos_Num,${posnum})}
        @{store(MTSCHECKOPSCTradeExtPar,${extpar})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="CHECK_OP__SCTrade">
      <set item="iparam:customer" value="${MTSCHECKOPSCTradeCustomer}" />
      <set item="iparam:opercode" value="${MTSCHECKOPSCTradeOperCode}" />
      <set item="iparam:summa" value="${MTSCHECKOPSCTradeSumma}" />
      <set item="iparam:sourceid" value="${MTSCHECKOPSCTradeSourceID}" />
      <set item="iparam:login" value="${MTSCHECKOPSCTradeLogin}" />
      <set item="iparam:posnum" value="${MTSCHECKOPSCTradePos_Num}" />
      <set item="iparam:extpar" value="${MTSCHECKOPSCTradeExtPar}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="opercode" />
      <param name="summa" />
      <param name="login" />
      <param name="posnum" />
      <param name="extpar" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="CHECK_OP__SCTrade" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="@{newGuid}" session_id="@{newGuid}">
        <Item procedureName="billing.ECOMMERCE_PKG.CHECK_OP_SCTrade">
          <Attribute name="p_MSISDN" type="STRING" value="${customer}" />
          <Attribute name="p_OPER_CODE" type="STRING" value="${opercode}" />
          <Attribute name="p_AMOUNT" type="STRING" value="${summa}" />
          <Attribute name="p_SOURCE_ID" type="STRING" value="${sourceid}" />
          <Attribute name="p_login" type="STRING" value="${login}" />
          <Attribute name="p_pos_num" type="STRING" value="${posnum}" />
          <Attribute name="p_ext_par" type="STRING" value="${extpar}" />
          <Attribute name="o_balance" type="STRING" />
          <Attribute name="o_RESULT" type="STRING" />
          <Attribute name="o_msg" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:balance" condition="//Item/@dbresult='0'" value="${o_balance}" />
      <set item="oparam:balance" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:result" condition="//Item/@dbresult='0'" value="${o_RESULT}" />
      <set item="oparam:result" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:msg" condition="//Item/@dbresult='0'" value="${o_msg}" />
      <set item="oparam:msg" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="opercode" />
      <param name="summa" />
      <param name="login" />
      <param name="posnum" />
      <param name="extpar" />
    </input>
    <output>
      <param name="balance" />
      <param name="result" />
      <param name="msg" />
    </output>
  </template>
  <!--    MTS_GetBonusServicesMTSMusic            -->
  <template procedureName="MTS_GetBonusServicesMTSMusic" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_GetBonusServicesMTSMusic" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(MTSGetBonusServicesMTSMusicCustomer,${customer})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="MTSGetBonusServicesMTSMusicMSISDN">
      <set item="iparam:customer" value="${MTSGetBonusServicesMTSMusicCustomer}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="sec_code" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="MTSGetBonusServicesMTSMusicMSISDN" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="@{newGuid}" session_id="@{newGuid}">
        <Item procedureName="billing.mg_check_music">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="rez" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:result" condition="//Item/@dbresult='0'" value="${rez}" />
      <set item="oparam:result" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="result" />
    </output>
  </template>
  <!--    MTS_GetAddedServiceMTSMusic             -->
  <template procedureName="MTS_GetAddedServiceMTSMusic" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_GetAddedServiceMTSMusic" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(MTSGetAddedServiceMTSMusicCustomer,${customer})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="GetAddServiceMTSMusic">
      <set item="iparam:customer" value="${MTSGetAddedServiceMTSMusicCustomer}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="customer" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="GetAddServiceMTSMusic" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="@{newGuid}" session_id="@{newGuid}">
        <Item procedureName="billing.mg_pack.getservicesmtsmusic">
          <Attribute name="customer" type="STRING" value="${customer}" />
          <Attribute name="service" type="CURSOR" />
          <Attribute name="outparam1" type="STRING" />
          <Attribute name="outparam2" type="INT" />
          <Attribute name="time_request" type="out:DATETIME" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:Services" value="#{NodesetToString(nodeset('${service}'))}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="Services" />
    </output>
  </template>
  <!--    MTS_PalomaSwitchCheck            -->
  <template procedureName="MTS_PalomaSwitchCheck" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_PalomaSwitchCheck" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(MTS_PalomaSwitchCheckSwitchCode,${switchcode})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="PalomaSwitchCheckMTS">
      <set item="iparam:switchcode" value="${MTS_PalomaSwitchCheckSwitchCode}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="switchcode" />
      <param name="sourceid" />
      <param name="sec_code" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="PalomaSwitchCheckMTS" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="@{newGuid}" session_id="@{newGuid}">
        <Item procedureName="billing.PALOMA_PKG.switch_check">
          <Attribute name="p_switch_code" type="STRING" value="${switchcode}" />
          <Attribute name="o_rez" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:result" condition="//Item/@dbresult='0'" value="${o_rez}" />
      <set item="oparam:result" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="switchcode" />
    </input>
    <output>
      <param name="result" />
    </output>
  </template>
  <!--    MTS_PalomaSetScorAnswer            -->
  <template procedureName="MTS_PalomaSetScorAnswer" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_PalomaSetScorAnswer" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(MTS_PalomaSetScorAnswerIdReq,${idreq})}
        @{store(MTS_PalomaSetScorAnswerPersonId,${personid})}
        @{store(MTS_PalomaSetScorAnswerAnswCode,${answcode})}
        @{store(MTS_PalomaSetScorAnswerDetail,${detail})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="PalomaSetScorAnswerMTS">
      <set item="iparam:idreq" value="${MTS_PalomaSetScorAnswerIdReq}" />
      <set item="iparam:personid" value="${MTS_PalomaSetScorAnswerPersonId}" />
      <set item="iparam:answcode" value="${MTS_PalomaSetScorAnswerAnswCode}" />
      <set item="iparam:detail" value="${MTS_PalomaSetScorAnswerDetail}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="idreq" />
      <param name="personid" />
      <param name="answcode" />
      <param name="detail" />
      <param name="sourceid" />
      <param name="sec_code" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="PalomaSetScorAnswerMTS" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="@{newGuid}" session_id="@{newGuid}">
        <Item procedureName="billing.PALOMA_PKG.set_scor_answer">
          <Attribute name="p_id_req" type="STRING" value="${idreq}" />
          <Attribute name="p_pers_uniq" type="STRING" value="${personid}" />
          <Attribute name="p_answ_code" type="STRING" value="${answcode}" />
          <Attribute name="p_detail" type="STRING" value="${detail}" />
          <Attribute name="o_rez" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:result" condition="//Item/@dbresult='0'" value="${o_rez}" />
      <set item="oparam:result" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="idreq" />
      <param name="personid" />
      <param name="answcode" />
      <param name="detail" />
    </input>
    <output>
      <param name="result" />
    </output>
  </template>
  <!--    MTS_GetBlockingMSISDN            -->
  <template procedureName="MTS_GetBlockingMSISDN" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_GetBlockingMSISDN" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(MTSGetBlockingMSISDNCustomer,${customer})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="MTSGetBlockingMSISDNStatus">
      <set item="iparam:customer" value="${MTSGetBlockingMSISDNCustomer}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="sec_code" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="MTSGetBlockingMSISDNStatus" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="@{newGuid}" session_id="@{newGuid}">
        <Item procedureName="billing.mg_pack.getblockingmsisdn">
          <Attribute name="i_msisdn" type="STRING" value="${customer}" />
          <Attribute name="o_blocking" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:Blocking" condition="//Item/@dbresult='0'" value="${o_blocking}" />
      <set item="oparam:Blocking" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="Blocking" />
    </output>
  </template>
  <!--    MTS_GetBalanceRBT            -->
  <template procedureName="MTS_GetBalanceRBT" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_GetBalanceRBT" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(MTSGetBalanceRBTCustomer,${customer})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="GetBalanceRBTInfo">
      <set item="iparam:customer" value="${MTSGetBalanceRBTCustomer}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="sec_code" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="GetBalanceRBTInfo" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="@{newGuid}" session_id="@{newGuid}">
        <Item procedureName="billing.mg_pack.rbt_balance_msisdn">
          <Attribute name="i_msisdn" type="STRING" value="${customer}" />
          <Attribute name="o_balance" type="STRING" />
          <Attribute name="o_blocking_limit" type="STRING" />
          <Attribute name="o_calcmethod" type="STRING" />
          <Attribute name="o_blocking" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:Balance" condition="//Item/@dbresult='0'" value="${o_balance}" />
      <set item="oparam:Balance" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:BlockLimit" condition="//Item/@dbresult='0'" value="${o_blocking_limit}" />
      <set item="oparam:BlockLimit" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:CalcMethod" condition="//Item/@dbresult='0'" value="${o_calcmethod}" />
      <set item="oparam:CalcMethod" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:Blocking" condition="//Item/@dbresult='0'" value="${o_blocking}" />
      <set item="oparam:Blocking" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="Balance" />
      <param name="BlockLimit" />
      <param name="CalcMethod" />
      <param name="Blocking" />
    </output>
  </template>
  <!--    MTS_CheckBalance            -->
  <template procedureName="MTS_CheckBalance" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_CheckBalance" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(MTSCheckBalanceCustomer,${customer})}
        @{store(MTSCheckBalanceOpercode,${opercode})}
        @{store(MTSCheckBalanceSumma,${summa})}
        @{store(MTSCheckBalanceSourceID,${sourceid})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="MTSCheckBalance">
      <set item="iparam:customer" value="${MTSCheckBalanceCustomer}" />
      <set item="iparam:opercode" value="${MTSCheckBalanceOpercode}" />
      <set item="iparam:summa" value="${MTSCheckBalanceSumma}" />
      <set item="iparam:sourceid" value="${MTSCheckBalanceSourceID}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="opercode" />
      <param name="summa" />
      <param name="sourceid" />
      <param name="sec_code" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="MTSCheckBalance" handler="DBCON_03">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="@{newGuid}" session_id="@{newGuid}">
        <Item procedureName="rep.INTERFACE_ERIP_PKG.check_balance">
          <Attribute name="p_source_id" type="STRING" value="${sourceid}" />
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="p_opercode" type="STRING" value="${opercode}" />
          <Attribute name="p_sum" type="STRING" value="${summa}" />
          <Attribute name="o_balance" type="STRING" />
          <Attribute name="o_res" type="STRING" />
          <Attribute name="o_msg" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:Balance" condition="//Item/@dbresult='0'" value="${o_balance}" />
      <set item="oparam:Balance" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:Res" condition="//Item/@dbresult='0'" value="${o_res}" />
      <set item="oparam:Res" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:Msg" condition="//Item/@dbresult='0'" value="${o_msg}" />
      <set item="oparam:Msg" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="opercode" />
      <param name="summa" />
      <param name="sourceid" />
    </input>
    <output>
      <param name="Balance" />
      <param name="Res" />
      <param name="Msg" />
    </output>
  </template>
  <!--    MTS_GetAbonentCalcType            -->
  <template procedureName="MTS_GetAbonentCalcType" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_GetAbonentCalcType" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(MTSGetAbonentCalcTypeCustomer,${customer})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="GetAbonentCalcTypeMTS">
      <set item="iparam:customer" value="${MTSGetAbonentCalcTypeCustomer}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="sec_code" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="GetAbonentCalcTypeMTS" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="@{newGuid}" session_id="@{newGuid}">
        <Item procedureName="billing.soap_service_pkg.GetAbonentCalcType">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="o_calc_type" type="STRING" />
          <Attribute name="dbresult" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:CalcType" condition="//Item/@dbresult='0'" value="${o_calc_type}" />
      <set item="oparam:CalcType" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:DbRes" condition="//Item/@dbresult='0'" value="${dbresult}" />
      <set item="oparam:DbRes" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="CalcType" />
      <param name="DbRes" />
    </output>
  </template>
  <!--    MTS_Get_Blocking             -->
  <template procedureName="MTS_Get_Blocking" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_Get_Blocking" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(MTSGetBlockingCustomer,${customer})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="MTSGetBLKMSISDN">
      <set item="iparam:customer" value="${MTSGetBlockingCustomer}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="customer" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="MTSGetBLKMSISDN" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="@{newGuid}" session_id="@{newGuid}">
        <Item procedureName="billing.ttt_get_blk">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="p_blocking" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:blocking" condition="//Item/@dbresult='0'" value="${p_blocking}" />
      <set item="oparam:blocking" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="blocking" />
    </output>
  </template>
  <!--    MTS_AccCreate            -->
  <template procedureName="MTS_AccCreate" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_AccCreate" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(MTSAccCreateorder_id,${order_id})}
        @{store(MTSAccCreateclient_id,${client_id})}
        @{store(MTSAccCreateclient_fio,${client_fio})}
        @{store(MTSAccCreateorder_sum,${order_sum})}
        @{store(MTSAccCreateproject,${project})}
        @{store(MTSAccCreatepay_mode,${pay_mode})}
        @{store(MTSAccCreateorder_data,${order_data})}
        @{store(MTSAccCreatedelivery_method,${delivery_method})}
        @{store(MTSAccCreatelogin_cust,${login_cust})}
        @{store(MTSAccCreateemail_cust,${email_cust})}
        @{store(MTSAccCreatedelivery_cust,${delivery_cust})}
        @{store(MTSAccCreatedelivery_addr_pcode,${delivery_addr_pcode})}
        @{store(MTSAccCreatedelivery_addr_obl,${delivery_addr_obl})}
        @{store(MTSAccCreatedelivery_addr_region,${delivery_addr_region})}
        @{store(MTSAccCreatedelivery_addr_town,${delivery_addr_town})}
        @{store(MTSAccCreatedelivery_addr_street,${delivery_addr_street})}
        @{store(MTSAccCreatedelivery_addr_home,${delivery_addr_home})}
        @{store(MTSAccCreatedelivery_addr_part,${delivery_addr_part})}
        @{store(MTSAccCreatedelivery_addr_flat,${delivery_addr_flat})}
        @{store(MTSAccCreatecontact_phone,${contact_phone})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="AccCreateNew">
      <set item="iparam:order_id" value="${MTSAccCreateorder_id}" />
      <set item="iparam:client_id" value="${MTSAccCreateclient_id}" />
      <set item="iparam:client_fio" value="${MTSAccCreateclient_fio}" />
      <set item="iparam:order_sum" value="${MTSAccCreateorder_sum}" />
      <set item="iparam:project" value="${MTSAccCreateproject}" />
      <set item="iparam:pay_mode" value="${MTSAccCreatepay_mode}" />
      <set item="iparam:order_data" value="${MTSAccCreateorder_data}" />
      <set item="iparam:delivery_method" value="${MTSAccCreatedelivery_method}" />
      <set item="iparam:login_cust" value="${MTSAccCreatelogin_cust}" />
      <set item="iparam:email_cust" value="${MTSAccCreateemail_cust}" />
      <set item="iparam:delivery_cust" value="${MTSAccCreatedelivery_cust}" />
      <set item="iparam:delivery_addr_pcode" value="${MTSAccCreatedelivery_addr_pcode}" />
      <set item="iparam:delivery_addr_obl" value="${MTSAccCreatedelivery_addr_obl}" />
      <set item="iparam:delivery_addr_region" value="${MTSAccCreatedelivery_addr_region}" />
      <set item="iparam:delivery_addr_town" value="${MTSAccCreatedelivery_addr_town}" />
      <set item="iparam:delivery_addr_street" value="${MTSAccCreatedelivery_addr_street}" />
      <set item="iparam:delivery_addr_home" value="${MTSAccCreatedelivery_addr_home}" />
      <set item="iparam:delivery_addr_part" value="${MTSAccCreatedelivery_addr_part}" />
      <set item="iparam:delivery_addr_flat" value="${MTSAccCreatedelivery_addr_flat}" />
      <set item="iparam:contact_phone" value="${MTSAccCreatecontact_phone}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="order_id" />
      <param name="client_id" />
      <param name="client_fio" />
      <param name="order_sum" />
      <param name="project" />
      <param name="pay_mode" />
      <param name="order_data" />
      <param name="delivery_method" />
      <param name="login_cust" />
      <param name="email_cust" />
      <param name="delivery_cust" />
      <param name="delivery_addr_pcode" />
      <param name="delivery_addr_obl" />
      <param name="delivery_addr_region" />
      <param name="delivery_addr_town" />
      <param name="delivery_addr_street" />
      <param name="delivery_addr_home" />
      <param name="delivery_addr_part" />
      <param name="delivery_addr_flat" />
      <param name="contact_phone" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="AccCreateNew" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.WS_pkg.ws_acc_create">
          <Attribute name="p_order_ID" type="STRING" value="${order_id}" />
          <Attribute name="p_client_id" type="STRING" value="${client_id}" />
          <Attribute name="p_client_fio" type="STRING" value="${client_fio}" />
          <Attribute name="p_order_sum" type="STRING" value="${order_sum}" />
          <Attribute name="p_project" type="STRING" value="${project}" />
          <Attribute name="p_pay_mode" type="STRING" value="${pay_mode}" />
          <Attribute name="p_order_data" type="STRING" value="${order_data}" />
          <Attribute name="p_delivery_method" type="STRING" value="${delivery_method}" />
          <Attribute name="p_LOGIN_CUST" type="STRING" value="${login_cust}" />
          <Attribute name="p_EMAIL_CUST" type="STRING" value="${email_cust}" />
          <Attribute name="p_DELIVERY_COST" type="STRING" value="${delivery_cust}" />
          <Attribute name="p_DELIVERY_ADDRESS_PCODE" type="STRING" value="${delivery_addr_pcode}" />
          <Attribute name="p_DELIVERY_ADDRESS_OBL" type="STRING" value="${delivery_addr_obl}" />
          <Attribute name="p_DELIVERY_ADDRESS_REGION" type="STRING" value="${delivery_addr_region}" />
          <Attribute name="p_DELIVERY_ADDRESS_TOWN" type="STRING" value="${delivery_addr_town}" />
          <Attribute name="p_DELIVERY_ADDRESS_STREET" type="STRING" value="${delivery_addr_street}" />
          <Attribute name="p_DELIVERY_ADDRESS_HOME" type="STRING" value="${delivery_addr_home}" />
          <Attribute name="p_DELIVERY_ADDRESS_PART" type="STRING" value="${delivery_addr_part}" />
          <Attribute name="p_DELIVERY_ADDRESS_FLAT" type="STRING" value="${delivery_addr_flat}" />
          <Attribute name="p_CONTACT_PHONE" type="STRING" value="${contact_phone}" />
          <Attribute name="o_acc" type="STRING" />
          <Attribute name="o_res" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:acc" condition="//Item/@dbresult='0'" value="${o_acc}" />
      <set item="oparam:acc" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:res" condition="//Item/@dbresult='0'" value="${o_res}" />
      <set item="oparam:res" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="order_id" />
      <param name="client_id" />
      <param name="client_fio" />
      <param name="order_sum" />
      <param name="project" />
      <param name="pay_mode" />
      <param name="order_data" />
      <param name="delivery_method" />
      <param name="login_cust" />
      <param name="email_cust" />
      <param name="delivery_cust" />
      <param name="delivery_addr_pcode" />
      <param name="delivery_addr_obl" />
      <param name="delivery_addr_region" />
      <param name="delivery_addr_town" />
      <param name="delivery_addr_street" />
      <param name="delivery_addr_home" />
      <param name="delivery_addr_part" />
      <param name="delivery_addr_flat" />
      <param name="contact_phone" />
    </input>
    <output>
      <param name="acc" />
      <param name="res" />
    </output>
  </template>
  <!--    MTS_AddNumAcceptor            -->
  <template procedureName="MTS_AddNumAcceptor" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_AddNumAcceptor" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(MTS_AddNumAcceptorCustomer,${customer})}
        @{store(MTS_AddNumAcceptorCustomer_fttx,${customer_fttx})}
        @{store(MTS_AddNumAcceptorPwd_fttx,${pwd_fttx})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="MAddNumAcceptor">
      <set item="iparam:customer" value="${MTS_AddNumAcceptorCustomer}" />
      <set item="iparam:customer_fttx" value="${MTS_AddNumAcceptorCustomer_fttx}" />
      <set item="iparam:pwd_fttx" value="${MTS_AddNumAcceptorPwd_fttx}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="customer_fttx" />
      <param name="pwd_fttx" />
      <param name="sourceid" />
      <param name="sec_code" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="MAddNumAcceptor" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="@{newGuid}" session_id="@{newGuid}">
        <Item procedureName="billing.bms_additional_func.addnumacceptor">
          <Attribute name="i_msisdn_mobile" type="STRING" value="${customer}" />
          <Attribute name="i_msisdn_fttx" type="STRING" value="${customer_fttx}" />
          <Attribute name="i_pwd_fttx" type="STRING" value="${pwd_fttx}" />
          <Attribute name="o_db_res" type="STRING" />
          <Attribute name="o_db_res_str" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:DbRes" condition="//Item/@dbresult='0'" value="${o_db_res}" />
      <set item="oparam:DbRes" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:DbResStr" condition="//Item/@dbresult='0'" value="${o_db_res_str}" />
      <set item="oparam:DbResStr" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="customer_fttx" />
      <param name="pwd_fttx" />
    </input>
    <output>
      <param name="DbRes" />
      <param name="DbResStr" />
    </output>
  </template>
  <!--    MTS_DelNumAcceptor            -->
  <template procedureName="MTS_DelNumAcceptor" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_DelNumAcceptor" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(MTS_DelNumAcceptorCustomer,${customer})}
        @{store(MTS_DelNumAcceptorCustomer_fttx,${customer_fttx})}
        @{store(MTS_DelNumAcceptorPwd_fttx,${pwd_fttx})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="MDelNumAcceptor">
      <set item="iparam:customer" value="${MTS_DelNumAcceptorCustomer}" />
      <set item="iparam:customer_fttx" value="${MTS_DelNumAcceptorCustomer_fttx}" />
      <set item="iparam:pwd_fttx" value="${MTS_DelNumAcceptorPwd_fttx}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="customer_fttx" />
      <param name="pwd_fttx" />
      <param name="sourceid" />
      <param name="sec_code" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="MDelNumAcceptor" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="@{newGuid}" session_id="@{newGuid}">
        <Item procedureName="billing.bms_additional_func.delnumacceptor">
          <Attribute name="i_msisdn_mobile" type="STRING" value="${customer}" />
          <Attribute name="i_msisdn_fttx" type="STRING" value="${customer_fttx}" />
          <Attribute name="i_pwd_fttx" type="STRING" value="${pwd_fttx}" />
          <Attribute name="o_db_res" type="STRING" />
          <Attribute name="o_db_res_str" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:DbRes" condition="//Item/@dbresult='0'" value="${o_db_res}" />
      <set item="oparam:DbRes" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:DbResStr" condition="//Item/@dbresult='0'" value="${o_db_res_str}" />
      <set item="oparam:DbResStr" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="customer_fttx" />
      <param name="pwd_fttx" />
    </input>
    <output>
      <param name="DbRes" />
      <param name="DbResStr" />
    </output>
  </template>
  <!--    MTS_AddCallMyAccount             -->
  <template procedureName="MTS_AddCallMyAccount" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_AddCallMyAccount" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(MTSAddCallMyAccountCustomer,${customer})}
        @{store(MTSAddCallMyAccountCustomerChild,${customer_child})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="AddCallMyAccountCheck">
      <set item="iparam:customer" value="${MTSAddCallMyAccountCustomer}" />
      <set item="iparam:customer_child" value="${MTSAddCallMyAccountCustomerChild}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="customer" />
      <param name="customer_child" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="AddCallMyAccountCheck" handler="DBCON_01">
    <receiveTemplate>
      <Message type="setprofile" initiator="ussd" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="billing.mg_get_validation_for_ivr">
          <Attribute name="p_msisdn" type="STRING" value="${customer_child}" />
          <Attribute name="dbresult" type="STRING" />
          <Attribute name="p_Tariffplan" type="STRING" />
          <Attribute name="p_State" type="STRING" />
          <Attribute name="p_Password" type="STRING" />
          <Attribute name="p_Regioncode" type="STRING" />
          <Attribute name="p_tp_name" type="STRING" />
          <Attribute name="p_check_password" type="STRING" />
          <Attribute name="p_cost" type="STRING" />
        </Item>
        @{store(MTSAddCallMyAccountCheckCustomer,${customer})}
        @{store(MTSAddCallMyAccountCustomerCheckChild,${customer_child})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='p_Tariffplan']/@value}'='58' or '#{/Message/Item/Attribute[@name='p_Tariffplan']/@value}'='158'}" call="AddCallMyAccount">
      <set item="iparam:customer" value="${MTSAddCallMyAccountCheckCustomer}" />
      <set item="iparam:customer_child" value="${MTSAddCallMyAccountCustomerCheckChild}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='p_Tariffplan']/@value}'!='58' or '#{/Message/Item/Attribute[@name='p_Tariffplan']/@value}'!='158'}">
      <set item="oparam:result_code" value="-1" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="customer_child" />
      <param name="summa" />
    </input>
    <output>
      <param name="result_code" />
    </output>
  </template>
  <template procedureName="AddCallMyAccount">
    <receiveTemplate>
      <Message type="setprofile" initiator="ussd" id="${guid}" session_id="@{newGuid}">
        <Item customer="${customer}" action="10">
          <Attribute name="favouritenumber" value="#{substring('${customer_child}',1,12)}" />
          <Attribute name="index" value="0" />
          <Attribute name="favouritenumbertypeid" value="5" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${dbresult}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="customer_child" />
      <param name="summa" />
    </input>
    <output>
      <param name="result_code" />
    </output>
  </template>
  <!--    MTS_DelCallMyAccount             -->
  <template procedureName="MTS_DelCallMyAccount" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_DelCallMyAccount" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(MTSDelCallMyAccountCustomer,${customer})}
        @{store(MTSDelCallMyAccountCustomerChild,${customer_child})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="DelCallMyAccount">
      <set item="iparam:customer" value="${MTSDelCallMyAccountCustomer}" />
      <set item="iparam:customer_child" value="${MTSDelCallMyAccountCustomerChild}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="customer" />
      <param name="customer_child" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="DelCallMyAccount">
    <receiveTemplate>
      <Message type="setprofile" initiator="ussd" id="${guid}" session_id="@{newGuid}">
        <Item customer="${customer}" action="11">
          <Attribute name="favouritenumber" value="#{substring('${customer_child}',1,12)}" />
          <Attribute name="index" value="0" />
          <Attribute name="favouritenumbertypeid" value="5" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${dbresult}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="customer_child" />
      <param name="summa" />
    </input>
    <output>
      <param name="result_code" />
    </output>
  </template>
  <!--    MTS_MovePayment             -->
  <template procedureName="MTS_MovePayment" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_MovePayment" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(MTSMovePaymentCustomer,${customer})}
        @{store(MTSMovePaymentCustomerReceicer,${customer_receiver})}
        @{store(MTSMovePaymentCustomerSumma,${summa})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="MTSMovePayments">
      <set item="iparam:customer" value="${MTSMovePaymentCustomer}" />
      <set item="iparam:customer_receiver" value="${MTSMovePaymentCustomerReceicer}" />
      <set item="iparam:summa" value="${MTSMovePaymentCustomerSumma}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="customer" />
      <param name="customer_receiver" />
      <param name="summa" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="MTSMovePayments">
    <receiveTemplate>
      <Message type="serviceorder" initiator="ussd" id="${guid}" session_id="@{newGuid}">
        <Item customer="${customer}">
          <Service id="movepaymentrequest" action="5">
            <Attribute name="receiver" value="${customer_receiver}" />
            <Attribute name="amount" value="${summa}" />
          </Service>
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="#{//Item/@dbresult}" />
      <set item="oparam:result_msg" condition="//Item/@dbresult='0'" value="Для подтверждения перевода #{/Message/Item/Service/Attribute[@name='amount']/@value div 100} р. абоненту ${receiver} наберите *363*#{/Message/Item/Service/Attribute[@name='code']/@value}#" />
      <set item="oparam:result_msg" condition="//Item/@dbresult='-1'" value="Перевод невозможен, повторите позже" />
      <set item="oparam:result_msg" condition="//Item/@dbresult='320060'" value="У Вас нет прав для обработки запроса." />
      <set item="oparam:result_msg" condition="//Item/@dbresult='320705'" value="Такая заявка не будет обработана" />
      <set item="oparam:result_msg" condition="//Item/@dbresult='320704'" value="Предыдущая заявка не обработана, повторите позже" />
      <set item="oparam:result_msg" condition="//Item/@dbresult='320999'" value="Срок действия кода авторизации истек" />
      <set item="oparam:result_msg" condition="//Item/@dbresult='320362'" value="У абонента #{/Message/Item/Service/Attribute[@name='receiver']/@value} отключена возможность приема P-t-P" />
      <set item="oparam:result_msg" condition="//Item/@dbresult='320703'" value="Неправильно указан номер получателя" />
      <set item="oparam:result_msg" condition="//Item/@dbresult='320361'" value="Услуга заблокирована, обратитесь в службу поддержки" />
      <set item="oparam:result_msg" condition="//Item/@dbresult='320702'" value="Услуга заблокирована, обратитесь в службу поддержки" />
      <set item="oparam:result_msg" condition="//Item/@dbresult='320101'" value="Повторный ввод информации, пожалуйста, следуйте инструкции" />
      <set item="oparam:result_msg" condition="//Item/@dbresult='320714'" value="Достигнут предел числа получателей" />
      <set item="oparam:result_msg" condition="//Item/@dbresult='320710'" value="Слишком маленькая сумма перевода" />
      <set item="oparam:result_msg" condition="//Item/@dbresult='320701'" value="Слишком большая сумма перевода" />
      <set item="oparam:result_msg" condition="//Item/@dbresult='320711'" value="Указанная сумма превышает лимит переводимых средств на сегодня" />
      <set item="oparam:result_msg" condition="//Item/@dbresult='320712'" value="Превышен лимит для получения за сутки" />
      <set item="oparam:result_msg" condition="//Item/@dbresult='320713'" value="Номер получателя совпадает с Вашим номером, пожалуйста, повторите ввод" />
      <set item="oparam:result_msg" condition="//Item/@dbresult='320709'" value="Услуга заблокирована, обратитесь в службу поддержки" />
      <set item="oparam:result_msg" condition="//Item/@dbresult='320191'" value="На Вашем счету недостаточно средств для перевода абоненту #{/Message/Item/Service/Attribute[@name='receiver']/@value}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="customer_receiver" />
      <param name="summa" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <!--    MTS_GetCustomerType             -->
  <template procedureName="MTS_GetCustomerType" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_GetCustomerType" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(MTSGetCustomerTypecustomer,${customer})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="MTSGetCustomerType">
      <set item="iparam:customer" value="${MTSGetCustomerTypecustomer}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="customer" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="MTSGetCustomerType" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="@{newGuid}" session_id="@{newGuid}">
        <Item procedureName="billing.mg_pack.Get_CustomerType">
          <Attribute name="i_msisdn" type="STRING" value="${customer}" />
          <Attribute name="o_rez" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:result_msg" condition="//Item/@dbresult='0'" value="${o_rez}" />
      <set item="oparam:result_msg" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="result_msg" />
    </output>
  </template>
  <!--    MTS_GuaranteedPayment             -->
  <template procedureName="MTS_GuaranteedPayment">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item customer="${Sender}">
          <Service id="guaranteedpayment" action="6" />
        </Item>
        @{store(MTSGuaranteedPaymentcustomer,${customer})}
        @{store(MTSGuaranteedPaymentamount,#{${amount} * 100})}
        @{store(MTSGuaranteedPaymentsourceid,${sourceid})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{('${allowed}' = 1 and '${dbresult}'= 0) }" call="MTSGuaranteedPayment">
      <set item="iparam:customer" value="${MTSGuaranteedPaymentcustomer}" />
      <set item="iparam:amount" value="${MTSGuaranteedPaymentamount}" />
      <set item="iparam:sourceid" value="${MTSGuaranteedPaymentsourceid}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${dbresult}" />
      <set item="oparam:result_msg" value="Извините, но данный запрос не может быть выполнен." />
      <set item="oparam:result_msg" condition="//Item/@dbresult=0" value="Обещанный платеж не может быть принят." />
      <set item="oparam:result_msg" conditionEx="#{${dbresult}=320341}" value="Номер Вашего телефона не зарегистрирован" />
      <set item="oparam:result_msg" conditionEx="#{${dbresult}=320347}" value="Услуга не может быть предоставлена, потому что номер заблокирован" />
      <set item="oparam:result_msg" conditionEx="#{${dbresult}=320191}" value="Данный сервис недоступен. Ваш баланс #{number('${balance}') div 100} р." />
      <set item="oparam:result_msg" conditionEx="#{${dbresult}=320203}" value="Услуга не может быть предоставлена, предыдущий обещанный платеж не погашен или в процессе регистрации" />
      <set item="oparam:result_msg" conditionEx="#{${dbresult}=320111}" value="Указывайте сумму не превышающую #{${maximumrur} div 100} р." />
      <set item="oparam:result_msg" conditionEx="#{${dbresult}=320121}" value="Невозможно установить обещанный платеж" />
      <set item="oparam:result_msg" conditionEx="#{${dbresult}=320113}" value="Сумма обещанного платежа меньше минимально возможной" />
      <set item="oparam:result_msg" conditionEx="#{${dbresult}=330140}" value="Обратитесь к персональному менеджеру" />
      <set item="oparam:result_msg" conditionEx="#{${dbresult}=330141}" value="Превышено допустимое кол-во обещанных платежей" />
      <set item="oparam:result_msg" conditionEx="#{${dbresult}=330142}" value="Исчерпан лимит средств для ввода обещанного платежа" />
      <set item="oparam:result_msg" conditionEx="#{${dbresult}=330132}" value="Данный сервис недоступен. Ваш баланс #{number('${balance}') div 100} р." />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="customer" />
      <param name="amount" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="MTSGuaranteedPayment">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Sender}">
          <Service id="guaranteedpayment" action="7">
            <Attribute name="amount" value="${amount}" />
            <Attribute name="currency" value="933" />
          </Service>
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" condition="//Item/@dbresult='0'" value="${dbresult}" />
      <set item="oparam:result_code" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:result_msg" value="Ошибка при выполнении запроса." />
      <set item="oparam:result_msg" condition="//Item/@dbresult=0" value="Обещанный платеж на сумму #{${amount} div 100} р. принят.Отображение на балансе в течение 10 минут." />
      <set item="oparam:result_msg" condition="//Item/@dbresult=320203" value="Регистрация запрещена - предыдущий обещанный платеж не оплачен." />
      <set item="oparam:result_msg" condition="//Item/@dbresult=320111" value="Превышена разрешенная сумма обещанного платежа." />
      <set item="oparam:result_msg" condition="//Item/@dbresult=320121" value="Платеж не может быть зарегистрирован." />
      <set item="oparam:result_msg" condition="//Item/@dbresult=320341" value="Нельзя ввести обещанный платеж на Вашем тарифном плане" />
      <set item="oparam:result_msg" condition="//Item/@dbresult=320110" value="Минимальная сумма обещанного платежа 1 руб.Введите большую сумму." />
      <set item="oparam:result_msg" conditionEx="#{${dbresult}=320347}" value="Услуга не может быть предоставлена, потому что номер заблокирован" />
      <set item="oparam:result_msg" conditionEx="#{${dbresult}=320191}" value="Услуга не может быть предоставлена, недостаточно средств" />
      <set item="oparam:result_msg" condition="//Item/@dbresult=-1" value="Обещанный платеж не может быть принят." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="amount" />
      <param name="sourceid" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <!--    MTS_Wargaming_GiftList             -->
  <template procedureName="MTS_Wargaming_GiftList" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_Wargaming_GiftList" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="WargamingGiftList">
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="WargamingGiftList" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="@{newGuid}" session_id="@{newGuid}">
        <Item procedureName="billing.mg_pack.Wargaming_GiftList">
          <Attribute name="Gift" type="CURSOR" />
          <Attribute name="outparam1" type="STRING" />
          <Attribute name="outparam2" type="INT" />
          <Attribute name="time_request" type="out:DATETIME" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:Gifts" value="#{NodesetToString(nodeset('${Gift}'))}" />
    </deliveryTemplate>
    <output>
      <param name="Gifts" />
    </output>
  </template>
  <!--    MTS_GetAbonentID: получение идентификатора абонента (customer_id) по номеру             -->
  <template procedureName="MTS_GetAbonentID" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_GetAbonentID" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(GetAbonentIDcustomer,${customer})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="GetAbonentID">
      <set item="iparam:customer" value="${GetAbonentIDcustomer}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="sec_code" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="GetAbonentID" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="@{newGuid}" session_id="@{newGuid}">
        <Item procedureName="billing.soap_service_pkg.GetAbonentID">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="o_cust_id" type="STRING" />
          <Attribute name="dbresult" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:Cust_ID" condition="//Item/@dbresult='0'" value="${o_cust_id}" />
      <set item="oparam:Cust_ID" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:DBRes" condition="//Item/@dbresult='0'" value="${dbresult}" />
      <set item="oparam:DBRes" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="Cust_ID" />
      <param name="DBRes" />
    </output>
  </template>
  <!--    MTS_Check_Sub_Blk_Srv_Memory             -->
  <template procedureName="MTS_Check_Sub_Blk_Srv_Memory" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_Check_Sub_Blk_Srv_Memory" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(CheckSubBlkSrvMemorycustomer,${customer})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="CheckSubBlkSrvMemory">
      <set item="iparam:customer" value="${CheckSubBlkSrvMemorycustomer}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="sec_code" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="CheckSubBlkSrvMemory" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="@{newGuid}" session_id="@{newGuid}">
        <Item procedureName="billing.mg_pack.check_sub_blk_srv">
          <Attribute name="i_msisdn" type="STRING" value="${customer}" />
          <Attribute name="o_srv" type="STRING" />
          <Attribute name="o_blk" type="STRING" />
          <Attribute name="o_subscriber" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:Service" condition="//Item/@dbresult='0'" value="${o_srv}" />
      <set item="oparam:Service" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:Subscriber" condition="//Item/@dbresult='0'" value="${o_subscriber}" />
      <set item="oparam:Subscriber" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:Blocking" condition="//Item/@dbresult='0'" value="${o_blk}" />
      <set item="oparam:Blocking" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="Service" />
      <param name="Subscriber" />
      <param name="Blocking" />
    </output>
  </template>
  <!-- 1c. проверка -->
  <template procedureName="CustomerDataAndValidation1S" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.sales_1s.CUSTOMER_DATA_AND_VALIDATION">
          <Attribute name="p_msisdn" type="STRING" value="${msisdn}" />
          <Attribute name="p_customer_type" type="INT" value="${customer_type}" />
          <Attribute name="p_operator" type="STRING" value="${operator}" />
          <Attribute name="p_model" type="STRING" value="${model}" />
          <Attribute name="p_proj_code" type="STRING" value="${proj_code}" />
          <Attribute name="p_id_akcia" type="INT" value="${id_akcia}" />
          <Attribute name="o_customer_id" type="INT" />
          <Attribute name="o_customer_type" type="INT" />
          <Attribute name="o_unn" type="STRING" />
          <Attribute name="o_naim" type="STRING" />
          <Attribute name="o_ur_adr" type="STRING" />
          <Attribute name="o_r_account" type="STRING" />
          <Attribute name="o_bank_code" type="STRING" />
          <Attribute name="o_bank_name" type="STRING" />
          <Attribute name="o_filial_code" type="STRING" />
          <Attribute name="o_f" type="STRING" />
          <Attribute name="o_s" type="STRING" />
          <Attribute name="o_p" type="STRING" />
          <Attribute name="o_bd" type="STRING" />
          <Attribute name="o_sex" type="STRING" />
          <Attribute name="o_inn" type="STRING" />
          <Attribute name="o_doc_type" type="STRING" />
          <Attribute name="o_doc_ser" type="STRING" />
          <Attribute name="o_doc_number" type="STRING" />
          <Attribute name="o_doc_date" type="STRING" />
          <Attribute name="o_doc_auth" type="STRING" />
          <Attribute name="o_adr" type="STRING" />
          <Attribute name="o_work" type="STRING" />
          <Attribute name="o_contact" type="STRING" />
          <Attribute name="o_scor_id" type="INT" />
          <Attribute name="rez" type="INT" />
          <Attribute name="msg" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate condition="//Item/@dbresult='0'">
      <set item="oparam:customer_id" value="${o_customer_id}" />
      <set item="oparam:customer_type" value="${o_customer_type}" />
      <set item="oparam:unn" value="${o_unn}" />
      <set item="oparam:naim" value="${o_naim}" />
      <set item="oparam:ur_adr" value="${o_ur_adr}" />
      <set item="oparam:account" value="${o_r_account}" />
      <set item="oparam:bank_code" value="${o_bank_code}" />
      <set item="oparam:bank_name" value="${o_bank_name}" />
      <set item="oparam:filial_code" value="${o_filial_code}" />
      <set item="oparam:f" value="${o_f}" />
      <set item="oparam:s" value="${o_s}" />
      <set item="oparam:p" value="${o_p}" />
      <set item="oparam:bd" value="${o_bd}" />
      <set item="oparam:sex" value="${o_sex}" />
      <set item="oparam:inn" value="${o_inn}" />
      <set item="oparam:doc_type" value="${o_doc_type}" />
      <set item="oparam:doc_ser" value="${o_doc_ser}" />
      <set item="oparam:doc_number" value="${o_doc_number}" />
      <set item="oparam:doc_date" value="${o_doc_date}" />
      <set item="oparam:doc_auth" value="${o_doc_auth}" />
      <set item="oparam:adr" value="${o_adr}" />
      <set item="oparam:work" value="${o_work}" />
      <set item="oparam:contact" value="${o_contact}" />
      <set item="oparam:scor_id" value="${o_scor_id}" />
      <set item="oparam:rez" value="${rez}" />
      <set item="oparam:msg" value="${msg}" />
    </deliveryTemplate>
    <deliveryTemplate condition="//Item/@dbresult!='0'">
      <set item="oparam:customer_id" value="Ошибка выполнения запроса." />
      <set item="oparam:customer_type" value="Ошибка выполнения запроса." />
      <set item="oparam:unn" value="Ошибка выполнения запроса." />
      <set item="oparam:naim" value="Ошибка выполнения запроса." />
      <set item="oparam:ur_adr" value="Ошибка выполнения запроса." />
      <set item="oparam:account" value="Ошибка выполнения запроса." />
      <set item="oparam:bank_code" value="Ошибка выполнения запроса." />
      <set item="oparam:bank_name" value="Ошибка выполнения запроса." />
      <set item="oparam:filial_code" value="Ошибка выполнения запроса." />
      <set item="oparam:f" value="Ошибка выполнения запроса." />
      <set item="oparam:s" value="Ошибка выполнения запроса." />
      <set item="oparam:p" value="Ошибка выполнения запроса." />
      <set item="oparam:bd" value="Ошибка выполнения запроса." />
      <set item="oparam:sex" value="Ошибка выполнения запроса." />
      <set item="oparam:inn" value="Ошибка выполнения запроса." />
      <set item="oparam:doc_type" value="Ошибка выполнения запроса." />
      <set item="oparam:doc_ser" value="Ошибка выполнения запроса." />
      <set item="oparam:doc_number" value="Ошибка выполнения запроса." />
      <set item="oparam:doc_date" value="Ошибка выполнения запроса." />
      <set item="oparam:doc_auth" value="Ошибка выполнения запроса." />
      <set item="oparam:adr" value="Ошибка выполнения запроса." />
      <set item="oparam:work" value="Ошибка выполнения запроса." />
      <set item="oparam:contact" value="Ошибка выполнения запроса." />
      <set item="oparam:scor_id" value="Ошибка выполнения запроса." />
      <set item="oparam:rez" value="Ошибка выполнения запроса." />
      <set item="oparam:msg" value="Ошибка выполнения запроса." />
    </deliveryTemplate>
    <input>
      <param name="msisdn" />
      <param name="customer_type" />
      <param name="operator" />
      <param name="model" />
      <param name="proj_code" />
      <param name="id_akcia" />
    </input>
    <output>
      <param name="customer_id" />
      <param name="customer_type" />
      <param name="unn" />
      <param name="naim" />
      <param name="ur_adr" />
      <param name="account" />
      <param name="bank_code" />
      <param name="bank_name" />
      <param name="filial_code" />
      <param name="f" />
      <param name="s" />
      <param name="p" />
      <param name="bd" />
      <param name="sex" />
      <param name="inn" />
      <param name="doc_type" />
      <param name="doc_ser" />
      <param name="doc_number" />
      <param name="doc_date" />
      <param name="doc_auth" />
      <param name="adr" />
      <param name="work" />
      <param name="contact" />
      <param name="scor_id" />
      <param name="rez" />
      <param name="msg" />
    </output>
  </template>
  <!-- 1c. проверка 2 -->
  <template procedureName="CustomerDataAndValidation1SI" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.sales_1s.CUSTOMER_DATA_AND_VALIDATION_I">
          <Attribute name="p_msisdn" type="STRING" value="${msisdn}" />
          <Attribute name="p_inn" type="STRING" value="${i_inn}" />
          <Attribute name="p_customer_type" type="INT" value="${customer_type}" />
          <Attribute name="p_operator" type="STRING" value="${operator}" />
          <Attribute name="p_model" type="STRING" value="${model}" />
          <Attribute name="p_proj_code" type="STRING" value="${proj_code}" />
          <Attribute name="p_id_akcia" type="INT" value="${id_akcia}" />
          <Attribute name="o_customer_id" type="INT" />
          <Attribute name="o_customer_type" type="INT" />
          <Attribute name="o_unn" type="STRING" />
          <Attribute name="o_naim" type="STRING" />
          <Attribute name="o_ur_adr" type="STRING" />
          <Attribute name="o_r_account" type="STRING" />
          <Attribute name="o_bank_code" type="STRING" />
          <Attribute name="o_bank_name" type="STRING" />
          <Attribute name="o_filial_code" type="STRING" />
          <Attribute name="o_f" type="STRING" />
          <Attribute name="o_s" type="STRING" />
          <Attribute name="o_p" type="STRING" />
          <Attribute name="o_bd" type="STRING" />
          <Attribute name="o_sex" type="STRING" />
          <Attribute name="o_inn" type="STRING" />
          <Attribute name="o_doc_type" type="STRING" />
          <Attribute name="o_doc_ser" type="STRING" />
          <Attribute name="o_doc_number" type="STRING" />
          <Attribute name="o_doc_date" type="STRING" />
          <Attribute name="o_doc_auth" type="STRING" />
          <Attribute name="o_adr" type="STRING" />
          <Attribute name="o_work" type="STRING" />
          <Attribute name="o_contact" type="STRING" />
          <Attribute name="o_scor_id" type="INT" />
          <Attribute name="rez" type="INT" />
          <Attribute name="msg" type="STRING" />
          <Attribute name="o_strana" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate condition="//Item/@dbresult='0'">
      <set item="oparam:customer_id" value="${o_customer_id}" />
      <set item="oparam:customer_type" value="${o_customer_type}" />
      <set item="oparam:unn" value="${o_unn}" />
      <set item="oparam:naim" value="${o_naim}" />
      <set item="oparam:ur_adr" value="${o_ur_adr}" />
      <set item="oparam:account" value="${o_r_account}" />
      <set item="oparam:bank_code" value="${o_bank_code}" />
      <set item="oparam:bank_name" value="${o_bank_name}" />
      <set item="oparam:filial_code" value="${o_filial_code}" />
      <set item="oparam:f" value="${o_f}" />
      <set item="oparam:s" value="${o_s}" />
      <set item="oparam:p" value="${o_p}" />
      <set item="oparam:bd" value="${o_bd}" />
      <set item="oparam:sex" value="${o_sex}" />
      <set item="oparam:inn" value="${o_inn}" />
      <set item="oparam:doc_type" value="${o_doc_type}" />
      <set item="oparam:doc_ser" value="${o_doc_ser}" />
      <set item="oparam:doc_number" value="${o_doc_number}" />
      <set item="oparam:doc_date" value="${o_doc_date}" />
      <set item="oparam:doc_auth" value="${o_doc_auth}" />
      <set item="oparam:adr" value="${o_adr}" />
      <set item="oparam:work" value="${o_work}" />
      <set item="oparam:contact" value="${o_contact}" />
      <set item="oparam:scor_id" value="${o_scor_id}" />
      <set item="oparam:rez" value="${rez}" />
      <set item="oparam:msg" value="${msg}" />
      <set item="oparam:strana" value="${o_strana}" />
    </deliveryTemplate>
    <deliveryTemplate condition="//Item/@dbresult!='0'">
      <set item="oparam:customer_id" value="Ошибка выполнения запроса." />
      <set item="oparam:customer_type" value="Ошибка выполнения запроса." />
      <set item="oparam:unn" value="Ошибка выполнения запроса." />
      <set item="oparam:naim" value="Ошибка выполнения запроса." />
      <set item="oparam:ur_adr" value="Ошибка выполнения запроса." />
      <set item="oparam:account" value="Ошибка выполнения запроса." />
      <set item="oparam:bank_code" value="Ошибка выполнения запроса." />
      <set item="oparam:bank_name" value="Ошибка выполнения запроса." />
      <set item="oparam:filial_code" value="Ошибка выполнения запроса." />
      <set item="oparam:f" value="Ошибка выполнения запроса." />
      <set item="oparam:s" value="Ошибка выполнения запроса." />
      <set item="oparam:p" value="Ошибка выполнения запроса." />
      <set item="oparam:bd" value="Ошибка выполнения запроса." />
      <set item="oparam:sex" value="Ошибка выполнения запроса." />
      <set item="oparam:inn" value="Ошибка выполнения запроса." />
      <set item="oparam:doc_type" value="Ошибка выполнения запроса." />
      <set item="oparam:doc_ser" value="Ошибка выполнения запроса." />
      <set item="oparam:doc_number" value="Ошибка выполнения запроса." />
      <set item="oparam:doc_date" value="Ошибка выполнения запроса." />
      <set item="oparam:doc_auth" value="Ошибка выполнения запроса." />
      <set item="oparam:adr" value="Ошибка выполнения запроса." />
      <set item="oparam:work" value="Ошибка выполнения запроса." />
      <set item="oparam:contact" value="Ошибка выполнения запроса." />
      <set item="oparam:scor_id" value="Ошибка выполнения запроса." />
      <set item="oparam:rez" value="Ошибка выполнения запроса." />
      <set item="oparam:msg" value="Ошибка выполнения запроса." />
      <set item="oparam:strana" value="Ошибка выполнения запроса." />
    </deliveryTemplate>
    <input>
      <param name="msisdn" />
      <param name="i_inn" />
      <param name="customer_type" />
      <param name="operator" />
      <param name="model" />
      <param name="proj_code" />
      <param name="id_akcia" />
    </input>
    <output>
      <param name="customer_id" />
      <param name="customer_type" />
      <param name="unn" />
      <param name="naim" />
      <param name="ur_adr" />
      <param name="account" />
      <param name="bank_code" />
      <param name="bank_name" />
      <param name="filial_code" />
      <param name="f" />
      <param name="s" />
      <param name="p" />
      <param name="bd" />
      <param name="sex" />
      <param name="inn" />
      <param name="doc_type" />
      <param name="doc_ser" />
      <param name="doc_number" />
      <param name="doc_date" />
      <param name="doc_auth" />
      <param name="adr" />
      <param name="work" />
      <param name="contact" />
      <param name="scor_id" />
      <param name="rez" />
      <param name="msg" />
      <param name="strana" />
    </output>
  </template>
  <!-- 1c. ret -->
  <template procedureName="RealisationReturn1C" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.sales_1s.RETURN_REALISATION">
          <Attribute name="p_msisdn" type="STRING" value="${msisdn}" />
          <Attribute name="p_acc" type="STRING" value="${acc}" />
          <Attribute name="p_service_id" type="STRING" value="${serviceid}" />
          <Attribute name="p_date_from" type="STRING" value="${date_from}" />
          <Attribute name="p_user_fio" type="STRING" value="${user_fio}" />
          <Attribute name="p_office" type="STRING" value="${office}" />
          <Attribute name="p_phone_imei" type="STRING" value="${imei}" />
          <Attribute name="p_kol" type="INT" value="${kol}" />
          <Attribute name="p_num_doc_1C" type="STRING" value="${n_doc_1C}" />
          <Attribute name="p_oper_type" type="INT" value="${oper_type}" />
          <Attribute name="p_summ" type="STRING" value="${summ}" />
          <Attribute name="p_ch_imei" type="STRING" value="${ch_imei}" />
          <Attribute name="o_rez" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate condition="//Item/@dbresult='0'">
      <set item="oparam:result" value="${o_rez}" />
    </deliveryTemplate>
    <deliveryTemplate condition="//Item/@dbresult!='0'">
      <set item="oparam:result" value="Ошибка выполнения запроса." />
    </deliveryTemplate>
    <input>
      <param name="msisdn" />
      <param name="acc" />
      <param name="serviceid" />
      <param name="date_from" />
      <param name="user_fio" />
      <param name="office" />
      <param name="imei" />
      <param name="kol" />
      <param name="n_doc_1C" />
      <param name="oper_type" />
      <param name="summ" />
      <param name="ch_imei" />
    </input>
    <output>
      <param name="result" />
    </output>
  </template>
  <!--    MTS_Check_Add_VoiceMail             -->
  <template procedureName="MTS_Check_Add_VoiceMail" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_Check_Add_VoiceMail" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(CheckAddVoiceMailcustomer,${customer})}
        @{store(CheckAddVoiceMailsourceid,${sourceid})}
        @{store(CheckAddVoiceMailservicecode,${servicecode})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="CheckAddVoiceMail">
      <set item="iparam:customer" value="${CheckAddVoiceMailcustomer}" />
      <set item="iparam:sourceid" value="${CheckAddVoiceMailsourceid}" />
      <set item="iparam:servicecode" value="${CheckAddVoiceMailservicecode}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="servicecode" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="CheckAddVoiceMail" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="@{newGuid}" session_id="@{newGuid}">
        <Item procedureName="billing.checkandaddvoicemail">
          <Attribute name="customer" type="STRING" value="${customer}" />
          <Attribute name="service_code" type="STRING" value="${servicecode}" />
          <Attribute name="sourceid" type="STRING" value="${sourceid}" />
          <Attribute name="rez" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:result" condition="//Item/@dbresult='0'" value="${rez}" />
      <set item="oparam:result" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="servicecode" />
    </input>
    <output>
      <param name="result" />
    </output>
  </template>
  <!--    MTS_Add_Internet_Blocking             -->
  <template procedureName="MTS_Add_Internet_Blocking" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_Add_Internet_Blocking" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(MTSAddInternetBlockingCustomer,${customer})}
        @{store(MTSAddInternetBlockingCustomerdays_count,${days_count})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="AddInternetBlocking">
      <set item="iparam:customer" value="${MTSAddInternetBlockingCustomer}" />
      <set item="iparam:days_count" value="${MTSAddInternetBlockingCustomerdays_count}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="days_count" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="AddInternetBlocking" handler="DBCON_02">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="@{newGuid}" session_id="@{newGuid}">
        <Item procedureName="wrappers.add_internet_blocking">
          <Attribute name="i_msisdn_fttx" type="STRING" value="${customer}" />
          <Attribute name="i_days_cnt" type="STRING" value="${days_count}" />
          <Attribute name="o_text_res" type="STRING" />
          <Attribute name="o_db_res" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:ResultDB" condition="//Item/@dbresult='0'" value="${o_db_res}" />
      <set item="oparam:ResultDB" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:ResultTXT" condition="//Item/@dbresult='0'" value="${o_text_res}" />
      <set item="oparam:ResultTXT" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="days_count" />
    </input>
    <output>
      <param name="ResultDB" />
      <param name="ResultTXT" />
    </output>
  </template>
  <!--    MTS_Get_Service_List_by_MSISDN             -->
  <template procedureName="MTS_Get_Service_List_by_MSISDN" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_Get_Service_List_by_MSISDN" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(GetServiceListbyMSISDNcustomer,${customer})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="GetServiceListbyMSISDN">
      <set item="iparam:customer" value="${GetServiceListbyMSISDNcustomer}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="sec_code" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="GetServiceListbyMSISDN" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="@{newGuid}" session_id="@{newGuid}">
        <Item procedureName="billing.ussdportal.GET_SERVICE_LIST_BY_MSISDN_MG">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="o_service_list" type="CURSOR" />
          <Attribute name="outparam1" type="STRING" />
          <Attribute name="outparam2" type="INT" />
          <Attribute name="time_request" type="out:DATETIME" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:ServiceLists" value="#{NodesetToString(nodeset('${o_service_list}'))}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="ServiceLists" />
    </output>
  </template>
  <!-- Bamboo   -->
  <template procedureName="MTS_Is_Number_Valid" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_Is_Number_valid" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(IsNumValidCustomer,${customer})}
        @{store(IsNumValidNumber,${number})}
        @{store(IsNumValidSourceIdentifcator,${sourceidentificator})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="Is_Num_valid">
      <set item="iparam:customer" value="${IsNumValidCustomer}" />
      <set item="iparam:number" value="${IsNumValidNumber}" />
      <set item="iparam:sourceidentificator" value="${IsNumValidSourceIdentifcator}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="number" />
      <param name="sourceidentificator" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="Is_Num_valid" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.ECOMMERCE_PKG.is_num_valid">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="p_num" type="STRING" value="${number}" />
          <Attribute name="p_source_id" type="STRING" value="${sourceid}" />
          <Attribute name="o_result" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:result" value="${o_result}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="number" />
      <param name="sourceid" />
    </input>
    <output>
      <param name="result" />
    </output>
  </template>
  <!-- internet.mts.by get_claimed_pay -->
  <template procedureName="MTS_GetClaimedPay" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_GetClaimedPay" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(GetClaimedPaycustomer,${customer})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="GetClaimedPay">
      <set item="iparam:customer" value="${GetClaimedPaycustomer}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="customer" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="GetClaimedPay" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.get_claimed_pay">
          <Attribute name="i_msisdn" type="STRING" value="${customer}" />
          <Attribute name="o_pay_claim_sum" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:pay_claim_sum" value="${o_pay_claim_sum}" />
      <set item="oparam:dbresult" value="${dbresult}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="pay_claim_sum" />
    </output>
  </template>
  <!-- Bookmate.MTS_Bookmate_get_sub_serv_blk -->
  <template procedureName="MTS_Bookmate_get_sub_serv_blk" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_Bookmate_get_sub_serv_blk" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(BookmateInfocustomer,${customer})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="Bookmate_get_sub_serv_blk">
      <set item="iparam:customer" value="${BookmateInfocustomer}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="customer" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="Bookmate_get_sub_serv_blk" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.mg_bookmate_get_sub_serv_blk">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="sub" type="STRING" />
          <Attribute name="blk" type="STRING" />
          <Attribute name="serv" type="STRING" />
          <Attribute name="sub_type" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate condition="//Item/@dbresult='0'" terminating="true">
      <set item="oparam:subscriber" value="${sub}" />
      <set item="oparam:blocking" value="${blk}" />
      <set item="oparam:service" value="${serv}" />
      <set item="oparam:type" value="${sub_type}" />
    </deliveryTemplate>
    <deliveryTemplate condition="//Item/@dbresult!='0'" terminating="true">
      <set item="oparam:subscriber" value="Ошибка выполнения запроса." />
      <set item="oparam:blocking" value="Ошибка выполнения запроса." />
      <set item="oparam:service" value="Ошибка выполнения запроса." />
      <set item="oparam:type" value="Ошибка выполнения запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="subscriber" />
      <param name="blocking" />
      <param name="service" />
      <param name="type" />
    </output>
  </template>
  <!-- Send sms portal-->
  <template procedureName="MTS_SendCode" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_SendCode" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(SendCodecustomer,${customer})}
        @{store(SendCodecode,${code})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="SendCode">
      <set item="iparam:customer" value="${SendCodecustomer}" />
      <set item="iparam:code" value="${SendCodecode}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="customer" />
      <param name="code" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="SendCode">
    <receiveTemplate>
      <Message type="SendSMS" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item>
          <Attribute name="customer" type="STRING" value="${customer}" />
          <Attribute name="Code" type="STRING" value="${code}" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input" condition="not(matches(/Message/Item/Attribute[@name='customer']/@value,&quot;^375(29|33|44|25)[0-9]{7}$&quot;))" terminating="true">
      <set item="oparam:rez" value="customer 12 цифр и только цифры" />
    </deliveryTemplate>
    <deliveryTemplate direction="input" terminating="false">
      <set item="oparam:rez" value="Сообщение отправлено в SMSC" />
    </deliveryTemplate>
    <deliveryTemplate direction="input" connector="SMSCON_01">
      <set item="Content" value="${code}" />
      <set item="Recipient" value="${customer}" />
      <set item="Sender" value="0884" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="code" />
    </input>
    <output>
      <param name="rez" />
    </output>
  </template>
  <!-- Change PASS -->
  <template procedureName="MTS_ChangePassword" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_ChangePassword" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(ChangePasswordcustomer,${customer})}
        @{store(ChangePasswordoldpassword,${oldpassword})}
        @{store(ChangePasswordoldnewpassword,${newpassword})}
        @{store(ChangePasswordoldsrc,${sourceid})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="ChangePasswordv2">
      <set item="iparam:customer" value="${ChangePasswordcustomer}" />
      <set item="iparam:oldpassword" value="${ChangePasswordoldpassword}" />
      <set item="iparam:newpassword" value="${ChangePasswordoldnewpassword}" />
      <set item="iparam:sourceid" value="${ChangePasswordoldsrc}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="customer" />
      <param name="oldpassword" />
      <param name="newpassword" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="ChangePassword">
    <receiveTemplate>
      <Message type="setprofile" initiator="ivrcon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${customer}">
          <Attribute name="oldpassword" value="1111" />
          <Attribute name="newpassword" value="${newpassword}" />
          <Attribute name="confirmpassword" value="${newpassword}" />
          <Attribute name="sourceid" value="${sourceid}" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{substring('${customer}',1,5) = 37500}" call="ChangePasswordfttx" direction="input">
      <set item="iparam:customer" value="${customer}" />
      <set item="iparam:oldpassword" value="1111" />
      <set item="iparam:newpassword" value="${newpassword}" />
      <set item="iparam:confirmpassword" value="${newpassword}" />
      <set item="iparam:sourceid" value="${sourceid}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate conditionEx="#{substring('${customer}',1,5) != 37500}" call="ChangePasswordbasic" direction="input">
      <set item="iparam:customer" value="${customer}" />
      <set item="iparam:oldpassword" value="1111" />
      <set item="iparam:newpassword" value="${newpassword}" />
      <set item="iparam:confirmpassword" value="${newpassword}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="oldpassword" />
      <param name="newpassword" />
      <param name="confirmpassword" />
    </input>
    <output>
      <param name="dbresult" />
    </output>
  </template>
  <template procedureName="ChangePasswordfttx" handler="DBCON_01">
    <receiveTemplate>
      <Message type="setprofile" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.changepasswordselfcare2">
          <Attribute name="customer" type="STRING" value="${customer}" />
          <Attribute name="oldpassword" type="STRING" value="1111" />
          <Attribute name="newpassword" type="STRING" value="${newpassword}" />
          <Attribute name="confirmpassword" type="STRING" value="${newpassword}" />
          <Attribute name="src" type="STRING" value="${sourceid}" />
          <Attribute name="dbresult" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <!-- <set item="oparam:dbresult" value="${dbresult}" /> -->
      <set item="oparam:dbresult" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="oldpassword" />
      <param name="newpassword" />
      <param name="confirmpassword" />
    </input>
    <output>
      <param name="dbresult" />
    </output>
  </template>
  <template procedureName="ChangePasswordbasic">
    <receiveTemplate>
      <Message type="setprofile" initiator="ivrcon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${customer}">
          <Attribute name="oldpassword" value="1111" />
          <Attribute name="newpassword" value="${newpassword}" />
          <Attribute name="confirmpassword" value="${newpassword}" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <!-- <set item="oparam:dbresult" value="${dbresult}" /> -->
      <set item="oparam:dbresult" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="oldpassword" />
      <param name="newpassword" />
      <param name="confirmpassword" />
    </input>
    <output>
      <param name="dbresult" />
    </output>
  </template>
  <template procedureName="ChangePasswordv2" handler="DBCON_01">
    <receiveTemplate>
      <Message type="setprofile" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.mg_pack.ChangePasswordSelfcareV2">
          <Attribute name="customer" type="STRING" value="${customer}" />
          <Attribute name="oldpassword" type="STRING" value="1111" />
          <Attribute name="newpassword" type="STRING" value="${newpassword}" />
          <Attribute name="confirmpassword" type="STRING" value="${newpassword}" />
          <Attribute name="src" type="STRING" value="${sourceid}" />
          <Attribute name="dbresult" type="STRING" />
          <Attribute name="detail" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" condition="//Item/@dbresult='0'" value="${dbresult}" />
      <set item="oparam:dbresult" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:detail" condition="//Item/@dbresult='0'" value="${detail}" />
      <set item="oparam:detail" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="oldpassword" />
      <param name="newpassword" />
      <param name="confirmpassword" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="detail" />
    </output>
  </template>
  <!-- Авторизация с портала. DPI  -->
  <template procedureName="MTS_AuthPortalInternet" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_AuthPortalInternet" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(AuthPortalInternetcustomer,${customer})}
        @{store(AuthPortalInternetpassword,${password})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="AuthPortalInternet">
      <set item="iparam:customer" value="${AuthPortalInternetcustomer}" />
      <set item="iparam:password" value="${AuthPortalInternetpassword}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="customer" />
      <param name="password" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="AuthPortalInternet" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.mg_pack.AuthPortal">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="pass" type="STRING" value="${password}" />
          <Attribute name="dbresult" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate condition="//Item/@dbresult='0'" terminating="true">
      <set item="oparam:dbresult" value="${dbresult}" />
    </deliveryTemplate>
    <deliveryTemplate condition="//Item/@dbresult!='0'" terminating="true">
      <set item="oparam:dbresult" value="Ошибка выполнения запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="password" />
    </input>
    <output>
      <param name="dbresult" />
    </output>
  </template>
  <!-- service   -->
  <template procedureName="MTS_GetServices" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_GetServices" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(GetServicescustomer,${customer})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="GetServices">
      <set item="iparam:customer" value="${GetServicescustomer}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="customer" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="GetServices">
    <receiveTemplate>
      <Message type="service_GET" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${customer}" datasource="state" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${dbresult}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="dbresult" />
    </output>
  </template>
  <!-- tp	-->
  <template procedureName="MTS_GetTPName" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_GetTPName" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(GetTPNamecustomer,${customer})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="GetTPName">
      <set item="iparam:customer" value="${GetTPNamecustomer}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="customer" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="GetTPName" handler="DBCON_01">
    <receiveTemplate>
      <Message type="verificationrequest" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="BILLING.mg_get_validation_for_ivr">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="p_tariffplan" type="STRING" />
          <Attribute name="p_state" type="STRING" />
          <Attribute name="p_password" type="STRING" />
          <Attribute name="p_regioncode" type="STRING" />
          <Attribute name="p_tp_name" type="STRING" />
          <Attribute name="dbresult" type="STRING" />
          <Attribute name="p_check_password" type="STRING" />
          <Attribute name="p_cost" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="-1" />
      <set item="oparam:dbresult" condition="//Item/@dbresult='320341'" value="-1" />
      <set item="oparam:dbresult" condition="//Item/@dbresult='0'" value="${p_tp_name}" />
      <set item="oparam:dbresult" condition="//Item/@dbresult='320343'" value="${p_tp_name}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="dbresult" />
    </output>
  </template>
  <!-- Баланс -->
  <template procedureName="MTS_GetBalance" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_GetBalance" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(GetBalancecustomer,${customer})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="GetBalance">
      <set item="iparam:customer" value="${GetBalancecustomer}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="customer" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="GetBalance" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.lll_dpi_balance">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="p_balance_str" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" condition="//Item/@dbresult='0'" value="${p_balance_str}" />
      <set item="oparam:dbresult" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="dbresult" />
    </output>
  </template>
  <!--- URS   -->
  <template procedureName="MTS_Get_FIO_by_MSISDN" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_Get_FIO_by_MSISDN" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(GetFIOcustomer,${customer})}
        @{store(GetFIOpwd,${pwd})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="Get_FIO_by_MSISDN">
      <set item="iparam:customer" value="${GetFIOcustomer}" />
      <set item="iparam:pwd" value="${GetFIOpwd}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="customer" />
      <param name="pwd" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="Get_FIO_by_MSISDN" handler="DBCON_02">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="oms.wrappers.get_fio_by_msisdn">
          <Attribute name="i_msisdn" type="STRING" value="${customer}" />
          <Attribute name="i_pwd" type="STRING" value="${pwd}" />
          <Attribute name="o_s" type="STRING" />
          <Attribute name="o_n" type="STRING" />
          <Attribute name="o_p" type="STRING" />
          <Attribute name="o_org_name" type="STRING" />
          <Attribute name="o_text_res" type="STRING" />
          <Attribute name="o_db_res" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:s" condition="//Item/@dbresult='0'" value="${o_s}" />
      <set item="oparam:s" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:n" condition="//Item/@dbresult='0'" value="${o_n}" />
      <set item="oparam:n" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:p" condition="//Item/@dbresult='0'" value="${o_p}" />
      <set item="oparam:p" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:org_name" condition="//Item/@dbresult='0'" value="${o_org_name}" />
      <set item="oparam:org_name" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:text_res" condition="//Item/@dbresult='0'" value="${o_text_res}" />
      <set item="oparam:text_res" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:db_res" condition="//Item/@dbresult='0'" value="${o_db_res}" />
      <set item="oparam:db_res" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="pwd" />
    </input>
    <output>
      <param name="s" />
      <param name="n" />
      <param name="p" />
      <param name="org_name" />
      <param name="text_res" />
      <param name="db_res" />
    </output>
  </template>
  <template procedureName="MTS_URS_FTTX_Activation" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_URS_FTTX_Activation" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(URSFTTXActivation_username,${username})}
        @{store(URSFTTXActivation_msisdn_fttx,${msisdn_fttx})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="URS_FTTX_Activation">
      <set item="iparam:username" value="${URSFTTXActivation_username}" />
      <set item="iparam:msisdn_fttx" value="${URSFTTXActivation_msisdn_fttx}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="username" />
      <param name="msisdn_fttx" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="URS_FTTX_Activation" handler="DBCON_02">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="oms.wrappers.urs_fttx_activation">
          <Attribute name="i_username" type="STRING" value="${username}" />
          <Attribute name="i_msisdn_fttx" type="STRING" value="${msisdn_fttx}" />
          <Attribute name="o_text_res" type="STRING" />
          <Attribute name="o_db_res" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:text_res" condition="//Item/@dbresult='0'" value="${o_text_res}" />
      <set item="oparam:text_res" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:db_res" condition="//Item/@dbresult='0'" value="${o_db_res}" />
      <set item="oparam:db_res" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="username" />
      <param name="msisdn_fttx" />
    </input>
    <output>
      <param name="text_res" />
      <param name="db_res" />
    </output>
  </template>
  <template procedureName="MTS_Get_MSISDN_by_ICCID" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_Get_MSISDN_by_ICCID" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(GetMSISDNbyICCID,${iccid})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="Get_MSISDN_by_ICCID">
      <set item="iparam:iccid" value="${GetMSISDNbyICCID}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="iccid" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="Get_MSISDN_by_ICCID" handler="DBCON_02">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="oms.wrappers.get_msisdn_by_iccid">
          <Attribute name="i_iccid" type="STRING" value="${iccid}" />
          <Attribute name="o_msisdn_fttx" type="STRING" />
          <Attribute name="o_text_res" type="STRING" />
          <Attribute name="o_db_res" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:text_res" condition="//Item/@dbresult='0'" value="${o_text_res}" />
      <set item="oparam:text_res" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:db_res" condition="//Item/@dbresult='0'" value="${o_db_res}" />
      <set item="oparam:db_res" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:msisdn_fttx" condition="//Item/@dbresult='0'" value="${o_msisdn_fttx}" />
      <set item="oparam:msisdn_fttx" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="iccid" />
    </input>
    <output>
      <param name="msisdn_fttx" />
      <param name="text_res" />
      <param name="db_res" />
    </output>
  </template>
  <template procedureName="MTS_Get_Act_Status_by_Username" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_Get_Act_Status_by_Username" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(GetActStatusbyUsername,${username})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="Get_Act_Status_by_Username">
      <set item="iparam:username" value="${GetActStatusbyUsername}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="username" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="Get_Act_Status_by_Username" handler="DBCON_02">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="oms.wrappers.get_act_status_by_username">
          <Attribute name="i_username" type="STRING" value="${username}" />
          <Attribute name="o_text_res" type="STRING" />
          <Attribute name="o_db_res" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:text_res" condition="//Item/@dbresult='0'" value="${o_text_res}" />
      <set item="oparam:text_res" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:db_res" condition="//Item/@dbresult='0'" value="${o_db_res}" />
      <set item="oparam:db_res" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="username" />
    </input>
    <output>
      <param name="text_res" />
      <param name="db_res" />
    </output>
  </template>
  <!-- Bamboo. Storno Debet Correct -->
  <template procedureName="MTS_StornoDebetCorrect" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_StornoDebetCorrect" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(stornodetcor_msisdn,${customer})}
        @{store(stornodetcor_transactionid,${transactionid})}
        @{store(stornodetcor_comment,${comment})}
        @{store(stornodetcor_sourceid,${sourceid})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="StornoDebetCorrect">
      <set item="iparam:customer" value="${stornodetcor_msisdn}" />
      <set item="iparam:transactionid" value="${stornodetcor_transactionid}" />
      <set item="iparam:comment" value="${stornodetcor_comment}" />
      <set item="iparam:sourceid" value="${stornodetcor_sourceid}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="transactionid" />
      <param name="comment" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="StornoDebetCorrect" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.ECOMMERCE_PKG.storno_debet_correction_proc">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="p_transaction_id" type="STRING" value="${transactionid}" />
          <Attribute name="p_commentary" type="STRING" value="${comment}" />
          <Attribute name="p_SOURCE_ID" type="STRING" value="${sourceid}" />
          <Attribute name="o_result" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:result" condition="//Item/@dbresult='0'" value="${o_result}" />
      <set item="oparam:result" condition="//Item/@dbresult!='0'" value="Ошибка" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="transactionid" />
      <param name="comment" />
    </input>
    <output>
      <param name="result" />
    </output>
  </template>
  <template procedureName="MTS_StornoDebetCorrect_Bamboo" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_StornoDebetCorrect_Bamboo" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(stornodetcorbamboo_msisdn,${customer})}
        @{store(detcorbamboo_transactionid,${transactionid})}
        @{store(detcorbamboo_comment,${comment})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="StornoDebetCorrectBamboo">
      <set item="iparam:customer" value="${stornodetcorbamboo_msisdn}" />
      <set item="iparam:transactionid" value="${detcorbamboo_transactionid}" />
      <set item="iparam:comment" value="${detcorbamboo_comment}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="transactionid" />
      <param name="comment" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="StornoDebetCorrectBamboo" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.bamboo_pkg.storno_debet_correction_proc">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="p_transaction_id" type="STRING" value="${transactionid}" />
          <Attribute name="p_commentary" type="STRING" value="${comment}" />
          <Attribute name="o_result" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:result" condition="//Item/@dbresult='0'" value="${o_result}" />
      <set item="oparam:result" condition="//Item/@dbresult!='0'" value="Ошибка" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="transactionid" />
      <param name="comment" />
    </input>
    <output>
      <param name="result" />
    </output>
  </template>
  <!-- Bamboo. Debet Correct -->
  <template procedureName="MTS_DebetCorrect" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_DebetCorrect" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(detcor_msisdn,${customer})}
        @{store(detcor_oper_code,${oper_code})}
        @{store(detcor_amount,${amount})}
        @{store(detcor_comment,${comment})}
        @{store(detcor_sourceid,${sourceid})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="DebetCorrect">
      <set item="iparam:customer" value="${detcor_msisdn}" />
      <set item="iparam:oper_code" value="${detcor_oper_code}" />
      <set item="iparam:amount" value="${detcor_amount}" />
      <set item="iparam:comment" value="${detcor_comment}" />
      <set item="iparam:sourceid" value="${detcor_sourceid}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="oper_code" />
      <param name="amount" />
      <param name="comment" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="DebetCorrect" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.ecommerce_pkg.debet_correction_proc">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="p_oper_code" type="INT" value="${oper_code}" />
          <Attribute name="p_amount" type="STRING" value="${amount}" />
          <Attribute name="p_commentary" type="STRING" value="${comment}" />
          <Attribute name="p_SOURCE_ID" type="STRING" value="${sourceid}" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_transaction_id" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:result" condition="//Item/@dbresult='0'" value="${o_result}" />
      <set item="oparam:result" condition="//Item/@dbresult!='0'" value="Ошибка" />
      <set item="oparam:transaction" condition="//Item/@dbresult='0'" value="${o_transaction_id}" />
      <set item="oparam:transaction" condition="//Item/@dbresult!='0'" value="Ошибка" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="oper_code" />
      <param name="amount" />
      <param name="comment" />
      <param name="sourceid" />
    </input>
    <output>
      <param name="result" />
      <param name="transaction" />
    </output>
  </template>
  <template procedureName="MTS_DebetCorrect_Bamboo" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_DebetCorrect_Bamboo" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(detcorbamboo_msisdn,${customer})}
        @{store(detcorbamboo_oper_code,${oper_code})}
        @{store(detcorbamboo_amount,${amount})}
        @{store(detcorbamboo_comment,${comment})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="DebetCorrectBamboo">
      <set item="iparam:customer" value="${detcorbamboo_msisdn}" />
      <set item="iparam:oper_code" value="${detcorbamboo_oper_code}" />
      <set item="iparam:amount" value="${detcorbamboo_amount}" />
      <set item="iparam:comment" value="${detcorbamboo_comment}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="oper_code" />
      <param name="amount" />
      <param name="comment" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="DebetCorrectBamboo" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.bamboo_pkg.debet_correction_proc">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="p_oper_code" type="INT" value="${oper_code}" />
          <Attribute name="p_amount" type="INT" value="${amount}" />
          <Attribute name="p_commentary" type="STRING" value="${comment}" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_transaction_id" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:result" condition="//Item/@dbresult='0'" value="${o_result}" />
      <set item="oparam:result" condition="//Item/@dbresult!='0'" value="Ошибка" />
      <set item="oparam:transaction" condition="//Item/@dbresult='0'" value="${o_transaction_id}" />
      <set item="oparam:transaction" condition="//Item/@dbresult!='0'" value="Ошибка" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="oper_code" />
      <param name="amount" />
      <param name="comment" />
    </input>
    <output>
      <param name="result" />
      <param name="transaction" />
    </output>
  </template>
  <!-- Bamboo. Get Balance -->
  <template procedureName="MTS_GetBalance_Ecommerce" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_GetBalance_Ecommerce" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(getbalecom_msisdn,${customer})}
        @{store(getbalcom_sourceid,${sourceid})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="GetBalance_ecommerce">
      <set item="iparam:customer" value="${getbalecom_msisdn}" />
      <set item="iparam:sourceid" value="${getbalcom_sourceid}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="sec_code" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="GetBalance_ecommerce" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.ecommerce_pkg.get_balance">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="p_SOURCE_ID" type="STRING" value="${sourceid}" />
          <Attribute name="o_result" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:result" condition="//Item/@dbresult='0'" value="${o_result}" />
      <set item="oparam:result" condition="//Item/@dbresult!='0'" value="Ошибка" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
    </input>
    <output>
      <param name="result" />
    </output>
  </template>
  <template procedureName="MTS_GetBalance_Bamboo" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_GetBalance_Bamboo" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(getbalbamboo_msisdn,${customer})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="GetBalance_Bamboo">
      <set item="iparam:customer" value="${getbalbamboo_msisdn}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="sec_code" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="GetBalance_Bamboo" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.bamboo_pkg.get_balance">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="o_result" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:result" condition="//Item/@dbresult='0'" value="${o_result}" />
      <set item="oparam:result" condition="//Item/@dbresult!='0'" value="Ошибка" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="result" />
    </output>
  </template>
  <!-- Bamboo. Validate msisdn -->
  <template procedureName="MTS_ValidateMSISDN_Ecommerce" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_ValidateMSISDN_Ecommerce" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(validateecom_msisdn,${customer})}
        @{store(validateecom_sourceid,${sourceid})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="ValidateMSISDN_ecommerce">
      <set item="iparam:customer" value="${validateecom_msisdn}" />
      <set item="iparam:sourceid" value="${validateecom_sourceid}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="sec_code" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="ValidateMSISDN_ecommerce" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.ecommerce_pkg.is_msisdn_valid">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="p_SOURCE_ID" type="STRING" value="${sourceid}" />
          <Attribute name="o_result" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:result" condition="//Item/@dbresult='0'" value="${o_result}" />
      <set item="oparam:result" condition="//Item/@dbresult!='0'" value="Ошибка" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
    </input>
    <output>
      <param name="result" />
    </output>
  </template>
  <template procedureName="MTS_ValidateMSISDN_Bamboo" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_ValidateMSISDN_Bamboo" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(validatebamboo_msisdn,${customer})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="ValidateMSISDN_Bamboo">
      <set item="iparam:customer" value="${validatebamboo_msisdn}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="sec_code" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="ValidateMSISDN_Bamboo" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.bamboo_pkg.is_msisdn_valid">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="o_result" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:result" condition="//Item/@dbresult='0'" value="${o_result}" />
      <set item="oparam:result" condition="//Item/@dbresult!='0'" value="Ошибка" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="result" />
    </output>
  </template>
  <!-- Get Type MSISDN   -->
  <template procedureName="MTS_GetTypeMSISDN" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_GetTypeMSISDN" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(gettype_customer,${customer})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="GetTypeMSISDN">
      <set item="iparam:customer" value="${gettype_customer}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="sec_code" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="GetTypeMSISDN" handler="DBCON_01">
    <receiveTemplate>
      <Message type="verificationrequest" initiator="ivrcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.mg_get_validation_for_ivr">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="dbresult" type="STRING" />
          <Attribute name="p_Tariffplan" type="STRING" />
          <Attribute name="p_State" type="STRING" />
          <Attribute name="p_Password" type="STRING" />
          <Attribute name="p_Regioncode" type="STRING" />
          <Attribute name="p_tp_name" type="STRING" />
          <Attribute name="p_check_password" type="STRING" />
          <Attribute name="p_cost" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="//Item/@dbresult='0'">
      <set item="oparam:Type" conditionEx="#{'#{/Message/Item/Attribute[@name='dbresult']/@value}'='320341' or '#{/Message/Item/Attribute[@name='dbresult']/@value}'='-1'}" value="NoSubscriber" />
      <set item="oparam:Type" conditionEx="#{('#{/Message/Item/Attribute[@name='p_Tariffplan']/@value}'!='4' or '#{/Message/Item/Attribute[@name='p_Tariffplan']/@value}'!='104') and '#{/Message/Item/Attribute[@name='dbresult']/@value}'='0'}" value="Subscriber" />
      <set item="oparam:Type" conditionEx="#{('#{/Message/Item/Attribute[@name='p_Tariffplan']/@value}'='4' or '#{/Message/Item/Attribute[@name='p_Tariffplan']/@value}'='104') and '#{/Message/Item/Attribute[@name='dbresult']/@value}'='0'}" value="Test" />
    </deliveryTemplate>
    <deliveryTemplate conditionEx="//Item/@dbresult!='0'">
      <set item="oparam:Type" value="Ошибка выполнения запроса" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="Type" />
    </output>
  </template>
  <!-- Validate user -->
  <template procedureName="MTS_ValidateUser" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_ValidateUser" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(validate_customer,${customer})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="ValidateUser">
      <set item="iparam:customer" value="${validate_customer}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="sec_code" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="ValidateUser" handler="DBCON_01">
    <receiveTemplate>
      <Message type="verificationrequest" initiator="ivrcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.mg_get_validation_for_ivr">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="dbresult" type="STRING" />
          <Attribute name="p_Tariffplan" type="STRING" />
          <Attribute name="p_State" type="STRING" />
          <Attribute name="p_Password" type="STRING" />
          <Attribute name="p_Regioncode" type="STRING" />
          <Attribute name="p_tp_name" type="STRING" />
          <Attribute name="p_check_password" type="STRING" />
          <Attribute name="p_cost" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:ValidateUser_Response" conditionEx="#{'#{/Message/Item/Attribute[@name='dbresult']/@value}'='320341'}" value="-1" />
      <set item="oparam:ValidateUser_Response" conditionEx="#{'#{/Message/Item/Attribute[@name='dbresult']/@value}'='-1'}" value="-1" />
      <set item="oparam:ValidateUser_Response" conditionEx="#{'#{/Message/Item/Attribute[@name='dbresult']/@value}'='0'}" value="0" />
      <set item="oparam:ValidateUser_Response" conditionEx="#{'#{/Message/Item/Attribute[@name='dbresult']/@value}'='320343'}" value="0" />
      <!-- <set item="oparam:ValidateUser_Response" value="$-1" /> -->
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="ValidateUser_Response" />
    </output>
  </template>
  <!-- Школьная библиотека. Получение добаленнных услуг и наличие блокировки на номере -->
  <template procedureName="MTS_MG_SL_GetServiceBlock" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_MG_SL_GetServiceBlock" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(sl_servblkcustomer,${customer})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="MG_SL_GetServiceBlock">
      <set item="iparam:customer" value="${sl_servblkcustomer}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="sec_code" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="MG_SL_GetServiceBlock" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.mg_school_library_get_serv_blk">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="blk" type="STRING" />
          <Attribute name="serv" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:Service" condition="//Item/@dbresult='0'" value="${serv}" />
      <set item="oparam:Service" condition="//Item/@dbresult!='0'" value="Ошибка" />
      <set item="oparam:Blocking" condition="//Item/@dbresult='0'" value="${blk}" />
      <set item="oparam:Blocking" condition="//Item/@dbresult!='0'" value="Ошибка" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="Service" />
      <param name="Blocking" />
    </output>
  </template>
  <!-- Школьная библиотека. Получить информацию по триальному периоду -->
  <template procedureName="MTS_GetTrialPeriodService" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_GetTrialPeriodService" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(gettrialperiodcustomer,${customer})}
        @{store(gettrialperiodservicecode,${servicecode})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="GetTrialPeriodServiceMTS">
      <set item="iparam:customer" value="${gettrialperiodcustomer}" />
      <set item="iparam:servicecode" value="${gettrialperiodservicecode}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="servicecode" />
      <param name="sourceid" />
      <param name="sec_code" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="GetTrialPeriodServiceMTS" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.mg_get_trial">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="p_srv_code" type="STRING" value="${servicecode}" />
          <Attribute name="d_fr" type="STRING" />
          <Attribute name="d_to" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:fd" condition="//Item/@dbresult='0'" value="${d_fr}" />
      <set item="oparam:fd" condition="//Item/@dbresult!='0'" value="Ошибка" />
      <set item="oparam:td" condition="//Item/@dbresult='0'" value="${d_to}" />
      <set item="oparam:td" condition="//Item/@dbresult!='0'" value="Ошибка" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="servicecode" />
    </input>
    <output>
      <param name="fd" />
      <param name="td" />
    </output>
  </template>
  <!--    Get WiFi codes   -->
  <template procedureName="MTS_WifiRequest" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_WifiRequest" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(wificustomer,${customer})}
        @{store(wifismstext,${smstext})}
        @{store(wifireqnum,${req_num})}
        @{store(wifisourceid,${sourceid})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="WifiRequest">
      <set item="iparam:customer" value="${wificustomer}" />
      <set item="iparam:smstext" value="${wifismstext}" />
      <set item="iparam:req_num" value="${wifireqnum}" />
      <set item="iparam:sourceid" value="${wifisourceid}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="smstext" />
      <param name="req_num" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="WifiRequest" handler="DBCON_02">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="wifi_alc.WiFiDispatcherTools.Wifi_Request">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="p_smstext" type="STRING" value="${smstext}" />
          <Attribute name="p_req_num" type="STRING" value="${req_num}" />
          <Attribute name="p_source_id" type="STRING" value="${sourceid}" />
          <Attribute name="o_rez" type="STRING" />
          <Attribute name="o_rez_txt" type="STRING" />
          <Attribute name="o_user" type="STRING" />
          <Attribute name="o_pass" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:rez" condition="//Item/@dbresult='0'" value="${o_rez}" />
      <set item="oparam:rez" condition="//Item/@dbresult!='0'" value="Ошибка" />
      <set item="oparam:rez_txt" condition="//Item/@dbresult='0'" value="${o_rez_txt}" />
      <set item="oparam:rez_txt" condition="//Item/@dbresult!='0'" value="Ошибка" />
      <set item="oparam:user" condition="//Item/@dbresult='0'" value="${o_user}" />
      <set item="oparam:user" condition="//Item/@dbresult!='0'" value="Ошибка" />
      <set item="oparam:pass" condition="//Item/@dbresult='0'" value="${o_pass}" />
      <set item="oparam:pass" condition="//Item/@dbresult!='0'" value="Ошибка" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="smstext" />
      <param name="req_num" />
      <param name="sourceid" />
    </input>
    <output>
      <param name="rez" />
      <param name="rez_txt" />
      <param name="user" />
      <param name="pass" />
    </output>
  </template>
  <!--    ByCard.by codes   -->
  <template procedureName="MTS_ByCard_Request" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_ByCard_Request" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(bycardcustomer,${customer})}
        @{store(bycardcode,${code_ticket})}
        @{store(bycardstatus,${status_ticket})}
        @{store(bycardinfo,${info_ticket})}
        @{store(bycardlock_code,${lock_code})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="ByCard_Request">
      <set item="iparam:customer" value="${bycardcustomer}" />
      <set item="iparam:code_ticket" value="${bycardcode}" />
      <set item="iparam:status_ticket" value="${bycardstatus}" />
      <set item="iparam:info_ticket" value="${bycardinfo}" />
      <set item="iparam:lock_code" value="${bycardlock_code}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="code_ticket" />
      <param name="status_ticket" />
      <param name="info_ticket" />
      <param name="lock_code" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="ByCard_Request" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.bycard_bonus.internal_request">
          <Attribute name="v_msisdn" type="STRING" value="${customer}" />
          <Attribute name="v_code" type="STRING" value="${code_ticket}" />
          <Attribute name="v_status" type="STRING" value="${status_ticket}" />
          <Attribute name="v_lock_code" type="INT" value="${lock_code}" />
          <Attribute name="v_info" type="STRING" value="${info_ticket}" />
          <Attribute name="v_response" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:result" condition="//Item/@dbresult='0'" value="${v_response}" />
      <set item="oparam:result" condition="//Item/@dbresult!='0'" value="/////" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="code_ticket" />
      <param name="status_ticket" />
      <param name="info_ticket" />
      <param name="lock_code" />
    </input>
    <output>
      <param name="result" />
    </output>
  </template>
  <!-- ******************************************************************** -->
  <!-- Get list akcii-->
  <template procedureName="AkciiForSales1S" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.SALES_1S.AKCII_BY_PROJECT_CODE">
          <Attribute name="p_login" type="STRING" value="${Login}" />
          <Attribute name="p_project_code" type="STRING" value="${Project_Code}" />
          <Attribute name="p_model" type="STRING" value="${Model}" />
          <Attribute name="p_msisdn" type="STRING" value="${Msisdn}" />
          <Attribute name="o_akcii" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:Akcii" condition="//Item/@dbresult='0'" value="${o_akcii}" />
      <set item="oparam:Akcii" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="Login" />
      <param name="Project_Code" />
      <param name="Model" />
      <param name="Msisdn" />
    </input>
    <output>
      <param name="Akcii" />
    </output>
  </template>
  <!-- Add details-->
  <template procedureName="MTS_DetailedBill" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_DetailedBill" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(DetBillcustomer,${customer})}
        @{store(DetBilladdress,${address})}
        @{store(DetBilldocformat,${docformat})}
        @{store(DetBillstartdate,${startdate})}
        @{store(DetBillenddate,${enddate})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="DetailedBill">
      <set item="iparam:customer" value="${DetBillcustomer}" />
      <set item="iparam:address" value="${DetBilladdress}" />
      <set item="iparam:docformat" value="${DetBilldocformat}" />
      <set item="iparam:startdate" value="${DetBillstartdate}" />
      <set item="iparam:enddate" value="${DetBillenddate}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="address" />
      <param name="docformat" />
      <param name="startdate" />
      <param name="enddate" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="DetailedBill">
    <receiveTemplate>
      <Message type="serviceorder" initiator="ivrcon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${customer}">
          <Service action="4" id="otdetailedbill">
            <Attribute name="methoddelivery" value="Email" />
            <Attribute name="address" value="${address}" />
            <Attribute name="docformat" value="@{switch(${docformat}|???,Html|Html,Pdf|Pdf,Xml|Xml)}" />
            <Attribute name="faxnumber" value="${address}" />
            <Attribute name="start" value="${startdate}" />
            <Attribute name="end" value="${enddate}" />
          </Service>
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="#{/Message/Item/@dbresult}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="address" />
      <param name="docformat" />
      <param name="startdate" />
      <param name="enddate" />
    </input>
    <output>
      <param name="dbresult" />
    </output>
  </template>
  <!-- Bill-->
  <template procedureName="Bill">
    <receiveTemplate>
      <Message type="serviceorder" initiator="ivrcon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${customer}">
          <Service action="4" id="otbill">
            <Attribute name="methoddelivery" value="Email" />
            <Attribute name="address" value="${address}" />
            <Attribute name="docformat" value="@{switch(${docformat}|???,Html|Html,Pdf|Pdf,Xml|Xml)}" />
            <Attribute name="start" value="${DateBill}" />
          </Service>
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="#{/Message/Item/@dbresult}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="address" />
      <param name="docformat" />
      <param name="DateBill" />
      <!--<param name="enddate" value="@{ADD_MONTHS('${startdate}',1)}" /> -->
    </input>
    <output>
      <param name="dbresult" />
    </output>
  </template>
  <!-- метод  FindInfoByNum -->
  <template procedureName="FindInfoByNum" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.zendesk.find_info_by_num">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="o_tarif" type="STRING" />
          <Attribute name="o_externalValue" type="STRING" />
          <Attribute name="o_status" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:Tariff" condition="//Item/@dbresult='0'" value="${o_tarif}" />
      <set item="oparam:Tariff" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:ExternalValue" condition="//Item/@dbresult='0'" value="${o_externalValue}" />
      <set item="oparam:ExternalValue" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:Status" condition="//Item/@dbresult='0'" value="${o_status}" />
      <set item="oparam:Status" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="Tariff" />
      <param name="ExternalValue" />
      <param name="Status" />
    </output>
  </template>
  <!-- типа метод -->
  <template procedureName="CheckCustomer" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.ext_part_req.CHECK_CUSTOMER">
          <Attribute name="p_partner_code" type="STRING" value="${PartnerCode}" />
          <Attribute name="p_inn" type="STRING" value="${PersonalID}" />
          <Attribute name="p_doc_ser" type="STRING" value="${PassportSeries}" />
          <Attribute name="p_doc_num" type="STRING" value="${PassportNumber}" />
          <Attribute name="p_doc_date" type="STRING" value="${PassportIssueDate}" />
          <Attribute name="p_bdate" type="STRING" value="${BirthDate}" />
          <Attribute name="o_code" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:code" condition="//Item/@dbresult='0'" value="${o_code}" />
      <set item="oparam:code" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:message" condition="//Item/@dbresult='0'" value="${o_message}" />
      <set item="oparam:message" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="PartnerCode" />
      <param name="PersonalID" />
      <param name="PassportSeries" />
      <param name="PassportNumber" />
      <param name="PassportIssueDate" />
      <param name="BirthDate" />
    </input>
    <output>
      <param name="code" />
      <param name="message" />
    </output>
  </template>
  <!-- btk_close_port -->
  <template procedureName="ClosePort" handler="DBCON_02">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="oms.wrappers.btk_close_port">
          <Attribute name="i_portid" type="STRING" value="${portid}" />
          <Attribute name="o_text_res" type="STRING" />
          <Attribute name="o_db_res" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:text_res" condition="//Item/@dbresult='0'" value="${o_text_res}" />
      <set item="oparam:text_res" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:db_res" condition="//Item/@dbresult='0'" value="${o_db_res}" />
      <set item="oparam:db_res" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="portid" />
    </input>
    <output>
      <param name="text_res" />
      <param name="db_res" />
    </output>
  </template>
  <!-- RoamingCheck -->
  <template procedureName="RoamingCheck" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.ivr_check_roam_subscriber">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="rez" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:rez" condition="//Item/@dbresult='0'" value="${rez}" />
      <set item="oparam:rez" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="rez" />
    </output>
  </template>
  <!-- 1c -->
  <template procedureName="PaySumByAcc1S" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.sales_1s.PAY_SUM_BY_ACC">
          <Attribute name="p_acc" type="STRING" value="${acc}" />
          <Attribute name="p_summ" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:summ" condition="//Item/@dbresult='0'" value="${p_summ}" />
      <set item="oparam:summ" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="acc" />
    </input>
    <output>
      <param name="summ" />
    </output>
  </template>
  <!-- 1c. проверка -->
  <template procedureName="LoadNewRealisation1S" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.sales_1s.LOAD_NEW_REALISATION">
          <Attribute name="p_msisdn" type="STRING" value="${msisdn}" />
          <Attribute name="p_acc" type="STRING" value="${acc}" />
          <Attribute name="p_summ" type="STRING" value="${summ}" />
          <Attribute name="p_date_from" type="STRING" value="${date_from}" />
          <Attribute name="p_srok" type="INT" value="${srok}" />
          <Attribute name="p_day_pay" type="STRING" value="${day_pay}" />
          <Attribute name="p_balance" type="STRING" value="${balance}" />
          <Attribute name="p_user_fio" type="STRING" value="${user_fio}" />
          <Attribute name="p_office" type="STRING" value="${office}" />
          <Attribute name="p_phone_imei" type="STRING" value="${phone_imei}" />
          <Attribute name="p_phone_name" type="STRING" value="${phone_name}" />
          <Attribute name="p_old_acc" type="STRING" value="${old_acc}" />
          <Attribute name="p_project_name" type="STRING" value="${project_name}" />
          <Attribute name="p_customer_type" type="INT" value="${customer_type}" />
          <Attribute name="p_kol" type="INT" value="${kol}" />
          <Attribute name="p_scor_id" type="INT" value="${scor_id}" />
          <Attribute name="p_customer_id" type="INT" value="${customer_id}" />
          <Attribute name="p_akcia" type="INT" value="${akcia}" />
          <Attribute name="p_oper_type" type="INT" value="${oper_type}" />
          <Attribute name="p_first_pay" type="STRING" value="${first_pay}" />
          <Attribute name="p_base_acc" type="STRING" value="${base_acc}" />
          <Attribute name="p_add_info" type="STRING" value="${add_info}" />
          <Attribute name="p_eq_type" type="STRING" value="${eq_type}" />
          <Attribute name="o_rez" type="INT" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:rez" condition="//Item/@dbresult='0'" value="${o_rez}" />
      <set item="oparam:rez" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="msisdn" />
      <param name="acc" />
      <param name="summ" />
      <param name="date_from" />
      <param name="srok" />
      <param name="day_pay" />
      <param name="balance" />
      <param name="user_fio" />
      <param name="office" />
      <param name="phone_imei" />
      <param name="phone_name" />
      <param name="old_acc" />
      <param name="project_name" />
      <param name="kol" />
      <param name="customer_type" />
      <param name="scor_id" />
      <param name="customer_id" />
      <param name="akcia" />
      <param name="oper_type" />
      <param name="first_pay" />
      <param name="base_acc" />
      <param name="add_info" />
      <param name="eq_type" />
    </input>
    <output>
      <param name="rez" />
    </output>
  </template>
  <!-- Проверка для ITV.BY -->
  <template procedureName="ValidateITV" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.MG_ValidateITV">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="p_pass" type="STRING" value="${password}" />
          <Attribute name="servicecode" type="STRING" value="${servicecode}" />
          <Attribute name="auth_result" type="STRING" />
          <Attribute name="service_result" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:auth_result" condition="//Item/@dbresult='0'" value="${auth_result}" />
      <set item="oparam:auth_result" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:service_result" condition="//Item/@dbresult='0'" value="${service_result}" />
      <set item="oparam:service_result" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="password" />
      <param name="servicecode" />
    </input>
    <output>
      <param name="auth_result" />
      <param name="service_result" />
    </output>
  </template>
  <!-- 1c. проверка -->
  <template procedureName="CUSTOMER_DATA_AND_VALIDATION" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.sales_1s.customer_data_and_validation">
          <Attribute name="p_msisdn" type="STRING" value="${msisdn}" />
          <Attribute name="p_customer_type" type="INT" value="${customer_type}" />
          <Attribute name="p_operator" type="STRING" value="${operator}" />
          <Attribute name="p_model" type="STRING" value="${model}" />
          <Attribute name="p_proj_code" type="STRING" value="${proj_code}" />
          <Attribute name="p_id_akcia" type="INT" value="${id_akcia}" />
          <Attribute name="o_customer_id" type="INT" />
          <Attribute name="o_customer_type" type="INT" />
          <Attribute name="o_unn" type="STRING" />
          <Attribute name="o_naim" type="STRING" />
          <Attribute name="o_ur_adr" type="STRING" />
          <Attribute name="o_f" type="STRING" />
          <Attribute name="o_s" type="STRING" />
          <Attribute name="o_p" type="STRING" />
          <Attribute name="o_bd" type="STRING" />
          <Attribute name="o_sex" type="STRING" />
          <Attribute name="o_inn" type="STRING" />
          <Attribute name="o_doc_type" type="STRING" />
          <Attribute name="o_doc_ser" type="STRING" />
          <Attribute name="o_doc_number" type="STRING" />
          <Attribute name="o_doc_date" type="STRING" />
          <Attribute name="o_doc_auth" type="STRING" />
          <Attribute name="o_adr" type="STRING" />
          <Attribute name="o_work" type="STRING" />
          <Attribute name="o_contact" type="STRING" />
          <Attribute name="o_scor_id" type="INT" />
          <Attribute name="rez" type="INT" />
          <Attribute name="msg" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate condition="//Item/@dbresult='0'" terminating="true">
      <set item="oparam:customer_id" value="${o_customer_id}" />
      <set item="oparam:customer_type" value="${o_customer_type}" />
      <set item="oparam:unn" value="${o_unn}" />
      <set item="oparam:naim" value="${o_naim}" />
      <set item="oparam:ur_adr" value="${o_ur_adr}" />
      <set item="oparam:f" value="${o_f}" />
      <set item="oparam:s" value="${o_s}" />
      <set item="oparam:p" value="${o_p}" />
      <set item="oparam:bd" value="${o_bd}" />
      <set item="oparam:sex" value="${o_sex}" />
      <set item="oparam:inn" value="${o_inn}" />
      <set item="oparam:doc_type" value="${o_doc_type}" />
      <set item="oparam:doc_ser" value="${o_doc_ser}" />
      <set item="oparam:doc_number" value="${o_doc_number}" />
      <set item="oparam:doc_date" value="${o_doc_date}" />
      <set item="oparam:doc_auth" value="${o_doc_auth}" />
      <set item="oparam:adr" value="${o_adr}" />
      <set item="oparam:work" value="${o_work}" />
      <set item="oparam:contact" value="${o_contact}" />
      <set item="oparam:scor_id" value="${o_scor_id}" />
      <set item="oparam:rez" value="${rez}" />
      <set item="oparam:msg" value="${msg}" />
    </deliveryTemplate>
    <deliveryTemplate condition="//Item/@dbresult!='0'" terminating="true">
      <set item="oparam:customer_id" value="Ошибка выполнения запроса." />
      <set item="oparam:customer_type" value="Ошибка выполнения запроса." />
      <set item="oparam:unn" value="Ошибка выполнения запроса." />
      <set item="oparam:naim" value="Ошибка выполнения запроса." />
      <set item="oparam:ur_adr" value="Ошибка выполнения запроса." />
      <set item="oparam:f" value="Ошибка выполнения запроса." />
      <set item="oparam:s" value="Ошибка выполнения запроса." />
      <set item="oparam:p" value="Ошибка выполнения запроса." />
      <set item="oparam:bd" value="Ошибка выполнения запроса." />
      <set item="oparam:sex" value="Ошибка выполнения запроса." />
      <set item="oparam:inn" value="Ошибка выполнения запроса." />
      <set item="oparam:doc_type" value="Ошибка выполнения запроса." />
      <set item="oparam:doc_ser" value="Ошибка выполнения запроса." />
      <set item="oparam:doc_number" value="Ошибка выполнения запроса." />
      <set item="oparam:doc_date" value="Ошибка выполнения запроса." />
      <set item="oparam:doc_auth" value="Ошибка выполнения запроса." />
      <set item="oparam:adr" value="Ошибка выполнения запроса." />
      <set item="oparam:work" value="Ошибка выполнения запроса." />
      <set item="oparam:contact" value="Ошибка выполнения запроса." />
      <set item="oparam:scor_id" value="Ошибка выполнения запроса." />
      <set item="oparam:rez" value="Ошибка выполнения запроса." />
      <set item="oparam:msg" value="Ошибка выполнения запроса." />
    </deliveryTemplate>
    <input>
      <param name="msisdn" />
      <param name="customer_type" />
      <param name="operator" />
      <param name="model" />
      <param name="proj_code" />
      <param name="id_akcia" />
    </input>
    <output>
      <param name="customer_id" />
      <param name="customer_type" />
      <param name="unn" />
      <param name="naim" />
      <param name="ur_adr" />
      <param name="f" />
      <param name="s" />
      <param name="p" />
      <param name="bd" />
      <param name="sex" />
      <param name="inn" />
      <param name="doc_type" />
      <param name="doc_ser" />
      <param name="doc_number" />
      <param name="doc_date" />
      <param name="doc_auth" />
      <param name="adr" />
      <param name="work" />
      <param name="contact" />
      <param name="scor_id" />
      <param name="rez" />
      <param name="msg" />
    </output>
  </template>
  <!-- Send otdel kadrov-->
  <template procedureName="personnel">
    <receiveTemplate>
      <Message type="personnel" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item>
          <Attribute name="customer" type="STRING" value="${customer}" />
          <Attribute name="txt" type="STRING" value="${txt}" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input" condition="not(matches(/Message/Item/Attribute[@name='customer']/@value,&quot;^[0-9]{12}$&quot;))" terminating="true">
      <set item="oparam:rez" value="customer 12 цифр и только цифры" />
    </deliveryTemplate>
    <deliveryTemplate direction="input" terminating="false">
      <set item="oparam:rez" value="Сообщение отправлено в SMSC" />
    </deliveryTemplate>
    <deliveryTemplate direction="input" connector="SMSCON_01">
      <set item="Content" value="${txt}" />
      <set item="Recipient" value="${customer}" />
      <set item="Sender" value="0884" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="txt" />
    </input>
    <output>
      <param name="rez" />
    </output>
  </template>
  <!-- Send sms -->
  <template procedureName="SOAPSendSMS">
    <receiveTemplate>
      <Message type="SendSMS" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item>
          <Attribute name="msisdn" type="STRING" value="${customer}" />
          <Attribute name="source_addr" type="STRING" value="${source_addr}" />
          <Attribute name="txt" type="STRING" value="${txt}" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input" condition="not(matches(/Message/Item/Attribute[@name='source_addr']/@value,&quot;^[0-9]{3,5}$&quot;))" terminating="true">
      <set item="oparam:rez" value="source_addr 3-5 цифр и только цифры" />
    </deliveryTemplate>
    <deliveryTemplate direction="input" terminating="false">
      <set item="oparam:rez" value="Будет отправлено SMS-сообщение" />
    </deliveryTemplate>
    <deliveryTemplate direction="input" connector="SMSCON_01">
      <set item="Content" value="${txt}" />
      <set item="Recipient" value="${customer}" />
      <set item="Sender" value="${source_addr}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="source_addr" />
      <param name="txt" />
    </input>
    <output>
      <param name="rez" />
    </output>
  </template>
  <!-- transfer money-->
  <template procedureName="MTS_TransferP2P" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_TransferP2P" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(MTS_TransferP2Pcustomer,${customer})}
        @{store(MTS_TransferP2Pcustomer_receiver,${customer_receiver})}
        @{store(MTS_TransferP2Pmoney,${money})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="Transfer_P2P">
      <set item="iparam:customer" value="${MTS_TransferP2Pcustomer}" />
      <set item="iparam:customer_receiver" value="${MTS_TransferP2Pcustomer_receiver}" />
      <set item="iparam:money" value="${MTS_TransferP2Pmoney}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="customer_receiver" />
      <param name="money" />
      <param name="sourceid" />
      <param name="sec_code" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="Transfer_P2P">
    <receiveTemplate>
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${customer}">
          <Service id="movepaymentrequest" action="5">
            <Attribute name="receiver" value="${customer_receiver}" />
            <Attribute name="amount" value="${money}" />
          </Service>
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="Перевод невозможен, повторите позже" />
      <set item="oparam:dbresult" condition="//Item/@dbresult='0'" value="Код #{/Message/Item/Service/Attribute[@name='code']/@value} для подтверждения перевода #{/Message/Item/Service/Attribute[@name='amount']/@value div 100} р. абоненту ${receiver}" />
      <set item="oparam:dbresult" condition="//Item/@dbresult='320060'" value="У Вас нет прав для обработки запроса." />
      <set item="oparam:dbresult" condition="//Item/@dbresult='320705'" value="Такая заявка не будет обработана" />
      <set item="oparam:dbresult" condition="//Item/@dbresult='320704'" value="Предыдущая заявка не обработана, повторите позже" />
      <set item="oparam:dbresult" condition="//Item/@dbresult='320666'" value="Неверный код авторизации" />
      <set item="oparam:dbresult" condition="//Item/@dbresult='320999'" value="Срок действия кода авторизации истек" />
      <set item="oparam:dbresult" condition="//Item/@dbresult='320362'" value="У абонента #{/Message/Item/Service/Attribute[@name='receiver']/@value} отключена возможность приема P-t-P" />
      <set item="oparam:dbresult" condition="//Item/@dbresult='320703'" value="Неправильно указан номер получателя" />
      <set item="oparam:dbresult" condition="//Item/@dbresult='320361'" value="Услуга заблокирована, обратитесь в службу поддержки" />
      <set item="oparam:dbresult" condition="//Item/@dbresult='320702'" value="Услуга заблокирована, обратитесь в службу поддержки" />
      <set item="oparam:dbresult" condition="//Item/@dbresult='320101'" value="Повторный ввод информации, пожалуйста, следуйте инструкции" />
      <set item="oparam:dbresult" condition="//Item/@dbresult='320714'" value="Достигнут предел числа получателей" />
      <set item="oparam:dbresult" condition="//Item/@dbresult='320710'" value="Слишком маленькая сумма перевода" />
      <set item="oparam:dbresult" condition="//Item/@dbresult='320701'" value="Слишком большая сумма перевода" />
      <set item="oparam:dbresult" condition="//Item/@dbresult='320711'" value="Указанная сумма превышает лимит переводимых средств на сегодня" />
      <set item="oparam:dbresult" condition="//Item/@dbresult='320712'" value="Превышен лимит для получателя на сутки" />
      <set item="oparam:dbresult" condition="//Item/@dbresult='320191'" value="На Вашем счету недостаточно средств для перевода абоненту #{/Message/Item/Service/Attribute[@name='receiver']/@value}" />
      <set item="oparam:dbresult" condition="//Item/@dbresult='320713'" value="Номер получателя совпадает с Вашим номером. Пожалуйста, повторите ввод" />
      <set item="oparam:dbresult" condition="//Item/@dbresult='320709'" value="Услуга заблокирована. Обратитетсь в службу поддержки" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="customer_receiver" />
      <param name="money" />
    </input>
    <output>
      <param name="dbresult" />
    </output>
  </template>
  <!-- confirm transfer money-->
  <template procedureName="MTS_ConfirmP2P" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_ConfirmP2P" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(MTS_ConfirmP2Pcustomer,${customer})}
        @{store(MTS_ConfirmP2Pcode,${code})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="Confirm_P2P">
      <set item="iparam:customer" value="${MTS_ConfirmP2Pcustomer}" />
      <set item="iparam:code" value="${MTS_ConfirmP2Pcode}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:result_code" value="${o_result}" />
      <set item="oparam:result_msg" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="code" />
      <param name="sourceid" />
      <param name="sec_code" />
    </input>
    <output>
      <param name="result_code" />
      <param name="result_msg" />
    </output>
  </template>
  <template procedureName="Confirm_P2P">
    <receiveTemplate>
      <Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${customer}">
          <Service id="movepaymentacceptance" action="5">
            <Attribute name="code" value="${code}" />
          </Service>
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{${dbresult}!=0}" terminating="true">
      <set item="oparam:dbresult" value="Операция не выполнена" />
    </deliveryTemplate>
    <deliveryTemplate conditionEx="#{${dbresult}=0}">
      <set item="oparam:dbresult" value="Выполнено пополнение баланса абонента #{/Message/Item/Service/Attribute[@name='receiver']/@value} на #{/Message/Item/Service/Attribute[@name='amount']/@value div 100} р." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="code" />
    </input>
    <output>
      <param name="dbresult" />
    </output>
  </template>
  <!-- Add details-->
  <!-- Add details-->
  <template procedureName="MTS_DetailedBalance" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_DetailedBalance" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(DetBalcustomer,${customer})}
        @{store(DetBaladdress,${address})}
        @{store(DetBaldocformat,${docformat})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="DetailedBalance">
      <set item="iparam:customer" value="${DetBalcustomer}" />
      <set item="iparam:address" value="${DetBaladdress}" />
      <set item="iparam:docformat" value="${DetBaldocformat}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="address" />
      <param name="docformat" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="DetailedBalance">
    <receiveTemplate>
      <Message type="serviceorder" initiator="ivrcon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${customer}">
          <Service action="4" id="otdetailedbalance">
            <Attribute name="methoddelivery" value="Email" />
            <Attribute name="address" value="${address}" />
            <Attribute name="docformat" value="@{switch(${docformat}|???,Html|Html,Pdf|Pdf,Xml|Xml)}" />
            <Attribute name="faxnumber" value="${address}" />
          </Service>
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="#{/Message/Item/@dbresult}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="address" />
      <param name="docformat" />
    </input>
    <output>
      <param name="dbresult" />
    </output>
  </template>
  <!-- Проверка номера, ЛС -->
  <template procedureName="isNumAccValid" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.wwp.isNumAccValid">
          <Attribute name="p_num" type="STRING" value="${NumAcc}" />
          <Attribute name="o_res" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:rez" condition="//Item/@dbresult='0'" value="${o_res}" />
      <set item="oparam:rez" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="NumAcc" />
    </input>
    <output>
      <param name="rez" />
    </output>
  </template>
  <!-- Проверка номера, ЛС -->
  <template procedureName="isNumAccValidCust" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.wwp.isNumAccValidCust">
          <Attribute name="p_num" type="STRING" value="${NumAcc}" />
          <Attribute name="o_cust" type="STRING" />
          <Attribute name="o_res" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:customer" condition="//Item/@dbresult='0'" value="${o_cust}" />
      <set item="oparam:customer" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:rez" condition="//Item/@dbresult='0'" value="${o_res}" />
      <set item="oparam:rez" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="NumAcc" />
    </input>
    <output>
      <param name="customer" />
      <param name="rez" />
    </output>
  </template>
  <template procedureName="DB_AddRemoveRBTService" sessionStorage="Memory" sessionLifetime="10">
    <receiveTemplate>
      <Message type="serviceorder" initiator="IMMO" id="${guid}" session_id="@{setSessionId(RBT${msisdn})}">
        <Item customer="${msisdn}">
          <Service id="${service}" action="@{switch(${action}|???,add|2,remove|3)}" class="0" />
        </Item>
        @{store(storeCommand,${action})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'${SRVUSED}'='1'}">
      <set item="oparam:RESULT" value="SERVICE IN PROGRESS" />
    </deliveryTemplate>
    <deliveryTemplate conditionEx="#{${dbresult}=0}">
      <set item="oparam:RESULT" value="OK@{store(SRVUSED,1)}" />
    </deliveryTemplate>
    <deliveryTemplate conditionEx="#{${dbresult}=320344}">
      <set item="oparam:RESULT" value="BALANCE_NOT_ENOUGHT" />
    </deliveryTemplate>
    <deliveryTemplate conditionEx="#{${dbresult}=320204}">
      <set item="oparam:RESULT" value="WRONG_TARIFF" />
    </deliveryTemplate>
    <deliveryTemplate conditionEx="#{'${dbresult}'='-1'}">
      <set item="oparam:RESULT" value="SERVER ERROR" />
    </deliveryTemplate>
    <deliveryTemplate conditionEx="#{${dbresult}=320205}">
      <set item="oparam:RESULT" value="SERVE_EXISTS" />
    </deliveryTemplate>
    <deliveryTemplate conditionEx="#{${dbresult}=320206}">
      <set item="oparam:RESULT" value="SERVICE_REMOVED" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:RESULT" value="UNKNOWN ERROR" />
    </deliveryTemplate>
    <input>
      <param name="msisdn" />
      <param name="service" />
      <param name="action" />
    </input>
    <output>
      <param name="RESULT" />
    </output>
  </template>
  <!-- SCTRADE  -->
  <template procedureName="SCTrade_Ins" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.MainTeller.InsertRec">
          <Attribute name="p_adres" type="STRING" value="${Addr}" />
          <Attribute name="p_id_adres" type="INT" value="${Id_Addr}" />
          <Attribute name="p_fn" type="STRING" value="${FN}" />
          <Attribute name="p_fio" type="STRING" value="${FIO}" />
          <Attribute name="p_moneyIn" type="STRING" value="${MoneyIn}" />
          <Attribute name="p_oper_date" type="DATETIME" value="${OperDate}" />
          <Attribute name="res" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:Res" condition="//Item/@dbresult='0'" value="${res}" />
      <set item="oparam:Res" condition="//Item/@dbresult!='0'" value="-1" />
    </deliveryTemplate>
    <input>
      <param name="Addr" />
      <param name="Id_Addr" />
      <param name="FN" />
      <param name="FIO" />
      <param name="MoneyIn" />
      <param name="OperDate" />
    </input>
    <output>
      <param name="Res" />
    </output>
  </template>
  <template procedureName="SCTrade_Upd" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.MainTeller.UpdateRec">
          <Attribute name="p_form_number" type="STRING" value="${FN}" />
          <Attribute name="p_fio" type="STRING" value="${FIO}" />
          <Attribute name="p_money_in" type="STRING" value="${MoneyIn}" />
          <Attribute name="p_money_cash" type="STRING" value="${MoneyCash}" />
          <Attribute name="p_money_card" type="STRING" value="${MoneyCard}" />
          <Attribute name="p_storn_cash" type="STRING" value="${StornCash}" />
          <Attribute name="p_storn_bank" type="STRING" value="${StornBank}" />
          <Attribute name="p_money_out" type="STRING" value="${MoneyOut}" />
          <Attribute name="p_status" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:Result" condition="//Item/@dbresult='0'" value="${p_status}" />
      <set item="oparam:Result" condition="//Item/@dbresult!='0'" value="-1" />
    </deliveryTemplate>
    <input>
      <param name="FN" />
      <param name="FIO" />
      <param name="MoneyIn" />
      <param name="MoneyCash" />
      <param name="MoneyCard" />
      <param name="StornCash" />
      <param name="StornBank" />
      <param name="MoneyOut" />
    </input>
    <output>
      <param name="Result" />
    </output>
  </template>
  <!-- Проверка наличия сервиса на абоненте -->
  <template procedureName="MTS_ValidateService" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_ValidateService" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(ValidateServicecustomer,${customer})}
        @{store(ValidateServiceservicecode,${servicecode})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="ValidateService">
      <set item="iparam:customer" value="${ValidateServicecustomer}" />
      <set item="iparam:servicecode" value="${ValidateServiceservicecode}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="customer" />
      <param name="servicecode" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="ValidateService" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.mg_validateservice">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="p_service_code" type="STRING" value="${servicecode}" />
          <Attribute name="rez" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:RESULT" condition="//Item/@dbresult='0'" value="${rez}" />
      <set item="oparam:RESULT" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="servicecode" />
    </input>
    <output>
      <param name="RESULT" />
    </output>
  </template>
  <!-- GetPriceTP2Change -->
  <template procedureName="GetPriceTP2Change" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.wwp.getPriceTP2Change">
          <Attribute name="P_msisdn" type="STRING" value="${customer}" />
          <Attribute name="p_new_tp" type="STRING" value="${new_tp}" />
          <Attribute name="o_cena" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:cost" condition="//Item/@dbresult='0'" value="${o_cena}" />
      <set item="oparam:cost" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="new_tp" />
    </input>
    <output>
      <param name="cost" />
    </output>
  </template>
  <!-- GetTPMSISDN -->
  <template procedureName="GetTPMSISDN" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.mg_get_validation_for_ivr">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="dbresult" type="STRING" />
          <Attribute name="p_Tariffplan" type="STRING" />
          <Attribute name="p_State" type="STRING" />
          <Attribute name="p_Password" type="STRING" />
          <Attribute name="p_Regioncode" type="STRING" />
          <Attribute name="p_tp_name" type="STRING" />
          <Attribute name="p_check_password" type="STRING" />
          <Attribute name="p_cost" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:TPID" condition="//Item/@dbresult='0'" value="${p_Tariffplan}" />
      <set item="oparam:TPID" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="TPID" />
    </output>
  </template>
  <!-- Получить pin,puk MVNO (3g btc) -->
  <template procedureName="GetPin" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.ttt_get_pin">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="sn" type="STRING" />
          <Attribute name="imsi" type="STRING" />
          <Attribute name="pin" type="STRING" />
          <Attribute name="pin2" type="STRING" />
          <Attribute name="puk" type="STRING" />
          <Attribute name="puk2" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:msisdn" condition="//Item/@dbresult='0'" value="${p_msisdn}" />
      <set item="oparam:msisdn" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:sn" condition="//Item/@dbresult='0'" value="${sn}" />
      <set item="oparam:sn" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:imsi" condition="//Item/@dbresult='0'" value="${imsi}" />
      <set item="oparam:imsi" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:pin" condition="//Item/@dbresult='0'" value="${pin}" />
      <set item="oparam:pin" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:pin2" condition="//Item/@dbresult='0'" value="${pin2}" />
      <set item="oparam:pin2" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:puk" condition="//Item/@dbresult='0'" value="${puk}" />
      <set item="oparam:puk" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:puk2" condition="//Item/@dbresult='0'" value="${puk2}" />
      <set item="oparam:puk2" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="msisdn" />
      <param name="sn" />
      <param name="imsi" />
      <param name="pin" />
      <param name="pin2" />
      <param name="puk" />
      <param name="puk2" />
    </output>
  </template>
  <!-- ADD SERVICES -->
  <template procedureName="MTS_AddService" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_AddService" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(ascustomer,${customer})}
        @{store(asservicecode,${servicecode})}
        @{store(assourceid,${sourceid})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="AddService">
      <set item="iparam:customer" value="${ascustomer}" />
      <set item="iparam:servicecode" value="${asservicecode}" />
      <set item="iparam:sourceid" value="${assourceid}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="servicecode" />
      <param name="sourceid" />
      <param name="sec_code" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="AddService" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="BILLING.add_close_srv_req.add_srv_req">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="srv_del_str" type="STRING" value="${servicecode}" />
          <Attribute name="source" type="STRING" value="${sourceid}" />
          <Attribute name="ret_code" type="STRING" />
          <Attribute name="reply" type="STRING" />
          <Attribute name="dbresult" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${ret_code}" />
      <set item="oparam:result" value="${reply}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="servicecode" />
      <param name="sourceid" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <!-- ADD SERVICES + Trial -->
  <template procedureName="MTS_AddServiceWithTrial" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_AddServiceWithTrial" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(addservtrialcustomer,${customer})}
        @{store(addservtrialservicecode,${servicecode})}
        @{store(addservtrialsourceid,${sourceid})}
        @{store(addservtrialidservtrial,${idtrial})}
        @{store(addservtrialdays,${days})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="AddServiceAddTrial">
      <set item="iparam:customer" value="${addservtrialcustomer}" />
      <set item="iparam:servicecode" value="${addservtrialservicecode}" />
      <set item="iparam:sourceid" value="${addservtrialsourceid}" />
      <set item="iparam:idtrial" value="${addservtrialidservtrial}" />
      <set item="iparam:days" value="${addservtrialdays}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="servicecode" />
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="idtrial" />
      <param name="days" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="AddServiceAddTrial" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="BILLING.mg_pack.AddServiceWithTrial_Blocking">
          <Attribute name="i_msisdn" type="STRING" value="${customer}" />
          <Attribute name="i_srv_del_str" type="STRING" value="${servicecode}" />
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_srv_trial" type="INT" value="${idtrial}" />
          <Attribute name="i_stv_trial_dt" type="INT" value="${days}" />
          <Attribute name="o_ret_code" type="STRING" />
          <Attribute name="o_reply" type="STRING" />
          <Attribute name="o_dbresult" type="STRING" />
          <Attribute name="o_blk" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_ret_code}" />
      <set item="oparam:result" value="${o_reply}" />
      <set item="oparam:blocking" value="${o_blk}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="servicecode" />
      <param name="sourceid" />
      <param name="idtrial" />
      <param name="days" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
      <param name="blocking" />
    </output>
  </template>
  <!-- DELETE SERVICES -->
  <template procedureName="MTS_DelService" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_DelService" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(scustomer,${customer})}
        @{store(sservicecode,${servicecode})}
        @{store(ssourceid,${sourceid})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="DelService">
      <set item="iparam:customer" value="${scustomer}" />
      <set item="iparam:servicecode" value="${sservicecode}" />
      <set item="iparam:sourceid" value="${ssourceid}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="servicecode" />
      <param name="sourceid" />
      <param name="sec_code" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="DelService" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="BILLING.add_close_srv_req.del_srv_req">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="srv_del_str" type="STRING" value="${servicecode}" />
          <Attribute name="source" type="STRING" value="${sourceid}" />
          <Attribute name="d_end" type="STRING" value="0" />
          <Attribute name="ret_code" type="STRING" />
          <Attribute name="reply" type="STRING" />
          <Attribute name="dbresult" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${ret_code}" />
      <set item="oparam:result" value="${reply}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="servicecode" />
      <param name="sourceid" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <!-- ADD SERVICES in CRM-->
  <template procedureName="AddServiceInCRM">
    <receiveTemplate>
      <Message type="serviceorder" initiator="${source}" id="${guid}" session_id="@{newGuid}">
        <Item customer="${customer}">
          <Service id="${servicecode}" action="2" class="0" needtariffication="${tariffication}" informOnImpossibility="0" createrequest="1" enddate="01.01.0001 00.00.00" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="#{/Message/Item/@dbresult}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="servicecode" />
      <param name="source" />
      <param name="tariffication" />
    </input>
    <output>
      <param name="dbresult" />
    </output>
  </template>
  <!-- Del SERVICES in CRM-->
  <template procedureName="DelServiceInCRM">
    <receiveTemplate>
      <Message type="serviceorder" initiator="${source}" id="${guid}" session_id="@{newGuid}">
        <Item customer="${customer}">
          <Service id="${servicecode}" action="3" class="0" needtariffication="${tariffication}" informOnImpossibility="0" createrequest="1" enddate="01.01.0001 00.00.00" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="#{/Message/Item/@dbresult}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="servicecode" />
      <param name="source" />
      <param name="tariffication" />
    </input>
    <output>
      <param name="dbresult" />
    </output>
  </template>
  <!-- change TP -->
  <template procedureName="MTS_ChangeTariffPlan" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_ChangeTariffPlan" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(ChangeTPcustomer,${customer})}
        @{store(ChangeTPTariffPlan,${tariffplan})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="MTSCheckChangeTariffPlan">
      <set item="iparam:customer" value="${ChangeTPcustomer}" />
      <set item="iparam:tariffplan" value="${ChangeTPTariffPlan}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="tariffplan" />
      <param name="sourceid" />
      <param name="sec_code" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="MTSCheckChangeTariffPlan" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_lll_manual_sm">
          <Attribute name="num" type="STRING" value="${customer}" />
          <Attribute name="tp_out" type="STRING" value="${tariffplan}" />
          <Attribute name="rez" type="STRING" />
        </Item>
        @{store(CheckChangeTPcustomer,${customer})}
        @{store(CheckChangeTPTariffPlan,${tariffplan})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='rez']/@value}'='1'}" call="ChangeTariffPlan">
      <set item="iparam:PhoneNumber" value="${CheckChangeTPcustomer}" />
      <set item="iparam:TariffPlan" value="${CheckChangeTPTariffPlan}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:RESULT" value="${rez}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="tariffplan" />
    </input>
    <output>
      <param name="RESULT" />
    </output>
  </template>
  <template procedureName="ChangeTariffPlan">
    <receiveTemplate>
      <Message type="serviceorder" initiator="USSD" id="${guid}" session_id="@{newGuid}">
        <Item customer="${PhoneNumber}">
          <Service id="changetariffplan" action="0" class="${TariffPlan}" needtarification="1" createrequest="1" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:RESULT" value="${dbresult}" />
    </deliveryTemplate>
    <input>
      <param name="PhoneNumber" />
      <param name="TariffPlan" />
    </input>
    <output>
      <param name="RESULT" />
    </output>
  </template>
  <!--	<template procedureName="ChangeTariffPlan" >
		<receiveTemplate>
			<Message type="serviceorder" initiator="USSD" id="${guid}" session_id="@{newGuid}">
				<Item customer="${PhoneNumber}">
					<Service id="changetariffplan" action="0" class="${TariffPlan}" needtarification="1" createrequest="1" />
				</Item>
			</Message>
		</receiveTemplate>
		<deliveryTemplate terminating="false">
			<set item="oparam:RESULT" value="${dbresult}" />
		</deliveryTemplate>
		<input>
			<param name="SourceId" value="IVRCON" />
			<param name="PhoneNumber" />
			<param name="TariffPlan" value="" />
		</input>
		<output>
			<param name="RESULT" value="0" />
		</output>
	</template>  -->
  <template procedureName="ChangeTariffPlanTest">
    <receiveTemplate>
      <Message type="serviceorder" initiator="IVRCON" id="${guid}" session_id="@{newGuid}">
        <Item customer="${PhoneNumber}">
          <Service id="changetariffplan" action="0" class="${TariffPlan}" needtarification="1" createrequest="1" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate terminating="false">
      <set item="oparam:RESULT" value="${dbresult}" />
    </deliveryTemplate>
    <input>
      <param name="SourceId" value="IVRCON" />
      <param name="PhoneNumber" />
      <param name="TariffPlan" value="" />
    </input>
    <output>
      <param name="RESULT" value="0" />
    </output>
  </template>
  <!-- Change PASS -->
  <template procedureName="ChangePasswordTest_">
    <receiveTemplate>
      <Message type="setprofile" initiator="IVRCON" id="${guid}" session_id="@{newGuid}">
        <Item customer="${customer}">
          <Attribute name="oldpassword" value="${oldpassword}" />
          <Attribute name="newpassword" value="${newpassword}" />
          <Attribute name="confirmpassword" value="${newpassword}" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${dbresult}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="oldpassword" />
      <param name="newpassword" />
      <param name="confirmpassword" />
    </input>
    <output>
      <param name="dbresult" />
    </output>
  </template>
  <!--    Add Fav num  -->
  <template procedureName="MTS_AddNewFavNum" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_AddNewFavNum" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(AddNewFavNumcustomer,${customer})}
        @{store(AddNewFavNumfavnum,${favnum})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="ValidationByMSISDN_add">
      <set item="iparam:customer" value="${AddNewFavNumcustomer}" />
      <set item="iparam:favnum" value="${AddNewFavNumfavnum}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="customer" />
      <param name="favnum" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <!-- проверка ТП при добавлении-->
  <template procedureName="ValidationByMSISDN_add" handler="DBCON_01">
    <receiveTemplate>
      <Message type="setprofile" initiator="ussd" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="billing.mg_get_validation_for_ivr">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="dbresult" type="STRING" />
          <Attribute name="p_Tariffplan" type="STRING" />
          <Attribute name="p_State" type="STRING" />
          <Attribute name="p_Password" type="STRING" />
          <Attribute name="p_Regioncode" type="STRING" />
          <Attribute name="p_tp_name" type="STRING" />
          <Attribute name="p_check_password" type="STRING" />
          <Attribute name="p_cost" type="STRING" />
        </Item>
        @{store(AddNewFavNumcustomer,${customer})}
        @{store(AddNewFavNumfavnum,${favnum})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="matches(/Message/Item/Attribute[@name='p_Tariffplan']/@value,(212|213|214|215|1212|1213|1214|1215) }" call="AddNewFavNum">
      <set item="iparam:customer" value="${AddNewFavNumcustomer}" />
      <set item="iparam:favnum" value="${AddNewFavNumfavnum}" />
      <set item="iparam:favouritenumtype" value="40" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate call="AddNewFavNum">
      <set item="iparam:customer" value="${AddNewFavNumcustomer}" />
      <set item="iparam:favnum" value="${AddNewFavNumfavnum}" />
      <set item="iparam:favouritenumtype" value="1" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="favnum" />
    </input>
    <output>
      <param name="result_code" />
    </output>
  </template>
  <template procedureName="AddNewFavNum">
    <receiveTemplate>
      <Message type="setprofile" initiator="ivrcon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${customer}" action="10">
          <Attribute name="favouritenumber" value="${favnum}" />
          <Attribute name="index" value="0" />
          <Attribute name="favouritenumbertypeid" value="${favouritenumtype}" />
          <Attribute name="createrequest" value="1" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${dbresult}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="favnum" />
      <param name="favouritenumtype" />
    </input>
    <output>
      <param name="dbresult" />
    </output>
  </template>
  <!--    Del Fav num  -->
  <template procedureName="MTS_DeleteFavoriteNum" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_DeleteFavoriteNum" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(DeleteNewFavNumcustomer,${customer})}
        @{store(DeleteNewFavNumfavnum,${favnum})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="ValidationByMSISDN_del">
      <set item="iparam:customer" value="${DeleteNewFavNumcustomer}" />
      <set item="iparam:favnum" value="${DeleteNewFavNumfavnum}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="customer" />
      <param name="favnum" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <!-- проверка ТП при удалени-->
  <template procedureName="ValidationByMSISDN_del" handler="DBCON_01">
    <receiveTemplate>
      <Message type="setprofile" initiator="ussd" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="billing.mg_get_validation_for_ivr">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="dbresult" type="STRING" />
          <Attribute name="p_Tariffplan" type="STRING" />
          <Attribute name="p_State" type="STRING" />
          <Attribute name="p_Password" type="STRING" />
          <Attribute name="p_Regioncode" type="STRING" />
          <Attribute name="p_tp_name" type="STRING" />
          <Attribute name="p_check_password" type="STRING" />
          <Attribute name="p_cost" type="STRING" />
        </Item>
        @{store(DeleteNewFavNumcustomer,${customer})}
        @{store(DeleteNewFavNumfavnum,${favnum})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="matches(/Message/Item/Attribute[@name='p_Tariffplan']/@value,(212|213|214|215|1212|1213|1214|1215) }" call="DeleteFavoriteNum">
      <set item="iparam:customer" value="${DeleteNewFavNumcustomer}" />
      <set item="iparam:favnum" value="${DeleteNewFavNumfavnum}" />
      <set item="iparam:favouritenumtype" value="40" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate call="DeleteFavoriteNum">
      <set item="iparam:customer" value="${DeleteNewFavNumcustomer}" />
      <set item="iparam:favnum" value="${DeleteNewFavNumfavnum}" />
      <set item="iparam:favouritenumtype" value="1" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="favnum" />
    </input>
    <output>
      <param name="result_code" />
    </output>
  </template>
  <template procedureName="DeleteFavoriteNum">
    <receiveTemplate>
      <Message type="setprofile" initiator="ivrcon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${customer}" action="11">
          <Attribute name="favouritenumber" value="${favnum}" />
          <Attribute name="index" value="0" />
          <Attribute name="favouritenumbertypeid" value="${favouritenumtype}" />
          <Attribute name="createrequest" value="1" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${dbresult}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="favnum" />
      <param name="favouritenumtype" />
    </input>
    <output>
      <param name="dbresult" />
    </output>
  </template>
  <!--    Update Fav num  -->
  <template procedureName="MTS_UpdateFavouriteNum" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_UpdateFavouriteNum" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(UpdateFavouriteNumcustomer,${customer})}
        @{store(UpdateFavouriteNumfavnum,${favnum})}
        @{store(UpdateFavouriteNumfavnumnew,${favnumnew})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="ValidationByMSISDN_update">
      <set item="iparam:customer" value="${UpdateFavouriteNumcustomer}" />
      <set item="iparam:favnum" value="${UpdateFavouriteNumfavnum}" />
      <set item="iparam:favnumnew" value="${UpdateFavouriteNumfavnumnew}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="customer" />
      <param name="favnum" />
      <param name="favnumnew" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <!-- проверка ТП при изменении -->
  <template procedureName="ValidationByMSISDN_update" handler="DBCON_01">
    <receiveTemplate>
      <Message type="setprofile" initiator="ussd" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="billing.mg_get_validation_for_ivr">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="dbresult" type="STRING" />
          <Attribute name="p_Tariffplan" type="STRING" />
          <Attribute name="p_State" type="STRING" />
          <Attribute name="p_Password" type="STRING" />
          <Attribute name="p_Regioncode" type="STRING" />
          <Attribute name="p_tp_name" type="STRING" />
          <Attribute name="p_check_password" type="STRING" />
          <Attribute name="p_cost" type="STRING" />
        </Item>
        @{store(UpdateFavouriteNumcustomer,${customer})}
        @{store(UpdateFavouriteNumfavnum,${favnum})}
        @{store(UpdateFavouriteNumfavnumnew,${favnumnew})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="matches(/Message/Item/Attribute[@name='p_Tariffplan']/@value,(212|213|214|215|216|1212|1213|1214|1215|1216) }" call="UpdateFavouriteNum">
      <set item="iparam:customer" value="${UpdateFavouriteNumcustomer}" />
      <set item="iparam:favnum" value="${UpdateFavouriteNumfavnum}" />
      <set item="iparam:favnumnew" value="${UpdateFavouriteNumfavnumnew}" />
      <set item="iparam:favouritenumtype" value="40" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate call="UpdateFavouriteNum">
      <set item="iparam:customer" value="${UpdateFavouriteNumcustomer}" />
      <set item="iparam:favnum" value="${UpdateFavouriteNumfavnum}" />
      <set item="iparam:favnumnew" value="${UpdateFavouriteNumfavnumnew}" />
      <set item="iparam:favouritenumtype" value="1" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="favnum" />
      <param name="favnumnew" />
    </input>
    <output>
      <param name="result_code" />
    </output>
  </template>
  <template procedureName="UpdateFavouriteNum">
    <receiveTemplate>
      <Message type="setprofile" initiator="ivrcon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${customer}" action="9">
          <Attribute name="favouritenumber" value="${favnum}" />
          <Attribute name="favouritenumbernew" value="${favnumnew}" />
          <Attribute name="favouritenumbertypeid" value="${favouritenumtype}" />
          <Attribute name="createrequest" value="1" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${dbresult}" />
      <set item="oparam:favouritenumber" value="${favouritenumber}" />
      <set item="oparam:favouritenumbernew" value="${favouritenumbernew}" />
      <set item="oparam:price" value="${price}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="favnum" />
      <param name="favnumnew" />
      <param name="favouritenumtype" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="favouritenumber" />
      <param name="favouritenumbernew" />
      <param name="price" />
    </output>
  </template>
  <!--    Get Fav num  -->
  <template procedureName="GetFavoriteNums">
    <receiveTemplate>
      <Message type="setprofile" initiator="ivrcon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${customer}" action="8">
          <Attribute name="favouritenumber" value="${favnum}" />
          <Attribute name="index" value="${index}" />
          <Attribute name="favouritenumbertypeid" value="1" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${dbresult}" />
      <set item="oparam:Count" value="${Count}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="favnum" />
      <param name="index" />
      <param name="favouritenumbertypeid" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="Count" />
      <param name="favouritenumber" />
    </output>
  </template>
  <!-- Баланс_2 -->
  <template procedureName="GetBalance_2">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${customer}" subject="balance_2" datasource="state" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${dbresult}" />
      <set item="oparam:rez" value="${rez}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="rez" />
    </output>
  </template>
  <!-- ADD SERVICES with CHECK -->
  <template procedureName="AddService_with_check">
    <receiveTemplate />
    <deliveryTemplate conditionEx="#{(
			'${customer}' = (375(292|295|297|298|336|333)\d{6})
			) and '${sourceid}' = (20|30)}" direction="input" call="GetTPName">
      <set item="iparam:customer" value="${customer}" />
      <set item="iparam:serviceCode" value="${serviceCode}" />
      <set item="iparam:sourceid" value="${sourceid}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="servicecode" />
      <param name="sourceid" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="GetTPName2">
    <receiveTemplate />
    <deliveryTemplate conditionEx="#{('${customer}' = 375297776319) }" direction="input" call="GetTPNametest">
      <set item="iparam:customer" value="${customer}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="dbresult" />
    </output>
  </template>
  <template procedureName="GetTPNametest">
    <receiveTemplate>
      <Message type="verificationrequest" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${customer}" datasource="state" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="-1" />
      <set item="oparam:dbresult" condition="//Item/@dbresult='320341'" value="-1" />
      <set item="oparam:dbresult" condition="//Item/@dbresult='0'" value="${tp_name} test" />
      <set item="oparam:dbresult" condition="//Item/@dbresult='320343'" value="${tp_name} test" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="dbresult" />
    </output>
  </template>
  <template procedureName="GetTPNameerr">
    <receiveTemplate />
    <deliveryTemplate direction="input">
      <set item="oparam:dbresult" value="неверный номер" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="dbresult" />
    </output>
  </template>
  <!-- Счетчики -->
  <template procedureName="GetCounters">
    <receiveTemplate>
      <Message type="get_counters" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${customer}" datasource="state" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:counters" value="${msg}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="counters" />
    </output>
  </template>
  <template procedureName="is_msisdnvalidPAY" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.wwp.art_valid">
          <Attribute name="tel" type="STRING" value="${customer}" />
          <Attribute name="o_res" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:rez" condition="//Item/@dbresult='0'" value="${o_res}" />
      <set item="oparam:rez" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="rez" />
    </output>
  </template>
  <!-- Проверка авторизации с портала -->
  <template procedureName="MTS_AuthPortal" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_AuthPortal" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(authcustomer,${customer})}
        @{store(authpassword,${password})}
        @{store(authsrcid,${sourceid})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="AuthPortal_">
      <set item="iparam:customer" value="${authcustomer}" />
      <set item="iparam:password" value="${authpassword}" />
      <set item="iparam:sourceid" value="${authsrcid}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="password" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="AuthPortal_" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.mg_AuthPortal">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="p_pass" type="STRING" value="${password}" />
          <Attribute name="SRC" type="INT" value="${sourceid}" />
          <Attribute name="dbresult" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" condition="//Item/@dbresult='0'" value="${dbresult}" />
      <set item="oparam:dbresult" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="password" />
      <param name="sourceid" />
    </input>
    <output>
      <param name="dbresult" />
    </output>
  </template>
  <template procedureName="AuthPortal" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.mg_AuthPortal">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="p_pass" type="STRING" value="${password}" />
          <Attribute name="SRC" type="INT" value="${sourceid}" />
          <Attribute name="dbresult" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" condition="//Item/@dbresult='0'" value="${dbresult}" />
      <set item="oparam:dbresult" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="password" />
      <param name="sourceid" />
    </input>
    <output>
      <param name="dbresult" />
    </output>
  </template>
  <!-- Установка нового пароля с портала -->
  <template procedureName="SetNewPassPortal" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.mg_set_new_password">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="dbresult" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" condition="//Item/@dbresult='0'" value="${dbresult}" />
      <set item="oparam:dbresult" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="dbresult" />
    </output>
  </template>
  <!-- GetDataByMsisdn -->
  <template procedureName="GetDataByMsisdn" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.converg_supply_pkg.getdatabymsisdn">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="p_date" type="DATETIME" value="${date}" />
          <Attribute name="p_jiraid" type="STRING" value="${jiraid}" />
          <Attribute name="p_source" type="STRING" value="${source}" />
          <Attribute name="o_fio" type="STRING" />
          <Attribute name="o_birth_place" type="STRING" />
          <Attribute name="o_inn" type="STRING" />
          <Attribute name="o_doc_data" type="STRING" />
          <Attribute name="o_contact_phone" type="STRING" />
          <Attribute name="o_contact_mail" type="STRING" />
          <Attribute name="o_curservices" type="STRING" />
          <Attribute name="o_tariffplanid" type="STRING" />
          <Attribute name="o_login" type="STRING" />
          <Attribute name="o_password" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate condition="//Item/@dbresult='0'" terminating="true">
      <set item="oparam:fio" value="${o_fio}" />
      <set item="oparam:birth_place" value="${o_birth_place}" />
      <set item="oparam:inn" value="${o_inn}" />
      <set item="oparam:doc_data" value="${o_doc_data}" />
      <set item="oparam:contact_phone" value="${o_contact_phone}" />
      <set item="oparam:contact_mail" value="${o_contact_mail}" />
      <set item="oparam:curservices" value="${o_curservices}" />
      <set item="oparam:tariffplanid" value="${o_tariffplanid}" />
      <set item="oparam:login" value="${o_login}" />
      <set item="oparam:password" value="${o_password}" />
    </deliveryTemplate>
    <deliveryTemplate condition="//Item/@dbresult!='0'" terminating="true">
      <set item="oparam:fio" value="Ошибка выполнения запроса." />
      <set item="oparam:birth_place" value="Ошибка выполнения запроса." />
      <set item="oparam:inn" value="Ошибка выполнения запроса." />
      <set item="oparam:doc_data" value="Ошибка выполнения запроса." />
      <set item="oparam:contact_phone" value="Ошибка выполнения запроса." />
      <set item="oparam:contact_mail" value="Ошибка выполнения запроса." />
      <set item="oparam:curservices" value="Ошибка выполнения запроса." />
      <set item="oparam:tariffplanid" value="Ошибка выполнения запроса." />
      <set item="oparam:login" value="Ошибка выполнения запроса." />
      <set item="oparam:password" value="Ошибка выполнения запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="date" />
      <param name="jiraid" />
      <param name="source" />
    </input>
    <output>
      <param name="fio" />
      <param name="birth_place" />
      <param name="inn" />
      <param name="doc_data" />
      <param name="contact_phone" />
      <param name="contact_mail" />
      <param name="curservices" />
      <param name="tariffplanid" />
      <param name="login" />
      <param name="password" />
    </output>
  </template>
  <!-- setdatabymsisdn -->
  <template procedureName="SetDatabyMsisdn" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.converg_supply_pkg.setdatabymsisdn">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="p_date" type="DATETIME" value="${date}" />
          <Attribute name="p_jiraid" type="STRING" value="${jiraid}" />
          <Attribute name="p_source" type="STRING" value="${source}" />
          <Attribute name="p_address" type="STRING" value="${address}" />
          <Attribute name="p_device_id" type="STRING" value="${deviceid}" />
          <Attribute name="p_port_id" type="STRING" value="${portid}" />
          <Attribute name="dbresult" type="STRING" />
          <Attribute name="o_dbresultstr" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" condition="//Item/@dbresult='0'" value="${dbresult}" />
      <set item="oparam:dbresult" condition="//Item/@dbresult!='0'" value="Ошибка выполнения запроса." />
      <set item="oparam:dbresultstr" condition="//Item/@dbresult='0'" value="${o_dbresultstr}" />
      <set item="oparam:dbresultstr" condition="//Item/@dbresult!='0'" value="Ошибка выполнения запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="date" />
      <param name="jiraid" />
      <param name="source" />
      <param name="address" />
      <param name="deviceid" />
      <param name="portid" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="dbresultstr" />
    </output>
  </template>
  <!-- Получить баланс и наличие блокировок на номере -->
  <template procedureName="GetBalanceBlocking" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.ttt_get_balance_blocking">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="p_balance" type="STRING" />
          <Attribute name="p_blocking_limit" type="STRING" />
          <Attribute name="p_blocking" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:balance" condition="//Item/@dbresult='0'" value="${p_balance}" />
      <set item="oparam:balance" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:blocking_limit" condition="//Item/@dbresult='0'" value="${p_blocking_limit}" />
      <set item="oparam:blocking_limit" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:blocking" condition="//Item/@dbresult='0'" value="${p_blocking}" />
      <set item="oparam:blocking" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="balance" />
      <param name="blocking_limit" />
      <param name="blocking" />
    </output>
  </template>
  <!-- Получить список платежей и корректировк на номере. Для БТК -->
  <template procedureName="GetPaymentsList" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.ttt_get_payments_list">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="dbresult" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" condition="//Item/@dbresult='0'" value="${dbresult}" />
      <set item="oparam:dbresult" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="dbresult" />
    </output>
  </template>
  <!-- Добавление принудительной, частичной блокировки. Для БТК -->
  <template procedureName="Add_Blocking" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="BILLING.wll.add_srv_req">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="srv_del_str" type="STRING" value="${block}" />
          <Attribute name="source" type="STRING" value="161" />
          <Attribute name="dbresult" type="STRING" />
          <Attribute name="reply" type="STRING" />
          <Attribute name="ret_code" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:comment" condition="//Item/@dbresult='0'" value="${reply}" />
      <set item="oparam:comment" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:code" condition="//Item/@dbresult='0'" value="${ret_code}" />
      <set item="oparam:code" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="block" />
    </input>
    <output>
      <param name="comment" />
      <param name="code" />
    </output>
  </template>
  <!-- Удаление принудительной, частичной блокировки. Для БТК -->
  <template procedureName="Del_Blocking" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="BILLING.wll.del_srv_req">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="srv_del_str" type="STRING" value="${block}" />
          <Attribute name="source" type="STRING" value="161" />
          <Attribute name="d_end" type="STRING" value="0" />
          <Attribute name="dbresult" type="STRING" />
          <Attribute name="reply" type="STRING" />
          <Attribute name="ret_code" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:comment" condition="//Item/@dbresult='0'" value="${reply}" />
      <set item="oparam:comment" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:code" condition="//Item/@dbresult='0'" value="${ret_code}" />
      <set item="oparam:code" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="block" />
    </input>
    <output>
      <param name="comment" />
      <param name="code" />
    </output>
  </template>
  <!-- Расторжение приложения. Для БТК -->
  <template procedureName="End_Blocking_Customer" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="BILLING.wll.proc_zakl_block">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="dbresult" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" condition="//Item/@dbresult='0'" value="${dbresult}" />
      <set item="oparam:dbresult" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="dbresult" />
    </output>
  </template>
  <!-- Добавление услуг. Для БТК -->
  <template procedureName="Add_Service" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="BILLING.wll.add_srv_req">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="srv_del_str" type="STRING" value="${service}" />
          <Attribute name="source" type="STRING" value="161" />
          <Attribute name="dbresult" type="STRING" />
          <Attribute name="reply" type="STRING" />
          <Attribute name="ret_code" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:comment" condition="//Item/@dbresult='0'" value="${reply}" />
      <set item="oparam:comment" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:code" condition="//Item/@dbresult='0'" value="${ret_code}" />
      <set item="oparam:code" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="service" />
    </input>
    <output>
      <param name="comment" />
      <param name="code" />
    </output>
  </template>
  <!-- Удаление услуг. Для БТК -->
  <template procedureName="Del_Service" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="BILLING.wll.del_srv_req">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="srv_del_str" type="STRING" value="${service}" />
          <Attribute name="source" type="STRING" value="161" />
          <Attribute name="d_end" type="STRING" value="${end}" />
          <Attribute name="dbresult" type="STRING" />
          <Attribute name="reply" type="STRING" />
          <Attribute name="ret_code" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:comment" condition="//Item/@dbresult='0'" value="${reply}" />
      <set item="oparam:comment" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:code" condition="//Item/@dbresult='0'" value="${ret_code}" />
      <set item="oparam:code" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="service" />
      <param name="end" />
    </input>
    <output>
      <param name="comment" />
      <param name="code" />
    </output>
  </template>
  <!-- Получить пароль -->
  <template procedureName="GetPassword" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.converg_supply_pkg.getorset_new_password">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="o_password" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:password" condition="//Item/@dbresult='0'" value="${o_password}" />
      <set item="oparam:password" condition="//Item/@dbresult!='0'" value="Ошибка выполнения запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="password" />
    </output>
  </template>
  <!-- Аутентификация юзера ADSL -->
  <template procedureName="AuthUserAdsl" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.converg_supply_pkg.authuseradsl">
          <Attribute name="i_user_name" type="STRING" value="${customer}" />
          <Attribute name="i_pass_word" type="STRING" value="${password}" />
          <Attribute name="o_result" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:result" condition="//Item/@dbresult='0'" value="${o_result}" />
      <set item="oparam:result" condition="//Item/@dbresult!='0'" value="Ошибка выполнения запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="password" />
    </input>
    <output>
      <param name="result" />
    </output>
  </template>
  <!-- Set New Password DPI -->
  <template procedureName="SetPasswordPortal">
    <receiveTemplate>
      <Message type="setprofile" initiator="IVRCON" id="${guid}" session_id="@{newGuid}">
        <Item customer="${customer}">
          <Attribute name="oldpassword" value="1111" />
          <Attribute name="newpassword" value="${newpassword}" />
          <Attribute name="confirmpassword" value="${newpassword}" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${dbresult}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="newpassword" />
    </input>
    <output>
      <param name="dbresult" />
    </output>
  </template>
  <!-- Авторизация с портала. DPI  -->
  <template procedureName="AuthPortalDPI" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.mg_pack.AuthPortal">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="pass" type="STRING" value="${password}" />
          <Attribute name="dbresult" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate condition="//Item/@dbresult='0'" terminating="true">
      <set item="oparam:dbresult" value="${dbresult}" />
    </deliveryTemplate>
    <deliveryTemplate condition="//Item/@dbresult!='0'" terminating="true">
      <set item="oparam:dbresult" value="Ошибка выполнения запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="password" />
    </input>
    <output>
      <param name="dbresult" />
    </output>
  </template>
  <!-- AccCreate Shop.mts.by -->
  <template procedureName="AccCreate" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.WS_pkg.ws_acc_create">
          <Attribute name="p_order_ID" type="STRING" value="${order_id}" />
          <Attribute name="p_client_id" type="STRING" value="${client_id}" />
          <Attribute name="p_client_fio" type="STRING" value="${client_fio}" />
          <Attribute name="p_order_sum" type="STRING" value="${order_sum}" />
          <Attribute name="p_project" type="STRING" value="${project}" />
          <Attribute name="p_pay_mode" type="STRING" value="${pay_mode}" />
          <Attribute name="p_order_data" type="STRING" value="${order_data}" />
          <Attribute name="p_delivery_method" type="STRING" value="${delivery_method}" />
          <Attribute name="o_acc" type="STRING" />
          <Attribute name="o_res" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:acc" condition="//Item/@dbresult='0'" value="${o_acc}" />
      <set item="oparam:acc" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:res" condition="//Item/@dbresult='0'" value="${o_res}" />
      <set item="oparam:res" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="order_id" />
      <param name="client_id" />
      <param name="client_fio" />
      <param name="order_sum" />
      <param name="project" />
      <param name="pay_mode" />
      <param name="order_data" />
      <param name="delivery_method" />
    </input>
    <output>
      <param name="acc" />
      <param name="res" />
    </output>
  </template>
  <!-- AccStatusUpdate Shop.mts.by -->
  <template procedureName="AccStatusUpdate" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.WS_pkg.ws_status_update">
          <Attribute name="p_acc" type="STRING" value="${acc}" />
          <Attribute name="ws_status" type="STRING" value="${status}" />
          <Attribute name="f_res" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:res" condition="//Item/@dbresult='0'" value="${f_res}" />
      <set item="oparam:res" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="acc" />
      <param name="status" />
    </input>
    <output>
      <param name="res" />
    </output>
  </template>
  <!-- Процедурадля банков. Служит для получения PAYMENT_DOCUMENT_ID по номеру лицевого счета, документа и дня совершения платежа -->
  <template procedureName="GetPdByDocnum" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="get_pd_by_docnum@bill">
          <Attribute name="p_panum" type="STRING" value="${panum}" />
          <Attribute name="p_docnum" type="STRING" value="${docnum}" />
          <Attribute name="p_strday" type="STRING" value="${strday}" />
          <Attribute name="o_paydoc_id" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:res" condition="//Item/@dbresult='0'" value="${o_paydoc_id}" />
      <set item="oparam:res" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="panum" />
      <param name="docnum" />
      <param name="strday" />
    </input>
    <output>
      <param name="res" />
    </output>
  </template>
  <!-- Процедура для получения кредитной истории от внешних партненров -->
  <template procedureName="bsg_exch" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.scoring_basegroup_pkg.bsg_exch">
          <Attribute name="p_inn" type="STRING" value="${inn}" />
          <Attribute name="passp_num" type="STRING" value="${passnum}" />
          <Attribute name="p_bdate" type="DATETIME" value="${bdate}" />
          <Attribute name="p_f" type="STRING" value="${surname}" />
          <Attribute name="p_i" type="STRING" value="${name}" />
          <Attribute name="p_o" type="STRING" value="${patronymic}" />
          <Attribute name="p_msisdn" type="STRING" value="${msisdn}" />
          <Attribute name="o_ans" type="STRING" />
          <Attribute name="o_msg_code" type="STRING" />
          <Attribute name="o_msg_dscr" type="STRING" />
          <Attribute name="o_query_id" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:ans" condition="//Item/@dbresult='0'" value="${o_ans}" />
      <set item="oparam:ans" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:msg_code" condition="//Item/@dbresult='0'" value="${o_msg_code}" />
      <set item="oparam:msg_code" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:msg_dscr" condition="//Item/@dbresult='0'" value="${o_msg_dscr}" />
      <set item="oparam:msg_dscr" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:query_id" condition="//Item/@dbresult='0'" value="${o_query_id}" />
      <set item="oparam:query_id" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="inn" />
      <param name="passnum" />
      <param name="bdate" />
      <param name="surname" />
      <param name="name" />
      <param name="patronymic" />
      <param name="msisdn" />
    </input>
    <output>
      <param name="ans" />
      <param name="msg_code" />
      <param name="msg_dscr" />
      <param name="query_id" />
    </output>
  </template>
  <!-- метод для проверки Белетелекомом принадлежности абонента -->
  <template procedureName="GetDataCentrex" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.converg_supply_pkg.getdatacentrex">
          <Attribute name="p_msisdn" type="STRING" value="${msisdn}" />
          <Attribute name="o_inn" type="STRING" />
          <Attribute name="o_name" type="STRING" />
          <Attribute name="o_resp" type="STRING" />
          <Attribute name="o_dbresult" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:inn" condition="//Item/@dbresult='0'" value="${o_inn}" />
      <set item="oparam:inn" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:name" condition="//Item/@dbresult='0'" value="${o_name}" />
      <set item="oparam:name" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:resp" condition="//Item/@dbresult='0'" value="${o_resp}" />
      <set item="oparam:resp" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:dbres" condition="//Item/@dbresult='0'" value="${o_dbresult}" />
      <set item="oparam:dbres" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="msisdn" />
    </input>
    <output>
      <param name="inn" />
      <param name="name" />
      <param name="resp" />
      <param name="dbres" />
    </output>
  </template>
  <!-- Получить баланс и наличие блокировок на номере -->
  <template procedureName="MTS_GetBalanceBlockingMSISDN" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_AddService" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(balblkcustomer,${customer})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="GetBalanceBlockingMSISDN">
      <set item="iparam:customer" value="${balblkcustomer}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:balance" value="${o_message}" />
      <set item="oparam:blocking_limit" value="${o_message}" />
      <set item="oparam:blocking" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="sourceid" />
      <param name="sec_code" />
    </input>
    <output>
      <param name="balance" />
      <param name="blocking_limit" />
      <param name="blocking" />
    </output>
  </template>
  <template procedureName="GetBalanceBlockingMSISDN" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.ttt_balance_blocking_msisdn">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="P_vendor" type="STRING" value="mts" />
          <Attribute name="p_balance" type="STRING" />
          <Attribute name="p_blocking_limit" type="STRING" />
          <Attribute name="p_blocking" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:balance" condition="//Item/@dbresult='0'" value="${p_balance}" />
      <set item="oparam:balance" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:blocking_limit" condition="//Item/@dbresult='0'" value="${p_blocking_limit}" />
      <set item="oparam:blocking_limit" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:blocking" condition="//Item/@dbresult='0'" value="${p_blocking}" />
      <set item="oparam:blocking" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="balance" />
      <param name="blocking_limit" />
      <param name="blocking" />
    </output>
  </template>
  <!-- обмен данными с веб-магазином -->
  <template procedureName="Acc_Create_Ext" handler="DBCON_01">
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="billing.ws_pkg.ws_acc_create">
          <Attribute name="p_order_id" type="STRING" value="${order_id}" />
          <Attribute name="p_client_id" type="STRING" value="${client_id}" />
          <Attribute name="p_client_fio" type="STRING" value="${client_fio}" />
          <Attribute name="p_order_sum" type="STRING" value="${order_sum}" />
          <Attribute name="p_project" type="STRING" value="${project}" />
          <Attribute name="p_order_data" type="STRING" value="${order_data}" />
          <Attribute name="p_delivery_method" type="STRING" value="${delivery_method}" />
          <Attribute name="p_pay_mode" type="STRING" value="${pay_mode}" />
          <Attribute name="p_email_cust" type="STRING" value="${email_cust}" />
          <Attribute name="p_delivery_cost" type="STRING" value="${delivery_cost}" />
          <Attribute name="p_delivery_address" type="STRING" value="${delivery_address}" />
          <Attribute name="p_contact_phone" type="STRING" value="${contact_phone}" />
          <Attribute name="o_acc" type="STRING" />
          <Attribute name="o_res" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:acc" condition="//Item/@dbresult='0'" value="${o_acc}" />
      <set item="oparam:acc" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
      <set item="oparam:res" condition="//Item/@dbresult='0'" value="${o_res}" />
      <set item="oparam:res" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="order_id" />
      <param name="client_id" />
      <param name="client_fio" />
      <param name="order_sum" />
      <param name="project" />
      <param name="order_data" />
      <param name="delivery_method" />
      <param name="pay_mode" />
      <param name="email_cust" />
      <param name="delivery_cost" />
      <param name="delivery_address" />
      <param name="contact_phone" />
    </input>
    <output>
      <param name="acc" />
      <param name="res" />
    </output>
  </template>
  <!-- internet.mts.by get_additional_msisdns   -->
  <template procedureName="MTS_GetAdditionalMSISDNs" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="BILLING.mg_auth">
          <Attribute name="i_source" type="STRING" value="${sourceid}" />
          <Attribute name="i_code" type="STRING" value="${sec_code}" />
          <Attribute name="i_method" type="STRING" value="MTS_GetAdditionalMSISDNs" />
          <Attribute name="o_result" type="STRING" />
          <Attribute name="o_message" type="STRING" />
        </Item>
        @{store(storedcustomer,${customer})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'#{/Message/Item/Attribute[@name='o_result']/@value}'='0'}" call="GetAdditionalMSISDNs">
      <set item="iparam:customer" value="${storedcustomer}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${o_result}" />
      <set item="oparam:result" value="${o_message}" />
    </deliveryTemplate>
    <input>
      <param name="sourceid" />
      <param name="sec_code" />
      <param name="customer" />
    </input>
    <output>
      <param name="dbresult" />
      <param name="result" />
    </output>
  </template>
  <template procedureName="GetAdditionalMSISDNs" handler="DBCON_01">
    <receiveTemplate>
      <Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item procedureName="BILLING.get_additional_msisdns">
          <Attribute name="i_msisdn" type="STRING" value="${customer}" />
          <Attribute name="o_msisdns_str" type="STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:msisdns_str" condition="//Item/@dbresult='0'" value="${o_msisdns_str}" />
      <set item="oparam:msisdns_str" condition="//Item/@dbresult!='0'" value="Ошибка при выполнении запроса." />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="msisdns_str" />
    </output>
  </template>
  <!-- Change TP. Leonid -->
  <template procedureName="ChangeTariffPlanLeonid">
    <receiveTemplate>
      <Message type="serviceorder" initiator="USSD" id="${guid}" session_id="@{newGuid}">
        <Item customer="${PhoneNumber}">
          <Service id="changetariffplan" action="0" class="${TariffPlan}" needtarification="${NeedTariffication}" createrequest="1" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:RESULT" value="${dbresult}" />
    </deliveryTemplate>
    <input>
      <param name="PhoneNumber" />
      <param name="TariffPlan" />
      <param name="NeedTariffication" />
    </input>
    <output>
      <param name="RESULT" />
    </output>
  </template>
  <!-- Change TP. PETR -->
  <template procedureName="ChangeTariffPlanPit">
    <receiveTemplate>
      <Message type="serviceorder" initiator="USSD" id="${guid}" session_id="@{newGuid}">
        <Item customer="${PhoneNumber}">
          <Service id="changetariffplan" action="0" class="${TariffPlan}" needtarification="${NeedTariffication}" createrequest="1" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate terminating="false">
      <set item="oparam:RESULT" value="${dbresult}" />
    </deliveryTemplate>
    <input>
      <param name="SourceId" value="IVRCON" />
      <param name="PhoneNumber" />
      <param name="TariffPlan" value="" />
      <param name="NeedTariffication" />
    </input>
    <output>
      <param name="RESULT" value="0" />
    </output>
  </template>
  <template procedureName="SendSMSC2C">
    <receiveTemplate>
      <Message type="SendSMS" initiator="soapcon" id="${guid}" session_id="@{newGuid}">
        <Item>
          <Attribute name="msisdn" type="STRING" value="${customer}" />
          <Attribute name="source_addr" type="STRING" value="${source_addr}" />
          <Attribute name="txt" type="STRING" value="${txt}" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input" terminating="false">
      <set item="oparam:rez" value="0" />
    </deliveryTemplate>
    <deliveryTemplate direction="input" connector="SMSCON_02">
      <set item="Content" value="${txt}" />
      <set item="Recipient" value="${customer}" />
      <set item="Sender" value="${source_addr}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="source_addr" />
      <param name="txt" />
    </input>
    <output>
      <param name="rez" />
    </output>
  </template>
</templates>