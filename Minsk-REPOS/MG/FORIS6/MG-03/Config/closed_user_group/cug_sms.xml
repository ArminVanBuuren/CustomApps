<templateGroup name="GroupManager">
  <macros>
    <define name="_ADD_TO_GROUP_NUMBER" value="5225" />
    <define name="_RESPONSE_INVITEE_NUMBER" value="5005" />
    <define name="_REMOVE_FROM_GROUP_NUMBER" value="5335" />
    <define name="_GET_MEMBER_LIST_NUMBER" value="5445" />
    <define name="_PRODUCT_TYPE_ID" value="#{document('config\closed_user_group\cug_product_id.xml')/groups/group/sms[@text='#{toupper('${token0}')}']/parent::group/@product_id}" />
  </macros>
  <template procedureName="InviteMember_Error" sessionStorage="Database">
    <condition>
      <test item="${Recipient}" matches="^_ADD_TO_GROUP_NUMBER$" />
      <test item="${Content}" matches="^\w+ \d{12}$" />
      <test item="@{SessionExists(InviteMember(${token1}))}" matches="^[Tt][Rr][Uu][Ee]$" />
    </condition>
    <receiveTemplate>
      <Message type="transfer_data" id="${guid}" session_id="${guid}">
        <Attribute name="Customer" value="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="В один момент времени может быть активно только одно приглашение в группу." />
      <set item="Encoding" value="unicodefffe" />
      <set item="Sender" value="_ADD_TO_GROUP_NUMBER" />
      <set item="Recipient" value="${Customer}" />
    </deliveryTemplate>
  </template>
  <template procedureName="AddToGroup_ISSA">
    <condition>
      <test item="0" matches="1" />
    </condition>
    <receiveTemplate />
    <deliveryTemplate call="GroupManager.InviteMember">
      <set item="Content" value="${sGroupType} ${sInvited}" />
      <set item="Encoding" value="unicodefffe" />
      <set item="Sender" value="${sInviter}" />
      <set item="Recipient" value="_ADD_TO_GROUP_NUMBER" />
    </deliveryTemplate>
  </template>
  <template procedureName="InviteMember" sessionStorage="Database" sessionLifetime="86400" onClean="GroupManager.AddToGroup_onClean">
    <condition>
      <test item="${Recipient}" matches="^_ADD_TO_GROUP_NUMBER$" />
      <test item="${Content}" matches="^\w+ \d{12}$" />
      <test item="@{SessionExists(InviteMember(${token1}))}" matches="^[Ff][Aa][Ll][Ss][Ee]$" />
    </condition>
    <receiveTemplate>
      <Message type="customergroup" initiator="smscon" id="${guid}" session_id="@{setSessionId(InviteMember(${token1}))}">
        @{store(sInviter,${sender})}
        @{store(sInvited,${token1})}
        @{store(sGroupType,#{toupper('${token0}')})}
        @{store(sIndex,_PRODUCT_TYPE_ID)}
        <Item customer="${sInviter}" action="2">
          <Attribute name="groupmember" value="${sInvited}" />
          <Attribute name="index" value="${sIndex}" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{${dbresult}!=0}">
      <set item="Content" value="Сервис временно недоступен. Пожалуйста, повторите попытку позже." />
      <set item="Content" conditionEx="#{${dbresult}=320060}" value="Нет прав для проведения данной операции." />
      <set item="Content" conditionEx="#{${dbresult}=320205}" value="Услуга уже подключена." />
      <set item="Content" conditionEx="#{${dbresult}=320707}" value="У пользователей разные регионы." />
      <set item="Content" conditionEx="#{${dbresult}=320203}" value="Существует открытая заявка." />
      <set item="Content" conditionEx="#{${dbresult}=320194}" value="Операции с группой запрещены." />
      <set item="Content" conditionEx="#{${dbresult}=320204}" value="У пользователя нет услуги или неизвестный тип группы." />
      <set item="Content" conditionEx="#{${dbresult}=320191}" value="Недостаточно средств." />
      <set item="Content" conditionEx="#{${dbresult}=320705}" value="Достигнут предел числа участников группы." />
      <set item="Content" conditionEx="#{${dbresult}=320706}" value="Пользователь уже включен в другую группу." />
      <set item="Content" conditionEx="#{${dbresult}=320341}" value="Неизвестный номер телефона." />
      <set item="Content" conditionEx="#{${dbresult}=320347}" value="Пользователь находится в блокировке." />
      <set item="Content" conditionEx="#{${dbresult}=330003}" value="Тарифный план приглашающего не позволяет создавать группу." />
      <set item="Content" conditionEx="#{${dbresult}=330004}" value="Тарифный план приглашаемого не позволяет вступать в группу." />
      <set item="Content" conditionEx="#{${dbresult}=330005}" value="Для вступления в группу необходимо сменить тарифный план." />
      <set item="Content" conditionEx="#{${dbresult}=330006}" value="User group type was not found." />
      <set item="Content" conditionEx="#{${dbresult}=330007}" value="Пользователь не может изменить группу." />
      <set item="Content" conditionEx="#{${dbresult}=330008}" value="Данный пользователь не поддерживается типом группы." />
      <set item="Content" conditionEx="#{${dbresult}=330009}" value="Не найдена закрытая группа." />
      <set item="Content" conditionEx="#{${dbresult}=330010}" value="Ваш тарифный план не предполагает наличие такой закрытой группы." />
      <set item="Content" conditionEx="#{${dbresult}=330011}" value="Тарифный план приглашаемого не предполагает наличие такой закрытой группы." />
      <set item="Content" conditionEx="#{${dbresult}=330012}" value="Достигнуто минимальное количество участников." />
      <set item="Content" conditionEx="#{${dbresult}=330013}" value="Участник может быть добавлен в группу только после приглашения." />
      <set item="Sender" value="_ADD_TO_GROUP_NUMBER" />
      <set item="Recipient" value="${sInviter}" />
      <set item="Encoding" value="unicodefffe" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate conditionEx="#{${dbresult}=0 and contains('${grouplisting}', '${sInvited}')}">
      <set item="Content" value="Приглашаемый абонент уже в группе!" />
      <set item="Sender" value="_ADD_TO_GROUP_NUMBER" />
      <set item="Recipient" value="${sInviter}" />
      <set item="Encoding" value="unicodefffe" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate conditionEx="#{${count}&lt;number('${maxcount}') or ${count}=0}" terminating="false">
      <set item="Content" value="Абонент ${sInviter} приглашает Вас в группу МТС. Отправьте YES/NO на номер 5005." />
      <set item="Encoding" value="unicodefffe" />
      <set item="Sender" value="_ADD_TO_GROUP_NUMBER" />
      <set item="Recipient" value="${sInvited}" />
    </deliveryTemplate>
    <deliveryTemplate conditionEx="#{${count}&lt;number('${maxcount}') or ${count}=0}">
      <set item="Content" value="Абоненту ${sInvited} отправлено приглашение в группу." />
      <set item="Encoding" value="unicodefffe" />
      <set item="Sender" value="_ADD_TO_GROUP_NUMBER" />
      <set item="Recipient" value="${sInviter}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="Content" value="В группе уже максимальное количество участников (${maxcount})!" />
      <set item="Sender" value="_ADD_TO_GROUP_NUMBER" />
      <set item="Recipient" value="${sInviter}" />
      <set item="Encoding" value="unicodefffe" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
  </template>
  <template procedureName="AddToGroup_onClean">
    <condition>
      <test item="0" matches="1" />
    </condition>
    <deliveryTemplate terminating="false">
      <set item="Content" value="Абонент ${sInvited} не подтвердил участие в группе. Ваше приглашение аннулировано." />
      <set item="Recipient" value="${sInviter}" />
      <set item="Sender" value="_ADD_TO_GROUP_NUMBER" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="Content" value="Вы не подтвердили участие в группе. Приглашение аннулировано." />
      <set item="Recipient" value="${sInvited}" />
      <set item="Sender" value="_ADD_TO_GROUP_NUMBER" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="InviteMember_InvalidFormat">
    <condition>
      <test item="${Recipient}" matches="^_ADD_TO_GROUP_NUMBER$" />
    </condition>
    <receiveTemplate>
      <Message type="transfer_data" id="${guid}" session_id="@{newGuid}">
        <Attribute name="Customer" value="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Неверный формат запроса на добавление в группу." />
      <set item="Encoding" value="unicodefffe" />
      <set item="Sender" value="_ADD_TO_GROUP_NUMBER" />
      <set item="Recipient" value="${Customer}" />
    </deliveryTemplate>
  </template>
  <template procedureName="AcceptInviteResponse" sessionStorage="Database">
    <condition>
      <test item="${Recipient}" matches="^_RESPONSE_INVITEE_NUMBER$" />
      <test item="${Content}" matches="^\s*[Yy][Ee][Ss]\s*$" />
      <test item="@{SessionExists(InviteMember(${Sender}))}" matches="^[Tt][Rr][Uu][Ee]$" />
    </condition>
    <receiveTemplate>
      <Message type="customergroup" initiator="smscon" id="${guid}" session_id="@{setSessionId(InviteMember(${Sender}))}">
        <Item customer="${sInviter}" action="2">
          <Attribute name="groupmember" value="${Sender}" />
          <Attribute name="index" value="${sIndex}" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{${dbresult}=-1}">
      <set item="Content" value="Сервис временно недоступен. Пожалуйста, повторите попытку позже." />
      <set item="Recipient" value="${sInvited}" />
      <set item="Sender" value="_RESPONSE_INVITEE_NUMBER" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
    <deliveryTemplate conditionEx="#{${dbresult}!=0}">
      <set item="Content" value="Произошла системная ошибка." />
      <set item="Content" conditionEx="#{${dbresult}=320060}" value="Нет прав для проведения данной операции." />
      <set item="Content" conditionEx="#{${dbresult}=320205}" value="Услуга уже подключена." />
      <set item="Content" conditionEx="#{${dbresult}=320707}" value="У пользователей разные регионы." />
      <set item="Content" conditionEx="#{${dbresult}=320203}" value="Существует открытая заявка." />
      <set item="Content" conditionEx="#{${dbresult}=320194}" value="Операции с группой запрещены." />
      <set item="Content" conditionEx="#{${dbresult}=320204}" value="У пользователя нет услуги или неизвестный тип группы." />
      <set item="Content" conditionEx="#{${dbresult}=320191}" value="Недостаточно средств." />
      <set item="Content" conditionEx="#{${dbresult}=320705}" value="Достигнут предел числа участников группы." />
      <set item="Content" conditionEx="#{${dbresult}=320706}" value="Пользователь уже включен в другую группу." />
      <set item="Content" conditionEx="#{${dbresult}=320341}" value="Неизвестный номер телефона." />
      <set item="Content" conditionEx="#{${dbresult}=320347}" value="Пользователь находится в блокировке." />
      <set item="Content" conditionEx="#{${dbresult}=330003}" value="Тарифный план приглашающего не позволяет создавать группу." />
      <set item="Content" conditionEx="#{${dbresult}=330004}" value="Тарифный план приглашаемого не позволяет вступать в группу." />
      <set item="Content" conditionEx="#{${dbresult}=330005}" value="Для вступления в группу необходимо сменить тарифный план." />
      <set item="Content" conditionEx="#{${dbresult}=330006}" value="User group type was not found." />
      <set item="Content" conditionEx="#{${dbresult}=330007}" value="Пользователь не может изменить группу." />
      <set item="Content" conditionEx="#{${dbresult}=330008}" value="Данный пользователь не поддерживается типом группы." />
      <set item="Content" conditionEx="#{${dbresult}=330009}" value="Не найдена закрытая группа." />
      <set item="Content" conditionEx="#{${dbresult}=330010}" value="Ваш тарифный план не предполагает наличие такой закрытой группы." />
      <set item="Content" conditionEx="#{${dbresult}=330011}" value="Тарифный план приглашаемого не предполагает наличие такой закрытой группы." />
      <set item="Content" conditionEx="#{${dbresult}=330012}" value="Достигнуто минимальное количество участников." />
      <set item="Content" conditionEx="#{${dbresult}=330013}" value="Участник может быть добавлен в группу только после приглашения." />
      <set item="Content" value="${Content} Приглашение аннулировано." />
      <set item="Sender" value="_RESPONSE_INVITEE_NUMBER" />
      <set item="Recipient" value="${sInvited}" />
      <set item="Encoding" value="unicodefffe" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate conditionEx="#{${count}&lt;number('${maxcount}') or ${count}=0}" call="AddMember">
      <set item="Content" value="${sGroupType} ${sInviter} ${sInvited}" />
      <set item="Encoding" value="unicodefffe" />
      <set item="Sender" value="_RESPONSE_INVITEE_NUMBER" />
      <set item="Recipient" value="${sInvited}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="Content" value="В группе уже максимальное количество участников (${maxcount})!" />
      <set item="Sender" value="_RESPONSE_INVITEE_NUMBER" />
      <set item="Recipient" value="${sInvited}" />
      <set item="Encoding" value="unicodefffe" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
  </template>
  <template procedureName="AddMember" sessionStorage="Database">
    <condition>
      <test item="0" matches="1" />
    </condition>
    <receiveTemplate>
      <Message type="customergroup" initiator="smscon" id="${guid}" session_id="${session_id}">
        <Item customer="${sInviter}" action="0">
          <Attribute name="groupmember" value="${sInvited}" />
          <Attribute name="index" value="${sIndex}" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{${dbresult}=0}" terminating="false">
      <set item="Content" value="Абонент ${sInvited} подтвердил участие в группе." />
      <set item="Sender" value="_RESPONSE_INVITEE_NUMBER" />
      <set item="Recipient" value="${sInviter}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
    <deliveryTemplate conditionEx="#{${dbresult}=0}">
      <set item="Content" value="Вы подтвердили участие в группе." />
      <set item="Sender" value="_RESPONSE_INVITEE_NUMBER" />
      <set item="Recipient" value="${sInvited}" />
      <set item="Encoding" value="unicodefffe" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate conditionEx="#{${dbresult}=-1}">
      <set item="Content" value="Сервис временно недоступен. Пожалуйста, повторите попытку позже." />
      <set item="Sender" value="_RESPONSE_INVITEE_NUMBER" />
      <set item="Recipient" value="${sInvited}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="Content" value="Произошла системная ошибка." />
      <set item="Content" conditionEx="#{${dbresult}=320205}" value="Услуга уже подключена." />
      <set item="Content" conditionEx="#{${dbresult}=320707}" value="У пользователей разные регионы." />
      <set item="Content" conditionEx="#{${dbresult}=320203}" value="Существует открытая заявка." />
      <set item="Content" conditionEx="#{${dbresult}=320194}" value="Операции с группой запрещены." />
      <set item="Content" conditionEx="#{${dbresult}=320204}" value="Ваш тарифный план не предусматривает такого рода действия." />
      <set item="Content" conditionEx="#{${dbresult}=320191}" value="Недостаточно средств." />
      <set item="Content" conditionEx="#{${dbresult}=320705}" value="Достигнут предел числа участников группы." />
      <set item="Content" conditionEx="#{${dbresult}=320706}" value="Пользователь уже включен в другую группу." />
      <set item="Content" conditionEx="#{${dbresult}=320341}" value="Неизвестный номер телефона." />
      <set item="Content" conditionEx="#{${dbresult}=320347}" value="Пользователь находится в блокировке." />
      <set item="Content" conditionEx="#{${dbresult}=330003}" value="Тарифный план приглашающего не позволяет создавать группу." />
      <set item="Content" conditionEx="#{${dbresult}=330004}" value="Тарифный план приглашаемого не позволяет вступать в группу." />
      <set item="Content" conditionEx="#{${dbresult}=330005}" value="Для вступления в группу необходимо сменить тарифный план." />
      <set item="Content" conditionEx="#{${dbresult}=330006}" value="User group type was not found." />
      <set item="Content" conditionEx="#{${dbresult}=330007}" value="Customer cannot change user group." />
      <set item="Content" conditionEx="#{${dbresult}=330008}" value="Foreign customer is not supported by this user group type." />
      <set item="Content" conditionEx="#{${dbresult}=330009}" value="User group was not found." />
      <set item="Content" conditionEx="#{${dbresult}=330010}" value="Inviter tariff plan is not allowed for this user group type." />
      <set item="Content" conditionEx="#{${dbresult}=330011}" value="Member tariff plan is not allowed for this user group type." />
      <set item="Content" conditionEx="#{${dbresult}=330012}" value="A minimun number of group members was achieved. No one can be deleted." />
      <set item="Content" conditionEx="#{${dbresult}=330013}" value="A member can be added to the group only after invitation." />
      <set item="Content" value="${Content} Приглашение аннулировано." />
      <set item="Sender" value="_RESPONSE_INVITEE_NUMBER" />
      <set item="Recipient" value="${sInvited}" />
      <set item="Encoding" value="unicodefffe" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
  </template>
  <template procedureName="RejectInviteResponse" sessionStorage="Database">
    <condition>
      <test item="${Recipient}" matches="^_RESPONSE_INVITEE_NUMBER$" />
      <test item="${Content}" matches="^\s*[Nn][Oo]\s*$" />
      <test item="@{SessionExists(InviteMember(${Sender}))}" matches="^[Tt][Rr][Uu][Ee]$" />
    </condition>
    <receiveTemplate>
      <Message type="transfer_data" initiator="smscon" id="${guid}" session_id="@{setSessionId(InviteMember(${Sender}))}" />
    </receiveTemplate>
    <deliveryTemplate direction="input" terminating="false">
      <set item="Content" value="Абонент ${sInvited} отклонил приглашение в группу. Приглашение аннулировано." />
      <set item="Recipient" value="${sInviter}" />
      <set item="Sender" value="_RESPONSE_INVITEE_NUMBER" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Вы отклонили приглашение в группу. Приглашение аннулировано." />
      <set item="Recipient" value="${sInvited}" />
      <set item="Sender" value="_RESPONSE_INVITEE_NUMBER" />
      <set item="Encoding" value="unicodefffe" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
  </template>
  <template procedureName="Response_InvalidFormat">
    <condition>
      <test item="${Recipient}" matches="^_RESPONSE_INVITEE_NUMBER$" />
      <test item="@{SessionExists(InviteMember(${Sender}))}" matches="^[Tt][Rr][Uu][Ee]$" />
    </condition>
    <receiveTemplate>
      <Message type="transfer_data" id="${guid}" session_id="@{newGuid}">
        <Attribute name="Customer" value="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Неправильный формат ответа. На приглашение отвечайте YES или NO." />
      <set item="Encoding" value="unicodefffe" />
      <set item="Sender" value="_RESPONSE_INVITEE_NUMBER" />
      <set item="Recipient" value="${Customer}" />
    </deliveryTemplate>
  </template>
  <template procedureName="Response_NoInvitation">
    <condition>
      <test item="${Recipient}" matches="^_RESPONSE_INVITEE_NUMBER$" />
    </condition>
    <receiveTemplate>
      <Message type="transfer_data" id="${guid}" session_id="@{newGuid}">
        <Attribute name="Customer" value="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="У вас нет активных приглашений." />
      <set item="Encoding" value="unicodefffe" />
      <set item="Sender" value="_RESPONSE_INVITEE_NUMBER" />
      <set item="Recipient" value="${Customer}" />
    </deliveryTemplate>
  </template>
  <template procedureName="RemoveMember">
    <condition>
      <test item="${Recipient}" matches="^_REMOVE_FROM_GROUP_NUMBER$" />
      <test item="${Content}" matches="^\w+$" />
    </condition>
    <receiveTemplate>
      <Message type="customergroup" initiator="smscon" id="${guid}" session_id="${guid}">
        <Item customer="${Sender}" action="1">
          <Attribute name="index" value="_PRODUCT_TYPE_ID" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="Сервис временно недоступен. Пожалуйста, повторите попытку позже." />
      <set item="Content" conditionEx="#{${dbresult}=0}" value="Вы удалены из группы." />
      <set item="Content" conditionEx="#{${dbresult}=320205}" value="Улуга уже подключена." />
      <set item="Content" conditionEx="#{${dbresult}=320707}" value="У пользователей разные регионы." />
      <set item="Content" conditionEx="#{${dbresult}=320203}" value="Существует открытая заявка." />
      <set item="Content" conditionEx="#{${dbresult}=320194}" value="Операции с группой запрещены." />
      <set item="Content" conditionEx="#{${dbresult}=320204}" value="У пользователя нет услуги или неизвестный тип группы." />
      <set item="Content" conditionEx="#{${dbresult}=320191}" value="Недостаточно средств." />
      <set item="Content" conditionEx="#{${dbresult}=320705}" value="Достигнут предел числа участников группы." />
      <set item="Content" conditionEx="#{${dbresult}=320706}" value="Пользователь уже включен в другую группу." />
      <set item="Content" conditionEx="#{${dbresult}=320341}" value="Неизвестный номер телефона." />
      <set item="Content" conditionEx="#{${dbresult}=320343}" value="Сервис не активирован." />
      <set item="Content" conditionEx="#{${dbresult}=320347}" value="Пользователь находится в блокировке." />
      <set item="Content" conditionEx="#{${dbresult}=330003}" value="Тарифный план приглашающего не позволяет создавать группу." />
      <set item="Content" conditionEx="#{${dbresult}=330004}" value="Тарифный план приглашаемого не позволяет вступать в группу." />
      <set item="Content" conditionEx="#{${dbresult}=330005}" value="Для вступления в группу необходимо сменить тарифный план." />
      <set item="Content" conditionEx="#{${dbresult}=330006}" value="User group type was not found." />
      <set item="Content" conditionEx="#{${dbresult}=330007}" value="Customer cannot change user group." />
      <set item="Content" conditionEx="#{${dbresult}=330008}" value="Foreign customer is not supported by this user group type." />
      <set item="Content" conditionEx="#{${dbresult}=330009}" value="User group was not found." />
      <set item="Content" conditionEx="#{${dbresult}=330010}" value="Inviter tariff plan is not allowed for this user group type." />
      <set item="Content" conditionEx="#{${dbresult}=330011}" value="Member tariff plan is not allowed for this user group type." />
      <set item="Content" conditionEx="#{${dbresult}=330012}" value="A minimun number of group members was achieved. No one can be deleted." />
      <set item="Content" conditionEx="#{${dbresult}=330013}" value="A member can be added to the group only after invitation." />
      <set item="Sender" value="_REMOVE_FROM_GROUP_NUMBER" />
      <set item="Recipient" value="${Customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="RemoveMember_InvalidFormat">
    <condition>
      <test item="${Recipient}" matches="^_REMOVE_FROM_GROUP_NUMBER$" />
    </condition>
    <receiveTemplate>
      <Message type="transfer_data" id="${guid}" session_id="@{newGuid}">
        <Attribute name="Customer" value="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Сообщение о неверном формате запроса на выход из группы, согласованное с МТС." />
      <set item="Encoding" value="unicodefffe" />
      <set item="Sender" value="_REMOVE_FROM_GROUP_NUMBER" />
      <set item="Recipient" value="${Customer}" />
    </deliveryTemplate>
  </template>
  <template procedureName="GetMemberList">
    <condition>
      <test item="${Recipient}" matches="^_GET_MEMBER_LIST_NUMBER$" />
      <test item="${Content}" matches="^\w+$" />
    </condition>
    <receiveTemplate>
      <Message type="customergroup" initiator="smscon" id="${guid}" session_id="@{newguid}">
        <Item customer="${Sender}" action="2">
          <Attribute name="index" value="_PRODUCT_TYPE_ID" />
          <Attribute name="groupmember" value="0" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{${dbresult}=0 and '${grouplisting}'=''}">
      <set item="Content" value="Ваша группа МТС пуста." />
      <set item="Encoding" value="unicodefffe" />
      <set item="Sender" value="_GET_MEMBER_LIST_NUMBER" />
      <set item="Recipient" value="${Customer}" />
    </deliveryTemplate>
    <deliveryTemplate conditionEx="#{${dbresult}=0}">
      <set item="Content" value="Список участников группы: ${grouplisting}." />
      <set item="Encoding" value="unicodefffe" />
      <set item="Sender" value="_GET_MEMBER_LIST_NUMBER" />
      <set item="Recipient" value="${Customer}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="Content" value="Сервис временно недоступен. Пожалуйста, повторите попытку позже." />
      <set item="Content" conditionEx="#{${dbresult}=320205}" value="услуга уже подключена." />
      <set item="Content" conditionEx="#{${dbresult}=320707}" value="у пользователей разные регионы." />
      <set item="Content" conditionEx="#{${dbresult}=320203}" value="существует открытая заявка." />
      <set item="Content" conditionEx="#{${dbresult}=320194}" value="операции с группой запрещены." />
      <set item="Content" conditionEx="#{${dbresult}=320204}" value="у пользователя нет услуги или неизвестный тип группы." />
      <set item="Content" conditionEx="#{${dbresult}=320191}" value="недостаточно средств." />
      <set item="Content" conditionEx="#{${dbresult}=320705}" value="достигнут предел числа участников группы." />
      <set item="Content" conditionEx="#{${dbresult}=320706}" value="пользователь уже включен в другую группу." />
      <set item="Content" conditionEx="#{${dbresult}=320341}" value="неизвестный номер телефона." />
      <set item="Content" conditionEx="#{${dbresult}=320347}" value="пользователь находится в блокировке." />
      <set item="Content" conditionEx="#{${dbresult}=330003}" value="тарифный план приглашающего не позволяет создавать группу." />
      <set item="Content" conditionEx="#{${dbresult}=330004}" value="тарифный план приглашаемого не позволяет вступать в группу." />
      <set item="Content" conditionEx="#{${dbresult}=330005}" value="для вступления в группу необходимо сменить тарифный план." />
      <set item="Content" conditionEx="#{${dbresult}=330006}" value="User group type was not found." />
      <set item="Content" conditionEx="#{${dbresult}=330007}" value="Customer cannot change user group." />
      <set item="Content" conditionEx="#{${dbresult}=330008}" value="Foreign customer is not supported by this user group type." />
      <set item="Content" conditionEx="#{${dbresult}=330009}" value="User group was not found." />
      <set item="Content" conditionEx="#{${dbresult}=330010}" value="Inviter tariff plan is not allowed for this user group type." />
      <set item="Content" conditionEx="#{${dbresult}=330011}" value="Member tariff plan is not allowed for this user group type." />
      <set item="Content" conditionEx="#{${dbresult}=330012}" value="A minimun number of group members was achieved. No one can be deleted." />
      <set item="Content" conditionEx="#{${dbresult}=330013}" value="A member can be added to the group only after invitation." />
      <set item="Sender" value="_GET_MEMBER_LIST_NUMBER" />
      <set item="Recipient" value="${Customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="GetMemberList_InvalidFormat">
    <condition>
      <test item="${Recipient}" matches="^_GET_MEMBER_LIST_NUMBER$" />
    </condition>
    <receiveTemplate>
      <Message type="transfer_data" id="${guid}" session_id="@{newGuid}">
        <Attribute name="Customer" value="${Sender}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate direction="input">
      <set item="Content" value="Сообщение о неверном формате запроса списка группы, согласованное с МТС." />
      <set item="Encoding" value="unicodefffe" />
      <set item="Sender" value="_GET_MEMBER_LIST_NUMBER" />
      <set item="Recipient" value="${Customer}" />
    </deliveryTemplate>
  </template>
</templateGroup>