<templates connector="SMS">
  #include "..\..\config\get_bms_counters\sms.xml"
  <!-- Send sms -->
  <template procedureName="SOAPSendSMS">
    <condition>
      <test item="0" matches="1" />
    </condition>
    <receiveTemplate>
      <Message />
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="${txt}" />
      <set item="Recipient" value="${msisdn}" />
      <set item="Sender" value="${source_addr}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- SendSMSfromMSISDNNoRezident -->
  <template procedureName="SendSMSfromMSISDNNoRezident">
    <condition>
      <test item="0" matches="1" />
    </condition>
    <receiveTemplate>
      <Message />
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="${txt}" />
      <set item="Recipient" value="${msisdn}" />
      <set item="Sender" value="375292171313" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="SendCode">
    <condition>
      <test item="0" matches="1" />
    </condition>
    <receiveTemplate>
      <Message />
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="${code}" />
      <set item="Recipient" value="${customer}" />
      <set item="Sender" value="0884" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="MTSCodeSMSAuthentication_">
    <condition>
      <test item="0" matches="1" />
    </condition>
    <receiveTemplate>
      <Message />
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="${o_code}" />
      <set item="Recipient" value="${o_msisdn}" />
      <set item="Sender" value="0884" />
      <set item="Encoding" value="unicodefffe" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
  </template>
  <template procedureName="personnel">
    <condition>
      <test item="0" matches="1" />
    </condition>
    <receiveTemplate>
      <Message />
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="${txt}" />
      <set item="Recipient" value="${customer}" />
      <set item="Sender" value="0884" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <template procedureName="SendSMSC2C">
    <condition>
      <test item="0" matches="1" />
    </condition>
    <receiveTemplate>
      <Message />
    </receiveTemplate>
    <deliveryTemplate>
      <set item="Content" value="${txt}" />
      <set item="Recipient" value="${msisdn}" />
      <set item="Sender" value="${source_addr}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
  </template>
  <!-- kostyl 
dropat 'Gruppa' l'gotnaia zgp ...
sms s nomera 364 ptp perevod podtverjdenie abonenty A-->
  <template procedureName="DeliveryRequest" persistent="true">
    <retry delay="300" attempts="2" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37500'}" dropReply="true" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37515'}" dropReply="true" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37516'}" dropReply="true" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37517'}" dropReply="true" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37521'}" dropReply="true" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37522'}" dropReply="true" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37523'}" dropReply="true" />
    <deliveryTemplate conditionEx="#{(substring(//Content/text(),1,6) = 'Gruppa')}" dropReply="true" />
    <deliveryTemplate conditionEx="#{(substring(//Content/text(),1,20) = 'Vypolneno popolnenie') or (substring(//Content/text(),1,20) = 'Выполнено пополнение') or (substring(//Content/text(),1,18) = 'Пополнение баланса')}">
      <set item="Content" value="#{//Content/text()}" />
      <set item="Sender" value="364" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="unicodefffe" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="Content" value="#{//Content/text()}" />
      <set item="Sender" value="0870" />
      <set item="Encoding" value="unicodefffe" />
      <set item="Recipient" value="${customer}" />
    </deliveryTemplate>
  </template>
  <template procedureName="DeliveryRequestPtP" persistent="true">
    <retry delay="300" attempts="2" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37500'}" dropReply="true" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37515'}" dropReply="true" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37516'}" dropReply="true" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37517'}" dropReply="true" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37521'}" dropReply="true" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37522'}" dropReply="true" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37523'}" dropReply="true" />
    <deliveryTemplate>
      <set item="Content" value="#{//Content/text()}" />
      <set item="Sender" value="364" />
      <set item="Encoding" value="unicodefffe" />
      <set item="Recipient" value="${customer}" />
    </deliveryTemplate>
  </template>
  <template procedureName="DeliveryRequestIssa" persistent="true">
    <retry delay="300" attempts="2" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37500'}" dropReply="true" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37515'}" dropReply="true" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37516'}" dropReply="true" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37517'}" dropReply="true" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37521'}" dropReply="true" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37522'}" dropReply="true" />
    <deliveryTemplate conditionEx="#{'#{substring('${customer}',1,5)}'='37523'}" dropReply="true" />
    <deliveryTemplate conditionEx="#{(substring(//Content/text(),1,18) = 'Произведен вход в ')}">
      <set item="Content" value="#{//Content/text()}" />
      <set item="Sender" value="0870" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" value="#{//Content/@charset}" />
      <set item="Encoding" condition="not(//Content/@charset)" value="unicodefffe" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="Content" value="#{//Content/text()}" />
      <set item="Sender" value="#{if(substring('${Sender}',1,3)='375','1241${Sender}','0870')}" />
      <set item="Recipient" value="${customer}" />
      <set item="Encoding" conditionEx="#{'#{//Content/@charset}'!=''}" value="#{//Content/@charset}" />
      <set item="Encoding" conditionEx="#{'#{//Content/@charset}'='' and not(matches('${Content}','[А-я]'))}" value="iso-8859-1" />
      <set item="Encoding" conditionEx="#{'#{//Content/@charset}'='' and matches('${Content}','[А-я]')}" value="unicodefffe" />
      <set item="ValidityPeriod" condition="//Item/@validityPeriod" value="${validityPeriod}" />
      <set item="ValidityPeriod" condition="not(//Item/@validityPeriod)" value="" />
      <set item="ScheduleDeliveryTime" condition="//Item/@scheduleTime" value="${scheduleTime}" />
      <set item="ScheduleDeliveryTime" condition="not(//Item/@scheduleTime)" value="" />
    </deliveryTemplate>
  </template>
</templates>