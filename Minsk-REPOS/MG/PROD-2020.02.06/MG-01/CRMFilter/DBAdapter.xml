<plugin name="DBAdapter">
	<Connections>
		<Handler name="db" type="OracleClient" connectionString="Server=crm;User ID=cust;Password=xa2qJliGe4y;Min Pool size=30"/> 
	</Connections>
	<ThreadPooling use="true" forwarding="true" minThreads="60" />
	<Procedures>
	
<!--   SOAP   -->
		<Procedure	cond="/Message/@type='get_counters' and /Message/@initiator='soapcon'" 
					call="billing.lll_dpi_counters" using="db" >
			<Parameters>
				<param name="counters_out" type="out:string" value=""/>
				<param name="p_msisdn" type="string" value="${customer}"/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" msg="${counters_out}">
  					</Item>				
				</Message>
			</SendTemplate>
		</Procedure>		
		<Procedure	cond="(	
					/Message/Item/Service/@service_id='CB410153' or
				       /Message/Item/Service/@service_id='CB108') and 
				       /Message/Item/Service/@action='2' and /Message/@initiator='soapcon'" 
					call="BILLING.add_close_srv_req.add_srv_req" using="db" >
			<Parameters>
				<param name="dbresult" type="out:string" value=""/>
				<param name="reply" type="out:string" value=""/>
				<param name="ret_code" type="out:string" value=""/>
				<param name="p_msisdn" type="string" value="${customer}"/>
				<param name="srv_del_str" type="string" value="${service_id}"/>
				<param name="source" type="string" value="${src}"/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${dbresult}" msg="${reply}">
						<Service id="${service_id}" >
					        	<Attribute name="state" value="0" />
					        	<Attribute name="ischarged" value="0" />
    						</Service>
  					</Item>				
				</Message>
			</SendTemplate>
		</Procedure>
		
		<Procedure	cond="(	
					/Message/Item/Service/@service_id='CB410153' or
				       /Message/Item/Service/@service_id='CB108') and 
				       /Message/Item/Service/@action='3' and /Message/@initiator='soapcon'" 
					call="BILLING.add_close_srv_req.del_srv_req" using="db" >
			<Parameters>
				<param name="dbresult" type="out:string" value=""/>
				<param name="reply" type="out:string" value=""/>
				<param name="ret_code" type="out:string" value=""/>
				<param name="p_msisdn" type="string" value="${customer}"/>
				<param name="srv_del_str" type="string" value="${service_id}"/>
				<param name="source" type="string" value="${src}"/>
				<param name="d_end" type="string" value="0" /> 
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${dbresult}" msg="${reply}">
						<Service id="${service_id}" >
					        	<Attribute name="state" value="0" />
					        	<Attribute name="ischarged" value="0" />
    						</Service>
  					</Item>				
				</Message>
			</SendTemplate>
		</Procedure>		


	<!--  rassrochka_doveria        -->

                <Procedure	cond="/Message/@type='kredit_dov'" 
					call="billing.kredit_limit.mg_lll_kredit_dov" using="db" >
			<Parameters>
				<param name="num" type="string" value="${customer}"/>
				<param name="ac" type="string" value="${ac}"/>
				<param name="is_mars" type="string" value="0"/>				
				<param name="msg" type="out:string" value=""/>
				<param name="dbresult" type="out:string" value=""/>				
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" reply = "${msg}" dbresult="${dbresult}" state="0">
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>	

		
	<!--  rassrochka_pasport        -->

                <Procedure	cond="/Message/@type='rassrochka_pasport'" 
					call="billing.lll_rassrochka_pasport_1" using="db" >
			<Parameters>
				<param name="num_0" type="string" value="${customer}"/>
				<param name="num" type="string" value="${num_pr}"/>
				<param name="passp_num" type="string" value="${pass_n}"/>				
				<param name="p_eq" type="string" value="${cod_o}"/>	
				<param name="p_sum" type="string" value="${sum_o}"/>
				<param name="src" type="string" value="${src_con}"/>				
				<param name="rez" type="out:string" value=""/>
				<param name="msg" type="out:string" value=""/>				
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" reply = "${msg}" dbresult="${rez}" state="0">
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>	

	<!--  zadoljennost        -->

                <Procedure	cond="/Message/@type='rassrochka_pasport_z'" 
					call="billing.lll_rassrochka_pasport_116" using="db" >
			<Parameters>
				<param name="num" type="string" value="${customer}"/>
				<param name="passp_num" type="string" value="${pass_n}"/>
				<param name="pa_num" type="string" value="${pa_n}"/>				
				<param name="rez" type="out:string" value=""/>
				<param name="msg" type="out:string" value=""/>				
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" reply = "${msg}" dbresult="${rez}" state="0">
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>	

	<!--  ussd_call_back        -->

                <Procedure	cond="/Message/@type='ussd_call_back'" 
					call="rep.tlk_add_ussd_call_back" using="db" >
			<Parameters>
				<param name="customer" type="string" value="${customer}"/>
				<param name="nomer" type="string" value="${nomer}"/>
				<param name="rez" type="out:string" value=""/>				
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" reply = "${rez}" state="0">
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>	
		
	<!--  USSD 350 NY Xpress        -->

                <Procedure	cond="/Message/@type='ussd_350'" 
					call="billing.mg_novogodnii_exp" using="db" >
			<Parameters>
				<param name="num" type="string" value="${customer}"/>
				<param name="msg" type="out:string" value=""/>
				<param name="dbresult" type="out:string" value=""/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${dbresult}" reply = "${msg}" state="0">
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>

<!-- TP_prechange_check -->

		<Procedure	cond="/Message/@type='TP_prechange_check'" 
					call="BILLING.lll_ussd_p_ch_tp" using="db" >
			<Parameters>
				<param name="dbresult" type="out:string" value=""/>
				<param name="result_str" type="out:string" value=""/>
				<param name="num" type="string" value="${customer}"/>
			</Parameters>
			<SendTemplate>
				<Message type="check_result" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${dbresult}">					
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>

<!-- TP_prechange_check 515 -->

		<Procedure	cond="/Message/@type='TP_prechange_check_515'" 
					call="BILLING.lll_ussd_p_ch_tp_otl" using="db" >
			<Parameters>
				<param name="dbresult" type="out:string" value=""/>
				<param name="result_str" type="out:string" value=""/>
				<param name="num" type="string" value="${customer}"/>
			</Parameters>
			<SendTemplate>
				<Message type="check_result" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${dbresult}">					
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>

		
	<!--  USSD 171 smartfony NY         -->

                <Procedure	cond="/Message/@type='ussd_171'" 
					call="billing.smart_new_year.mg_171" using="db" >
			<Parameters>
				<param name="num" type="string" value="${customer}"/>
				<param name="v" type="string" value="${act}"/>
				<param name="msg" type="out:string" value=""/>
				<param name="dbresult" type="out:string" value=""/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${dbresult}" reply = "${msg}" state="0">
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>

	<!--  sms balance other num        -->

                <Procedure	cond="/Message/@type='bal_other_num'" 
					call="billing.mg_balance_dr_num" using="db" >
			<Parameters>
				<param name="mob_num" type="string" value="${customer}"/>
				<param name="str_in" type="string" value="${str_in}"/>
				<param name="msg" type="out:string" value=""/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" reply = "${msg}" state="0">
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>

	<!--  zapros PUK       -->

                <Procedure	cond="/Message/@type='zapros_PUK'" 
					call="billing.mg_puk_kod " using="db" >
			<Parameters>
				<param name="mob_num" type="string" value="${customer}"/>
				<param name="str_in" type="string" value="${str_in}"/>
				<param name="msg" type="out:string" value=""/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" reply = "${msg}" state="0">
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>


	<!--  nick ussd 981        -->

                <Procedure	cond="/Message/@type='ussd_981'" 
					call="billing.mg_get_ussd981_string" using="db" >
			<Parameters>
				<param name="p_msisdn" type="string" value="${str_in}"/>
				<param name="customer" type="string" value="${customer}"/>					
				<param name="p_rez_str" type="out:string" value=""/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" reply = "${p_rez_str}" state="0">
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>

                <Procedure	cond="/Message/@type='ussd_981_v2'" 
					call="billing.mg_get_ussd981_string_v2" using="db" >
			<Parameters>
				<param name="p_msisdn" type="string" value="${str_in}"/>
				<param name="customer" type="string" value="${customer}"/>
				<param name="passp_num" type="string" value="${pass_n}"/>				
				<param name="p_rez_str" type="out:string" value=""/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" reply = "${p_rez_str}" state="0">
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>		

                <Procedure	cond="/Message/@type='ussd_lopatov_callevent'" 
					call="billing.lop_5_callevent" using="db" >
			<Parameters>
				<param name="p_msisdn" type="string" value="${customer}"/>
				<param name="p_ret_str" type="out:string" value=""/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" reply = "${p_ret_str}" state="0">
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>	

		
	<!--  USSD 708 smena TP         -->

                <Procedure	cond="/Message/@type='ussd_mg_prechange_TP'" 
					call="billing.mg_ctp_companyja" using="db" >
			<Parameters>
				<param name="num" type="string" value="${customer}"/>
				<param name="msg" type="out:string" value=""/>
				<param name="dbresult" type="out:string" value=""/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${dbresult}" reply = "${msg}" state="0">
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>

	<!--  USSD 706 ostatok bonus paketov        -->

                <Procedure	cond="/Message/@type='ussd_mg_bonus_packet'" 
					call="billing.bonus_ussd_p.get_bonus_balance_mg" using="db" >
			<Parameters>
				<param name="num" type="string" value="${customer}"/>
				<param name="msg" type="out:string" value=""/>
				<param name="dbresult" type="out:string" value=""/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${dbresult}" reply = "${msg}" state="0">
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>


		<!--  USSD 323 inet bonus         -->

                <Procedure	cond="/Message/@type='ussd_mg_inet_bonus'" 
					call="billing.mg_inet_bonus" using="db" >
			<Parameters>
				<param name="num" type="string" value="${customer}"/>
				<param name="msg" type="out:string" value=""/>
				<param name="dbresult" type="out:string" value=""/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${dbresult}" reply = "${msg}" state="0">
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>
		
		<!--  USSD 151 152 153 Smartfony         -->

                <Procedure	cond="/Message/@type='ussd_mts_smartfony'" 
					call="billing.MG_smartfony" using="db" >
			<Parameters>
				<param name="num" type="string" value="${customer}"/>
				<param name="ac" type="string" value="${act}"/>
				<param name="srv" type="string" value="${srv}"/>
				<param name="msg" type="out:string" value=""/>
				<param name="dbresult" type="out:string" value=""/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${dbresult}" reply = "${msg}" state="0">
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>


<!--  USSD 305 Zelanie         -->

                <Procedure	cond="/Message/@type='ussd_305'" 
					call="billing.mg_marafon" using="db" >
			<Parameters>
				<param name="num" type="string" value="${customer}"/>
				<param name="ac" type="string" value="${action}"/>
				<param name="msg" type="out:string" value=""/>
				<param name="dbresult" type="out:string" value=""/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${dbresult}" reply = "${msg}" state="0">
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>

<!--  USSD 478 utrom deshevle         -->

                <!-- <Procedure	cond="/Message/Item/Service/@service_id='FR1717'" 
					call="billing.mg_crm_comp_utrom_desh" using="db" >
			<Parameters>
				<param name="num" type="string" value="${customer}"/>
				<param name="ac" type="string" value="${action}"/>
				<param name="msg" type="out:string" value=""/>
				<param name="dbresult" type="out:string" value=""/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${dbresult}" reply = "${msg}" state="0">
					</Item>
				</Message>
			</SendTemplate>
		</Procedure> -->



<!--  USSD 105 Red zone enerdgy activate -->        

                <Procedure	cond="/Message/@type='ussd_105'" 
					call="billing.lll_Red_Energy.Activate_RedEnergy" using="db" >
			<Parameters>
				<param name="num" type="string" value="${customer}"/>
				<param name="msg" type="out:string" value=""/>
				<param name="dbresult" type="out:string" value=""/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${dbresult}" reply = "${msg}">
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>


<!--  USSD 104 poddergy RED energy    check     -->

                <Procedure	cond="/Message/@type='ussd_104'" 
					call="billing.lll_Red_Energy.Check_RedEnergy" using="db" >
			<Parameters>
				<param name="num" type="string" value="${customer}"/>
				<param name="msg" type="out:string" value=""/>
				<param name="dbresult" type="out:string" value=""/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${dbresult}" reply = "${msg}" state="0">
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>

<!--  Rassrochka passport ussd 791, sms 7910     -->

  <!--              <Procedure	cond="/Message/@type='RassrochkaPassport'" 
					call="billing.lll_rassrochka_pasport " using="db" >
			<Parameters>
				<param name="num" type="string" value="${customer}"/>
				<param name="passp_num" type="string" value="${passport_number}"/>
				<param name="rez" type="out:string" value=""/>
				<param name="msg" type="out:string" value=""/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${rez}" msg="${msg}">
					</Item>
				</Message>
			</SendTemplate>
		</Procedure> -->

<!--  Ostavaisa s MTS         -->

                <Procedure	cond="/Message/@type='ussd_172'" 
					call="billing.mg_del_ost_mts" using="db" >
			<Parameters>
				<param name="p_msisdn_in" type="string" value="${customer}"/>
				<param name="msg" type="out:string" value=""/>
				<param name="dbresult" type="out:string" value=""/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${dbresult}" reply = "${msg}">
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>

<!--  Rassrochka         -->

                <Procedure	cond="/Message/@type='rassrochka'" 
					call="billing.mg_lll_rassrochka" using="db" >
			<Parameters>
				<param name="p_msisdn_in" type="string" value="${customer}"/>
				<param name="pa_num" type="string" value="${acc}"/>
				<param name="msg" type="out:string" value=""/>
				<param name="dbresult" type="out:string" value=""/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${dbresult}" reply = "${msg}">
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>


<!--  USSD 106 Zelanie         -->

                <Procedure	cond="/Message/@type='ussd_106'" 
					call="billing.MG_three_desires" using="db" >
			<Parameters>
				<param name="num" type="string" value="${customer}"/>
				<param name="ac" type="string" value="${action}"/>
				<param name="srv" type="string" value="${srv}"/>
				<param name="msg" type="out:string" value=""/>
				<param name="dbresult" type="out:string" value=""/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${dbresult}" reply = "${msg}" state="0">
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>


<!--  USSD CRM kampania 488    -->

                <Procedure	cond="/Message/@type='ussd_CRM_kampania'" 
					call="billing.mg_crm_company" using="db" >
			<Parameters>
				<param name="num" type="string" value="${customer}"/>
				<param name="ac" type="string" value="${action}"/>
				<param name="msg" type="out:string" value=""/>
				<param name="dbresult" type="out:string" value=""/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${dbresult}" reply = "${msg}" >
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>



<!-- USSD 108 akcia add-->

		<Procedure	cond="/Message/@type='ussd_108' " 
					call="billing.mg_add_my_company" using="db" >
			<Parameters>
				<param name="num" type="string" value="${customer}"/>
				<param name="msg" type="out:string" value=""/>
				<param name="dbresult" type="out:string" value=""/>
			</Parameters>
			<SendTemplate>
				<Message type="ussd_108_result" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" db_result = "${dbresult}">
						<Attribute name="msg" value="${msg}"/>
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>

<!-- USSD 108 akcia del-->

		<Procedure	cond="/Message/@type='ussd_108_del' " 
					call="billing.mg_del_my_company" using="db" >
			<Parameters>
				<param name="num" type="string" value="${customer}"/>
				<param name="msg" type="out:string" value=""/>
				<param name="dbresult" type="out:string" value=""/>
			</Parameters>
			<SendTemplate>
				<Message type="ussd_108_result" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" db_result = "${dbresult}">
						<Attribute name="msg" value="${msg}"/>
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>

<!--  USSD 109 ZGP      -->

                <Procedure	cond="/Message/@type='ussd_109'" 
					call="billing.MG_zgp_texnol" using="db" >
			<Parameters>
				<param name="num" type="string" value="${customer}"/>
				<param name="ac" type="string" value="${action}"/>
				<param name="msg" type="out:string" value=""/>
				<param name="dbresult" type="out:string" value=""/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${dbresult}" reply = "${msg}" state="0">
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>



<!-- USSD 133, 135, 150, 155, 156, 185, 215, 302, 310, 311,312,313,314,315,316,322, 343, 345, 351, 353, 360, 367, 478, 479, 480, 481, 483, 484, 485, 486, 500, 505, 515, 520, 811, 812, 813, 814, 815, 816, 845, 846, 847, 505, 506, 510, 302, 602, 673, 710, 911, 999 akcia add -->

		
		<Procedure	cond="(
					/Message/Item/Service/@service_id='FR3612' or
					/Message/Item/Service/@service_id='FR8100' or
					/Message/Item/Service/@service_id='FR7833' or
					/Message/Item/Service/@service_id='FR7902' or
					/Message/Item/Service/@service_id='FR7783' or
					/Message/Item/Service/@service_id='FR7406' or
					/Message/Item/Service/@service_id='FR7476' or
					/Message/Item/Service/@service_id='FR6926' or	
					/Message/Item/Service/@service_id='FR5596' or
					/Message/Item/Service/@service_id='FR7599' or		
					/Message/Item/Service/@service_id='FR7400' or			
					/Message/Item/Service/@service_id='FR5423' or																				/Message/Item/Service/@service_id='FR2754' or
					/Message/Item/Service/@service_id='FR6096' or
					/Message/Item/Service/@service_id='FR5595' or					
					/Message/Item/Service/@service_id='FR3622' or
					/Message/Item/Service/@service_id='FR3613' or
					/Message/Item/Service/@service_id='FR3611' or
					/Message/Item/Service/@service_id='FR2327' or
					/Message/Item/Service/@service_id='FR2509' or
					/Message/Item/Service/@service_id='FR2328' or
					/Message/Item/Service/@service_id='FR1717' or
					/Message/Item/Service/@service_id='FR2329' or
					/Message/Item/Service/@service_id='FR2330' or
					/Message/Item/Service/@service_id='FR2331' or
					/Message/Item/Service/@service_id='FR2332' or
					/Message/Item/Service/@service_id='FR1742' or
					/Message/Item/Service/@service_id='FR1747' or
					/Message/Item/Service/@service_id='FR1871' or
					/Message/Item/Service/@service_id='FR1755' or					
					/Message/Item/Service/@service_id='FR1949' or
					/Message/Item/Service/@service_id='FR15573' or
					/Message/Item/Service/@service_id='FR1950' or
					/Message/Item/Service/@service_id='FR1951' or
					/Message/Item/Service/@service_id='FR1952' or
					/Message/Item/Service/@service_id='FR1953' or
					/Message/Item/Service/@service_id='FR1954' or
					/Message/Item/Service/@service_id='FR1960' or
					/Message/Item/Service/@service_id='FR1739' or
					/Message/Item/Service/@service_id='FR1872' or
					/Message/Item/Service/@service_id='FR1728' or
					/Message/Item/Service/@service_id='FR1722' or
					/Message/Item/Service/@service_id='FR1851' or
					/Message/Item/Service/@service_id='FR1732' or
					/Message/Item/Service/@service_id='FR1837' or
					/Message/Item/Service/@service_id='FR1839' or
					/Message/Item/Service/@service_id='FR1841' or
					/Message/Item/Service/@service_id='FR1853' or
					/Message/Item/Service/@service_id='FR1855' or
					/Message/Item/Service/@service_id='FR1724' or
					/Message/Item/Service/@service_id='FR1719' or
					/Message/Item/Service/@service_id='FR298' or
				    /Message/Item/Service/@service_id='FR833' or 
					/Message/Item/Service/@service_id='FR1597' or
					/Message/Item/Service/@service_id='FR1680' or
				    /Message/Item/Service/@service_id='FR841' or
				    /Message/Item/Service/@service_id='FR858' or
				    /Message/Item/Service/@service_id='FR1032' or
				    /Message/Item/Service/@service_id='FR1109' or
				    /Message/Item/Service/@service_id='FR1034' or
				    /Message/Item/Service/@service_id='FR1035' or
				    /Message/Item/Service/@service_id='SCP1007' or
				    /Message/Item/Service/@service_id='FR268') and 
				    /Message/Item/Service/@action='2' and /Message/@initiator='ussd'" 
					call="BILLING.add_close_srv_req.add_srv_req" using="db" >
			<Parameters>
				<param name="dbresult" type="out:string" value=""/>
				<param name="reply" type="out:string" value=""/>
				<param name="ret_code" type="out:string" value=""/>
				<param name="p_msisdn" type="string" value="${customer}"/>
				<param name="srv_del_str" type="string" value="${service_id}"/>
				<param name="source" type="string" value="15"/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${dbresult}" msg="${reply}">
						<Service id="${service_id}" >
					        	<Attribute name="state" value="0" />
					        	<Attribute name="ischarged" value="0" />
    						</Service>
  					</Item>				
				</Message>
			</SendTemplate>
		</Procedure>

<!-- USSD 133, 135, 150,  215, 302, 345, 351, 353, 360, 367, 478, 479, 480, 481, 483, 484, 486, 500, 505, 515, 520, 811, 812, 813, 814, 815, 816, 845, 846, 847, 302, 602, 911 akcia del -->

		<Procedure	cond="(
					/Message/Item/Service/@service_id='FR3612' or
					/Message/Item/Service/@service_id='FR8100' or
					/Message/Item/Service/@service_id='FR7833' or
					/Message/Item/Service/@service_id='FR7902' or
					/Message/Item/Service/@service_id='FR7783' or
					/Message/Item/Service/@service_id='FR7406' or
					/Message/Item/Service/@service_id='FR7476' or				
					/Message/Item/Service/@service_id='FR5423' or
					/Message/Item/Service/@service_id='FR5596' or
					/Message/Item/Service/@service_id='FR7599' or				
					/Message/Item/Service/@service_id='FR7400' or
					/Message/Item/Service/@service_id='FR6926' or
					/Message/Item/Service/@service_id='FR2754' or
					/Message/Item/Service/@service_id='FR5595' or				
					/Message/Item/Service/@service_id='FR2724' or
					/Message/Item/Service/@service_id='FR3611' or
					/Message/Item/Service/@service_id='FR2327' or
					/Message/Item/Service/@service_id='FR2328' or
					/Message/Item/Service/@service_id='FR2329' or
					/Message/Item/Service/@service_id='FR2330' or
					/Message/Item/Service/@service_id='FR1717' or
					/Message/Item/Service/@service_id='FR2331' or
					/Message/Item/Service/@service_id='FR2332' or
					/Message/Item/Service/@service_id='FR1871' or
					/Message/Item/Service/@service_id='FR1747' or
					/Message/Item/Service/@service_id='FR1872' or
					/Message/Item/Service/@service_id='FR1755' or				
					/Message/Item/Service/@service_id='FR15573' or
					/Message/Item/Service/@service_id='FR1742' or
					/Message/Item/Service/@service_id='FR1739' or
					/Message/Item/Service/@service_id='FR1728' or
					/Message/Item/Service/@service_id='FR1722' or
					/Message/Item/Service/@service_id='FR1724' or
					/Message/Item/Service/@service_id='FR1851' or
					/Message/Item/Service/@service_id='FR1732' or
					/Message/Item/Service/@service_id='FR1719' or
					/Message/Item/Service/@service_id='FR298' or
				    /Message/Item/Service/@service_id='FR1109' or
					/Message/Item/Service/@service_id='FR1949' or
					/Message/Item/Service/@service_id='FR1950' or
					/Message/Item/Service/@service_id='FR1951' or
					/Message/Item/Service/@service_id='FR1952' or
					/Message/Item/Service/@service_id='FR1953' or
					/Message/Item/Service/@service_id='FR1954' or
				    /Message/Item/Service/@service_id='FR833' or
					/Message/Item/Service/@service_id='FR1597' or
					/Message/Item/Service/@service_id='FR1680' or
				    /Message/Item/Service/@service_id='SCP1007' or
				    /Message/Item/Service/@service_id='FR268') and 
				    /Message/Item/Service/@action='3' and /Message/@initiator='ussd' " 
					call="BILLING.add_close_srv_req.del_srv_req" using="db" >
			<Parameters>
				<param name="dbresult" type="out:string" value=""/>
				<param name="reply" type="out:string" value=""/>
				<param name="ret_code" type="out:string" value=""/>
				<param name="p_msisdn" type="string" value="${customer}"/>
				<param name="srv_del_str" type="string" value="${service_id}"/>
				<param name="source" type="string" value="15"/>
				<param name="d_end" type="string" value="0"/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${dbresult}" msg="${reply}">
						<Service id="${service_id}" >
					        	<Attribute name="state" value="0" />
					        	<Attribute name="ischarged" value="0" />
    						</Service>
  					</Item>				
				</Message>
			</SendTemplate>
		</Procedure>	

<!-- USSD 155,156,311,312,313,314,315,316, 510, 673  del koncom mesiaca -->

		<Procedure	cond="(
					/Message/Item/Service/@service_id='FR2509' or
					/Message/Item/Service/@service_id='FR3613' or
					/Message/Item/Service/@service_id='FR841') and 
				      /Message/Item/Service/@action='3' and /Message/@initiator='ussd'" 
					call="BILLING.add_close_srv_req.del_srv_req" using="db" >
			<Parameters>
				<param name="dbresult" type="out:string" value=""/>
				<param name="reply" type="out:string" value=""/>
				<param name="ret_code" type="out:string" value=""/>
				<param name="p_msisdn" type="string" value="${customer}"/>
				<param name="srv_del_str" type="string" value="${service_id}"/>
				<param name="source" type="string" value="15"/>
				<param name="d_end" type="string" value="1"/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${dbresult}" msg="${reply}">
						<Service id="${service_id}" >
					        	<Attribute name="state" value="0" />
					        	<Attribute name="ischarged" value="0" />
    						</Service>
  					</Item>				
				</Message>
			</SendTemplate>
		</Procedure>

<!-- USSD 160 hypervoice add -->

		<Procedure	cond="/Message/@type='mg_add_hyper_voice_160' " 
					call="billing.mg_add_HyperVoice" using="db" >
			<Parameters>
				<param name="num" type="string" value="${customer}"/>
				<param name="msg" type="out:string" value=""/>
				<param name="dbresult" type="out:string" value=""/>
			</Parameters>
			<SendTemplate>
				<Message type="mg_add_hyper_voice_160_result" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult = "${dbresult}">
						<Attribute name="msg" value="${msg}"/>
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>

<!-- USSD 160 hypervoice del -->

		<Procedure	cond="/Message/@type='mg_del_hyper_voice_160' " 
					call="billing.mg_Del_HyperVoice" using="db" >
			<Parameters>
				<param name="num" type="string" value="${customer}"/>
				<param name="msg" type="out:string" value=""/>
				<param name="dbresult" type="out:string" value=""/>
			</Parameters>
			<SendTemplate>
				<Message type="mg_Del_hyper_voice_160_result" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult = "${dbresult}">
						<Attribute name="msg" value="${msg}"/>
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>

<!-- USSD 175 MTS Wifi add -->

		<Procedure	cond="/Message/Item/Service/@service_id='FR300' and 
				      /Message/Item/Service/@action='2' " 
					call="BILLING.add_close_srv_req.add_srv_req" using="db" >
			<Parameters>
				<param name="dbresult" type="out:string" value=""/>
				<param name="reply" type="out:string" value=""/>
				<param name="ret_code" type="out:string" value=""/>
				<param name="p_msisdn" type="string" value="${customer}"/>
				<param name="srv_del_str" type="string" value="${service_id}"/>
				<param name="source" type="string" value="15"/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${dbresult}" msg="${reply}">
						<Service id="${service_id}" >
					        	<Attribute name="state" value="0" />
					        	<Attribute name="ischarged" value="0" />
    						</Service>
  					</Item>				
				</Message>
			</SendTemplate>
		</Procedure>

<!-- USSD 175 MTS Wifi del -->

		<Procedure	cond="/Message/Item/Service/@service_id='FR300' and 
				      /Message/Item/Service/@action='3' " 
					call="BILLING.add_close_srv_req.del_srv_req" using="db" >
			<Parameters>
				<param name="dbresult" type="out:string" value=""/>
				<param name="reply" type="out:string" value=""/>
				<param name="ret_code" type="out:string" value=""/>
				<param name="p_msisdn" type="string" value="${customer}"/>
				<param name="srv_del_str" type="string" value="${service_id}"/>
				<param name="source" type="string" value="15"/>
				<param name="d_end" type="string" value="0"/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${dbresult}" msg="${reply}">
						<Service id="${service_id}" >
					        	<Attribute name="state" value="0" />
					        	<Attribute name="ischarged" value="0" />
    						</Service>
  					</Item>				
				</Message>
			</SendTemplate>
		</Procedure>	

<!--  USSD 180 dlinie razgovory         -->

                <Procedure	cond="/Message/@type='ussd_180_add'" 
					call="billing.MG_a_d_night_unlim" using="db" >
			<Parameters>
				<param name="num" type="string" value="${customer}"/>
				<param name="ac" type="string" value="${action}"/>
				<param name="msg" type="out:string" value=""/>
				<param name="dbresult" type="out:string" value=""/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${dbresult}" reply = "${msg}" state="0">
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>


<!--  USSD 181 festival        -->

                <Procedure	cond="/Message/@type='ussd_181_festival'" 
					call="billing.ego_festival_action" using="db" >
			<Parameters>
				<param name="num" type="string" value="${customer}"/>
				<param name="msg" type="out:string" value=""/>
				<param name="dbresult" type="out:string" value=""/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${dbresult}" reply = "${msg}" state="0">
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>


<!-- USSD 999 test -->

		<Procedure	cond="/Message/@type='SuperZeroFunc_999' " 
					call="billing.SuperZeroFunc.Activate" using="db" >
			<Parameters>
				<param name="p_msisdn" type="string" value="${customer}"/>
				<param name="msg" type="out:string" value=""/>
				<param name="dbresult" type="out:string" value=""/>
			</Parameters>
			<SendTemplate>
				<Message type="SuperZeroFunc_result" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" db_result = "${dbresult}">
						<Attribute name="msg" value="${msg}"/>
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>		
		

		<Procedure	cond="/Message/@type='verificationrequest' and /Message/Item/@datasource='state'" 
					call="billing.mg_get_validation_for_ivr" using="db" >
			<Parameters>
				<param name="dbresult" type="out:string" value=""/>
				<param name="p_Tariffplan" type="out:string" value=""/>
				<param name="p_State" type="out:string" value=""/>
				<param name="p_Password" type="out:string" value=""/>
				<param name="p_Regioncode" type="out:string" value=""/>
				<param name="p_tp_name" type="out:string" value=""/>
				<param name="p_check_password" type="out:string" value=""/>
				<param name="p_msisdn" type="string" value="${customer}"/>
				<param name="p_cost" type="out:string" value=""/>
			</Parameters>
			<SendTemplate>
				<Message type="verificationresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${dbresult}" tariffplan="${p_Tariffplan}" tp_name="${p_tp_name}" state="${p_State}" check="${p_check_password}">
						<Attribute name="password" value="${p_Password}"/>
						<Attribute name="regioncode" value="${p_Regioncode}"/>
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>



		<Procedure	cond="/Message/@type='serviceinterrogation' and /Message/Item/Service/@action='interrogation' and /Message/Item/@datasource='state'" 
					call="BILLING.MG_SERVICEINTERROGATION" using="db" >
			<Parameters>
				<param name="dbresult" type="out:string" value=""/>
				<param name="p_Allowed" type="out:string" value="0"/>
				<param name="p_Subscription" type="out:string" value="0"/>
				<param name="p_Status" type="out:string" value="0"/>
				<param name="p_Class" type="out:string" value="0"/>
				<param name="p_ChargedAmount" type="out:string" value="-1"/>
				<param name="p_msisdn" type="string" value="${customer}"/>
				<param name="p_service" type="string" value="${service_id}"/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceinterrogationresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${dbresult}" state="0">
					<Service id="${service_id}" resultcode="0">
						<Attribute name="allowed" value="${p_Allowed}"/>
						<Attribute name="subscription" value="${p_Subscription}"/>
						<Attribute name="status" value="${p_Status}"/>
						<Attribute name="class" value="${p_Class}"/>
						<Attribute name="chargedamount" value="${p_ChargedAmount}"/>
					</Service>
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>


		<Procedure	cond="/Message/@type='Informing_belneft'" 
					call="billing.tlk_inform_belneft" using="db" >
			<Parameters>
				<param name="p_msisdn" type="string" value="${customer}"/>
				<param name="dbresult" type="out:string" value=""/>
				<param name="rez" type="out:string" value=""/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${dbresult}" rez = "${rez}" state="0">
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>

		<Procedure	cond="/Message/@type='retrievecustomerdata' and /Message/Item/@subject='balance' and /Message/Item/@datasource='state'"
			call="billing.SMS_GET_BALANS" using="db" >
			<Parameters>
				<param name="p_msisdn" type="string" value="${customer}"/>
				<param name="dbresult" type="out:string" value=""/>
				<param name="rez" type="out:string" value=""/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${dbresult}" rez = "${rez}" state="0">
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>		

                <Procedure	cond="/Message/@type='Del_internight'" 
					call="billing.enin_del_srv_any" using="db" >
			<Parameters>
				<param name="dbresult" type="out:string" value=""/>
				<param name="reply" type="out:string" value=""/>
				<param name="ret_code" type="out:string" value=""/>
				<param name="p_msisdn" type="string" value="${customer}"/>
				<param name="srv_del_str" type="string" value="FR107700"/>
				<param name="source" type="string" value="6"/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${dbresult}" reply = "${reply}" state="0">
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>


<!--  ADD_SMS-Roaming   -->
                <Procedure	cond="/Message/@type='Add_SMS-ROAMING'" 
					call="BILLING.lll_add_sms_rouning" using="db" >
			<Parameters>
				<param name="dbresult" type="out:string" value=""/>
				<param name="reply" type="out:string" value=""/>
				<param name="ret_code" type="out:string" value=""/>
				<param name="p_msisdn" type="string" value="${customer}"/>
				<param name="srv_del_str" type="string" value="${service_id}"/>
				<param name="source" type="string" value="6"/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${dbresult}" reply = "${reply}" state="0">
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>
		
<!--   ADD SMS WEEKEND     -->
                <Procedure	cond="/Message/@type='Add_sms_weekend'" 
					call="BILLING.mg_add_smsb" using="db" >
			<Parameters>
				<param name="tel" type="string" value="${customer}"/>
				<param name="msg" type="out:string" value=""/>
				<param name="rez" type="out:string" value=""/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${rez}" reply = "${msg}" state="0">
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>

<!-- SMS_Check_GuaranteedPayment -->

		<Procedure	cond="/Message/@type='serviceorder' and /Message/Item/Service/@id='guaranteedpayment' and /Message/Item/Service/@action='9'" 
					call="billing.mg_deact_op" using="db" >
			<Parameters>
				<param name="mob_num" type="string" value="${customer}"/>
				<param name="dbresult" type="out:string" value=""/>		
			</Parameters>
			<SendTemplate>
				<Message type="retrievecustomerdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${dbresult}" state="0">
					<Service id="guaranteedpayment" resultcode="0">
					</Service>
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>


<!-- SMS_Check_GuaranteedPayment -->

		<Procedure	cond="/Message/@type='serviceorder' and /Message/Item/Service/@id='guaranteedpayment' and /Message/Item/Service/@action='6'" 
					call="BILLING.is_pay_claimed" using="db" >
			<Parameters>
				<param name="dbresult" type="out:string" value=""/>
				<param name="p_Allowed" type="out:string" value="0"/>
				<param name="p_Pending" type="out:string" value="0"/>
				<param name="p_Maximumusd" type="out:string" value=""/>
				<param name="p_Maximumrur" type="out:string" value=""/>
				<param name="p_msisdn" type="string" value="${customer}"/>
				<param name="p_msisdn_o" type="out:string" value=""/>  <!-- p_msisdn_o number customer from IMSI -->
				<param name="p_source" type="string" value="${init}"/>
				<param name="p_pending_str" type="out:string" value="0"/>
				<param name="p_addon" type="string" value="${p_addon}"/>								
			</Parameters>
			<SendTemplate>
				<Message type="retrievecustomerdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${p_msisdn_o}" dbresult="${dbresult}" pending_str="${p_pending_str}" state="0">
					<Service id="guaranteedpayment" resultcode="0">
						<Attribute name="allowed" value="${p_Allowed}" />
						<Attribute name="pending" value="${p_Pending}" />
						<Attribute name="maximumusd" value="${p_Maximumusd}" />
						<Attribute name="maximumrur" value="${p_Maximumrur}" />
					</Service>
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>

<!-- SMS_GuaranteedPayment -->

                <Procedure	cond="/Message/@type='serviceorder' and /Message/Item/Service/@id='guaranteedpayment' 
					and /Message/Item/@datasource='state' and /Message/Item/Service/@action='7'" 
					call="BILLING.mg_add_pay_claimed" using="db" >
			<Parameters>
				<param name="dbresult" type="out:string" value=""/>
				<param name="p_Allowed" type="out:string" value="0"/>
				<param name="p_Amount" type="out:string" value="0"/>
				<param name="p_Currency" type="out:string" value=""/>
				<param name="p_msisdn" type="string" value="${customer}"/>
				<param name="p_sum" type="string" value="${amount}"/>
				<param name="p_curr" type="string" value="${currency}"/>
				<param name="p_source" type="string" value="${init}"/>
				<param name="p_addon" type="string" value="${p_addon}"/>				
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${dbresult}" state="0">
					<Service id="guaranteedpayment" resultcode="0">
						<Attribute name="allowed" value="${p_Allowed}" />
						<Attribute name="amount" value="${p_Amount}" />
						<Attribute name="currency" value="${p_Currency}" />
					</Service>
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>

<!-- Dobavlenie uslug serviceorder RBT-->
<Procedure	cond="(/Message/Item/Service/@service_id='CB412694' or
		       /Message/Item/Service/@service_id='CB412716' or
		       /Message/Item/Service/@service_id='FR848' or
		       /Message/Item/Service/@service_id='FR856' or
		       /Message/Item/Service/@service_id='FR857' ) and 
		       /Message/Item/Service/@action='2'" 
					call="BILLING.add_close_srv_req.add_srv_req" using="db" >
			<Parameters>
				<param name="dbresult" type="out:string" value=""/>
				<param name="reply" type="out:string" value=""/>
				<param name="ret_code" type="out:string" value=""/>
				<param name="p_msisdn" type="string" value="${customer}"/>
				<param name="srv_del_str" type="string" value="${service_id}"/>
				<param name="source" type="string" value="23"/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${ret_code}" state="0">
						<Service id="${service_id}" resultcode="0">
					        	<Attribute name="state" value="0" />
					        	<Attribute name="ischarged" value="0" />
    						</Service>
  					</Item>				
				</Message>
			</SendTemplate>
		</Procedure>


<!-- Udalenie uslug serviceorder tekuschim dnem RBT-->
<Procedure	cond="(/Message/Item/Service/@service_id='CB412694' or
		       /Message/Item/Service/@service_id='CB412716' or
		       /Message/Item/Service/@service_id='FR848' or
		       /Message/Item/Service/@service_id='FR856' or
		       /Message/Item/Service/@service_id='FR857' ) and 
			/Message/Item/Service/@action='3'" 
					call="BILLING.add_close_srv_req.del_srv_req" using="db" >
			<Parameters>
				<param name="dbresult" type="out:string" value=""/>
				<param name="reply" type="out:string" value=""/>
				<param name="ret_code" type="out:string" value=""/>
				<param name="p_msisdn" type="string" value="${customer}"/>
				<param name="srv_del_str" type="string" value="${service_id}"/>
				<param name="source" type="string" value="23"/>
				<param name="d_end" type="string" value="0"/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${ret_code}" state="0">
						<Service id="${service_id}" resultcode="0">
					        	<Attribute name="state" value="0" />
					        	<Attribute name="ischarged" value="0" />
    						</Service>
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>


<!-- Dobavlenie uslug serviceorder SMS-->
<Procedure	
cond="
(
/Message/Item/Service/@service_id='FR7343' or
/Message/Item/Service/@service_id='FR6100' or
/Message/Item/Service/@service_id='FR5596' or
/Message/Item/Service/@service_id='FR6101' or
/Message/Item/Service/@service_id='FR6102' or
/Message/Item/Service/@service_id='FR6628' or
/Message/Item/Service/@service_id='FR6627' or
/Message/Item/Service/@service_id='FR6626' or
/Message/Item/Service/@service_id='FR2643' or
/Message/Item/Service/@service_id='FR2644' or
/Message/Item/Service/@service_id='FR2645' or
/Message/Item/Service/@service_id='FR2646' or
/Message/Item/Service/@service_id='FR2647' or
/Message/Item/Service/@service_id='FR2648' or
/Message/Item/Service/@service_id='FR5595' or
/Message/Item/Service/@service_id='FR15573' or
/Message/Item/Service/@service_id='FR1949' or
/Message/Item/Service/@service_id='FR1950' or
/Message/Item/Service/@service_id='FR1951' or
/Message/Item/Service/@service_id='FR1952' or
/Message/Item/Service/@service_id='FR1953' or
/Message/Item/Service/@service_id='FR1954' or
/Message/Item/Service/@service_id='FR1960' or
/Message/Item/Service/@service_id='FR1871' or
/Message/Item/Service/@service_id='FR1872' or 
/Message/Item/Service/@service_id='SCP1006' or
/Message/Item/Service/@service_id='FR511001' or
/Message/Item/Service/@service_id='FR5570' or
/Message/Item/Service/@service_id='FR5571' or
/Message/Item/Service/@service_id='FR5572' or
/Message/Item/Service/@service_id='FR669' or 
/Message/Item/Service/@service_id='FR670' or 
/Message/Item/Service/@service_id='FR671' or 
/Message/Item/Service/@service_id='FR633' or 
/Message/Item/Service/@service_id='FR634' or 
/Message/Item/Service/@service_id='FR733' or
/Message/Item/Service/@service_id='FR2035' or
/Message/Item/Service/@service_id='FR990' or
/Message/Item/Service/@service_id='CB123' or 
/Message/Item/Service/@service_id='CB403864' or 
/Message/Item/Service/@service_id='CB412736' or 
/Message/Item/Service/@service_id='CB412737' or 
/Message/Item/Service/@service_id='CB412738' or 
/Message/Item/Service/@service_id='FR107700' or 
/Message/Item/Service/@service_id='FR665' or  
/Message/Item/Service/@service_id='FR666' or 
/Message/Item/Service/@service_id='FR667' or 
/Message/Item/Service/@service_id='FR668' or
/Message/Item/Service/@service_id='FR1116' or
/Message/Item/Service/@service_id='FR882' or
/Message/Item/Service/@service_id='FR883' or
/Message/Item/Service/@service_id='FR884' or
/Message/Item/Service/@service_id='FR892' or
/Message/Item/Service/@service_id='FR893' or
/Message/Item/Service/@service_id='SCP1007' or
/Message/Item/Service/@service_id='FR722' ) and 
/Message/Item/Service/@action='2' and /Message/@initiator='smscon'" 
					call="BILLING.add_close_srv_req.add_srv_req" using="db" >
			<Parameters>
				<param name="dbresult" type="out:string" value=""/>
				<param name="reply" type="out:string" value=""/>
				<param name="ret_code" type="out:string" value=""/>
				<param name="p_msisdn" type="string" value="${customer}"/>
				<param name="srv_del_str" type="string" value="${service_id}"/>
				<param name="source" type="string" value="6"/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${dbresult}" ret_code="${ret_code}" state="0" msg="${reply}">
						<Service id="${service_id}" resultcode="0">
					        	<Attribute name="state" value="0" />
					        	<Attribute name="ischarged" value="0" />
    						</Service>
  					</Item>				
				</Message>
			</SendTemplate>
		</Procedure>

<!-- Udalenie uslug serviceorder koncom mesiaca SMS--> 
<Procedure	
cond="
(
/Message/Item/Service/@service_id='FR7343' or
/Message/Item/Service/@service_id='FR6100' or
/Message/Item/Service/@service_id='FR6101' or
/Message/Item/Service/@service_id='FR6628' or
/Message/Item/Service/@service_id='FR6627' or
/Message/Item/Service/@service_id='FR6626' or
/Message/Item/Service/@service_id='FR2643' or
/Message/Item/Service/@service_id='FR2644' or
/Message/Item/Service/@service_id='FR2645' or
/Message/Item/Service/@service_id='FR2646' or
/Message/Item/Service/@service_id='FR2647' or
/Message/Item/Service/@service_id='FR2648' or
/Message/Item/Service/@service_id='FR1960' or
/Message/Item/Service/@service_id='CB412736' or
/Message/Item/Service/@service_id='CB412737' or
/Message/Item/Service/@service_id='CB412738' or
/Message/Item/Service/@service_id='FR5571' or
/Message/Item/Service/@service_id='FR5572' or
/Message/Item/Service/@service_id='FR5573' or
/Message/Item/Service/@service_id='FR634' or
/Message/Item/Service/@service_id='FR733' or
/Message/Item/Service/@service_id='FR2035' or
/Message/Item/Service/@service_id='FR990' or
/Message/Item/Service/@service_id='FR669' or
/Message/Item/Service/@service_id='FR670' or
/Message/Item/Service/@service_id='FR671' or
/Message/Item/Service/@service_id='FR633' or  
/Message/Item/Service/@service_id='FR107700' or 
/Message/Item/Service/@service_id='FR665' or  
/Message/Item/Service/@service_id='FR666' or 
/Message/Item/Service/@service_id='FR667' or 
/Message/Item/Service/@service_id='FR668' or 
/Message/Item/Service/@service_id='FR1116' ) and
/Message/Item/Service/@action='3' and /Message/@initiator='smscon'" 
					call="BILLING.add_close_srv_req.del_srv_req" using="db" >
			<Parameters>
				<param name="dbresult" type="out:string" value=""/>
				<param name="reply" type="out:string" value=""/>
				<param name="ret_code" type="out:string" value=""/>
				<param name="p_msisdn" type="string" value="${customer}"/>
				<param name="srv_del_str" type="string" value="${service_id}"/>
				<param name="source" type="string" value="6"/>
				<param name="d_end" type="string" value="1"/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${dbresult}" ret_code="${ret_code}" state="0" msg="${reply}">
						<Service id="${service_id}" resultcode="0">
					        	<Attribute name="state" value="0" />
					        	<Attribute name="ischarged" value="0" />
    						</Service>
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>

<!-- Udalenie uslug serviceorder tekuschim dnem SMS--> 
<Procedure	
cond="
(/Message/Item/Service/@service_id='FR1871' or
/Message/Item/Service/@service_id='FR6102' or
/Message/Item/Service/@service_id='FR1949' or
/Message/Item/Service/@service_id='FR1950' or
/Message/Item/Service/@service_id='FR1951' or
/Message/Item/Service/@service_id='FR1952' or
/Message/Item/Service/@service_id='FR1953' or
/Message/Item/Service/@service_id='FR1954' or
/Message/Item/Service/@service_id='FR1872' or
/Message/Item/Service/@service_id='FR5595' or
/Message/Item/Service/@service_id='FR5596' or
/Message/Item/Service/@service_id='FR15573' or 
/Message/Item/Service/@service_id='CB123' or 
/Message/Item/Service/@service_id='CB403864' or 
/Message/Item/Service/@service_id='FR893' or
/Message/Item/Service/@service_id='SCP1006' or
/Message/Item/Service/@service_id='SCP1007' or
/Message/Item/Service/@service_id='FR511001') and
/Message/Item/Service/@action='3' and /Message/@initiator='smscon'" 
					call="BILLING.add_close_srv_req.del_srv_req" using="db" >
			<Parameters>
				<param name="dbresult" type="out:string" value=""/>
				<param name="reply" type="out:string" value=""/>
				<param name="ret_code" type="out:string" value=""/>
				<param name="p_msisdn" type="string" value="${customer}"/>
				<param name="srv_del_str" type="string" value="${service_id}"/>
				<param name="source" type="string" value="6"/>
				<param name="d_end" type="string" value="0"/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${dbresult}" ret_code="${ret_code}" state="0" msg="${reply}">
						<Service id="${service_id}" resultcode="0">
					        	<Attribute name="state" value="0" />
					        	<Attribute name="ischarged" value="0" />
    						</Service>
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>



<!-- Процедура CCP_register_in_MTS -->
<Procedure cond="/Message/@type='bankcardpayments' and /Message/Item/@subject='register' and /Message/Item/@datasource='cust'" call="sts_ccp_register_interface.register_in_mts_ussd" using="db" >
	<Parameters>
		<param name="pErr_Message" type="out:string" value=""/>
		<param name="pErr_Code" type="out:string" value=""/>
		<param name="pUser_IP_Address" type="string" value="mg"/>
		<param name="pUser_Id" type="string" value="100500"/>
		<param name="pThreshold_Value" type="string" value="${pThreshold_Value}"/>
		<param name="pBank_Id" type="string" value="${pBank_Id}"/>
		<param name="pMSISDN" type="string" value="${pMSISDN}"/>
	</Parameters>
	<SendTemplate>
		<Message type="retrievecustomerdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
			<Item customer="${pMSISDN}" dbresult="${pErr_Code}">
			</Item>
		</Message>
	</SendTemplate>
</Procedure>

<!-- Процедура CCP_cansel_register_in_MTS -->
<Procedure cond="/Message/@type='bankcardpayments' and /Message/Item/@subject='canselreg' and /Message/Item/@datasource='cust'" call="sts_ccp_register_interface.cancel_reg_in_mts_ussd" using="db" >
	<Parameters>
		<param name="pErr_Message" type="out:string" value=""/>
		<param name="pErr_Code" type="out:string" value=""/>
		<param name="pUser_IP_Address" type="string" value="mg"/>
		<param name="pUser_Id" type="string" value="100500"/>
		<param name="pMSISDN" type="string" value="${pMSISDN}"/>
	</Parameters>
	<SendTemplate>
		<Message type="retrievecustomerdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
			<Item customer="${pMSISDN}" dbresult="${pErr_Code}">
			</Item>
		</Message>
	</SendTemplate>
</Procedure>

<!-- Процедура CCP_change_register_in_MTS -->
<Procedure cond="/Message/@type='bankcardpayments' and /Message/Item/@subject='change' and /Message/Item/@datasource='cust'" call="sts_ccp_register_interface.change_attrs_ussd" using="db" >
	<Parameters>
		<param name="pErr_Message" type="out:string" value=""/>
		<param name="pErr_Code" type="out:string" value=""/>
		<param name="pUser_IP_Address" type="string" value="mg"/>
		<param name="pUser_Id" type="string" value="100500"/>
		<param name="pMSISDN" type="string" value="${pMSISDN}"/>
		<param name="pThreshold_Value" type="string" value="${pThreshold_Value}"/>
	</Parameters>
	<SendTemplate>
		<Message type="retrievecustomerdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
			<Item customer="${pMSISDN}" dbresult="${pErr_Code}">
			</Item>
		</Message>
	</SendTemplate>
</Procedure>

<!-- Процедура CCP_payment_register_in_MTS -->
<Procedure cond="/Message/@type='bankcardpayments' and /Message/Item/@subject='payment' and /Message/Item/@datasource='cust'" call="sts_ccp_register_interface.reg_payment_sms_ussd" using="db" >
	<Parameters>
		<param name="pErr_Message" type="out:string" value=""/>
		<param name="pErr_Code" type="out:string" value=""/>
		<param name="pMSISDN" type="string" value="${pMSISDN}"/>
		<param name="pAmount" type="string" value="${pAmount}"/>
	</Parameters>
	<SendTemplate>
		<Message type="retrievecustomerdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
			<Item customer="${pMSISDN}" dbresult="${pErr_Code}">
			</Item>
		</Message>
	</SendTemplate>
</Procedure>

<!-- Процедура STS_CUG.Register_Request 
<Procedure cond="/Message/@type='customergroup' and /Message/Item/@subject='invite' and /Message/Item/@datasource='cust'" call="STS_CUG.Register_Request" using="db" >
	<Parameters>
		<param name="p_Error_Code" type="out:string" value=""/>
		<param name="p_CUG_Member_MSISDN" type="string" value="${p_CUG_Member_MSISDN}"/>
		<param name="p_Initiator_MSISDN" type="string" value="${p_Initiator_MSISDN}"/>
	</Parameters>
	<SendTemplate>
		<Message type="retrievecustomerdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
			<Item customer="${p_Initiator_MSISDN}" dbresult="${p_Error_Code}">
				<Attribute name="p_CUG_Member_MSISDN" value="${p_CUG_Member_MSISDN}" />
			</Item>
		</Message>
	</SendTemplate>
</Procedure> -->

<!-- Процедура STS_CUG.Close_Request -->
<Procedure cond="/Message/@type='customergroup' and /Message/Item/@subject='answer' and /Message/Item/@datasource='cust'" call="STS_CUG.Close_Request" using="db" >
	<Parameters>
		<param name="p_Error_Code" type="out:string" value=""/>
		<param name="p_Initiator_MSISDN" type="out:string" value=""/>
		<param name="p_CUG_Member_MSISDN" type="string" value="${p_CUG_Member_MSISDN}"/>
		<param name="p_New_State" type="string" value="${p_New_State}"/>
	</Parameters>
	<SendTemplate>
		<Message type="customergroup"  initiator="smscon" id="@{newGuid}" session_id="${session_id}" request_id="${id}" >
  			<Item customer="${p_Initiator_MSISDN}" action="0" dbresult="${p_Error_Code}" p_New_State="${p_New_State}" p_CUG_Member_MSISDN="${p_CUG_Member_MSISDN}" >
      			</Item>
		</Message>
	</SendTemplate>
</Procedure>

<!-- Процедура STS_CUG.Personal_Data -->
<Procedure cond="/Message/Item/@subject='personaldata' and /Message/Item/@datasource='cust'" call="STS_CUG.get_personal_data" using="db" >
	<Parameters>
		<param name="p_Data" type="out:string" value=""/>
		<param name="p_msisdn" type="string" value="${p_CUG_Member_MSISDN}"/>
	</Parameters>
	<SendTemplate>
		<Message type="customergroup"  initiator="smscon" id="@{newGuid}" session_id="${session_id}" request_id="${id}" >
  			<Item dbresult="${p_Data}" >
      			</Item>
		</Message>
	</SendTemplate>
</Procedure>

<!-- Платный входящие ТП Детский UNDONE -->
<Procedure cond="/Message/@type='setprofile' and /Message/Item/@subject='check' and /Message/Item/@datasource='cust'" call="sts_favorite_number.Get_Tariff_Plan_By_MSISDN" using="db" >
     <Parameters>
          <param name="pTariff_Plan_Id" type="out:string" value=""/>
          <param name="pErr_Message" type="out:string" value=""/>
          <param name="pErr_Code" type="out:string" value=""/>
          <param name="pMSISDN" type="string" value="${pMSISDN}"/>
     </Parameters>
     <SendTemplate>
          <Message type="setprofile"  initiator="smscon" id="@{newGuid}" session_id="${session_id}" request_id="${id}" >
                 <Item customer="${customer}" dbresult="${pTariff_Plan_Id}" >
                 </Item>
          </Message>
     </SendTemplate>
</Procedure>

<!--   List SERVICE     -->
                <Procedure	cond="/Message/@type='List_service'" 
					call="BILLING.mg_list_of_service" using="db" >
			<Parameters>
				<param name="mob_num" type="string" value="${customer}"/>
				<param name="msg" type="out:string" value=""/>
				<param name="dbresult" type="out:string" value=""/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${dbresult}" reply = "${msg}" state="0">
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>

<!--   KIP USER        -->
                <Procedure	cond="/Message/@type='mg_add_del_KIP'" 
					call="billing.mg_add_del_KIP" using="db" >
			<Parameters>
				<param name="num" type="string" value="${customer}"/>
				<param name="ac" type="string" value="${action}"/>
				<param name="msg" type="out:string" value=""/>
				<param name="dbresult" type="out:string" value=""/>
			</Parameters>
			<SendTemplate>
				<Message type="serviceorderdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
					<Item customer="${customer}" dbresult="${dbresult}" reply = "${msg}" state="0">
					</Item>
				</Message>
			</SendTemplate>
		</Procedure>

		<!--  Бонус Жукович Н.В.   -->
 		<Procedure cond="/Message/@type='Bonus_test'" call="billing.dn_test_bonus" using="db">
 			<Parameters>
				<param name="num" type="string" value="${customer}" /> 
				<param name="msg" type="out:string" value="" /> 
				<param name="dbresult" type="out:string" value="" /> 
		</Parameters>
 		<SendTemplate>
 			<Message type="serviceorderdataresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
			<Item customer="${customer}" dbresult="${dbresult}" reply="${msg}" state="0" /> 
			</Message>
		</SendTemplate>
		</Procedure>
		<!-- tel in varchar, pan in number, bal_i out number, calc_metod out varchar, cred_limit out number, unbl_limit out number -->
 		<Procedure cond="/Message/@type='mc_GetBalanceInfo'" call="WWP.SIDOR_GETBALANCE_FULLINFO" using="db">
 			<Parameters>
				<param name="tel" type="string" value="${customer}" />
				<param name="pan" type="string" value="${personalaccount}" />
				<param name="bal_i" type="out:string" value="" />
				<param name="calc_metod" type="out:string" value="" />
				<param name="cred_limit" type="out:string" value="" />
				<param name="unbl_limit" type="out:string" value="" />
		</Parameters>
 		<SendTemplate>
 			<Message type="mobilecommerceresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
			<Item customer="${customer}" >
		        <Attribute name="balanceinfo" value="${bal_i}" />
		        <Attribute name="calculationmethod" value="${calc_metod}" />
				<Attribute name="creditlimit" value="${cred_limit}" />
				<Attribute name="unblocklimit" value="${unbl_limit}" />
			</Item>
			</Message>
		</SendTemplate>
		</Procedure>
		
		<!-- p_msisdn IN VARCHAR2, o_tp_name OUT VARCHAR2, o_tp_id OUT VARCHAR2, o_lng_id OUT VARCHAR2 -->
		<Procedure cond="/Message/@type='mc_get_tp_id'" call="WWP.get_tp_id" using="db">
 			<Parameters>
				<param name="p_msisdn" type="string" value="${customer}" />
				<param name="o_tp_name" type="out:string" value="" />
				<param name="o_tp_id" type="out:string" value="" />
				<param name="o_lng_id" type="out:string" value="" />
		</Parameters>
 		<SendTemplate>
 			<Message type="mobilecommerceresult" id="@{newGuid}" session_id="${session_id}" request_id="${id}">
			<Item customer="${customer}" dbresult="0" >
		        <Attribute name="tpname" value="${o_tp_name}" />
		        <Attribute name="tpid" value="${o_tp_id}" />
				<Attribute name="lngid" value="${o_lng_id}" />
			</Item>
			</Message>
		</SendTemplate>
		</Procedure>
		
</Procedures>
</plugin>  
  
