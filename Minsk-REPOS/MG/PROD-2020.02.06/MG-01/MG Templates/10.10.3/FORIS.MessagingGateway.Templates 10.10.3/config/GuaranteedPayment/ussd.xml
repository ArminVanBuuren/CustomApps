<templateGroup name="GuaranteedPayment">
	<macros>
		<define name="_SMSCON" value="SMSCON_01" />
	</macros>

	<template procedureName="Acceptance">
		<condition>
            <test item="${Sender}" matches="^00111$" />
			<test item="${Content}" matches="^[0-9]{11}\*promised_payment_rur(\*[0-9]+)?$" />
		</condition>
		<receiveTemplate>
			<Message type="serviceorder" initiator="ussd" id="${guid}" session_id="${guid}">
				<Item customer="${token0}">
					<Service id="guaranteedpayment" action="7">
						<Attribute name="amount" value="#{if('${token2}'!='',number('${token2}') * 100,'')}" />
						<Attribute name="currency" value="810" />
					</Service>
				</Item>
			</Message>
		</receiveTemplate>
		<deliveryTemplate direction="input" terminating="false">
			<set item="Content"   value="Ваша заявка принята. Ждите СМС с результатом" />
			<set item="Sender" value="11111" />
			<set item="Recipient" value="00111" />
			<set item="Encoding" value="unicodefffe" />
		</deliveryTemplate>
		<deliveryTemplate connector="_SMSCON" />
	</template>

	<template procedureName="Verification">
		<condition>
            <test item="${Sender}" matches="^00111$" />
			<test item="${Content}" matches="^[0-9]{11}\*promised_payment_verification$" />
		</condition>
		<receiveTemplate>
			<Message type="serviceorder" initiator="ussd" id="${guid}" session_id="${guid}">
				<Item customer="${token0}">
					<Service id="guaranteedpayment" action="6" />
				</Item>
			</Message>
		</receiveTemplate>
		<deliveryTemplate direction="input" terminating="false">
			<set item="Content"   value="Ваша заявка принята. Ждите СМС с результатом" />
			<set item="Sender" value="11111" />
			<set item="Recipient" value="00111" />
			<set item="Encoding" value="unicodefffe" />
		</deliveryTemplate>
		<deliveryTemplate connector="_SMSCON" />
	</template>

	<template procedureName="List">
		<condition>
            <test item="${Sender}" matches="^00111$" />
			<test item="${Content}" matches="^[0-9]{11}\*promised_payment_list$" />
		</condition>
		<receiveTemplate>
			<Message type="retrievecustomerdata" initiator="ussd" id="${guid}" session_id="${guid}">
				<Item customer="${token0}" subject="get_guaranteedpayment" />
			</Message>
		</receiveTemplate>
		<deliveryTemplate direction="input" terminating="false">
			<set item="Content"   value="Ваша заявка принята. Ждите СМС с результатом" />
			<set item="Sender" value="11111" />
			<set item="Recipient" value="00111" />
			<set item="Encoding" value="unicodefffe" />
		</deliveryTemplate>
		<deliveryTemplate connector="_SMSCON" />
	</template>

</templateGroup>