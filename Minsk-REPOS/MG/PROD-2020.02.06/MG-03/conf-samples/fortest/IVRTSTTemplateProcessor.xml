<templates connector="IVR">

<!-- TP_prechange_check -->

<template procedureName="DB_TP_prechange">
    <condition>
    </condition>
    <receiveTemplate>
      <Message type="TP_prechange_check" initiator="ivrcon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${customer}" >
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate />
    <input>
      <param name="customer" />
     </input>
    <output>
	<param name="dbresult" type="3" value="-1"/>
    </output>
  </template>

<template procedureName="DB_CValidation" persistent="false">
    <condition>
    </condition>
    <receiveTemplate>
      <Message type="verificationrequest" initiator="ivrcon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${customer}" datasource="state">
            <Attribute name="checkivrservice" value="1" />
            <Attribute name="checkblocks" value="1" />
       </Item> 
      </Message>
    </receiveTemplate>
    <deliveryTemplate />
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="TariffPlan" type="3" value="0" />
      <param name="State" type="2" value="0" />
      <param name="Password" type="1" value="" />
      <param name="regioncode" type="3" value="0" />
      <param name="language_id" type="3" value="1" />
      <param name="customerblocks" type="1" value="" />
    </output>
</template>

 <template procedureName="DB_BalanceRetriev" persistent="false">
  <input>
   <param name="Customer"/>
  </input>
  <output>
   <param name="balanceintpartdotpart" type="3" value="0"/>
   <param name="accumulator1" type="1" value="" />
   <param name="accumulator2" type="1" value="" />
   <param name="accumulator3" type="1" value="" />
   <param name="disconnectiontime" type="3" value="0"/>
  </output>
  <receiveTemplate>
   <Message type="retrievecustomerdata" initiator="ivrcon" id="${guid}" session_id="@{newGuid}">
    <Item customer="${customer}" subject="balance" datasource="state" />
   </Message>
  </receiveTemplate>
  <deliveryTemplate />
 </template>

<template procedureName="DB_SProcessing">
    <condition>
    </condition>
  <receiveTemplate>
		<Message type="serviceorder" initiator="IVRCON" id="${guid}" session_id="@{newGuid}">
				<Item customer="${customer}">
					<Service id="${ServiceCode}" action="0" class="${Class}" needtarification="1" createrequest="1" />
				</Item>
		</Message>
  </receiveTemplate>
 <deliveryTemplate />
    <input>
      <param name="customer" />
      <param name="ServiceCode" />
      <param name="class" />
      <param name="action" />
    </input>
    <output>
      <param name="dbresult" type="3" value="0"/>
      <param name="state" type="2" value="0"/>
      <param name="ischarged" type="2" value="0"/>
      <param name="price" type="3" value="0"/>
    </output>
  </template>
  
   <template procedureName="DB_PayVerification" persistent="false">
    <condition>
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="ivrcon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${customer}">
          <Service id="guaranteedpayment" action="6" />
        </Item>
    </Message>
    </receiveTemplate>
    <deliveryTemplate>
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
    <param name="allowed" type="2" value="0" />
    <param name="pending" type="2" value="0" />
    <param name="maximumusd" type="3" value="0" />
    <param name="maximumrur" type="3" value="0" />
    </output>
  </template>

  <template procedureName="DB_TPChangeStatus"> 
  <input>
     <param name="customer" />
  </input>
  <receiveTemplate>
     <Message type="retrieveinfo" initiator="ivrcon" id="${guid}" session_id="@{newGuid}">
         <Item customer="${customer}" subject="changetariffplanrequeststatus" />
     </Message>
  </receiveTemplate>
  <output>
      <param name="requeststatus" type="3" value="0" />
      <param name="dateofstart" type="1" value="" />
      <param name="dateofcomplete" type="1" value="" />
  </output>
  </template>

<template procedureName="DB_NewCValidation" persistent="false">
  <input>
   <param name="customer"/>
  </input>
  <output>
      <param name="tariffplan" type="3" value="0" />
      <param name="state" type="2" value="0" />
      <param name="password" type="1" value="" />
      <param name="customer_info" type="3" value="1" />
      <param name="check" type="3" value="0" />
      <param name="cost" type="3" value="0" />
  </output>
  <receiveTemplate>
      <Message type="verificationrequest" initiator="ivrcon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${customer}" datasource="state" />
      </Message>
  </receiveTemplate>
  <deliveryTemplate />
 </template>  

 <template procedureName="DB_NewCValidation2" persistent="false">
  <input>
   <param name="Customer"/>
  </input>
  <output>
	<param name="reply" type="3" value="0" />
  </output>
  <receiveTemplate>
      <Message type="Cost_customer" initiator="ivrcon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${customer}" datasource="state" />
      </Message>
  </receiveTemplate>
  <deliveryTemplate />
 </template>  

<template procedureName="DB_PayAcceptance"  persistent="false">
    <condition>
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="ivrcon" id="${guid}" session_id="@{newGuid}">
        <Item customer="${customer}">
          <Service id="guaranteedpayment" action="7">
            <Attribute name="amount" value="${amount}" />
            <Attribute name="currency" value="${currency}" />
          </Service>
        </Item>
      </Message>
    </receiveTemplate>
    <input>
      <param name="customer" />
      <param name="currency" />
      <param name="amount" />
    </input>
    <output>
    </output>
  </template>

<template procedureName="DB_PayAcceptance2">
    <condition>
    </condition>
    <receiveTemplate>
      <Message type="serviceorder" initiator="ivrcon" id="${guid}" session_id="@{newGuid}">
 	<Item customer="${customer}" datasource="state">
 	  <Service id="guaranteedpayment" action="7">
     		<Attribute name="amount" value="${amount}" />
		<Attribute name="currency" value="${currency}" />
		<Attribute name="init" value="${init}" />
	  </Service>
 	</Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="amount" />
      <param name="currency" />
      <param name="init" />
    </input>
    <output>
      <param name="allowed" type="2" value="1" />
      <param name="amount" type="3" value="0" />
      <param name="currency" type="3" value="974" />
    </output>
  </template>

</templates>