<templates connector="SOAP">
  <template procedureName="DevelopProvision" sessionStorage="Memory" sessionLifetime="30" persistent="true">
    <receiveTemplate>
      <Message type="serviceorder" initiator="ussd" id="@{newGuid}" session_id="@{setSessionId(DevelopProvision_${customer})}">
        <Item customer="${customer}">
          <Service id="${service}" action="${action}" class="0" sourcetypeid="11" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:result" value="${dbresult}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="action" />
      <param name="service" />
    </input>
    <output>
      <param name="result" />
    </output>
  </template>
  <template procedureName="GetMsisdnByImsi" handler="_DBCON" sessionStorage="Memory" sessionLifetime="30" persistent="true">
    <receiveTemplate>
      <Message type="dummyrequest" process="dispatcher" initiator="_CURRENT_INITIATOR" id="@{newGuid}" session_id="@{setSessionId(GetMSISDN_${imsi})}">
        <Item procedureName="mobile_app.getmsisdnbyimsi">
          <Attribute name="p_imsi" type="STRING" value="${imsi}" />
          <Attribute name="result" type="out:STRING" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:result" value="${result}" />
    </deliveryTemplate>
    <input>
      <param name="imsi" />
    </input>
    <output>
      <param name="result" />
    </output>
  </template>
  <template procedureName="ServiceProvisioning" sessionStorage="Memory" sessionLifetime="15" persistent="true">
    <receiveTemplate>
      <Message type="serviceorder" initiator="ussd" id="@{newGuid}" session_id="@{setSessionId(ServiceWHIRL_${customer})}">
        <Item customer="${customer}">
          <Service id="${service}" action="${action}" class="0" sourcetypeid="36" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:result" value="${dbresult}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="action" />
      <param name="service" />
    </input>
    <output>
      <param name="result" />
    </output>
  </template>
  <template procedureName="ServiceProvisioning2" handler="DBCON_03_01" sessionStorage="Memory" sessionLifetime="15" persistent="true">
    <receiveTemplate>
      <Message type="dummyrequest" process="dispatcher" initiator="ussd" id="@{newGuid}" session_id="@{setSessionId(ServiceWHIRL_${customer})}">
        <Item procedureName="other_spikes.GET_WHIRL_COUNTER">
          <Attribute name="p_msisdn" type="STRING" value="${customer}" />
          <Attribute name="result" type="out:STRING" />
        </Item>
        @{store(sCustomer,${customer})}
        @{store(sAction,${action})}
        @{store(sService,${service})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{'${result}'>'50'}">
      <set item="oparam:result" value="320194" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate call="ServiceProvisioning_Step2" />
    <input>
      <param name="customer" />
      <param name="action" />
      <param name="service" />
    </input>
    <output>
      <param name="result" />
    </output>
  </template>
  <template procedureName="ServiceProvisioning_Step2" sessionStorage="Memory" sessionLifetime="15" persistent="true">
    <receiveTemplate>
      <Message type="serviceorder" initiator="ussd" id="@{newGuid}" session_id="${SessionId}">
        <Item customer="${sCustomer}">
          <Service id="${sService}" action="${sAction}" class="0" sourcetypeid="36" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:result" value="${dbresult}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="action" />
      <param name="service" />
    </input>
    <output>
      <param name="result" />
    </output>
  </template>
</templates>