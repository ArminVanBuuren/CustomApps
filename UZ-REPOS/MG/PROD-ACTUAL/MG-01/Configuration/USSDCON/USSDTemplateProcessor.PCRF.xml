<templates connector="USSD">
	<macros>
		<!-- ==========================  REDIRECT CONNECTORS   ========================= -->
		<define name="_SMSCON_1"                        value="SMSCON_01_01"/>
		<define name="_SMSCON_ISSA"                     value="SMSCON_01_02"/>
		<define name="_DBCON"                           value="DBCON_01_01"/>
		<!-- ==========================  REDIRECT CONNECTORS   ========================= -->

		<!-- ==========================  PCRF  ========================= -->
		<define name="_PCRF_SERVICE"                    value="#{replace('${Content}','^(\d{12})_(.+)$','$2')}"/>
		<!-- ==========================  PCRF  ========================= -->

		<!-- ==========================  USSD SPECIAL   ========================= -->
		<define name="_USSD_SRV_COMM"                   value="#{replace('_PARCE_CONTENT','_USSD_SRV_RGPATT','$1')}"/>
		<define name="_USSD_SRV_ACT"                    value="@{switch(#{replace('_PARCE_CONTENT','_USSD_SRV_RGPATT','$3')}|,_CONFIRM_VALUE|_CONFIRM_VALUE,0|0,2|0,1|1)}"/>
		<define name="_USSD_SRV_DEAL"                   value="#{replace('_PARCE_CONTENT','_USSD_SRV_RGPATT','$5')}"/>
		<define name="_USSD_SRV_RGPATT"                 value="^(\*.{3,}?(\*|)(_CONFIRM_VALUE|[0-9]|))(\*(\d{9})|)$|^.*$"/>
		<define name="_USSD_PTP_SRV"                    value="#{replace('_PARCE_CONTENT','_USSD_PTP_RGPATT','$1$7')}"/>
		<define name="_USSD_PTP_RECEIVER"               value="#{replace('_PARCE_CONTENT','_USSD_PTP_RGPATT','$4$5')}"/>
		<define name="_USSD_PTP_AMOUNT"                 value="#{replace('_PARCE_CONTENT','_USSD_PTP_RGPATT','$6')}"/>
		<define name="_USSD_PTP_RGPATT"                 value="^(.*?)(\*\+|\*)((\d{12}|)|(\d{12})\*([1-5])|)$|^(.*)$"/>
		<define name="_PARCE_LANG"                      value="#{replace('${Content}','^(.*)\|(.*)$|^.*$','$1')}"/>
		<define name="_PARCE_CONTENT"                   value="#{replace('${Content}','^(.*)\|(.*)$|^.*$','$2')}"/>
		<define name="_DEALER_NUM"                      value="\*\d{9}"/>

		<define name="_PORTAL_ASSIGN_TOKENS"            value="#{if('${sTokens}'!='' and '${Content}'='0','_PORTAL_STEP_BACK','#{if('${sTokens}'!='' and '${Content}'='*','_PORTAL_STEP_BCKTOTOP','#{if(matches('${Content}','_RGPATT_NTFREQ'),_PORTAL_STEP_NEXT,'_USSD_CONTENT')}')}')}"/>
		<define name="_PORTAL_STEP_NEXT"                value="concat('${sTokens}','*','${Content}')"/>
		<define name="_PORTAL_STEP_BACK"                value="#{replace('${sTokens}','\*\d+$|\*[_RGPATT_SPEC_SYMB]$','')}"/>
		<define name="_PORTAL_STEP_BCKTOTOP"            value="#{replace('${sTokens}','(\*00)+$','')}"/>
		<define name="_GET_PORTAL_ANSWER"               value="#{document('Config\Portal\DealerUSSDPortal_01.xml')/Portal/Item[code/@value='${sTokens}']/@info__GET_LANG}"/>
		<define name="_GET_PORTAL_LENGTH_ANSWER"        value="#{string-length(document('Config\Portal\DealerUSSDPortal_01.xml')/Portal/Item[code/@value='${sTokens}']/@info__GET_LANG)}"/>


		<define name="_USSD_CHECK_NUMBER"               value="#{replace('${Content}','^\*_DEF_USSDNUM\*\d{4}\*(\d{7})\#$','$1')}"/>
		<define name="_USSD_CHECK_MASK"                 value="#{replace('${Content}','^\*_DEF_USSDNUM\*\d{3}\*(\d{4})\#$','$1')}"/>
		<define name="_NUMBER_STATUS"                   value="#{replace('${result}','STATUS:(\d)_CATEGORY:(\w*)_REGION:(\d{6})','$1')}"/>
		<define name="_NUMBER_CATEGORY"                 value="#{document('Config\Service\SERIES.xml')/InfoList/Category[code/@value='#{replace('${result}','STATUS:(\d)_CATEGORY:(\w*)_REGION:(\d{6})','$2')}']/@info}"/>
		<define name="_NUMBER_REGION"                   value="#{document('Config\Service\SERIES.xml')/InfoList/Region[code/@value='#{replace('${result}','STATUS:(\d)_CATEGORY:(\w*)_REGION:(\d{6})','$3')}']/@info}"/>
		<define name="_SLUJEB_TP_NUMBER"                value="#{replace('${Content}','^\*_DEF_USSDNUM\*4444\*(99897\d{7})\*(\d{5})\#$','$1')}"/>
		<define name="_SLUJEB_TP_CODE"                  value="#{replace('${Content}','^\*_DEF_USSDNUM\*4444\*(99897\d{7})\*(\d{5})\#$','$2')}"/>


		<define name="_USSD_CONTENT"                    value="#{replace('_USSD_RGPATT','^_USSD_NUMBER','')}"/>
		<define name="_USSD_NUMBER"                     value="#{replace('_USSD_RGPATT','\*.*','')}"/>
		<define name="_USSD_RGPATT"                     value="#{replace('${Content}','^\*(.+)\#.*$|^.*$','$1')}"/>
		<define name="_SBSCR_LANGUAGE"                  value="#{document('Config\Service\All_SERVICE.xml')/ServiceList/Language/lang[_CURRENT_MODULE/@value='${sTokens}']/@param}"/>
		<define name="_COUNTERS_NOTPCOUNTERS"           value="#{document('Config\Service\COUNTERS.xml')/Counters/Group[_CURRENT_MODULE/@value='${sCountertype}']/@checktpcounters_nocounters__GET_LANG}"/>
		<define name="_COUNTERS_NOONETIMECOUNTERS"      value="#{document('Config\Service\COUNTERS.xml')/Counters/Group[_CURRENT_MODULE/@value='${sCountertype}']/@checkonetimecounters_nocounters__GET_LANG}"/>
		<define name="_IS_NTFREQ_COMMAND"               value="matches('${sContent}','_RGPATT_NTFREQ')"/>
		<define name="_RGPATT_NTFREQ"                   value="^\d+(\*\d+|)+$|^[_RGPATT_SPEC_SYMB]$"/>
		<define name="_RGPATT_SPEC_SYMB"                value="?"/>
		<define name="_DEF_USSDNUM"                     value="171"/>
		<!-- ==========================  USSD SPECIAL   ========================= -->

		<!-- ==========================  SERVICE PROVISIONING  ========================= -->
		<define name="_GET_SERVICE_RESULT"              value="#{if('#{document('Config\Service\SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/@info_${sDbresult}__GET_LANG}'='','#{if('#{document('Config\Service\SERVICE.xml')/ServiceList/Group[@name='${sGroupName}']/@info_${sDbresult}__GET_LANG}'='','_GET_DBRESULT','#{document('Config\Service\SERVICE.xml')/ServiceList/Group[@name='${sGroupName}']/@info_${sDbresult}__GET_LANG}')}','#{document('Config\Service\SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/@info_${sDbresult}__GET_LANG}')}"/>
		<define name="_GET_CONFIRM_SERVICE_RESULT"      value="#{if('#{document('Config\Service\SERVICE.xml')/ServiceList/Service[@service_code='_SERVICE_CODE']/@info_${sDbresult}__GET_LANG}'='','#{if('#{document('Config\Service\SERVICE.xml')/ServiceList/Group[@name='#{document('Config\Service\SERVICE.xml')/ServiceList/GroupList/Item[@id='#{document('Config\Service\SERVICE.xml')/ServiceList/Service[@service_code='_SERVICE_CODE']/@group}']/@name}']/@info_${sDbresult}__GET_LANG}'='','_GET_DBRESULT','#{document('Config\Service\SERVICE.xml')/ServiceList/Group[@name='#{document('Config\Service\SERVICE.xml')/ServiceList/GroupList/Item[@id='#{document('Config\Service\SERVICE.xml')/ServiceList/Service[@service_code='_SERVICE_CODE']/@group}']/@name}']/@info_${sDbresult}__GET_LANG}')}','#{document('Config\Service\SERVICE.xml')/ServiceList/Service[@service_code='_SERVICE_CODE']/@info_${sDbresult}__GET_LANG}')}"/>
		<define name="_SERVICE_CONFIRM_NAME"            value="#{document('Config\Service\SERVICE.xml')/ServiceList/Service[@service_code='_SERVICE_CODE']/@service_name__GET_LANG}"/>
		<define name="_SERVICE_TP_CNT"                  value="#{if(count(document('Config\Service\SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/tplist[1][ivrcode/@value='#{//Message/Item/@tariffplan}']/ivrcode)>0,count(document('Config\Service\SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/tplist[1][ivrcode/@value='#{//Message/Item/@tariffplan}']/ivrcode),count(document('Config\Service\SERVICE.xml')/ServiceList/Group[@name='${sGroupName}']/tplist[1][ivrcode/@value='#{//Message/Item/@tariffplan}']/ivrcode))}"/>
		<define name="_SERVICE_TP_ISAVAIL"                 value="#{if('#{document('Config\Service\SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/tplist[1]/@available}'!='','#{document('Config\Service\SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/tplist[1]/@available}','#{document('Config\Service\SERVICE.xml')/ServiceList/Group[@name='${sGroupName}']/tplist[1]/@available}')}"/>
		<define name="_SERVICE_TP_NOTAVALINFO"             value="#{if('#{document('Config\Service\SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/tplist[1]/@info_notaval__GET_LANG}'!='','#{document('Config\Service\SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/tplist[1]/@info_notaval__GET_LANG}','#{document('Config\Service\SERVICE.xml')/ServiceList/Group[@name='${sGroupName}']/tplist[1]/@info_notaval__GET_LANG}')}"/>
		<define name="_SERVICE_CUSTLST_CNT"             value="#{if(count(document('Config\Service\SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/customerlist[1]/customer[@value='${customer}']/@value)>0,count(document('Config\Service\SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/customerlist[1]/customer[@value='${customer}']/@value),count(document('Config\Service\SERVICE.xml')/ServiceList/Group[@name='${sGroupName}']/customerlist[1]/customer[@value='${customer}']/@value))}"/>
		<define name="_SERVICE_CUSTLST_ISAVAIL"            value="#{if('#{document('Config\Service\SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/customerlist[1]/@available}'!='','#{document('Config\Service\SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/customerlist[1]/@available}','#{document('Config\Service\SERVICE.xml')/ServiceList/Group[@name='${sGroupName}']/customerlist[1]/@available}')}"/>
		<define name="_SERVICE_CUSTLST_NOTAVAILINFO"       value="#{if('#{document('Config\Service\SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/customerlist[1]/@info_notaval__GET_LANG}'!='','#{document('Config\Service\SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/customerlist[1]/@info_notaval__GET_LANG}','#{document('Config\Service\SERVICE.xml')/ServiceList/Group[@name='${sGroupName}']/customerlist[1]/@info_notaval__GET_LANG}')}"/>
		<define name="_SERVICE_SRVBIND_CNT"             value="#{if(count(document('Config\Service\SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/servicebindinglist[1]/service)>0,count(document('Config\Service\SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/servicebindinglist[1]/service),count(document('Config\Service\SERVICE.xml')/ServiceList/Group[@name='${sGroupName}']/servicebindinglist[1]/service))}"/>
		<define name="_SERVICE_SRVBIND_SRVCODE"            value="#{if('#{document('Config\Service\SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/servicebindinglist[1]/service[${sCnt}]/@service_code}'!='','#{document('Config\Service\SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/servicebindinglist[1]/service[${sCnt}]/@service_code}','#{document('Config\Service\SERVICE.xml')/ServiceList/Group[@name='${sGroupName}']/servicebindinglist[1]/service[${sCnt}]/@service_code}')}"/>
		<define name="_SERVICE_SRVBIND_SUBSR"              value="#{if('#{document('Config\Service\SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/servicebindinglist[1]/service[${sCnt}]/@subscription}'!='','#{document('Config\Service\SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/servicebindinglist[1]/service[${sCnt}]/@subscription}','#{document('Config\Service\SERVICE.xml')/ServiceList/Group[@name='${sGroupName}']/servicebindinglist[1]/service[${sCnt}]/@subscription}')}"/>
		<define name="_SERVICE_SRVBIND_STORE"              value="#{if('#{document('Config\Service\SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/servicebindinglist[1]/service[${sCnt}]/@store}'!='','#{document('Config\Service\SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/servicebindinglist[1]/service[${sCnt}]/@store}','#{document('Config\Service\SERVICE.xml')/ServiceList/Group[@name='${sGroupName}']/servicebindinglist[1]/service[${sCnt}]/@store}')}"/>
		<define name="_SERVICE_SRVBIND_INFO"               value="#{if('#{document('Config\Service\SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/servicebindinglist[1]/service[${sCnt}]/@info_notaval__GET_LANG}'!='','#{document('Config\Service\SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/servicebindinglist[1]/service[${sCnt}]/@info_notaval__GET_LANG}','#{document('Config\Service\SERVICE.xml')/ServiceList/Group[@name='${sGroupName}']/servicebindinglist[1]/service[${sCnt}]/@info_notaval__GET_LANG}')}"/>
		<define name="_SERVICE_SUCCESSFUL_RESPONSE"     value="#{if('#{document('Config\Service\SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/@successful_response}'='','#{document('Config\Service\SERVICE.xml')/ServiceList/Group[@name='${sGroupName}']/@successful_response}','#{document('Config\Service\SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/@successful_response}')}"/>
		<define name="_SERVICE_CHECKBLOCK"              value="#{if('#{document('Config\Service\SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/@check_block}'='','#{document('Config\Service\SERVICE.xml')/ServiceList/Group[@name='${sGroupName}']/@check_block}','#{document('Config\Service\SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/@check_block}')}"/>
		<define name="_SERVICE_REDIRECT"                value="#{if('#{document('Config\Service\SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/@redirect}'='','#{document('Config\Service\SERVICE.xml')/ServiceList/Group[@name='${sGroupName}']/@redirect}','#{document('Config\Service\SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/@redirect}')}"/>
		<define name="_SERVICE_AVAIL_BAL"               value="#{if('#{document('Config\Service\SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/@availbalance}'='','#{document('Config\Service\SERVICE.xml')/ServiceList/Group[@name='${sGroupName}']/@availbalance}','#{document('Config\Service\SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/@availbalance}')}"/>
		<define name="_SERVICE_TIMETOPROGRESS"          value="#{if('#{document('Config\Service\SERVICE.xml')/ServiceList/Service[@service_code='#{if('${sServiceCode}'='','_SERVICE_CODE','${sServiceCode}')}']/@timetoprogress}'='','#{document('Config\Service\SERVICE.xml')/ServiceList/Group[@name='#{if('${sGroupName}'='','_SERVICE_GROUPNAME','${sGroupName}')}']/@timetoprogress}','#{document('Config\Service\SERVICE.xml')/ServiceList/Service[@service_code='#{if('${sServiceCode}'='','_SERVICE_CODE','${sServiceCode}')}']/@timetoprogress}')}"/>
		<define name="_SERVICE_DATEFROM"                value="#{document('Config\Service\SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/@datefrom}"/>
		<define name="_SERVICE_DATETO"                  value="#{document('Config\Service\SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/@dateto}"/>
		<define name="_SERVICE_NAME"                    value="#{document('Config\Service\SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/@service_name__GET_LANG}"/>
		<define name="_SERVICE_GROUPNAME"               value="#{document('Config\Service\SERVICE.xml')/ServiceList/GroupList/Item[@id='#{document('Config\Service\SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/@group}']/@name}"/>
		<define name="_SERVICE_COMM_ACTION"             value="#{document('Config\Service\SERVICE.xml')/ServiceList/CommandList/Command[_CURRENT_MODULE/@value='${sAction}']/@action}"/>
		<define name="_SERVICE_COMM_STATUS"             value="#{document('Config\Service\SERVICE.xml')/ServiceList/CommandList/Command[_CURRENT_MODULE/@value='${sAction}']/@status}"/>
		<define name="_SERVICE_COMM_CODE"               value="#{document('Config\Service\SERVICE.xml')/ServiceList/CommandList/Command[_CURRENT_MODULE/@value='${sAction}']/@code}"/>
		<define name="_SERVICE_COMM_ACTPARCE"           value="#{document('Config\Service\SERVICE.xml')/ServiceList/CommandList/Command[_CURRENT_MODULE/@value='${sAction}']/@parce}"/>
		<define name="_SERVICE_CRMSTATUS"               value="#{document('Config\Service\SERVICE.xml')/ServiceList/CommandList/Command[@status='${subscription}']/@parce}"/>
		<define name="_SERVICE_CRMACTION_ADD"           value="#{document('Config\Service\SERVICE.xml')/ServiceList/CommandList/Command[@action='2']/@parce}"/>
		<define name="_SERVICE_CRMACTION_DEL"           value="#{document('Config\Service\SERVICE.xml')/ServiceList/CommandList/Command[@action='3']/@parce}"/>
		<define name="_SERVICE_CODE"                    value="#{document('Config\Service\SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/@service_code}"/>
		<!-- ==========================  SERVICE PROVISIONING  ========================= -->

		<!-- ==========================  CHANGE TP   ========================= -->
		<define name="_GET_TARIFF_RESULT"               value="#{if('#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/@info_${sDbresult}__GET_LANG}'='','#{if('#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Group[@name='${sGroupName}']/@info_${sDbresult}__GET_LANG}'='','_GET_DBRESULT','#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Group[@name='${sGroupName}']/@info_${sDbresult}__GET_LANG}')}','#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/@info_${sDbresult}__GET_LANG}')}"/>
		<define name="_GET_CONFIRM_TARIFF_RESULT"       value="#{if('#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/@info_${sDbresult}__GET_LANG}'='','#{if('#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Group[@name='#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/GroupList/Item[@id='#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/@group}']/@name}']/@info_${sDbresult}__GET_LANG}'='','_GET_DBRESULT','#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Group[@name='#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/GroupList/Item[@id='#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/@group}']/@name}']/@info_${sDbresult}__GET_LANG}')}','#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/@info_${sDbresult}__GET_LANG}')}"/>
		<define name="_TARIFF_TP_CNT"                   value="#{if(count(document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/tplist[1][ivrcode/@value='#{//Message/Item/@tariffplan}'])>0,count(document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/tplist[1][ivrcode/@value='#{//Message/Item/@tariffplan}']),count(document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Group[@name='${sGroupName}']/tplist[1][ivrcode/@value='#{//Message/Item/@tariffplan}']))}"/>
		<define name="_TARIFF_TP_ISAVAIL"                  value="#{if('#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/tplist[1]/@available}'!='','#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/tplist[1]/@available}','#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/tplist[1]/@available}')}"/>
		<define name="_TARIFF_TP_NOTAVAILINFO"             value="#{if('#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/tplist[1]/@info_notaval__GET_LANG}'!='','#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/tplist[1]/@info_notaval__GET_LANG}','#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/tplist[1]/@info_notaval__GET_LANG}')}"/>
		<define name="_TARIFF_CUSTLST_CNT"              value="#{if(count(document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/customerlist[1]/customer[@value='${customer}'])>0,count(document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/customerlist[1]/customer[@value='${customer}']),count(document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Group[@name='${sGroupName}']/customerlist[1]/customer[@value='${customer}']))}"/>
		<define name="_TARIFF_CUSTLST_ISAVAIL"             value="#{if('#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/customerlist[1]/@available}'!='','#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/customerlist[1]/@available}','#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Group[@name='${sGroupName}']/customerlist[1]/@available}')}"/>
		<define name="_TARIFF_CUSTLST_NOTAVAILINFO"        value="#{if('#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/customerlist[1]/@info_notaval__GET_LANG}'!='','#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/customerlist[1]/@info_notaval__GET_LANG}','#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Group[@name='${sGroupName}']/customerlist[1]/@info_notaval__GET_LANG}')}"/>
		<define name="_TARIFF_SRVBIND_CNT"              value="#{if(count(document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/servicebindinglist[1]/service)>0,count(document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/servicebindinglist[1]/service),count(document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Group[@name='${sGroupName}']/servicebindinglist[1]/service))}"/>
		<define name="_TARIFF_SRVBIND_SRVCODE"             value="#{if('#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/servicebindinglist[1]/service[${sCnt}]/@service_code}'!='','#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/servicebindinglist[1]/service[${sCnt}]/@service_code}','#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Group[@name='${sGroupName}']/servicebindinglist[1]/service[${sCnt}]/@service_code}')}"/>
		<define name="_TARIFF_SRVBIND_SUBSR"               value="#{if('#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/servicebindinglist[1]/service[${sCnt}]/@subscription}'!='','#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/servicebindinglist[1]/service[${sCnt}]/@subscription}','#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Group[@name='${sGroupName}']/servicebindinglist[1]/service[${sCnt}]/@subscription}')}"/>
		<define name="_TARIFF_SRVBIND_STORE"               value="#{if('#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/servicebindinglist[1]/service[${sCnt}]/@store}'!='','#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/servicebindinglist[1]/service[${sCnt}]/@store}','#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Group[@name='${sGroupName}']/servicebindinglist[1]/service[${sCnt}]/@store}')}"/>
		<define name="_TARIFF_SRVBIND_INFO"                value="#{if('#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/servicebindinglist[1]/service[${sCnt}]/@info_notaval__GET_LANG}'!='','#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/servicebindinglist[1]/service[${sCnt}]/@info_notaval__GET_LANG}','#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Group[@name='${sGroupName}']/servicebindinglist[1]/service[${sCnt}]/@info_notaval__GET_LANG}')}"/>
		<define name="_TARIFF_SUCCESSFUL_RESPONSE"      value="#{if('#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/@successful_response}'='','#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Group[@name='${sGroupName}']/@successful_response}','#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/@successful_response}')}"/>
		<define name="_TARIFF_CHECKBLOCK"               value="#{if('#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/@check_block}'='','#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Group[@name='${sGroupName}']/@check_block}','#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/@check_block}')}"/>
		<define name="_TARIFF_REDIRECT"                 value="#{if('#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/@redirect}'='','#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Group[@name='${sGroupName}']/@redirect}','#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/@redirect}')}"/>
		<define name="_TARIFF_TIMETOPROGRESS"           value="#{if('#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[@ivrcode='#{if('${sTariffIvrCode}'='','_TARIFF_IVRCODE','${sTariffIvrCode}')}']/@timetoprogress}'='','#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Group[@name='#{if('${sGroupName}'='','_TARIFF_GROUPNAME','${sGroupName}')}']/@timetoprogress}','#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[@ivrcode='#{if('${sTariffIvrCode}'='','_TARIFF_IVRCODE','${sTariffIvrCode}')}']/@timetoprogress}')}"/>
		<define name="_TARIFF_AVAIL_BAL"                value="#{if('#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/@availbalance}'='','#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Group[@name='${sGroupName}']/@availbalance}','#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/@availbalance}')}"/>
		<define name="_TARIFF_DATEFROM"                 value="#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/@datefrom}"/>
		<define name="_TARIFF_DATETO"                   value="#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/@dateto}"/>
		<define name="_TARIFF_NAME"                     value="#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/@tariffname__GET_LANG}"/>
		<define name="_TARIFF_GROUPNAME"                value="#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/GroupList/Item[@id='#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/@group}']/@name}"/>
		<define name="_TARIFF_CURRENT_NAME"             value="#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[@ivrcode='#{//Message/Item/@tariffplan}']/@tariffname__GET_LANG}"/>
		<define name="_TARIFF_IVRCODE"                  value="#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[_CURRENT_MODULE/@value='${sNewTariffPlan}']/@ivrcode}"/>
		<define name="_TARIFF_BALANCE_NAME"             value="#{document('Config\Tariff\TARIFF_PLANS.xml')/TariffPlans/Tariff[@ivrcode='${sTariffIvrCode}']/@tariffname__GET_LANG}"/>
		<!-- ==========================  CHANGE TP  ========================= -->

		<!-- ==========================  ALL SERVICE   ========================= -->
		<define name="_COUNTERS_TYPE"                   value="#{document('Config\Service\COUNTERS.xml')/Counters/Group[_CURRENT_MODULE/@value='${sCountertype}']/@name}"/>
		<define name="_GET_ALL_SRV_RESULT"              value="#{document('Config\Service\All_SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/@info_${sDbresult}__GET_LANG}"/>
		<define name="_ALLSERVICE_TP_CNT"               value="count(document('Config\Service\All_SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/tplist[1][ivrcode/@value='#{//Message/Item/@tariffplan}'])"/>
		<define name="_ALLSERVICE_TP_ISAVAIL"               value="#{document('Config\Service\All_SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/tplist[1]/@available}"/>
		<define name="_ALLSERVICE_TP_NOTAVAILINFO"          value="#{document('Config\Service\All_SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/tplist[1]/@info_notaval__GET_LANG}"/>
		<define name="_ALLSERVICE_CUSTLST_CNT"          value="count(document('Config\Service\All_SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/customerlist[1]/customer[@value='${customer}'])"/>
		<define name="_ALLSERVICE_CUSTLST_ISAVAIL"          value="#{document('Config\Service\All_SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/customerlist[1]/@available}"/>
		<define name="_ALLSERVICE_CUSTLST_NOTAVAILINFO"     value="#{document('Config\Service\All_SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/customerlist[1]/@info_notaval__GET_LANG}"/>
		<define name="_ALLSERVICE_SRVBIND_CNT"          value="count(document('Config\Service\All_SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/servicebindinglist[1]/service)"/>
		<define name="_ALLSERVICE_SRVBIND_SRVCODE"          value="#{document('Config\Service\All_SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/servicebindinglist[1]/service[${sCnt}]/@service_code}"/>
		<define name="_ALLSERVICE_SRVBIND_SUBSR"            value="#{document('Config\Service\All_SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/servicebindinglist[1]/service[${sCnt}]/@subscription}"/>
		<define name="_ALLSERVICE_SRVBIND_STORE"            value="#{document('Config\Service\All_SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/servicebindinglist[1]/service[${sCnt}]/@store}"/>
		<define name="_ALLSERVICE_SRVBIND_INFO"             value="#{document('Config\Service\All_SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/servicebindinglist[1]/service[${sCnt}]/@info_notaval__GET_LANG}"/>
		<define name="_ALLSERVICE_SUCCESSFUL_RESPONSE"  value="#{document('Config\Service\All_SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/@successful_response}"/>
		<define name="_ALLSERVICE_CHECKBLOCK"           value="#{document('Config\Service\All_SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/@check_block}"/>
		<define name="_ALLSERVICE_REDIRECT"             value="#{document('Config\Service\All_SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/@redirect}"/>
		<define name="_ALLSERVICE_TIMETOPROGRESS"       value="#{document('Config\Service\All_SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/@timetoprogress}"/>
		<define name="_ALLSERVICE_AVAIL_BAL"            value="#{document('Config\Service\All_SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/@availbalance}"/>
		<define name="_ALLSERVICE_NAME"                 value="#{document('Config\Service\All_SERVICE.xml')/ServiceList/Service[_CURRENT_MODULE/@value='${sService}']/@name}"/>
		<!-- ==========================  ALL SERVICE   ========================= -->

		<!-- ==========================  SETTINGS   ========================= -->
		<define name="_WAIT_IFASYNC_INPROCESS"          value="#{if('${sDbresult}'='redirect','#{if(not(matches('${sInProgress}','_IF_TRUE')),'true','')}','')}"/>
		<define name="_GET_TODAY"                       value="#{concat(substring('@{now}',7,4),substring('@{now}',4,2),substring('@{now}',1,2))}"/>
		<define name="_GET_SECONDS"                     value="#{(number(substring('@{now}',12,2)) * 60 * 60) + (number(substring('@{now}',15,2)) * 60) + number(substring('@{now}',18,2))}"/>
		<define name="_GET_DBRESULT"                    value="#{document('Config\GET_DBRESULT.xml')/DBresults/Item[code/@value='${sDbresult}']/@info__GET_LANG}"/>
		<define name="_GET_LENGTH_DBRESULT"             value="#{string-length(document('Config\GET_DBRESULT.xml')/DBresults/Item[code/@value='${sDbresult}']/@info__GET_LANG)}"/>
		<define name="_GET_AFTER_VERIFY_DBRESULT"       value="#{if('#{document('Config\GET_DBRESULT.xml')/DBresults/Item[code/@value='${customerblocks}']/@info__GET_LANG}'!='','${customerblocks}','${dbresult}')}"/>
		<define name="_ENCODING"                        value="#{document('Config\Service\All_SERVICE.xml')/ServiceList/Language/lang[@param='_GET_LANG']/@encoding}"/>
		<define name="_INLANGUAGE"                      value="#{if('#{document('Config\Service\All_SERVICE.xml')/ServiceList/Language/lang[@scp='${inlang}' and @ussd='${smsussdlang}']/@param}'='','#{document('Config\Service\All_SERVICE.xml')/ServiceList/Language/lang[@scp='' and @ussd='']/@param}','#{document('Config\Service\All_SERVICE.xml')/ServiceList/Language/lang[@scp='${inlang}' and @ussd='${smsussdlang}']/@param}')}" />
		<define name="_GET_LANG"                        value="#{if('${sLang}'='','#{document('Config\Service\All_SERVICE.xml')/ServiceList/Language/lang[@scp='' and @ussd='']/@param}','${sLang}')}" />
		<define name="_DEFAULT_ERR"                     value="#{if('${dbresult}'='-1','err001','${dbresult}')}" />
		<define name="_REDIRECT_TO_SMS"                 value="^[Ss][Mm][Ss]$"/>
		<define name="_REDIRECT_TO_CURRENT"             value="^[Nn][Oo][Tt][Rr][Ee][Dd][Ii][Rr][Ee][Cc][Tt]$"/>
		<define name="_IF_TRUE"                         value="^([Tt][Rr][Uu][Ee]|1)$"/>
		<define name="_BYCRM"                           value="[Bb][Yy][Cc][Rr][Mm]"/>
		<define name="_CURRENT_MODULE"                  value="#{if('${sModule}'!='','${sModule}','soapcon')}" />
		<define name="_EXIST_MODULE"                    value="soapcon"/>
		<define name="_CONFIRM_VALUE"                   value="confirm"/>
		<define name="_CURRENT_INITIATOR"               value="pcrf"/>
		<!-- ==========================  SETTINGS   ========================= -->
	</macros>
	<template procedureName="ServiceProvisioning" sessionStorage="Memory" sessionLifetime="30">
		<condition>
		<condition>
			<test item="${Sender}" matches="^pcrf_huawei$"/>
			<test item="${Content}" matches="^(\d{12})_(.+)$"/>
		</condition>
		</condition>
		<receiveTemplate>
			<Message type="getlanguage" process="dispatcher" initiator="_CURRENT_INITIATOR" id="@{newGuid}" session_id="@{setSessionId(PCRF_SrvProv_${Recipient})}">
				<Item customer="${Recipient}"/>
				@{store(sCustomer,${Recipient})}
				@{store(sRecipient,${Sender})}
				@{store(sService,_PCRF_SERVICE)}
				@{store(sAction,2)}
				@{store(sModule,_CURRENT_MODULE)}
			</Message>
		</receiveTemplate>
		<deliveryTemplate conditionEx="false@{store(sLang,_INLANGUAGE)}"/>
		<deliveryTemplate conditionEx="#{'${dbresult}'!='0'}" call="ServiceStringFormat">
			<set conditionEx="0@{store(sDbresult,${dbresult})}"/>
			<set item="Content" value=""/>
		</deliveryTemplate>
		<deliveryTemplate call="ServiceProvisioning_Order_Step5"/>
	</template>
	<template procedureName="ServiceProvisioning_Order_Step5" sessionStorage="Memory" sessionLifetime="30" persistent="true">
		<condition>
			<test item="0" matches="1"/>
		</condition>
		<receiveTemplate>
			<Message type="serviceorder" initiator="_CURRENT_INITIATOR" id="@{newGuid}" session_id="${SessionId}">
				<Item customer="${sCustomer}">
					<Service id="${sService}" action="${sAction}" class="0"/>
				</Item>
			</Message>
		</receiveTemplate>
		<deliveryTemplate call="ServiceStringFormat">
			<set conditionEx="0@{store(SlowAsync,_WAIT_IFASYNC_INPROCESS)}"/>
			<set item="Content" conditionEx="#{'${dbresult}'='0'}" value="@{store(sDbresult,8800)}"/>
			<set item="Content" conditionEx="#{'${dbresult}'!='0'}" value="@{store(sDbresult,${dbresult})}"/>
		</deliveryTemplate>
	</template>
	<template procedureName="ServiceStringFormat" sessionStorage="Memory" sessionLifetime="30" persistent="false">
		<condition>
			<test item="0" matches="1"/>
		</condition>
		<receiveTemplate>
			<Message type="stringformat" process="dispatcher" initiator="_CURRENT_INITIATOR" id="@{newGuid}" session_id="${SessionId}">
				<Item customer="${sCustomer}">
					<Attribute name="stringformat" value="#{if('${Content}'='','_GET_SERVICE_RESULT','${Content}')}@{store(SlowAsync,)}"/>
					<Attribute name="params" value="${sParams}"/>
					<Attribute name="split" value=";"/>
				</Item>
			</Message>
		</receiveTemplate>
		<deliveryTemplate conditionEx="#{not(matches('${sInProgress}','_IF_TRUE')) and ('${sDbresult}'='redirect' or matches('${SlowAsync}','_IF_TRUE'))}">
			<set conditionEx="0@{store(sInProgress,true)}"/>
			<set conditionEx="0@{store(sStartSecond,_GET_SECONDS)}"/>
			<set item="Content" value="${no-escape:result}"/>
			<set item="Sender" value="${sRecipient}"/>
			<set item="Recipient" value="${customer}"/>
			<set item="UssdServiceOp" value="1"/>
			<set item="Encoding" value="_ENCODING"/>
		</deliveryTemplate>
		<deliveryTemplate conditionEx="false@{store(sIsFreeSession,#{if(number(_SERVICE_TIMETOPROGRESS)&gt;0,'false','true')})}"/>
		<deliveryTemplate conditionEx="#{matches('${sInProgress}','_IF_TRUE') and matches('_SERVICE_REDIRECT','_REDIRECT_TO_SMS') and not(matches('${sDbresult}','inprogress_|alrprogress_|_CONFIRM_VALUE|inprogress'))}" connector="_SMSCON_1"/>
		<deliveryTemplate conditionEx="#{'${dbresult}'='0' and matches('${sDbresult}','inprogress_|alrprogress_|_CONFIRM_VALUE|inprogress')}">
			<set item="Content" value="${no-escape:result}"/>
			<set item="Sender" value="${sRecipient}"/>
			<set item="Recipient" value="${customer}"/>
			<set item="Encoding" value="_ENCODING"/>
		</deliveryTemplate>
		<deliveryTemplate conditionEx="#{'${dbresult}'='0' and (not(matches('${sDbresult}','success')) or matches('${sIsFreeSession}','_IF_TRUE'))}">
			<set item="Content" value="${no-escape:result}"/>
			<set item="Sender" value="${sRecipient}"/>
			<set item="Recipient" value="${customer}"/>
			<set item="Encoding" value="_ENCODING"/>
			<set conditionEx="0@{freeSession}"/>
		</deliveryTemplate>
		<deliveryTemplate conditionEx="#{'${dbresult}'='0' and not(matches('${sIsFreeSession}','_IF_TRUE'))}">
			<set conditionEx="0@{store(sStartSecond,_GET_SECONDS)}"/>
			<set item="Content" value="${no-escape:result}"/>
			<set item="Sender" value="${sRecipient}"/>
			<set item="Recipient" value="${customer}"/>
			<set item="Encoding" value="_ENCODING"/>
		</deliveryTemplate>
		<deliveryTemplate conditionEx="#{'${customer}'!='' and matches('@{SessionExists(${session_id})}','_IF_TRUE')}">
			<set conditionEx="0@{store(sDbresult,_DEFAULT_ERR)}" />
			<set item="Content" value="_GET_DBRESULT"/>
			<set item="Recipient" value="${customer}"/>
			<set item="Sender" value="${sRecipient}"/>
			<set item="Encoding" value="_ENCODING"/>
			<set conditionEx="0@{freeSession}"/>
		</deliveryTemplate>
		<deliveryTemplate conditionEx="true@{freeSession}" dropReply="true"/>
	</template>
</templates>