<Command Name="SC.CreateTD">
  <Description>CreateTDOnFINPlatform</Description>
  <Author Name="Victor Kosonogov" Date="2017-05-01+01:01" />
  <Properties GenerationType="DataSetXml" />
  <Request>
    <RequestTemplate>
      <![CDATA[<DataSet Name="CreateTDCDataSet" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <Attributes>
    <Attribute Name="Label" Type="System.String" Value="CreateTDC;##datetime##;SPA"/>
    <Attribute Name="Protocol" Type="System.String" Value="Remoting"/>
  </Attributes>
  <DataTable Name="CreateTDCDataTable">
    <Columns>
      <Column Name="REQUEST_ID" Type="System.String"/>
      <Column Name="PERSONAL_ACCOUNT_ID" Type="System.Int64"/>
      <Column Name="TERMINAL_DEVICE_CONTRACT_ID" Type="System.Int64"/>
      <Column Name="TARIFF_PLAN_ID" Type="System.Int32"/>
      <Column Name="BILLING_GROUP_ID" Type="System.Int64"/>
      <Column Name="TERMINAL_DEVICE_STATE" Type="System.Int32"/>
      <Column Name="ADMIN_BLOCK" Type="System.Int32"/>
      <Column Name="ADMIN_BLOCKED_DATE" Type="System.DateTime"/>
      <Column Name="FIRST_CALL_END_DATE" Type="System.DateTime"/>
      <Column Name="MAX_INACTIVE_PERIOD" Type="System.Int32"/>
      <Column Name="MSISDN" Type="System.String"/>
      <Column Name="IMSI" Type="System.String"/>
      <Column Name="LANGUAGE" Type="System.String"/>
      <Column Name="TIME_ZONE" Type="System.Int32"/>
      <Column Name="PRIVATE_USER_GROUPS" Type="System.String"/>
      <Column Name="TERMINAL_DEVICE_CLASS" Type="System.Int32"/>
      <Column Name="SMS_USSD_LANG" Type="System.Int32"/>
    </Columns>
    <Rows>
      <Row REQUEST_ID="##ASYNC_REQUEST_ID##" PERSONAL_ACCOUNT_ID="##PersonalAccount##" TERMINAL_DEVICE_CONTRACT_ID="##TerminalDeviceID##" 
TARIFF_PLAN_ID="##TARIFF_PLAN_ID##" BILLING_GROUP_ID="##BILLING_GROUP_ID##" TERMINAL_DEVICE_STATE="##SC.TERMINAL_DEVICE_STATE##" ##SC.ADMIN_BLOCK## 
##SC.ADMIN_BLOCKED_DATE## ##SC.FIRST_CALL_END_DATE## MAX_INACTIVE_PERIOD="##SC.MAX_INACTIVE_PERIOD##" MSISDN="##msisdn##" IMSI="##imsi##" LANGUAGE="##LANGUAGE##" 
TIME_ZONE="##SC.TIME_ZONE##" PRIVATE_USER_GROUPS="##PRIVATE_USER_GROUPS##" TERMINAL_DEVICE_CLASS="##TERMINAL_DEVICE_CLASS##" SMS_USSD_LANG="##SC.SMS_USSD_LANG##" />
    </Rows>
  </DataTable>
  <DataTable Name="ServiceCodeDataTable">
    <Columns>
      <Column Name="SERVICE_ROW_ID" Type="System.Int64"/>
      <Column Name="REQUEST_ID" Type="System.String"/>
      <Column Name="PERSONAL_ACCOUNT_ID" Type="System.Int64"/>
      <Column Name="TERMINAL_DEVICE_CONTRACT_ID" Type="System.Int64"/>
      <Column Name="SERVICE_CODE" Type="System.String"/>
      <Column Name="DATE_FROM" Type="System.DateTime"/>
      <Column Name="DATE_TO" Type="System.DateTime"/>
      <Column Name="COUNTER_COEFFICIENT" Type="System.Decimal"/>
      <Column Name="DISCOUNT_TYPE" Type="System.Decimal"/>
      <Column Name="DISCOUNT_VALUE" Type="System.String"/>
    </Columns>
    <Rows>##RegisteredServices##</Rows>
  </DataTable>
  <DataTable Name="ServiceParameters">
    <Columns>
      <Column Name="SERVICE_ROW_ID" Type="System.Int64"/>
      <Column Name="PARAM_CODE" Type="System.String"/>
      <Column Name="PARAM_VALUE" Type="System.String"/>
    </Columns>
    <Rows>##Parameters##</Rows>
  </DataTable>
</DataSet>]]>
    </RequestTemplate>
    <Item Name="datetime" Type="Wellknown" />
    <Item Name="PersonalAccount" Type="Wellknown" />
    <Item Name="TerminalDeviceID" Type="Wellknown" />
    <Item Name="TARIFF_PLAN_ID" Type="Parameter" />
    <Item Name="BILLING_GROUP_ID" Type="Parameter" />
    <Item Name="SC.TERMINAL_DEVICE_STATE" Type="Parameter" />
    <Item Name="SC.ADMIN_BLOCK" Type="LocalParameter" />
    <Item Name="SC.ADMIN_BLOCKED_DATE" Type="LocalParameter" />
    <Item Name="SC.FIRST_CALL_END_DATE" Type="Parameter" />
    <Item Name="SC.MAX_INACTIVE_PERIOD" Type="Parameter" />
    <Item Name="msisdn" Type="Wellknown" />
    <Item Name="imsi" Type="Wellknown" />
    <Item Name="LANGUAGE" Type="Parameter" />
    <Item Name="SC.TIME_ZONE" Type="Parameter" />
    <Item Name="PRIVATE_USER_GROUPS" Type="Constant" />
    <Item Name="TERMINAL_DEVICE_CLASS" Type="Parameter" />
    <Item Name="SC.SMS_USSD_LANG" Type="Parameter" />
    <Item Name="RegisteredServices" Type="LocalDynamicParameter" />
    <Item Name="Parameters" Type="LocalDynamicParameter" />
  </Request>
  <RollbackRequest>
    <RequestTemplate>
      <![CDATA[<DataSet Name="DeleteTDCDataSet" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <Attributes>
    <Attribute Name="Label" Type="System.String" Value="DeleteTerminalDeviceContracts;##datetime##;SPA"/>
    <Attribute Name="Protocol" Type="System.String" Value="Remoting"/>
  </Attributes>
  <DataTable Name="DeleteTDCDataTable">
    <Columns>
      <Column Name="REQUEST_ID" Type="System.String"/>
      <Column Name="PERSONAL_ACCOUNT_ID" Type="System.Int64"/>
      <Column Name="TERMINAL_DEVICE_CONTRACT_ID" Type="System.Int64"/>
    </Columns>
    <Rows>
      <Row REQUEST_ID="##ASYNC_REQUEST_ID##" PERSONAL_ACCOUNT_ID="##PersonalAccount##" TERMINAL_DEVICE_CONTRACT_ID="##TerminalDeviceID##"/>
    </Rows>
  </DataTable>
</DataSet>]]>
    </RequestTemplate>
    <Item Name="datetime" Type="Wellknown" />
    <Item Name="PersonalAccount" Type="Wellknown" />
    <Item Name="TerminalDeviceID" Type="Wellknown" />
  </RollbackRequest>
  <ParametersList>
    <Parameter Name="SC.ADMIN_BLOCK">
      <Source Path="//AdditionalData/AddList//TdStatus/BlockStatus" AbsenceValue="" PostFormat="ADMIN_BLOCK=&quot;{0}&quot;" />
      <PossibleValues StringToKeyTable="true" />
    </Parameter>
    <Parameter Name="SC.ADMIN_BLOCKED_DATE">
      <Source Path="//AdditionalData/AddList//TdStatus/AdminBlockedDate[string-length(.) &gt; 0]" AbsenceValue="" PostFormat="ADMIN_BLOCKED_DATE=&quot;{0}&quot;" />
      <PossibleValues StringToKeyTable="true" />
    </Parameter>
  </ParametersList>
  <DynamicParametersList>
    <DynamicParameter Name="RegisteredServices">
      <Source Path="//string" />
      <DynamicObject Name="RegisteredServices" SkipMissed="True" />
    </DynamicParameter>
    <DynamicParameter Name="Parameters">
      <Source Path="//string" />
      <DynamicObject Name="RegisteredServicesParams" SkipMissed="True" />
    </DynamicParameter>
  </DynamicParametersList>
  <ErrorsList CodePage="ascii">
    <Error Name="ERROR_CODE&gt;-154018&lt;" Value="SUCCESS" />
  </ErrorsList>
</Command>