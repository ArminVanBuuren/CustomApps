<templates connector="SOAP">
	<macros>
		<define name="_SMSCON" value="SMSCON_01" />
	</macros>
	<!--template procedureName="ReplacementPossibility">
    <receiveTemplate>
      <Message type="canchangesim" initiator="jrm" id="${guid}" session_id="@{newGuid}">
        <Item customer="${MSISDN}">
          <Attribute name="operatorlogin" value="${OperatorLogin}" />
          <Attribute name="changesimtype" value="${ChangeSimType}" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:ResultCode" value="-999" />
      <set item="oparam:ResultCode" conditionEx="#{number(${tdstatus})=-1}" value="${tdstatus}" />
      <set item="oparam:ResultCode" conditionEx="#{number(${tdstatus})=1}" value="${tdstatus}" />
      <set item="oparam:ResultCode" conditionEx="#{number(${tdstatus})>=-12 and -4>=number(${tdstatus})}" value="${tdstatus}" />
      <set item="oparam:ResultCode" conditionEx="#{number(${tdstatus})=0}" value="${tdstatus}" />
      <set item="oparam:IMSI" value="${imsi}" />
    </deliveryTemplate>
    <input>
        <param name="MSISDN" />
        <param name="ChangeSimType" />
        <param name="OperatorLogin" />
    </input>
    <output>
        <param name="ResultCode" />
        <param name="IMSI" />
    </output>
  </template-->
   <template procedureName="ReplacementPossibility" handler="DBCON_01" sessionStorage="Memory" sessionLifetime="60" onClean="ChangeTP_onClean">
    <receiveTemplate>
      <Message initiator="ussd" id="@{setMessageId(@{newGuid})}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="MG.UMC_GET_PoP_block">	
			<Attribute name="p_msisdn" type="STRING" value="${MSISDN}" />
			<Attribute name="p_ChangeSimType" type="STRING" value="${ChangeSimType}" />
			<Attribute name="p_OperatorLogin" type="STRING" value="${OperatorLogin}" />
			<Attribute name="p_msisdn1" type="STRING" />
			<Attribute name="p_ChangeSimType1" type="STRING" />
			<Attribute name="p_OperatorLogin1" type="STRING" />
			<Attribute name="p_db_result" type="STRING" />
			<Attribute name="p_imsi" type="STRING" />			
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{${p_db_result}='0'}" call="ReplacementPossibility2">
      <set item="iparam:MSISDN" value="${p_msisdn1}" />
      <set item="iparam:ChangeSimType" value="${p_ChangeSimType1}" />
	    <set item="iparam:OperatorLogin" value="${p_OperatorLogin1}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:ResultCode" value="${p_db_result}" />
	    <set item="oparam:IMSI" value="${p_imsi}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <input>
        <param name="MSISDN" />
        <param name="ChangeSimType" />
        <param name="OperatorLogin" />
    </input>
    <output>
        <param name="ResultCode" />
        <param name="IMSI" />
    </output>
  </template>
  
  <template procedureName="ReplacementPossibility2" sessionStorage="Memory" sessionLifetime="60">
    <receiveTemplate>
      <Message type="canchangesim" initiator="jrm" id="${guid}" session_id="@{newGuid}">
        <Item customer="${MSISDN}">
          <Attribute name="operatorlogin" value="NT AUTHORITY\SYSTEM" />
          <Attribute name="changesimtype" value="${ChangeSimType}" />
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:ResultCode" value="-999" />
      <set item="oparam:ResultCode" conditionEx="#{number(${tdstatus})=-1}" value="${tdstatus}" />
      <set item="oparam:ResultCode" conditionEx="#{number(${tdstatus})=1}" value="${tdstatus}" />
      <set item="oparam:ResultCode" conditionEx="#{number(${tdstatus})>=-12 and -4>=number(${tdstatus})}" value="${tdstatus}" />
      <set item="oparam:ResultCode" conditionEx="#{number(${tdstatus})=0}" value="${tdstatus}" />
      <set item="oparam:IMSI" value="${imsi}" />
	  <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <input>
        <param name="MSISDN" />
        <param name="ChangeSimType" />
        <param name="OperatorLogin" />
    </input>
    <output>
        <param name="ResultCode" />
        <param name="IMSI" />
    </output>
  </template>
  
  <template procedureName="DB_PrP2PoPMigrationPossibility">
    <receiveTemplate>
      <Message type="prp2popmigrationpossibility" initiator="jrm" id="${guid}" session_id="@{newGuid}">
        <Item customer="${customer}" />
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
	<!--set item="oparam:ICCID" conditionEx!="#{${dbresult}=0}" value="" /-->
      <set item="oparam:ResultCode" value="UnknownError" />
      <set item="oparam:ResultCode" conditionEx="#{${dbresult}=0}" value="OK" />
      <set item="oparam:ResultCode" conditionEx="#{${dbresult}=320341}" value="InvalidNumber" />
      <set item="oparam:ResultCode" conditionEx="#{${dbresult}=320347}" value="PhoneBlocked" />
      <set item="oparam:ResultCode" conditionEx="#{${dbresult}=320191}" value="NotEnoughMoney" />
      <set item="oparam:ResultCode" conditionEx="#{${dbresult}=321003}" value="MigratedFromPoP" />
      <set item="oparam:ResultCode" conditionEx="#{${dbresult}=321004}" value="AlreadyMigrated" />
      <set item="oparam:ResultCode" conditionEx="#{${dbresult}=321005}" value="ProhibitedTariff" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="ResultCode" value=""/>
      <param name="ICCID" value=""  />
      <param name="IMSI" value=""  />
    </output>
  </template>  
  <template procedureName="DB_PrP2PoPMigrationProcess" sessionStorage="Memory" sessionLifetime="60" persistent="true">
    <receiveTemplate>
      <Message type="prp2popmigrationprocess" initiator="jrm" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item customer="${Customer}" imsi="${IMSI}" startmigration="${StartMigration}"/>
        @{store(sStartMigration,${StartMigration})}
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:ResultCode" value="UnknownError" />
      <set item="oparam:ResultCode" conditionEx="#{${dbresult}=0}" value="OK" />
      <set item="oparam:ResultCode" conditionEx="#{${dbresult}=321002}" value="InvalidStatus" />
      <set item="oparam:ResultCode" conditionEx="#{${dbresult}=320341}" value="InvalidNumber" />
      <set item="oparam:ResultCode" conditionEx="#{${dbresult}=321001}" value="MSISDN_IMSI_mismatch" />
      <set item="oparam:RequestId" conditionEx="#{'${sStartMigration}'='0' or ${dbresult}!=0}" value="" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <input>
      <param name="Customer" />
      <param name="IMSI" />
      <param name="StartMigration" />
    </input>
    <output>
      <param name="Status" value=""  />
	  <param name="ResultCode" value=""/>
      <param name="RequestId" value=""  />
    </output>
  </template>
  
  
  <template procedureName="DB_PrP2PoPGetServiceStatus">
    <receiveTemplate>
      <Message type="prp2popgetservicestatus" initiator="jrm" id="${guid}" session_id="@{newGuid}">
        <Item customer="${Customer}" serviceid="${ServiceID}"/>
      </Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:ResultCode" value="UnknownError" />
      <set item="oparam:ResultCode" conditionEx="#{${dbresult}=0}" value="OK" />
      <set item="oparam:ResultCode" conditionEx="#{${dbresult}=320341}" value="InvalidNumber" />
      <set item="oparam:ServiceStatus" conditionEx="#{${dbresult}!=0}" value="" />
    </deliveryTemplate>
    <input>
      <param name="Customer" />
      <param name="ServiceID" />
    </input>
    <output>
      <param name="ResultCode" value=""/>
      <param name="ServiceStatus" value="" />
    </output>
  </template>
  
   
	    <template procedureName="ChangeSIMInitiation2" handler="DBCON_01" sessionStorage="Memory" sessionLifetime="60" onClean="ChangeTP_onClean">
    <receiveTemplate>
      <Message initiator="ussd" id="@{setMessageId(@{newGuid})}" session_id="@{setSessionId(@{newGuid})}">
        <Item procedureName="MG.umc_get_lol_block">	
			<Attribute name="p_msisdn" type="STRING" value="${MSISDN}" />
			<Attribute name="p_NewIMSI" type="STRING" value="${NewIMSI}" />
			<Attribute name="p_ChangeSimType" type="STRING" value="${ChangeSimType}" />
			<Attribute name="p_SourceMeans" type="STRING" value="${SourceMeans}" />
			<Attribute name="p_IsTarification" type="STRING" value="${IsTarification}" />
			<Attribute name="p_OperatorLogin" type="STRING" value="${OperatorLogin}" />
			<Attribute name="p_msisdn1" type="STRING" />
			<Attribute name="p_NewIMSI1" type="STRING" />
			<Attribute name="p_ChangeSimType1" type="STRING" />
			<Attribute name="p_SourceMeans1" type="STRING" />
			<Attribute name="p_IsTarification1" type="STRING" />
			<Attribute name="p_OperatorLogin1" type="STRING" />
			<Attribute name="p_db_result" type="STRING" />	
        </Item>
      </Message>
    </receiveTemplate>
    <deliveryTemplate conditionEx="#{${p_db_result}='0'}" call="ChangeSIMInitiation2">
      <set item="iparam:MSISDN" value="${p_msisdn1}" />
      <set item="iparam:NewIMSI" value="${p_NewIMSI1}" />
      <set item="iparam:ChangeSimType" value="${p_ChangeSimType1}" />
      <set item="iparam:SourceMeans" value="${p_SourceMeans1}" />
      <set item="iparam:IsTarification" value="${p_IsTarification1}" />
      <set item="iparam:OperatorLogin" value="${p_OperatorLogin1}" />
    </deliveryTemplate>
    <deliveryTemplate>
      <set item="oparam:ResultCode" value="-155" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <input>
          <param name="MSISDN" />
          <param name="NewIMSI" />
          <param name="ChangeSimType" />
          <param name="SourceMeans" />
          <param name="IsTarification" />
          <param name="OperatorLogin" />
    </input>
    <output>
          <param name="ResultCode" />
    </output>
  </template>

	  
    <template procedureName="ChangeSIMInitiation">
      <receiveTemplate>
        <Message type="changesim" initiator="jrm" id="${guid}" session_id="@{newGuid}">
          <Item customer="${MSISDN}">
            <Attribute name="operatorlogin" value="NT AUTHORITY\SYSTEM" />
            <Attribute name="changesimtype" value="${ChangeSimType}" />
            <Attribute name="sourcemeans" value="${SourceMeans}" />
            <Attribute name="newimsi" value="${NewIMSI}" />
            <Attribute name="istarification" value="${IsTarification}" />
          </Item>
        </Message>
      </receiveTemplate>
      <!--deliveryTemplate>
        <set item="oparam:ResultCode" value="-999" />
        <set item="oparam:ResultCode"  conditionEx="#{number(${requestid})=-10}" value="-10" />
        <set item="oparam:ResultCode"  conditionEx="#{number(${requestid})=-12}" value="-12" />
        <set item="oparam:ResultCode"  conditionEx="#{number(${requestid})=-20}" value="-20" />
        <set item="oparam:ResultCode"  conditionEx="#{number(${requestid})=-1}" value="-1" />   
        <set item="oparam:ResultCode"  conditionEx="#{number(${requestid})=-22}" value="-22" />   
        <set item="oparam:ResultCode"  conditionEx="#{number(${requestid})=-23}" value="-23" />   
        <set item="oparam:ResultCode"  conditionEx="#{number(${requestid})=-24}" value="-24" />
        <set item="oparam:ResultCode"  conditionEx="#{number(${requestid})=-25}" value="-25" />   
        <set item="oparam:ResultCode"  conditionEx="#{number(${requestid})=-26}" value="-12" />          
        <set item="oparam:ResultCode"  conditionEx="#{number(${requestid})>0}" value="${requestid}" />                 
        </deliveryTemplate-->
		<!--504 15-03-2015 FORIS.MessagingGateway.Templates 11.40.4-->
  <deliveryTemplate>
	<set item="oparam:ResultCode" value="-999" />
	<set item="oparam:ResultCode"  conditionEx="#{number(${requestid})=-10}" value="-10" />
	<set item="oparam:ResultCode"  conditionEx="#{number(${requestid})=-12}" value="-12" />
	<set item="oparam:ResultCode"  conditionEx="#{number(${requestid})=-20}" value="-20" />
	<set item="oparam:ResultCode"  conditionEx="#{number(${requestid})=-1}" value="-1" />   
	<set item="oparam:ResultCode"  conditionEx="#{number(${requestid})=-22}" value="-22" />   
	<set item="oparam:ResultCode"  conditionEx="#{number(${requestid})=-23}" value="-23" />   
	<set item="oparam:ResultCode"  conditionEx="#{number(${requestid})=-24}" value="-24" />
	<set item="oparam:ResultCode"  conditionEx="#{number(${requestid})=-25}" value="-25" />   
	<set item="oparam:ResultCode"  conditionEx="#{number(${requestid})=-26}" value="-12" />
	<set item="oparam:ResultCode"  conditionEx="#{number(${requestid})=-21}" value="-21" />
	<set item="oparam:ResultCode"  conditionEx="#{number(${requestid})=-320203}" value="-5" />           
	<set item="oparam:ResultCode"  conditionEx="#{number(${requestid})>0}" value="${requestid}" />                 
	<set item="oparam:ResultCode"  conditionEx="#{'${dbresult}'='0' and '${requestid}'=''}" value="0" />   
  </deliveryTemplate>

        <input>
          <param name="MSISDN" />
          <param name="NewIMSI" />
           <param name="ChangeSimType" />
          <param name="SourceMeans" />
          <param name="IsTarification" />
         <param name="OperatorLogin" />
        </input>
        <output>
          <param name="ResultCode" />
        </output>
      </template>

   
    <!--template procedureName="ChangeSIMInitiation">
      <receiveTemplate>
        <Message type="changesim" initiator="jrm" id="${guid}" session_id="@{newGuid}">
          <Item customer="${MSISDN}">
            <Attribute name="operatorlogin" value="${OperatorLogin}" />
            <Attribute name="changesimtype" value="${ChangeSimType}" />
            <Attribute name="sourcemeans" value="${SourceMeans}" />
            <Attribute name="newimsi" value="${NewIMSI}" />
            <Attribute name="istarification" value="${IsTarification}" />
          </Item>
        </Message>
      </receiveTemplate>
      <deliveryTemplate>
        <set item="oparam:ResultCode" value="-999" />
        <set item="oparam:ResultCode"  conditionEx="#{number(${requestid})=-10}" value="-10" />
        <set item="oparam:ResultCode"  conditionEx="#{number(${requestid})=-12}" value="-12" />
        <set item="oparam:ResultCode"  conditionEx="#{number(${requestid})=-20}" value="-20" />
        <set item="oparam:ResultCode"  conditionEx="#{number(${requestid})=-1}" value="-1" />   
        <set item="oparam:ResultCode"  conditionEx="#{number(${requestid})=-22}" value="-22" />   
        <set item="oparam:ResultCode"  conditionEx="#{number(${requestid})=-23}" value="-23" />   
        <set item="oparam:ResultCode"  conditionEx="#{number(${requestid})=-24}" value="-24" />
        <set item="oparam:ResultCode"  conditionEx="#{number(${requestid})=-25}" value="-25" />   
        <set item="oparam:ResultCode"  conditionEx="#{number(${requestid})=-26}" value="-12" />          
        <set item="oparam:ResultCode"  conditionEx="#{number(${requestid})>0}" value="${requestid}" />                 
        </deliveryTemplate>
        <input>
          <param name="MSISDN" />
          <param name="NewIMSI" />
           <param name="ChangeSimType" />
          <param name="SourceMeans" />
          <param name="IsTarification" />
         <param name="OperatorLogin" />
        </input>
        <output>
          <param name="ResultCode" />
        </output>
      </template-->

  <!--template procedureName="ChangeSIMInitiation">
      <receiveTemplate>
        <Message type="changesim" initiator="jrm" id="${guid}" session_id="@{newGuid}">
          <Item customer="${MSISDN}">
            <Attribute name="operatorlogin" value="${OperatorLogin}" />
            <Attribute name="changesimtype" value="${ChangeSimType}" />
            <Attribute name="sourcemeans" value="${SourceMeans}" />
            <Attribute name="newimsi" value="${NewIMSI}" />
            <Attribute name="istarification" value="${IsTarification}" />
          </Item>
        </Message>
      </receiveTemplate>
      <deliveryTemplate>
        <set item="oparam:ResultCode" value="-999" />
        <set item="oparam:ResultCode" conditionEx="#{number(${tdstatus})>=-13 and 2>=number(${${tdstatus})}" value="${tdstatus}" />
        </deliveryTemplate>
        <input>
          <param name="MSISDN" />
          <param name="NewIMSI" />
           <param name="ChangeSimType" />
          <param name="SourceMeans" />
          <param name="IsTarification" />
         <param name="OperatorLogin" />
        </input>
        <output>
          <param name="ResultCode" />
        </output>
      </template-->
      <template procedureName="CheckChangeSIMStatus">
        <receiveTemplate>
          <Message type="getchangesimstatus" initiator="jrm" id="${guid}" session_id="@{newGuid}">
            <Item request="${ReqID}">
              <Attribute name="operatorlogin" value="${OperatorLogin}" />
            </Item>
          </Message>
        </receiveTemplate>
        <deliveryTemplate>
          <set item="oparam:ResultCode" value="-999" />
          <set item="oparam:ResultCode" conditionEx="#{'${tdstatus}'='-1'}" value="${tdstatus}" />
          <set item="oparam:ResultCode" conditionEx="#{'${tdstatus}'='-2'}" value="${tdstatus}" />
          <set item="oparam:ResultCode" conditionEx="#{'${tdstatus}'='0'}" value="${requeststatus}" />
        </deliveryTemplate>
        <input>
          <param name="ReqID" />
          <param name="OperatorLogin" />
        </input>
        <output>
          <param name="ResultCode" />
        </output>
      </template>
	  
<!-- FORIS.MessagingGateway.Templates 10.10.18 --> 
<template procedureName="GetCBCountersAcync">
  <receiveTemplate>
	  <Message type="retrievecustomerdata" initiator="smscon" id="${guid}" session_id="UNIBALANCE">
		  <Item customer="${customer}" subject="balance">
			  <Attribute name="requestcountertype" value="3"/>
		  </Item>
	  </Message>
	</receiveTemplate>
	<deliveryTemplate direction="input" terminating="false">
		<set item="oparam:dbresult" value="0" /> 
	</deliveryTemplate>
	<deliveryTemplate connector="_SMSCON" /> 
	<input>
		<param name="customer" /> 
	</input>
	<output>
		<param name="dbresult" /> 
	</output>
</template>
<!-- FORIS.MessagingGateway.Templates 10.10.18 --> 

</templates>