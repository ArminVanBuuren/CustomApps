<templateGroup name="SMSPackageMG">
	<macros>
		<define name="_SMS_SERVICE_NUMBER" value="606"/>
	</macros>
	<template procedureName="Add">
		<condition>
			<test item="${Recipient}" matches="^_SMS_SERVICE_NUMBER$"/>
			<test item="${Content}" matches="^(1801)$|^(1802)$|^(1803)$|^(1804)$"/>
		</condition>
		<receiveTemplate>
			<Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{newGuid}">
				<Item customer="${Sender}">
					<Service id="@{switch(${token0}|,1801|FRPOPCR252A,1802|FRPOPCR252B,1803|FRPOPCR252A1,1804|FRPOPCR252B1)}" action="2" class="0"/>
				</Item>
			</Message>
		</receiveTemplate>
		<deliveryTemplate conditionEx="#{${dbresult} != 0}" forward="ServiceOrderErrorHandler.SendProvisionErrorMessage" terminating="false"/>
		<deliveryTemplate conditionEx="#{${dbresult}=document('c:\Foris\Messaging Gateway\config\SelfDescriptiveCodes.xml')/dbresults/dbresult}" forward="ServiceOrderErrorHandler.SendCRMErrorMessage"/>
		<deliveryTemplate>
			<set item="Content" value="Ошибка при добавлении услуги"/>
			<set item="Content" condition="//Item/@dbresult=0" value="Заявка принята"/>
			<set item="Content" condition="//Item/@dbresult=320203" value="Добавление услуги невозможно пока не завершится предыдущая операция"/>
			<set item="Content" condition="//Item/@dbresult=320204" value="Услуга не предоставляется для Вашего тарифного плана"/>
			<set item="Content" condition="//Item/@dbresult=320205" value="Услуга была добавлена ранее"/>
			<set item="Content" condition="//Item/@dbresult=320191" value="Недостаточно средств на балансе  для проведения операции"/>
			<set item="Content" condition="//Item/@dbresult=320194" value="Услуга Вам недоступна"/>
			<set item="Content" condition="//Item/@dbresult=-1" value="Данный запрос не может быть выполнен"/>
			<set item="Encoding" value="unicodefffe"/>
			<set item="Sender" value="_SMS_SERVICE_NUMBER"/>
			<set item="Recipient" value="${customer}"/>
		</deliveryTemplate>
	</template>
	<template procedureName="Del">
		<condition>
			<test item="${Recipient}" matches="^_SMS_SERVICE_NUMBER$"/>
			<test item="${Content}" matches="^(1901)$|^(1902)$|^(1903)$|^(1904)$"/>
		</condition>
		<receiveTemplate>
			<Message type="serviceorder" initiator="smscon" id="${guid}" session_id="@{newGuid}">
				<Item customer="${Sender}">
					<Service id="@{switch(${token0}|,1901|FRPOPCR252A,1902|FRPOPCR252B,1903|FRPOPCR252A1,1904|FRPOPCR252B1)}" action="3" class="0"/>
				</Item>
			</Message>
		</receiveTemplate>
		<deliveryTemplate conditionEx="#{${dbresult} != 0}" forward="ServiceOrderErrorHandler.SendProvisionErrorMessage" terminating="false"/>
		<deliveryTemplate conditionEx="#{${dbresult}=document('c:\Foris\Messaging Gateway\config\SelfDescriptiveCodes.xml')/dbresults/dbresult}" forward="ServiceOrderErrorHandler.SendCRMErrorMessage"/>
		<deliveryTemplate>
			<set item="Content" value="Ошибка при удалении услуги"/>
			<set item="Content" condition="//Item/@dbresult=0" value="Заявка принята"/>
			<set item="Content" condition="//Item/@dbresult=320203" value="Удаление услуги невозможно пока не завершится предыдущая операция"/>
			<set item="Content" condition="//Item/@dbresult=320204" value="Услуга не предоставляется для Вашего тарифного плана"/>
			<set item="Content" condition="//Item/@dbresult=320205" value="Услуга была добавлена ранее"/>
			<set item="Content" condition="//Item/@dbresult=320191" value="Недостаточно средств на балансе  для проведения операции"/>
			<set item="Content" condition="//Item/@dbresult=320194" value="Услуга Вам недоступна"/>
			<set item="Content" condition="//Item/@dbresult=-1" value="Данный запрос не может быть выполнен"/>
			<set item="Encoding" value="unicodefffe"/>
			<set item="Sender" value="_SMS_SERVICE_NUMBER"/>
			<set item="Recipient" value="${customer}"/>
		</deliveryTemplate>
	</template>
</templateGroup>
