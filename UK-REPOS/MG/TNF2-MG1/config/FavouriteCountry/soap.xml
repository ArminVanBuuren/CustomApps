<templateGroup name="FavouriteCountry">

	<macros>
  		<define name="_SMSCON" value="SMSCON_01" />
	</macros>

	<template procedureName="DB_AddFavouriteCountry" sessionStorage="Memory" sessionLifetime="29">
		<receiveTemplate>
			<Message type="serviceorder" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
				<Item customer="${customer}">
					<Service id="#{document('C:\Foris\Messaging Gateway\config\Common\FavouriteCountry.xml')/favcountries/favcountry[@soapcode='${favouritecountry}']/@crmcode}" action="2" needtariffication="0">
						<Attribute name="isparametricaldiscount" value="1" />
					</Service>
				</Item>
				@{store(sSessionExists,1)}
			</Message>
		</receiveTemplate>
		<deliveryTemplate conditionEx="#{'${sSessionExists}'='1'}">
    		<set conditionEx="0@{freeSession}" />
		</deliveryTemplate>
		<deliveryTemplate connector="_SMSCON" call="FavouriteCountry.AddFavouriteCountry" />
		<input>
			<param name="customer" />
			<param name="favouritecountry" />
		</input>
		<output>
			<param name="dbresult" />
		</output>
	</template>

	<template procedureName="DB_GetFavouriteCountry" sessionStorage="Memory" sessionLifetime="29">
		<receiveTemplate>
			<Message type="retrievecustomerdata" initiator="ivrcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
				<Item customer="${customer}" subject="get_parametrical_discount">
					<Attribute name="service_id" value="#{document('C:\Foris\Messaging Gateway\config\Common\FavouriteCountry.xml')/favcountries/favcountry[@soapcode='${favouritecountry}']/@crmcode}" />
				</Item>
				@{store(sSessionExists,1)}
			</Message>
		</receiveTemplate>
		<deliveryTemplate conditionEx="#{'${sSessionExists}'='1'}">
			<set conditionEx="0@{freeSession}"  />
		</deliveryTemplate>
		<deliveryTemplate connector="_SMSCON" call="FavouriteCountry.GetFavouriteCountry" />
		<input>
			<param name="customer" />
			<param name="favouritecountry" />
		</input>
		<output>
			<param name="dbresult" />
			<param name="service_id" />
			<param name="discount_counter" />
			<param name="discount_type" />
			<param name="discount_value" />
			<param name="currency_code" />
		</output>
	</template>

</templateGroup>