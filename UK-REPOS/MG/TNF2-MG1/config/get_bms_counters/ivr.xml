<templateGroup name="BMS">
	<macros>
  		<define name="_BMSHND" value="WCFHND_01" />
  		<define name="_SMSCON" value="SMSCON_01" />
	</macros>

	<template procedureName="GetBMSBalance" handler="_BMSHND" sessionStorage="Remoting" sessionLifetime="300">
		<receiveTemplate>
			<Message type="getcounters" initiator="ivrcon" id="${guid}" session_id="@{setSessionId(${guid})}">
				<Item procedureName="GetBalance">
					<Attribute name="Customer" type="String" value="${customer}" />
					<Attribute name="Balance" />
					<Attribute name="Counters" />
					<Attribute name="CreateDate" />
					<Attribute name="Result" />
	       		</Item>
	       		@{store(sInputCode,${countercode})}
			</Message>
		</receiveTemplate>
		<deliveryTemplate direction="input" terminating="false">
			<set item="param:dbresult" value="0"/>
        </deliveryTemplate>
		<deliveryTemplate connector="_SMSCON" />
		<input>
			<param name="customer" />
		</input>
		<output>
			<param name="dbresult" type="3" value="0" />
		</output>
	</template>
	
		<template procedureName="GetAutumnCounter" handler="_BMSHND" sessionStorage="Remoting" sessionLifetime="300">
		<receiveTemplate>
			<Message type="getautumncounters" initiator="ivrcon" id="${guid}" session_id="@{setSessionId(${guid})}">
				<Item procedureName="GetMsisdnCurrentCounterInstances">
					<Attribute name="Customer" type="String" value="${customer}" />
					<Attribute name="CounterInstances" />
					<Attribute name="Result" />
	       		</Item>
	       		@{store(sInputCode,${countercode})}
	       		@{store(sBMScode,#{document('C:\Foris\Messaging Gateway\config\get_bms_counters\counters.xml')/counters/counter[@ivr_code='${countercode}']/@bms_code})}
			</Message>
		</receiveTemplate>
		<deliveryTemplate direction="input" conditionEx="#{'${sBMScode}'=''}">
			<set item="param:dbresult" value="-1"/>
			<set conditionEx="0@{freeSession}"  />
		</deliveryTemplate>
		<deliveryTemplate direction="input" terminating="false">
			<set item="param:dbresult" value="0"/>
        </deliveryTemplate>
		<deliveryTemplate connector="_SMSCON" />
		<input>
			<param name="customer" />
			<param name="countercode" />
		</input>
		<output>
			<param name="dbresult" type="3" value="0" />
		</output>
	</template>


</templateGroup>