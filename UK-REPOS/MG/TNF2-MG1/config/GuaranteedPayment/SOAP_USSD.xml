<templateGroup name="GuaranteedPayment">
	<macros>
		<define name="_SMSCON" value="SMSCON_01" />
		<define name="_CURRENT_INITIATOR" value="ussd" />
	</macros>

	<template procedureName="List" sessionStorage="Database" sessionLifetime="60" >
		<receiveTemplate>
			<Message type="serviceorder" initiator="_CURRENT_INITIATOR" id="@{newGuid}" session_id="@{setSessionId(Get_GrntPay_${customer})}">
				<Item customer="${customer}">
					<Service id="guaranteedpayment" action="6"/>
				</Item>
				@{store(sInputParams,_CURRENT_INITIATOR_)}
			</Message>
		</receiveTemplate>
		<deliveryTemplate direction="input" terminating="false">
			<set item="oparam:dbresult" value="0"/>
			<set item="oparam:result" value="Ваша заявка принята. Результат будет сообщен Вам в SMS"/>
		</deliveryTemplate>	
		<deliveryTemplate connector="_SMSCON"/>	
		<input>
			<param name="customer"/>
		</input>
		<output>
			<param name="dbresult"/>
			<param name="result"/>
		</output>
	</template>
	<template procedureName="Acceptance" sessionStorage="Database" sessionLifetime="60" >
		<receiveTemplate>
			<Message type="serviceorder" initiator="_CURRENT_INITIATOR" id="@{newGuid}" session_id="@{setSessionId(GrntPay_${customer})}">
				<Item customer="${customer}">
					<Service id="guaranteedpayment" action="6"/>
				</Item>
				@{store(sInputParams,_CURRENT_INITIATOR_${amount})}
			</Message>
		</receiveTemplate>
		<deliveryTemplate direction="input" terminating="false">
			<set item="oparam:dbresult" value="0"/>
			<set item="oparam:result" value="Ваша заявка на установку Обещанного платежа принята. Результат будет сообщен Вам в СМС"/>
		</deliveryTemplate>	
		<deliveryTemplate connector="_SMSCON"/>	
		<input>
			<param name="customer"/>
			<param name="amount"/>
		</input>
		<output>
			<param name="dbresult"/>
			<param name="customer"/>
			<param name="result"/>
		</output>
	</template>

</templateGroup>