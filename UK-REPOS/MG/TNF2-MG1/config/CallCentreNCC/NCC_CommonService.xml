<templateGroup name="NCC_Common">
	<macros>
		<define name="_CURRENT_INITIATOR" value="ivrcon"/>
	</macros>
	<!--  Get Tariff Plan -->
	<template procedureName="GetTariffPlan">
		<receiveTemplate>
			<Message type="verificationrequest" initiator="_CURRENT_INITIATOR" id="@{newGuid}" session_id="@{newGuid}">
				<Item customer="${customer}">
					<Attribute name="checkivrservice" value="1"/>
					<Attribute name="checkblocks" value="0"/>
				</Item>
			</Message>
		</receiveTemplate>
		<deliveryTemplate>
			<set item="oparam:dbresult" value="${dbresult}" />
			<set item="oparam:ivrcode" value="${tariffplan}" />
		</deliveryTemplate>
		<input>
			<param name="customer"/>
		</input>
		<output>
			<param name="dbresult"/>
			<param name="ivrcode"/>
		</output>
	</template>
	<!--  Get Customer LOCNO -->
	<template procedureName="GetLocno">
		<receiveTemplate>
			<Message type="retrievecustomerdata" initiator="_CURRENT_INITIATOR" id="@{newGuid}" session_id="@{newGuid}">
				<Item customer="${customer}" subject="getlocnoattribute" />
			</Message>
		</receiveTemplate>
		<deliveryTemplate>
			<set item="oparam:dbresult" value="${dbresult}" />
			<set item="oparam:locno" value="${locnoattribute}" />
		</deliveryTemplate>
		<input>
			<param name="customer" />
		</input>
		<output>
			<param name="dbresult" />
			<param name="locno" />
		</output>
	</template>
	<!--  Get Customer Status -->
	<template procedureName="CheckBlocks">
		<receiveTemplate>
			<Message type="verificationrequest" initiator="_CURRENT_INITIATOR" id="@{newGuid}" session_id="@{newGuid}">
				<Item customer="${customer}">
					<Attribute name="checkivrservice" value="0"/>
					<Attribute name="checkblocks" value="1"/>
				</Item>
			</Message>
		</receiveTemplate>
		<deliveryTemplate>
			<set item="oparam:dbresult" value="${dbresult}" />
			<set item="oparam:status" value="#{if('${customerblocks}'!='' or '${dbresult}'='320347','1','0')}" />
			<set item="oparam:customerblocks" value="${customerblocks}" />
		</deliveryTemplate>
		<input>
			<param name="customer"/>
		</input>
		<output>
			<param name="dbresult"/>
			<param name="status"/>
			<param name="customerblocks"/>
		</output>
	</template>
	<!--  Get Customer Balance -->
	<template procedureName="GetBalance">
		<receiveTemplate>
			<Message type="retrievecustomerdata" initiator="_CURRENT_INITIATOR" id="@{newGuid}" session_id="@{newGuid}">
				<Item customer="${customer}" subject="balance">
					<Attribute name="unpayment" value="0"/>
					<Attribute name="requestcountertype" value="0"/>
				</Item>
			</Message>
		</receiveTemplate>
		<deliveryTemplate>
			<set item="oparam:dbresult" value="${dbresult}" />
			<set item="oparam:currency" value="${currency}" />
			<set item="oparam:creditlimitintpartdotpart" conditionEx="#{'${creditlimitintpartdotpart}'!=''}" value="#{number(${creditlimitintpartdotpart} div 100)}" />
			<set item="oparam:balance" conditionEx="#{'${balanceintpartdotpart}'!=''}" value="#{number(${balanceintpartdotpart} div 100)}" />
		</deliveryTemplate>
		<input>
			<param name="customer"/>
		</input>
		<output>
			<param name="dbresult"/>
			<param name="balance"/>
			<param name="currency"/>
			<param name="creditlimitintpartdotpart"/>
		</output>
	</template>
	<!--  Get Customer Balance -->
	<template procedureName="GetCounters">
		<receiveTemplate>
			<Message type="retrievecustomerdata" initiator="_CURRENT_INITIATOR" id="@{newGuid}" session_id="@{newGuid}">
				<Item customer="${customer}" subject="balance">
					<Attribute name="unpayment" value="0"/>
					<Attribute name="requestcountertype" value="3"/>
				</Item>
			</Message>
		</receiveTemplate>
		<deliveryTemplate>
			<set item="oparam:dbresult" value="${dbresult}" />
			<set item="oparam:accumulator" value="#{//Item/Attribute[@name='accumulator']/@value}" />
		</deliveryTemplate>
		<input>
			<param name="customer"/>
		</input>
		<output>
			<param name="dbresult"/>
			<param name="accumulator"/>
		</output>
	</template>
	<!--  Get Customer Service Status -->
	<template procedureName="GetServiceStatus">
		<receiveTemplate>
			<Message type="serviceinterrogation" initiator="_CURRENT_INITIATOR" id="@{newGuid}" session_id="@{newGuid}">
				<Item customer="${customer}">
					<Service id="${servicecode}" action="interrogation"/>
				</Item>
			</Message>
		</receiveTemplate>
		<deliveryTemplate>
			<set item="oparam:dbresult" value="${dbresult}" />
			<set item="oparam:subscription" value="${subscription}" />
			<set item="oparam:allowed" value="${allowed}" />
			<set item="oparam:status" value="${status}" />
		</deliveryTemplate>
		<input>
			<param name="customer"/>
			<param name="servicecode"/>
		</input>
		<output>
			<param name="dbresult"/>
			<param name="subscription"/>
			<param name="allowed"/>
			<param name="status"/>
		</output>
	</template>
	<!--  Get Customer Last Paymnet -->
	<template procedureName="GetLastPayment">
		<receiveTemplate>
			<Message type="retrievecustomerdata" initiator="_CURRENT_INITIATOR" id="@{newGuid}" session_id="@{newGuid}">
				<Item customer="${customer}" subject="payments">
					<Attribute name="index" value="0"/>
				</Item>
			</Message>
		</receiveTemplate>
		<deliveryTemplate>
			<set item="oparam:dbresult" value="${dbresult}" />
			<set item="oparam:amount" conditionEx="#{'${intpartfracpart}'!=''}" value="#{number(${intpartfracpart} div 100)}" />
			<set item="oparam:day" value="${day}" />
		</deliveryTemplate>
		<input>
			<param name="customer"/>
		</input>
		<output>
			<param name="dbresult"/>
			<param name="amount"/>
			<param name="day"/>
		</output>
	</template>
	<!-- Open bills on last successful minibilling run data -->
	<template procedureName="GetBillData">
		<receiveTemplate>
			<Message type="retrievecustomerdata" initiator="_CURRENT_INITIATOR" id="@{newGuid}" session_id="@{newGuid}">
				<Item customer="${customer}" subject="openbills">
					<Attribute name="includeunbilleddata" value="1"/>
				</Item>
			</Message>
		</receiveTemplate>
		<deliveryTemplate>
			<set item="oparam:dbresult" value="${dbresult}" />
			<set item="oparam:total" conditionEx="#{'${summintdotpart}'!=''}" value="#{number(${summintdotpart} div 100)}" />
		</deliveryTemplate>
		<input>
			<param name="customer"/>
		</input>
		<output>
			<param name="dbresult"/>
			<param name="total"/>
		</output>
	</template>
	<!-- Assign Service -->
	<template procedureName="AssignService">
		<receiveTemplate>
			<Message type="serviceorder" initiator="_CURRENT_INITIATOR" id="@{newGuid}" session_id="@{newGuid}">
				<Item customer="${customer}">
					<Service id="${servicecode}" class="0" action="2"/>
				</Item>
			</Message>
		</receiveTemplate>
		<deliveryTemplate>
			<set item="oparam:dbresult" value="${dbresult}" />
		</deliveryTemplate>
		<input>
			<param name="customer"/>
			<param name="servicecode"/>
		</input>
		<output>
			<param name="dbresult"/>
		</output>
	</template>
	<!-- Remove Service -->
	<template procedureName="RemoveService">
		<receiveTemplate>
			<Message type="serviceorder" initiator="_CURRENT_INITIATOR" id="@{newGuid}" session_id="@{newGuid}">
				<Item customer="${customer}">
					<Service id="${servicecode}" class="0" action="3"/>
				</Item>
			</Message>
		</receiveTemplate>
		<deliveryTemplate>
			<set item="oparam:dbresult" value="${dbresult}" />
		</deliveryTemplate>
		<input>
			<param name="customer"/>
			<param name="servicecode"/>
		</input>
		<output>
			<param name="dbresult"/>
		</output>
	</template>
	<!-- Change Tariff Plan -->
	<template procedureName="ChangeTariffPlan">
		<receiveTemplate>
			<Message type="serviceorder" initiator="_CURRENT_INITIATOR" id="@{newGuid}" session_id="@{newGuid}">
				<Item customer="${customer}">
					<Service id="changetariffplan" action="0" class="${ivrcode}"/>
				</Item>
			</Message>
		</receiveTemplate>
		<deliveryTemplate>
			<set item="oparam:dbresult" value="${dbresult}" />
		</deliveryTemplate>
		<input>
			<param name="customer"/>
			<param name="ivrcode"/>
		</input>
		<output>
			<param name="dbresult"/>
		</output>
	</template>
	<!-- Latest bills request for accounting period  -->
	<template procedureName="LastPeriodBill" >
		<receiveTemplate>
			<Message type="retrievecustomerdata" initiator="_CURRENT_INITIATOR" id="@{newGuid}" session_id="@{newGuid}">
				<Item customer="${customer}" subject="lastperiodbill" >
					<Attribute name="startdate" value="${startdate}" />
					<Attribute name="enddate" value="${enddate}" />
				</Item>
			</Message>
		</receiveTemplate>
		<deliveryTemplate>
			<set item="oparam:dbresult" value="${dbresult}" />
			<set item="oparam:beginday" value="${beginday}" />
			<set item="oparam:endday" value="${endday}" />
			<set item="oparam:draftintdotpart" conditionEx="#{'${draftintdotpart}'!=''}" value="#{number(${draftintdotpart} div 100)}" />
		</deliveryTemplate>
		<input>
			<param name="customer" />
			<param name="startdate" />
			<param name="enddate" />
		</input>
		<output>
			<param name="dbresult" value="" />
			<param name="beginday" value="" />
			<param name="endday" value="" />
			<param name="draftintdotpart" value="" />
		</output>
	</template>
</templateGroup>