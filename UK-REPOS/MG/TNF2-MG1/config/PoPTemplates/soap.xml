<templateGroup name="PoPTemplate">
	<macros>
		<define name="_SMSCON" value="SMSCON_02" />
		<define name="_BMSCON" value="WCFHND_01"/>

		<define name="_SMS_SERVICE_NUMBER" value="110" />
		<define name="_SMS_LIMIT_CONTENT_VALUE" value="111" />
		<define name="_SOAP_SUCCESS_RESULT" value="0" />
		<define name="_MSCPHND" value="WCFHND_03" />

		<define name="_POP_TEMPLATE_FOR_SENDING" value="PoPTemplate.DB_MessageFromSOAP" />

		<!-- Created by Vladimir Khovanskiy - Task 782279
		+ Fixed templates - Task 801618
		+ Edited by Doroshenko Sergey - Task 866301
    -->
		
		<define name="_IF_TRUE"                       value="(^[Tt][Rr][Uu][Ee]$)|(^1$)" />
		<define name="_SERVICE_CODE_FROM_TEMPLATE"    value="#{document('C:\Foris\Messaging Gateway\config\PoPTemplates\SERVICE_NAMES.xml')/ServiceList/service[@service_code='${sService}']/@service_code}"/>
		<define name="_SERVICE_ACTION"                value="#{document('C:\Foris\Messaging Gateway\config\PoPTemplates\SERVICE_NAMES.xml')//item[command/@val='${sAction}']/@action}"/>
		<define name="_SERVICE_STATUS"                value="#{document('C:\Foris\Messaging Gateway\config\PoPTemplates\SERVICE_NAMES.xml')//item[command/@val='${sAction}']/@status}"/>
		<define name="_SERVICE_COUNT_CHECK_BINDING"   value="count(document('C:\Foris\Messaging Gateway\config\PoPTemplates\SERVICE_NAMES.xml')/ServiceList/service[@service_code='${sService}']/servicebinding)"/>
		<define name="_SERVICE_BINDING"               value="#{document('C:\Foris\Messaging Gateway\config\PoPTemplates\SERVICE_NAMES.xml')/ServiceList/service[@service_code='${sService}']/servicebinding[${sCnt}]/@code}"/>
		<define name="_INFO_TEXT_DBRESULTS"           value="#{document('C:\Foris\Messaging Gateway\config\PoPTemplates\SERVICE_NAMES.xml')/ServiceList/service[@service_code='${sService}']/@info_${sDbresult}${sLang}}"/>
		<define name="_INFO_CHECK_DATE"               value="#{document('C:\Foris\Messaging Gateway\config\PoPTemplates\SERVICE_NAMES.xml')/ServiceList/service[@service_code='${sService}']/@info_check_date}"/>
		<define name="_INFO_CHECK_ACCUM"              value="#{document('C:\Foris\Messaging Gateway\config\PoPTemplates\SERVICE_NAMES.xml')/ServiceList/service[@service_code='${sService}']/@check_accumulator}"/>
	</macros>
	<!-- *110*15 --> 
	<template procedureName="DB_ChargesInfoSync" > 
		<receiveTemplate> 
			<Message type="getcharges" initiator="smscon" id="${guid}" session_id="@{newGuid}"> 
				<Item customer="${Msisdn}"> 
				</Item> 
			</Message> 
		</receiveTemplate> 
		<deliveryTemplate> 
			<set item='oparam:dbresult' value='${dbresult}' /> 
			<set item='oparam:ChargeAmount' value='${ChargeAmount}' /> 
			<set item='oparam:Currency' value='${Currency}' /> 
			<set item='oparam:CurrentBillingPeriodStartDate' value='${CurrentBillingPeriodStartDate}' /> 
		</deliveryTemplate> 
		<input> 
			<param name="Msisdn" /> 
		</input> 
		<output> 
			<param name="dbresult"  /> 
			<param name="ChargeAmount"  /> 
			<param name="Currency"  /> 
			<param name="CurrentBillingPeriodStartDate"  /> 
		</output> 
	</template> 
	<template procedureName="DB_SInterrogation" persistent="false">
		<!-- Service status check -->
		<condition>
		</condition>
		<receiveTemplate>
			<Message type="serviceinterrogation" initiator="ivrcon" id="${guid}" session_id="@{newGuid}">
				<Item customer="${customer}">
					<Service id="${service}" action="interrogation" />
				</Item>
			</Message>
		</receiveTemplate>
		<input>
			<param name="customer" />
			<param name="service" />
		</input>
		<output>
			<param name="dbresult" type="3" value="0" /> 
			<param name="Allowed" type="2" value="0" />
			<param name="Subscription" type="2" value="0" />
			<param name="Status" type="2" value="0" />
			<param name="Class" type="3" value="0" />
			<param name="ChargedAmount" type="3" value="0" />
		</output>
	</template>
	<template procedureName="DB_ServiveProcessing" sessionStorage="Memory" sessionLifetime="160">
		<receiveTemplate>
			<Message type="verificationrequest" initiator="ussd" id="@{newGuid}" session_id="@{setSessionId(${customer}_${service}_${action})}">
				<Item customer="${customer}">
					<Attribute name="checkivrservice" value="1" />
					<Attribute name="checkblocks" value="1" />
				</Item>
				@{store(sCustomer,${customer})}
				@{store(sService,${service})}
				@{store(sAction,${action})}
				@{store(sActParce,#{document('C:\Foris\Messaging Gateway\config\PoPTemplates\SERVICE_NAMES.xml')//item[command/@val='${action}']/@parce})}
				@{store(sLang,@{switch(${LANGUAGE_ID}|_ua,1|_en,3|_ru)})}
			</Message>
		</receiveTemplate>
		<deliveryTemplate conditionEx="#{'${customerblocks}'!='' or '${dbresult}'='320347'}">
			<set item="oparam:dbresult" value="0@{store(sDbresult,320347)}"/>
			<set item="oparam:result" conditionEx="#{'_INFO_TEXT_DBRESULTS'=''}" value="@{store(sService,_TEST1234)}"/>
			<set item="oparam:result" value="_INFO_TEXT_DBRESULTS"/>
			<set conditionEx="0@{freeSession}"/>
		</deliveryTemplate>
		<deliveryTemplate conditionEx="#{'${dbresult}'='0' and '${sActParce}'!='' and '_SERVICE_CODE_FROM_TEMPLATE'!='' and '_SERVICE_STATUS'!='' and '_SERVICE_ACTION'!=''}" call="DB_ServiveProcessing2">	
			<set item="iparam:customer"  value="${customer}"/>
		</deliveryTemplate>
		<deliveryTemplate conditionEx="#{'${dbresult}'='0'}" >	
			<set item="oparam:dbresult"  value="329990"/>
			<set item="oparam:result"  value="Operaciya nevozmozhna!"/>
			<set conditionEx="0@{freeSession}"/>
		</deliveryTemplate>
		<deliveryTemplate>
			<set item="oparam:dbresult"  value="0@{store(sDbresult,${dbresult})}"/>
			<set item="oparam:result" conditionEx="#{'_INFO_TEXT_DBRESULTS'=''}" value="@{store(sService,_TEST1234)}"/>
			<set item="oparam:result" conditionEx="#{'_INFO_TEXT_DBRESULTS'=''}" value="@{store(sDbresult,499999)}"/>
			<set item="oparam:result" value="_INFO_TEXT_DBRESULTS"/>
			<set conditionEx="0@{freeSession}"/>
		</deliveryTemplate>
		<input>
			<param name="customer"/>
			<param name="service"/>
			<param name="action"/>
		</input>
		<output>
			<param name="dbresult"/>
			<param name="customer"/>
			<param name="result"/>
		</output>
	</template>
	<template procedureName="DB_ServiveProcessing2" sessionStorage="Memory" sessionLifetime="160">
		<receiveTemplate>
			<Message type="serviceinterrogation" initiator="ussd" id="@{newGuid}" session_id="${session_id}">
				<Item customer="${sCustomer}">
					<Service id="_SERVICE_CODE_FROM_TEMPLATE" action="interrogation"/>
				</Item>
			</Message>
		</receiveTemplate>
		<deliveryTemplate conditionEx="#{'${dbresult}'='0' and '_SERVICE_STATUS'='${subscription}'}">
			<set item="oparam:dbresult" value="0@{store(sDbresult,#{document('C:\Foris\Messaging Gateway\config\PoPTemplates\SERVICE_NAMES.xml')//item[@status='${subscription}']/@code})}"/>
			<set item="oparam:result" conditionEx="#{'_INFO_TEXT_DBRESULTS'=''}" value="@{store(sService,_TEST1234)}"/>
			<set item="oparam:result" value="_INFO_TEXT_DBRESULTS"/>
			<set conditionEx="0@{freeSession}"  />
		</deliveryTemplate>
		<deliveryTemplate conditionEx="#{${dbresult}=0 and _SERVICE_COUNT_CHECK_BINDING>0}" call="DB_ServiveProcessingCheckBinding">
			<set item="iparam:customer"  value="${customer}"/>
		</deliveryTemplate>
		<deliveryTemplate conditionEx="#{'${dbresult}'='0' and '_SERVICE_STATUS'!='${subscription}'}" call="DB_ServiveProcessing3">
			<set item="iparam:customer" value="${customer}"/>
		</deliveryTemplate>
		<deliveryTemplate conditionEx="#{'${dbresult}'='0'}" >	
			<set item="oparam:dbresult"  value="329991"/>
			<set item="oparam:result"  value="Operaciya nevozmozhna!"/>
			<set conditionEx="0@{freeSession}"/>
		</deliveryTemplate>
		<deliveryTemplate>
			<set item="oparam:dbresult"  value="0@{store(sDbresult,${dbresult})}"/>
			<set item="oparam:result" conditionEx="#{'_INFO_TEXT_DBRESULTS'=''}" value="@{store(sService,_TEST1234)}"/>
			<set item="oparam:result" conditionEx="#{'_INFO_TEXT_DBRESULTS'=''}" value="@{store(sDbresult,499999)}"/>
			<set item="oparam:result" value="_INFO_TEXT_DBRESULTS"/>
			<set conditionEx="0@{freeSession}"/>
		</deliveryTemplate>
		<input>
			<param name="customer"/>
		</input>
		<output>
			<param name="dbresult"/>
			<param name="customer"/>
			<param name="result"/>
		</output>
	</template>
	<template procedureName="DB_ServiveProcessingCheckBinding" sessionStorage="Memory" sessionLifetime="160">
		<receiveTemplate>
			<Message type="serviceinterrogation" initiator="ussd" id="@{newGuid}" session_id="${session_id}">
				@{store(sCnt,#{if('${sCnt}'='',1,number('${sCnt}')+1)})}
				<Item customer="${sCustomer}">
					<Service id="_SERVICE_BINDING" action="interrogation"/>
				</Item>
			</Message>
		</receiveTemplate>
		<deliveryTemplate conditionEx="#{'${dbresult}'='0' and '${subscription}'='0'}">
			<set item="oparam:dbresult" value="0@{store(sDbresult,320412)}"/>
			<set item="oparam:result" conditionEx="#{'_INFO_TEXT_DBRESULTS'=''}" value="@{store(sService,_TEST1234)}"/>
			<set item="oparam:result" value="_INFO_TEXT_DBRESULTS"/>
			<set conditionEx="0@{freeSession}"/>
		</deliveryTemplate>
		<deliveryTemplate conditionEx="#{${dbresult}=0 and ${sCnt}=_SERVICE_COUNT_CHECK_BINDING}" call="DB_ServiveProcessing3">
			<set item="iparam:customer"  value="${customer}"/>
		</deliveryTemplate>
		<deliveryTemplate conditionEx="#{'${dbresult}'='0' and '${subscription}'='1'}" call="DB_ServiveProcessingCheckBinding">
			<set item="iparam:customer" value="${customer}"/>
		</deliveryTemplate>
		<deliveryTemplate>
			<set item="oparam:dbresult"  value="0@{store(sDbresult,${dbresult})}"/>
			<set item="oparam:result" conditionEx="#{'_INFO_TEXT_DBRESULTS'=''}" value="@{store(sService,_TEST1234)}"/>
			<set item="oparam:result" conditionEx="#{'_INFO_TEXT_DBRESULTS'=''}" value="@{store(sDbresult,499999)}"/>
			<set item="oparam:result" value="_INFO_TEXT_DBRESULTS"/>
			<set conditionEx="0@{freeSession}"/>
		</deliveryTemplate>		
		<input>
			<param name="customer"/>
		</input>
		<output>
			<param name="dbresult"/>
			<param name="customer"/>
			<param name="result"/>
		</output>
	</template>
	<template procedureName="DB_ServiveProcessing3" sessionStorage="Memory" sessionLifetime="160" >	
		<receiveTemplate>
			<Message type="serviceorder" initiator="ussd" id="@{newGuid}" session_id="${session_id}">
				<Item customer="${sCustomer}">
					<Service id="_SERVICE_CODE_FROM_TEMPLATE" action="_SERVICE_ACTION"/>
				</Item>				
			</Message>
		</receiveTemplate>		
		<deliveryTemplate conditionEx="#{'${dbresult}'='0'}">
			<set item="oparam:dbresult" value="0@{store(sDbresult,success_${sActParce})}"/>
			<set item="oparam:result" conditionEx="#{'_INFO_TEXT_DBRESULTS'=''}" value="@{store(sService,_TEST1234)}"/>
			<set item="oparam:result" value="_INFO_TEXT_DBRESULTS"/>
			<set conditionEx="0@{freeSession}"  />
		</deliveryTemplate>
		<deliveryTemplate>
			<set item="oparam:dbresult"  value="0@{store(sDbresult,${dbresult})}"/>
			<set item="oparam:result" conditionEx="#{'_INFO_TEXT_DBRESULTS'=''}" value="@{store(sService,_TEST1234)}"/>
			<set item="oparam:result" conditionEx="#{'_INFO_TEXT_DBRESULTS'=''}" value="@{store(sDbresult,499999)}"/>
			<set item="oparam:result" value="_INFO_TEXT_DBRESULTS"/>
			<set conditionEx="0@{freeSession}"/>
		</deliveryTemplate>
		<input>
			<param name="customer"/>
		</input>
		<output>
			<param name="result"/>
			<param name="customer"/>
			<param name="dbresult"/>
		</output>
	</template>
	<template procedureName="DB_CheckServive" sessionStorage="Memory" sessionLifetime="60" >	
		<receiveTemplate>
			<Message type="serviceinterrogation" initiator="ussd" id="@{newGuid}" session_id="@{setSessionId(${customer}_${service})}">
				<Item customer="${customer}">
					<Service id="${service}" action="interrogation"/>
				</Item>
				@{store(sService,${service})}
				@{store(sLang,@{switch(${LANGUAGE_ID}|_ua,1|_en,3|_ru)})}
			</Message>
		</receiveTemplate>
		<deliveryTemplate conditionEx="#{'${dbresult}'='0' and '${subscription}'='1' and matches('_INFO_CHECK_ACCUM','_IF_TRUE')}" call="DB_CheckServiveAccum">
			<set item="iparam:customer" value="${customer}"/>
		</deliveryTemplate>
		<!--deliveryTemplate conditionEx="#{'${dbresult}'='0' and '${subscription}'='1' and matches('_INFO_CHECK_DATE','_IF_TRUE')}" call="DB_CheckServiveDate">
			<set item="iparam:customer" value="${customer}"/>
		</deliveryTemplate-->
		<deliveryTemplate conditionEx="#{'${dbresult}'='0'}">
			<set item="oparam:dbresult" value="0@{store(sDbresult,service_#{document('C:\Foris\Messaging Gateway\config\PoPTemplates\SERVICE_NAMES.xml')//item[@status='${subscription}']/@parce})}"/>
			<set item="oparam:result" conditionEx="#{'_INFO_TEXT_DBRESULTS'=''}" value="@{store(sService,_TEST1234)}"/>
			<set item="oparam:result" value="_INFO_TEXT_DBRESULTS" />
			<set conditionEx="0@{freeSession}"/>
		</deliveryTemplate>
		<deliveryTemplate>
			<set item="oparam:dbresult"  value="0@{store(sDbresult,${dbresult})}"/>
			<set item="oparam:result" conditionEx="#{'_INFO_TEXT_DBRESULTS'=''}" value="@{store(sService,_TEST1234)}"/>
			<set item="oparam:result" conditionEx="#{'_INFO_TEXT_DBRESULTS'=''}" value="@{store(sDbresult,499999)}"/>
			<set item="oparam:result" value="_INFO_TEXT_DBRESULTS"/>
			<set conditionEx="0@{freeSession}"/>
		</deliveryTemplate>
		<input>
			<param name="customer"/>
			<param name="service"/>
		</input>
		<output>
			<param name="result"/>
			<param name="customer"/>
			<param name="dbresult"/>
		</output>
	</template>
	<template procedureName="DB_CheckServiveAccum" sessionStorage="Memory" sessionLifetime="60" >	
		<receiveTemplate>
			<Message type="retrievecustomerdata" initiator="ussd" id="${guid}" session_id="${session_id}">
				<Item customer="${customer}" subject="balance">
					<Attribute name="unpayment" value="1"/>
					<Attribute name="requestcountertype" value="3"/>
				</Item>
			</Message>
		</receiveTemplate>
		<deliveryTemplate conditionEx="#{'${dbresult}'='0' and '${accumulator}'!=''}">
			<set item="oparam:dbresult" value="0@{store(sDbresult,service_#{document('C:\Foris\Messaging Gateway\config\PoPTemplates\SERVICE_NAMES.xml')//item[@status='1']/@parce})}"/>
			<set item="oparam:result" conditionEx="#{'_INFO_TEXT_DBRESULTS'=''}" value="@{store(sService,_TEST1234)}"/>
			<set item="oparam:result" value="#{if('${sLang}'='_en','You used: ${accumulator} ','')}_INFO_TEXT_DBRESULTS#{if('${sLang}'!='_en',' ${accumulator}','')}" />
			<set conditionEx="0@{freeSession}"/>
		</deliveryTemplate>
		<deliveryTemplate conditionEx="#{'${dbresult}'='0'}">
			<set item="oparam:dbresult" value="0@{store(sDbresult,service_#{document('C:\Foris\Messaging Gateway\config\PoPTemplates\SERVICE_NAMES.xml')//item[@status='1']/@parce})}"/>
			<set item="oparam:result" conditionEx="#{'_INFO_TEXT_DBRESULTS'=''}" value="@{store(sService,_TEST1234)}"/>
			<set item="oparam:result" value="_INFO_TEXT_DBRESULTS" />
			<set conditionEx="0@{freeSession}"/>
		</deliveryTemplate>
		<deliveryTemplate>
			<set item="oparam:dbresult"  value="0@{store(sDbresult,${dbresult})}"/>
			<set item="oparam:result" conditionEx="#{'_INFO_TEXT_DBRESULTS'=''}" value="@{store(sService,_TEST1234)}"/>
			<set item="oparam:result" conditionEx="#{'_INFO_TEXT_DBRESULTS'=''}" value="@{store(sDbresult,499999)}"/>
			<set item="oparam:result" value="_INFO_TEXT_DBRESULTS"/>
			<set conditionEx="0@{freeSession}"/>
		</deliveryTemplate>
		<input>
			<param name="customer"/>
		</input>
		<output>
			<param name="dbresult" value=""/>
			<param name="result" value=""/>
		</output>
	</template>	












	<template procedureName="DB_BalanceRetrievfgergr" handler="_MSCPHND" sessionStorage="Memory" sessionLifetime="300">
		<receiveTemplate>
			<Message type="scnsbcgetbalance" initiator="ivrcon" id="${guid}" session_id="@{setSessionId(${guid})}">
				<Item procedureName="SCN_SBC_GET_BALANCE">
					<Attribute name="CLIENT_ID" type="String" value="911"/>
					<Attribute name="REQUEST_ID" type="String" value="#{substring('${guid}',1,10)}"/>
					<Attribute name="MSISDN" value="+${Customer}"/>

					<Attribute name="RESULT_CODE"/>
					<Attribute name="REQUEST_ID"/>
					<Attribute name="BALANCE"/>
					<Attribute name="CURRENCY"/>
					<Attribute name="CUST_STATUS"/>
					<Attribute name="EXPIRE_DATE"/>
					<Attribute name="BLOCKED_END_DATE"/>
					<Attribute name="REQUEST_DATE"/>
					<Attribute name="SYSTEM_TIME_ZONE"/>
					<Attribute name="ADDITIONAL_DATA" />
				</Item>
			</Message>
		</receiveTemplate>
		<deliveryTemplate conditionEx="#{'${BALANCE}'!=''}">
			<set item="oparam:dbresult" value="${RESULT_CODE}"/>
			<set item="oparam:zbalanceintpartdotpart" value="#{round(${BALANCE} div 10000)}"/>
		</deliveryTemplate>
		<deliveryTemplate>
			<set item="oparam:dbresult" value="${RESULT_CODE}"/>
			<set item="oparam:zbalanceintpartdotpart" value="${BALANCE}"/>
		</deliveryTemplate>
		<!--deliveryTemplate>
			<set item="oparam:dbresult" value="${RESULT_CODE}"/>
			<set item="oparam:zbalanceintpartdotpart" value="#{if(${BALANCE}>=0,'#{round(${BALANCE} div 10000)}','-#{number(#{substring('${BALANCE}',2,string-length('${BALANCE}'))}) div 10000}')}"/>
		</deliveryTemplate-->
		<input>
			<param name="Customer"/>
		</input>
		<output>
			<param name="dbresult" value="-1"/>
			<param name="zbalanceintpartdotpart" value=""/>
		</output>
	</template>  


	<template procedureName="GetMarketingCategory" handler="DBCON_01">
		<receiveTemplate>
			<Message initiator="ivrcon" id="${guid}" session_id="@{setSessionId(${guid})}">
				<Item procedureName="customer_selfcare.get_td_info_by_msisdn">
					<Attribute name="p_msisdn" type="STRING" value="${customer}"/>
					<Attribute name="p_ref"    type="CURSOR"/>	
				</Item>
			</Message>
		</receiveTemplate>
		<deliveryTemplate conditionEx="#{'${p_ref}'!=''}" call="GetMarketingCategory2">
			<set item="iparam:panumber" value="#{nodeset('${p_ref}')/ResultDataSet/p_ref/PERSONAL_ACCOUNT_NUMBER/text()}"/>
		</deliveryTemplate>
		<deliveryTemplate>
			<set item="oparam:dbresult" value="${dbresult}"/>
			<set item="oparam:mcat" value="-1"/>
		</deliveryTemplate>
		<input>
			<param name="customer"/>
		</input>
		<output>
			<param name="dbresult" type="3" value="-1"/>
			<param name="panumber" type="3" value="-1"/>
			<param name="mcat" type="3" value="-1"/>
		</output>
	</template>
	<template procedureName="GetMarketingCategory2" handler="DBCON_01">
		<receiveTemplate>
			<Message initiator="ivrcon" id="${guid}" session_id="${session_id}">
				<Item procedureName="customer_selfcare.get_customer_info_by_pa_n">
					<Attribute name="p_pa_number" type="STRING" value="${panumber}"/>
					<Attribute name="c_ref" type="out:CURSOR"/>
				</Item>
			</Message>
		</receiveTemplate>
		<deliveryTemplate conditionEx="#{'#{nodeset('${c_ref}')/ResultDataSet/c_ref/MARKETING_CATEGORY_ID/text()}'!=''}">
			<set item="oparam:dbresult" value="${dbresult}"/>
			<set item="oparam:mcat" value="#{nodeset('${c_ref}')/ResultDataSet/c_ref/MARKETING_CATEGORY_ID/text()}"/>
		</deliveryTemplate>
		<deliveryTemplate>
			<set item="oparam:dbresult" value="${dbresult}"/>
			<set item="oparam:mcat" value="-1"/>
		</deliveryTemplate>
		<input>
			<param name="panumber"/>
		</input>
		<output>
			<param name="dbresult" type="3" value="-1"/>
			<param name="mcat" type="3" value="-1"/>
		</output>
	</template>

	<template procedureName="DB_ACCOUNT_ENDDATE_SRV" handler="DBCON_01" persistent="false">
		<receiveTemplate>
			<Message initiator="ussd" id="${guid}" session_id="@{newGuid}">
				<Item procedureName="MG.UMC_GET_ENDDATE_SRV">
					<Attribute name="p_msisdn" type="STRING" value="${customer}" />
					<Attribute name="p_service" type="STRING" value="${service}" />
					<Attribute name="p_dbresult" type="STRING" />
					<Attribute name="p_date_result" type="STRING" />
				</Item>
			</Message>
		</receiveTemplate>
		<deliveryTemplate>
			<set item="oparam:dbresult" value="#{if('${p_dbresult}'='',-1,number('${p_dbresult}'))}" />
			<set item="oparam:date_result" value="#{/Message/Item/Attribute[@name='p_date_result']/@value}" />
		</deliveryTemplate>
		<input>
			<param name="customer" />
			<param name="service" />
		</input>
		<output>
			<param name="dbresult"  type="3" value="-1" />
			<param name="date_result"   type="1" value="-1" />
		</output> 		
	</template>




	<template procedureName="DB_BalanceRetriev">
		<receiveTemplate>
			<Message type="retrievecustomerdata" initiator="ivrcon" id="${guid}" session_id="@{newGuid}">
				<Item customer="${customer}" subject="balance" >
					<Attribute name="unpayment" value="0" />
					<Attribute name="requestcountertype" value="0" />
				</Item>   
			</Message>
		</receiveTemplate>
		<deliveryTemplate>
			<set item="oparam:dbresult" value="${dbresult}" />
			<set item="oparam:balanceintpartdotpart" value="${balanceintpartdotpart}" />
		</deliveryTemplate>
		<input>
			<param name="Customer"/>  
		</input>
		<output>
			<param name="dbresult"                   value="-1" />
			<param name="balanceintpartdotpart"      value=""/>
		</output> 
	</template>

	<template procedureName="DB_PaymentRetriev" sessionStorage="Memory" sessionLifetime="29">
		<receiveTemplate>
			<Message type="retrievecustomerdata" initiator="ivrcc" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
				<Item customer="${customer}" subject="payments">
					<Attribute name="index" value="${index}" />
				</Item>
			</Message>
		</receiveTemplate>
		<deliveryTemplate>
			<set item="oparam:dbresult" value="${dbresult}"/>
			<set item="oparam:zcount" value="${count}"/>
			<set item="oparam:zday" value="${day}"/>
			<set item="oparam:zcurrency" value="${currency}"/>
			<set item="oparam:zintpartfracpart" value="${intpartfracpart}"/>
		</deliveryTemplate>
		<input>
			<param name="customer" />
			<param name="index" />
		</input>
		<output>
			<param name="dbresult" value=""/>
			<param name="zcount" value="0" />
			<param name="zday" value="" />
			<param name="zcurrency" value="0" />
			<param name="zintpartfracpart" value="0" />
		</output>
	</template>



	<template procedureName="DB_LastPeriodBill" sessionStorage="Memory" sessionLifetime="20" persistent="true" >
		<receiveTemplate>
			<Message type="retrievecustomerdata" initiator="emailcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
				<Item customer="${customer}" subject="lastperiodbill" />
				<Attribute name="startdate" value="${startdate}" />
				<Attribute name="enddate" value="${enddate}" />@{store(stest,111)}</Message>
		</receiveTemplate>
		<!--deliveryTemplate direction="input" conditionEx="#{${customer}=79163515044}" terminating="true">
      <set item="oparam:dbresult" value="320341" />
      <set item="oparam:beginday" value="31.12.2007" />
      <set item="oparam:endday" value="@{GetSessionsContaining(stest,111)}" />
      <set item="oparam:" conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate conditionEx="#{${customer}=79163515045}" connector="SMSCON_01">
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate-->
		<!--deliveryTemplate conditionEx="#{${dbresult}=0}" call="DB_LastPeriodBill2">
      <set item="iparam:customer" value="${customer}" />
      <set item="iparam:beginday" value="${beginday}" />
      <set item="iparam:endday"   value="${endday}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate-->
		<deliveryTemplate conditionEx="#{${dbresult}=0}">
			<set item="oparam:dbresult" value="${dbresult}" />
			<set item="oparam:draftintdotpart" value="${draftintdotpart}" />
			<set item="oparam:beginday" value="${beginday}" />
			<set item="oparam:endday"   value="${endday}" />
			<set conditionEx="0@{freeSession}" />
		</deliveryTemplate>
		<input>
			<param name="customer" />
			<param name="startdate" />
			<param name="enddate" />
		</input>
		<output>
			<param name="dbresult" value="" />
			<param name="beginday" value="" />
			<param name="endday" value="" />
			<param name="draftintdotpart" value="" />
		</output>
	</template>

	<!--
  <template procedureName="DB_LastPeriodBill" sessionStorage="Memory" sessionLifetime="20" persistent="true" >
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="emailcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item customer="${customer}" subject="lastperiodbill" />
        <Attribute name="startdate" value="${startdate}" />
        <Attribute name="enddate" value="${enddate}" />@{store(stest,111)}</Message>
    </receiveTemplate>
    <deliveryTemplate direction="input" conditionEx="#{${customer}=79163515044}" terminating="true">
      <set item="oparam:dbresult" value="320341" />
      <set item="oparam:beginday" value="31.12.2007" />
      <set item="oparam:endday" value="@{GetSessionsContaining(stest,111)}" />
      <set item="oparam:" conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate conditionEx="#{${customer}=79163515045}" connector="SMSCON_01">
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <deliveryTemplate conditionEx="#{${dbresult}=0}" call="DB_LastPeriodBill2">
      <set item="iparam:customer" value="${customer}" />
      <set item="iparam:beginday" value="${beginday}" />
      <set item="iparam:endday"   value="${endday}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
    </input>
    <output>
      <param name="dbresult" value="" />
      <param name="beginday" value="" />
      <param name="endday" value="" />
    </output>
  </template>

  <template procedureName="DB_LastPeriodBill2" sessionStorage="Memory" sessionLifetime="20" persistent="true" >
    <receiveTemplate>
      <Message type="retrievecustomerdata" initiator="soapcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
        <Item customer="${customer}" subject="knownperiodbill" />
        <Attribute name="startdate" value="${beginday}" />
        <Attribute name="enddate" value="${endday}" />@{store(stest,01.06.2008)}</Message>
    </receiveTemplate>
    <deliveryTemplate>
      <set item="oparam:dbresult" value="${dbresult}" />
      <set item="oparam:draftintdotpart" value="${draftintdotpart}" />
      <set item="oparam:beginday" value="${endday}" />
      <set item="oparam:endday"   value="${stest}" />
      <set conditionEx="0@{freeSession}" />
    </deliveryTemplate>
    <input>
      <param name="customer" />
      <param name="beginday" />
      <param name="endday" />
    </input>
    <output>
      <param name="dbresult" value="" />
      <param name="draftintdotpart" value="" />
      <param name="beginday" value="" />
      <param name="endday" value="" />
    </output>
  </template>
-->
	<template procedureName="GetBMSBalanceSync" handler="_BMSCON" sessionLifetime="300">
		<receiveTemplate>
			<Message type="getcounters" initiator="ivrcon" id="${guid}" session_id="@{setSessionId(${guid})}">
				<Item procedureName="GetBalance">
					<Attribute name="Customer" type="String" value="${Msisdn}"/>
					<Attribute name="Balance"/>
					<Attribute name="Counters"/>
					<Attribute name="CreateDate"/>
					<Attribute name="Result"/>
				</Item>
				@{store(sMsisdn,${Msisdn})}
			</Message>
		</receiveTemplate>
		<deliveryTemplate conditionEx="#{'${Result}'='0'}" call="GetBMSCounter">
			<set item="iparam:Msisdn" value="${sMsisdn}"/>
			<set item="iparam:Balance" value="${Balance}"/>
			<set item="iparam:CreateDate" value="${CreateDate}"/>
		</deliveryTemplate>
		<input>
			<param name="Msisdn"/>
			<param name="LanguageId"/>
		</input>
		<output>
			<param name="dbresult" value="-1"/>
			<param name="Balance" value=""/>
			<param name="CreateDate" value=""/>
			<param name="CampaignId" value=""/>
			<param name="CampaignName" value=""/>
			<param name="CounterId" value=""/>
			<param name="CounterName" value=""/>
			<param name="CounterValue" value=""/>
			<param name="EndDate" value=""/>
			<param name="StartDate" value=""/>
		</output>
	</template>

	<template procedureName="DB_ServiceActivation" persistent="false">
		<condition>
		</condition>
		<receiveTemplate>
			<Message type="serviceorder" initiator="ivrcon" id="${guid}" session_id="@{newGuid}">
				<Item customer="${customer}">
					<Service id="${service}" action="2" class="1" createrequest="1"/>
				</Item>
			</Message>
		</receiveTemplate>
		<deliveryTemplate conditionEx="#{${dbresult} != 0}" connector="SMSCON_01" call="ServiceOrderErrorHandler.SendProvisionErrorMessage" terminating="false" /><deliveryTemplate conditionEx="#{${dbresult} = document('c:\Foris\Messaging Gateway\config\SelfDescriptiveCodes.xml')/dbresults/dbresult}" connector="SMSCON_01" call="ServiceOrderErrorHandler.SendCRMErrorMessage" terminating="false" />
		<deliveryTemplate>
			<set item="oparam:dbresult"   value="${dbresult}"/>
		</deliveryTemplate>
		<input>
			<param name="customer" />
			<param name="service" />
		</input>
		<output>
			<param name="dbresult" type="3" value="" /> 
		</output>
	</template>

	<template procedureName="DB_ServiceActivation2" persistent="false">
		<condition>
		</condition>
		<receiveTemplate>
			<Message type="serviceorder" initiator="ivrcon" id="${guid}" session_id="@{newGuid}">
				<Item customer="${customer}" action="9.2">
					<Product code="${service}" />
				</Item>
			</Message>
		</receiveTemplate>
		<deliveryTemplate conditionEx="#{${dbresult} != 0}" connector="SMSCON_01" call="ServiceOrderErrorHandler.SendProvisionErrorMessage" terminating="false" /><deliveryTemplate conditionEx="#{${dbresult} = document('c:\Foris\Messaging Gateway\config\SelfDescriptiveCodes.xml')/dbresults/dbresult}" connector="SMSCON_01" call="ServiceOrderErrorHandler.SendCRMErrorMessage" terminating="false" />
		<deliveryTemplate>
			<set item="oparam:dbresult"   value="${dbresult}"/>
		</deliveryTemplate>
		<input>
			<param name="customer" />
			<param name="service" />
		</input>
		<output>
			<param name="dbresult" type="3" value="" /> 
		</output>
	</template>

	<template procedureName="DB_ServiceDeactivation" persistent="false">
		<condition>
		</condition>
		<receiveTemplate>
			<Message type="serviceorder" initiator="ivrcon" id="${guid}" session_id="@{newGuid}">
				<Item customer="${customer}">
					<Service id="${service}" action="3" class="1" createrequest="1"/>
				</Item>
			</Message>
		</receiveTemplate>
		<input>
			<param name="customer" />
			<param name="service" />
		</input>
		<output>
			<param name="dbresult" type="3" value="" /> 
		</output>
	</template>

	<template procedureName="DB_ServiceDeactivation2" persistent="false">
		<condition>
		</condition>
		<receiveTemplate>
			<Message type="serviceorder" initiator="ivrcon" id="${guid}" session_id="@{newGuid}">
				<Item customer="${customer}" action="10.2">
					<Product code="${service}" />
				</Item>
			</Message>
		</receiveTemplate>
		<input>
			<param name="customer" />
			<param name="service" />
		</input>
		<output>
			<param name="dbresult" type="3" value="" /> 
		</output>
	</template>

	<!--template procedureName="DB_OrderBonusVoucher" handler="DBCON_01">
		<receiveTemplate>
			<Message initiator="ivrcon" id="${guid}" session_id="@{newGuid}">
				<Item procedureName="DB_OrderBonusVoucher">
					<Attribute name="p_MSISDN" type="STRING" value="${Customer}" />
					<Attribute name="p_TYPE" type="STRING" value="${VouchType}" />
					<Attribute name="p_NAME" type="STRING" value="${VouchDescription}" />
					<Attribute name="p_BonusPrice" type="STRING" value="${BonusPrice}" /> 
				</Item>
			</Message>
		</receiveTemplate>
		<deliveryTemplate>
			<set item="param:dbresult" value="#{if('${p_dbresult}'='',-1,number('${p_dbresult}'))}" />
		</deliveryTemplate>
		<input>
			<param name="Customer" />
			<param name="name" />
			<param name="cmd" />
			<param name="type" />
		</input>
		<output>
			<param name="dbresult"  type="3" value="-1" />
		</output>
	</template-->







	<template procedureName="DB_OrderBonusVoucher" sessionLifetime="300">
		<receiveTemplate>
			<Message type="CustomerBonusRequest" initiator="ivrcon" id="@{newGuid}" session_id="@{setSessionId(@{newGuid})}">
				<Item customer="${customer}">
					<Attribute name="BonusCode" value="${bonuscode}"/>
					<Attribute name="language_id" value="1"/>
				</Item>
				@{store(Msisdn,${customer})}
			</Message>
		</receiveTemplate>
		<deliveryTemplate conditionEx="#{'${dbresult}'='0'}" call="OrderBonusVoucher">
			<set item="iparam:Msisdn" value="${Msisdn}"/>
			<set item="iparam:FirstName" value="${FirstName}"/>
			<set item="iparam:LastName" value="${LastName}"/>
			<set item="iparam:OrganizationName" value="${OrganizationName}"/>
			<set item="iparam:PANumber" value="${PANumber}"/>
			<set item="iparam:TerminalDeviceID" value="${TerminalDeviceID}"/>
			<set item="iparam:ResponsiblePerson" value="${ResponsiblePerson}"/>
			<set item="iparam:ContactPhone" value="${ContactPhone}"/>
			<set item="iparam:ZIP" value="${ZIP}"/>
			<set item="iparam:City" value="${City}"/>
			<set item="iparam:Street" value="${Street}"/>
			<set item="iparam:House" value="${House}"/>
			<set item="iparam:Flat" value="${Flat}"/>
			<set item="iparam:District" value="${District}"/>
			<set item="iparam:Region" value="${Region}"/>
			<set item="iparam:Description" value="${Description}"/>
			<set item="iparam:Code" value="${Code}"/>
			<set item="iparam:Name" value="${Name}"/>
		</deliveryTemplate>
		<deliveryTemplate>
			<set item="oparam:dbresult" value="${dbresult}"/>
			<set conditionEx="0@{freeSession}"/>
		</deliveryTemplate>
		<input>
			<param name="customer"/>
			<param name="bonuscode"/>
		</input>
		<output>
			<param name="dbresult" type="3" value="-1"/>
		</output>
	</template>
	<template procedureName="OrderBonusVoucher" handler="DBCON_05"  sessionLifetime="300">
		<receiveTemplate>
			<Message initiator="ivrcon" id="@{newGuid}" session_id="${session_id}">
				<Item procedureName="WEBAPP.INSERT_ORDER_VOUCHER">
					<Attribute name="i_addr_first_name" type="STRING" value="${FirstName}"/>
					<Attribute name="i_addr_last_name" type="STRING" value="${LastName}"/>
					<Attribute name="i_msisdn" type="STRING" value="${Msisdn}"/>
					<Attribute name="i_acc_number" value="${PANumber}"/>
					<Attribute name="i_phys_res_id" type="INT" value="${TerminalDeviceID}"/>
					<Attribute name="i_vouch_desc" type="STRING" value="${Name}"/>
					<Attribute name="i_vouch_type" type="STRING" value="${Code}"/>
					<Attribute name="i_user_name" type="STRING" value="USSD"/>
					<Attribute name="i_create_date" type="DATETIME" value="@{now}"/>
					<Attribute name="i_date_process" type="DATETIME" value=""/>
					<Attribute name="i_zip" type="STRING" value="${ZIP}"/>
					<Attribute name="i_city" type="STRING" value="${City}"/>
					<Attribute name="i_street" type="STRING" value="${Street}"/>
					<Attribute name="i_house" type="STRING" value="${House}"/>
					<Attribute name="i_float_addr" type="STRING" value="${Flat}"/>
					<Attribute name="i_name_addr" type="STRING" value="${FirstName}"/>
					<Attribute name="i_phone_addr" type="STRING" value="${Msisdn}"/>
					<Attribute name="i_note_addr" type="STRING" value=""/>
					<Attribute name="i_is_mail" type="INT" value="0"/>
					<Attribute name="i_region" type="STRING" value="${Region}"/>
					<Attribute name="i_district" type="STRING" value="${District}"/>
					<Attribute name="i_user_proc" type="STRING" value=""/>
					<Attribute name="i_amount" type="INT" value="1"/>
					<Attribute name="i_cust_type" type="INT" value="0"/>
					<Attribute name="i_request_id" type="INT" value=""/>
					<Attribute name="reqnumber" type="out:INT"/>
				</Item>
			</Message>
		</receiveTemplate>
		<deliveryTemplate>
			<set item="oparam:dbresult" value="${dbresult}"/>
			<set item="oparam:reqnumber" value="${reqnumber}"/>
			<set conditionEx="0@{freeSession}"/>
		</deliveryTemplate>
		<input>
			<param name="Msisdn"/>
			<param name="FirstName"/>
			<param name="LastName"/>
			<param name="OrganizationName"/>
			<param name="PANumber"/>
			<param name="TerminalDeviceID"/>
			<param name="ResponsiblePerson"/>
			<param name="ContactPhone"/>
			<param name="ZIP"/>
			<param name="City"/>
			<param name="Street"/>
			<param name="House"/>
			<param name="Flat"/>
			<param name="District"/>
			<param name="Region"/>
			<param name="Description"/>
			<param name="Code"/>
			<param name="Name"/>
		</input>
		<output>
			<param name="dbresult" type="3" value="-1"/>
			<param name="reqnumber" type="3" value="-1"/>
		</output>
	</template>










	<!--template procedureName="DB_OrderBonusGift" handler="DBCON_01">
		<receiveTemplate>
			<Message initiator="ivrcon" id="${guid}" session_id="@{newGuid}">
				<Item procedureName="DB_OrderBonusGift">
					<Attribute name="p_MSISDN" type="STRING" value="${Customer}" />
					<Attribute name="p_Code" type="STRING" value="${CustServiceID}" />
					<Attribute name="p_BonusPrice" type="STRING" value="${BonusPrice}" /> 
				</Item>
			</Message>
		</receiveTemplate>
		<deliveryTemplate>
			<set item="param:dbresult" value="#{if('${p_dbresult}'='',-1,number('${p_dbresult}'))}" />
		</deliveryTemplate>
		<input>
			<param name="Customer" />
			<param name="code" />
		</input>
		<output>
			<param name="dbresult"  type="3" value="-1" />
		</output>
	</template-->
	<template procedureName="DB_OrderBonusGift" handler="DBCON_05">
		<receiveTemplate>
			<Message initiator="ivrcon" id="${guid}" session_id="@{newGuid}">
				<Item procedureName="WEBAPP.FRS_CUSTOMER_REQUEST.WRAPPER_INSERT_REQUEST_MSISDN">
					<Attribute name="I_MSISDN" type="STRING" value="${Customer}"/>
					<Attribute name="I_FRS_SERVICE_CODE" type="STRING" value="${Code}"/>
					<Attribute name="I_REQ_TYPE" type="INT" value="1"/>
					<Attribute name="I_REQ_COMMENT" type="STRING" value=""/>
					<Attribute name="I_REQ_PRIORITY" type="INT" value="0"/>
					<Attribute name="I_REQ_PARAM" type="STRING" value=""/>
					<Attribute name="I_REQ_USER" type="STRING" value="USSD"/>
					<Attribute name="I_MARKET" type="INT" value="0"/>
					<Attribute name="I_SALESMAN_ID" type="INT" value=""/>
					<Attribute name="I_SALE_POINT_CODE" type="STRING" value=""/>
					<Attribute name="RAISE_ERRORS_FLAG" type="STRING" value="False"/>
					<Attribute name="reqnumber" type="out:INT"/>
				</Item>
			</Message>
		</receiveTemplate>
		<deliveryTemplate>
			<set item="oparam:dbresult" value="${dbresult}"/>
			<set item="oparam:reqnumber" value="${reqnumber}"/>
		</deliveryTemplate>
		<input>
			<param name="Customer"/>
			<param name="Code"/>
		</input>
		<output>
			<param name="dbresult" type="3" value="-1"/>
			<param name="reqnumber" type="3" value="-1"/>
		</output>
	</template>

	<template procedureName="DB_LangSetting" > 
		<receiveTemplate>
			<Message type="setprofile" initiator="ivrcon" id="${guid}" session_id="@{newGuid}">
				<Item customer="${customer}" >
					<Attribute name="communicationlanguage" value="${communicationlanguage}"/>
				</Item>
			</Message>
		</receiveTemplate>
		<deliveryTemplate>
			<set item="oparam:dbresult" value="${dbresult}" />
		</deliveryTemplate>
		<input>
			<param name="customer" />
			<param name="communicationlanguage" />	  
		</input>
		<output>
			<param name="dbresult" type="3" value="0" /> 
		</output>
	</template>  
	<template procedureName="GetBMSCounter" handler="_BMSCON" sessionLifetime="300">
		<receiveTemplate>
			<Message type="getcounters" initiator="ivrcon" id="${guid}" session_id="@{setSessionId(${guid})}">
				<Item procedureName="GetMsisdnCurrentCounterInstances">
					<Attribute name="Customer" type="String" value="${Msisdn}"/>
					<Attribute name="LanguageId" type="String" value="3"/>
					<Attribute name="CounterInstances"/>
					<Attribute name="Result"/>
				</Item>
				@{store(sBalance,${Balance})}
				@{store(sCreateDate,${CreateDate})}
			</Message>
		</receiveTemplate>
		<deliveryTemplate conditionEx="#{'${Result}'='0'}">
			<set item="oparam:dbresult" value="0"/>
			<set item="oparam:Balance" value="${sBalance}"/>
			<set item="oparam:CreateDate" value="${sCreateDate}"/>

			<!--			<set item="oparam:CampaignId" value="#{nodeset('${CounterInstances}')/CounterInstances/CounterInstance/CampaignId/text()}"/>
			<set item="oparam:CampaignName" value="#{nodeset('${CounterInstances}')/CounterInstances/CounterInstance/CampaignName/text()}"/>
			<set item="oparam:CounterId" value="#{nodeset('${CounterInstances}')/CounterInstances/CounterInstance/CounterId/text()}"/>
			<set item="oparam:CounterName" value="#{nodeset('${CounterInstances}')/CounterInstances/CounterInstance/CounterName/text()}"/>
			<set item="oparam:CounterValue" value="#{nodeset('${CounterInstances}')/CounterInstances/CounterInstance/CounterValue/text()}"/>
			<set item="oparam:EndDate" value="#{nodeset('${CounterInstances}')/CounterInstances/CounterInstance/EndDate/text()}"/>
			<set item="oparam:StartDate" value="#{nodeset('${CounterInstances}')/CounterInstances/CounterInstance/StartDate/text()}"/>
-->
			<set item="oparam:Counters" value="${CounterInstances}"/>
		</deliveryTemplate>
		<deliveryTemplate conditionEx="#{'${Result}'='-1'}">
			<set item="oparam:dbresult" value="-1"/>
			<set item="oparam:Counters" value="0"/>
		</deliveryTemplate>
		<input>
			<param name="Msisdn"/>
			<param name="Balance"/>
			<param name="CreateDate"/>
		</input>
		<output>
			<param name="dbresult" value="-1"/>
			<param name="Balance" value=""/>
			<param name="CreateDate" value=""/>

			<!--			<param name="CampaignId" value=""/>
			<param name="CampaignName" value=""/>
			<param name="CounterId" value=""/>
			<param name="CounterName" value=""/>
			<param name="CounterValue" value=""/>
			<param name="EndDate" value=""/>
			<param name="StartDate" value=""/>
-->
			<param name="Counters" value="0"/>

		</output>
	</template>

	<!-- 29.09.2013 Task 709266 -->

	<template procedureName="DB_FavUpdate" sessionStorage="Memory" sessionLifetime="120">
		<receiveTemplate>
			<Message type="setprofile" initiator="ivrcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
				<Item customer="${customer}" action="10">
					<Attribute name="favouritenumber" value="${favouritenumber}" />
					<Attribute name="index" value="0" />
					<Attribute name="favouritenumbertypeid" value="${fntype}" />
				</Item>
				@{store(sFavouriteNumber,${favouritenumber})}  
			</Message>
		</receiveTemplate>
		<deliveryTemplate>
			<set item="oparam:dbresult" value="${dbresult}" />
			<set item="oparam:favouritenumber" value="${sFavouriteNumber}" />
			<set item="oparam:count" value="${count}" />
			<set conditionEx="0@{freeSession}" />
		</deliveryTemplate>
		<input>
			<param name="customer" />
			<param name="favouritenumber" />
			<param name="fntype" />
		</input>
		<output>
			<param name="dbresult" />
			<param name="favouritenumber" />
			<param name="count" value="0" />
		</output>
	</template>


	<template procedureName="DB_FavDeleteIndex" sessionStorage="Memory" sessionLifetime="120">
		<receiveTemplate>
			<Message type="setprofile" initiator="ivrcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
				<Item customer="${customer}" action="8">
					<Attribute name="favouritenumber" value="" />
					<Attribute name="index" value="${index}" />
					<Attribute name="favouritenumbertypeid" value="${fntype}" />
				</Item>
				@{store(sIndex,${index})}
				@{store(sFavouritenumbertypeid,${fntype})}
			</Message>
		</receiveTemplate>
		<deliveryTemplate conditionEx="#{'${dbresult}'='0' and '${favouritenumber}'!=''}" call="DB_FavDeleteIndex_s2">
			<set item="iparam:customer"  value="${customer}"/>
			<set item="iparam:favouritenumber"  value="${favouritenumber}"/>
			<set item="iparam:index"  value="${sIndex}"/>
			<set item="iparam:fntype"  value="${sFavouritenumbertypeid}"/>
			<set item="iparam:count"  value="${count}"/>
		</deliveryTemplate>
		<deliveryTemplate conditionEx="#{'${favouritenumber}'='' and '${dbresult}'='0'}">
			<set item="oparam:dbresult" value="320009" />
			<set item="oparam:favouritenumber" value="${favouritenumber}" />
			<set item="oparam:count" value="${count}" />
			<set conditionEx="0@{freeSession}" />
		</deliveryTemplate>		
		<deliveryTemplate>
			<set item="oparam:dbresult" value="${dbresult}" />
			<set item="oparam:favouritenumber" value="${favouritenumber}" />
			<set item="oparam:count" value="${count}" />
			<set conditionEx="0@{freeSession}" />
		</deliveryTemplate>	
		<input>
			<param name="customer" />
			<param name="index" />
			<param name="fntype" />
		</input>
		<output>
			<param name="dbresult" />
			<param name="favouritenumber" />
			<param name="count" />
		</output>
	</template>

	<template procedureName="DB_FavDeleteIndex_s2" sessionStorage="Memory" sessionLifetime="120">
		<receiveTemplate>
			<Message type="setprofile" initiator="ivrcon" id="${guid}" session_id="${session_id}">
				<Item customer="${customer}" action="11">
					<Attribute name="favouritenumber" value="${favouritenumber}" />
					<Attribute name="index" value="${index}" />
					<Attribute name="favouritenumbertypeid" value="${fntype}" />
				</Item>
				@{store(sCount,${count})}
			</Message>
		</receiveTemplate>
		<deliveryTemplate>
			<set item="oparam:dbresult" value="${dbresult}" />
			<set item="oparam:favouritenumber" value="${favouritenumber}" />
			<set item="oparam:count" value="${sCount}" />
			<set conditionEx="0@{freeSession}" />
		</deliveryTemplate>
		<input>
			<param name="customer" />
			<param name="favouritenumber" />
			<param name="index" />
			<param name="fntype" />
			<param name="count" />
		</input>
		<output>
			<param name="dbresult" />
			<param name="favouritenumber" />
			<param name="count" />
		</output>
	</template>


	<template procedureName="DB_FavDelete" sessionStorage="Memory" sessionLifetime="120">
		<receiveTemplate>
			<Message type="setprofile" initiator="ivrcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
				<Item customer="${customer}" action="11">
					<Attribute name="favouritenumber" value="${favouritenumber}" />
					<Attribute name="index" value="0" />
					<Attribute name="favouritenumbertypeid" value="${fntype}" />
				</Item>
			</Message>
		</receiveTemplate>
		<deliveryTemplate>
			<set item="oparam:dbresult" value="${dbresult}" />
			<set item="oparam:favouritenumber" value="${favouritenumber}" />
			<set item="oparam:count" value="${count}" />
			<set conditionEx="0@{freeSession}" />
		</deliveryTemplate>
		<input>
			<param name="customer" />
			<param name="favouritenumber" />
			<param name="fntype" />
		</input>
		<output>
			<param name="dbresult" />
			<param name="favouritenumber" />
			<param name="count" />
		</output>
	</template>  


	<template procedureName="DB_FavBrowse" sessionStorage="Memory" sessionLifetime="120">
		<receiveTemplate>
			<Message type="setprofile" initiator="ivrcon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
				<Item customer="${customer}" action="8">
					<Attribute name="favouritenumber" value="" />
					<Attribute name="index" value="${index}" />
					<Attribute name="favouritenumbertypeid" value="${fntype}" />
				</Item>
			</Message>
		</receiveTemplate>
		<deliveryTemplate conditionEx="#{'${favouritenumber}'='' and '${dbresult}'='0'}">
			<set item="oparam:dbresult" value="320009" />
			<set item="oparam:favouritenumber" value="${favouritenumber}" />
			<set item="oparam:count" value="${count}" />
			<set conditionEx="0@{freeSession}" />
		</deliveryTemplate>		
		<deliveryTemplate>
			<set item="oparam:dbresult" value="${dbresult}" />
			<set item="oparam:favouritenumber" value="${favouritenumber}" />
			<set item="oparam:count" value="${count}" />
			<set conditionEx="0@{freeSession}" />
		</deliveryTemplate>
		<input>
			<param name="customer" />
			<param name="index" />
			<param name="fntype" />
		</input>
		<output>
			<param name="dbresult" />
			<param name="favouritenumber" />
			<param name="count" value="0" />
		</output>
	</template>

<template procedureName="GetRetrieveTdLimit" sessionStorage="Memory" sessionLifetime="300">
  
    <receiveTemplate>
      <Message type="retrievetdlimit" initiator="ussd" id="${guid}" session_id="@{setSessionId(${guid})}">
        <Item customer="${customer}"/>
      </Message>
    </receiveTemplate>
                
                
                               <deliveryTemplate>
                                               <set item="oparam:current_expenses" value="#{round(10000*${current_expenses}) div 1}"/>
                               </deliveryTemplate>
                                               
                <input>
      <param name="customer" />
    </input>
    <output>
      <param name="has_td_limit"  value=""/> 
                  <param name="blocked_by_limit" value=""/> 
                  <param name="block_threshold"  value=""/> 
                  <param name="notify_threshold" value=""/> 
                  <param name="current_expenses"  value=""/>
    </output>
  </template>
	
	<template procedureName="DB_CustomerCategoryRetriev" persistent="false">
		<receiveTemplate>
			<Message type="retrievecustomerdata" initiator="ivrcon" id="${guid}" session_id="@{newGuid}">
				<Item customer="${customer}" subject="category" />
			</Message>
		</receiveTemplate>
		<input>
			<param name="customer" />      
		</input>
		<output>
			<param name="customercategory" type="2" value="0" />
			<param name="clientstatus" type="3" value="0" />
			<param name="personalaccounttype" type="3" value="0" />
		</output>
	</template>

	<!-- FORIS.MessagingGateway.Templates 10.10.17 -->
	<template procedureName="ServiceActivateSecured">
		<receiveTemplate>
			<Message initiator="soapcon" id="${guid}" session_id="@{newGuid}">
				<Item customer="${Msisdn}" />
				<Item text="${ServiceCode}1*${Password}" />
				<Item Password="${Password}" />
				<Item LanguageId="${LanguageId}" />
				<Item Code="${ServiceCode}1" />
			</Message>
		</receiveTemplate>
		<deliveryTemplate direction="input" terminating="false">
			<set item="oparam:Success" value="_POP_SOAP_SUCCESS_RESULT"/>
		</deliveryTemplate>
		<deliveryTemplate direction="input" connector="_POP_SMSCON" call="_POP_TEMPLATE_FOR_SENDING" />
		<input>
			<param name="Msisdn" />
			<param name="LanguageId" />
			<param name="ServiceCode" />
			<param name="Password" />
		</input>
		<output>
			<param name="Success"  />
		</output>
	</template>

	<template procedureName="ServiceDeactivateSecured">
		<receiveTemplate>
			<Message initiator="soapcon" id="${guid}" session_id="@{newGuid}">
				<Item customer="${Msisdn}" />
				<Item text="${ServiceCode}2*${Password}" />
				<Item Password="${Password}" />
				<Item LanguageId="${LanguageId}" />
				<Item Code="${ServiceCode}2" />
			</Message>
		</receiveTemplate>
		<deliveryTemplate direction="input" terminating="false">
			<set item="oparam:Success" value="_POP_SOAP_SUCCESS_RESULT"/>
		</deliveryTemplate>
		<deliveryTemplate direction="input" connector="_POP_SMSCON" call="_POP_TEMPLATE_FOR_SENDING" />
		<input>
			<param name="Msisdn" />
			<param name="LanguageId" />
			<param name="ServiceCode" />
			<param name="Password" />
		</input>
		<output>
			<param name="Success"  />
		</output>
	</template>

	<template procedureName="DB_PaymentsInformationSecured" persistent="false">
		<receiveTemplate>
			<Message initiator="soapcon" id="${guid}" session_id="@{newGuid}">
				<Item customer="${Msisdn}" />
				<Item text="11*${Password}" />
				<Item Password="${Password}" />
				<Item LanguageId="${LanguageId}" />
				<Item Code="11" />
			</Message>
		</receiveTemplate>
		<deliveryTemplate direction="input" terminating="false">
			<set item="oparam:Success" value="_POP_SOAP_SUCCESS_RESULT"/>
		</deliveryTemplate>
		<deliveryTemplate direction="input" connector="_POP_SMSCON" call="_POP_TEMPLATE_FOR_SENDING" />
		<input>
			<param name="Msisdn" />
			<param name="LanguageId" />
			<param name="PaymentsCount" />
			<param name="Password" />
		</input>
		<output>
			<param name="Success"  />
		</output>
	</template>

	<template procedureName="DB_PaymentsInformationSecuredSync" persistent="false">
		<receiveTemplate>
			<Message type="retrievecustomerdataSecured" initiator="smscon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
				<Item customer="${Msisdn}" subject="paymentsSecured" pin="${Password}">
					<Attribute name="index" value="0" />
				</Item>
			</Message>
		</receiveTemplate>
		<deliveryTemplate>
			<set item='oparam:dbresult' value='${dbresult}' />
			<set item='oparam:DateTo' value='${dateto}' />
			<set item='oparam:DateFrom' value='${datefrom}' />
			<set item='oparam:ServiceCode' value='${additionalagreementcode}' />
			<set item='oparam:DaysLeft' value='${daysbeforetheend}' />
		</deliveryTemplate>
		<input>
			<param name="Msisdn" />
			<param name="LanguageId" />
			<param name="PaymentsCount" />
			<param name="Password" />
		</input>
		<output>
			<param name="dbresult"  />
			<param name="DateTo"  />
			<param name="DateFrom"  />
			<param name="ServiceCode"  />
			<param name="DaysLeft"  />
		</output>
	</template>


	<template procedureName="DB_BillsInformationSecured" persistent="false">
		<receiveTemplate>
			<Message initiator="soapcon" id="${guid}" session_id="@{newGuid}">
				<Item customer="${Msisdn}" />
				<Item text="12*${Password}" />
				<Item Password="${Password}" />
				<Item LanguageId="${LanguageId}" />
				<Item Code="12" />
			</Message>
		</receiveTemplate>
		<deliveryTemplate direction="input" terminating="false">
			<set item="oparam:Success" value="_POP_SOAP_SUCCESS_RESULT"/>
		</deliveryTemplate>
		<deliveryTemplate direction="input" connector="_POP_SMSCON" call="_POP_TEMPLATE_FOR_SENDING" />
		<input>
			<param name="Msisdn" />
			<param name="LanguageId" />
			<param name="BillsCount" />
			<param name="Password" />
		</input>
		<output>
			<param name="Success"  />
		</output>
	</template>

	<template procedureName="DB_BillsInformationSecuredSync" persistent="false">
		<receiveTemplate>
			<Message type="retrievecustomerdataSecured" initiator="smscon" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
				<Item customer="${Msisdn}" subject="billsSecured" pin="${Password}">
					<Attribute name="index" value="0" />
				</Item>
			</Message>
		</receiveTemplate>
		<deliveryTemplate>
			<set item='oparam:dbresult' value='${dbresult}' />
			<set item='oparam:IvrAccountInfoInactive' value='${dateto}' />
			<set item='oparam:Bills' value='${datefrom}' />
		</deliveryTemplate>
		<input>
			<param name="Msisdn" />
			<param name="LanguageId" />
			<param name="BillsCount" />
			<param name="Password" />
		</input>
		<output>
			<param name="dbresult"  />
			<param name="IvrAccountInfoInactive"  />
			<param name="Bills"  />
		</output>
	</template>

	<template procedureName="ChangeMobilePassword">
		<receiveTemplate>
			<Message initiator="soapcon" id="${guid}" session_id="@{newGuid}">
				<Item customer="${Msisdn}" />
				<Item text="123*${Password}*${NewPassword}" />
				<Item Password="${Password}" />
				<Item LanguageId="${LanguageId}" />
				<Item Code="123" />
			</Message>
		</receiveTemplate>
		<deliveryTemplate direction="input" terminating="false">
			<set item="oparam:Success" value="_POP_SOAP_SUCCESS_RESULT"/>
		</deliveryTemplate>
		<deliveryTemplate direction="input" connector="_POP_SMSCON" call="_POP_TEMPLATE_FOR_SENDING" />
		<input>
			<param name="Msisdn" />
			<param name="LanguageId" />
			<param name="NewPassword" />
			<param name="Password" />
		</input>
		<output>
			<param name="Success"  />
		</output>
	</template>
	<!-- FORIS.MessagingGateway.Templates 10.10.17 -->


 <!--  FORIS.MessagingGateway.Templates 11.41.2_CR-650 
  --> 
<template procedureName="DB_OrderBonusVoucher_1" handler="_BMSCON" sessionLifetime="300">
 <receiveTemplate>
 <Message type="ordergiftvalidation" initiator="soap" id="${guid}" session_id="@{setSessionId(@{newGuid})}">
 <Item procedureName="OrderGiftValidationSingle">
  <Attribute name="Msisdn" value="${customer}" /> 
  <Attribute name="GiftCode" value="${bonuscode}" /> 
  <Attribute name="isAvailable" /> 
  <Attribute name="Result" /> 
  </Item>
  @{store(Msisdn,${customer})} @{store(sBonusCode,${bonuscode})} 
  </Message>
  </receiveTemplate>
  <deliveryTemplate conditionEx="#{'${Result}'='0' and '${isAvailable}'='1'}" call="DB_OrderBonusVoucherCheck_1" /> 
 <deliveryTemplate conditionEx="#{'${Result}'='0'}">
  <set item="oparam:dbresult" value="0" /> 
  <set item="oparam:bmsresult" value="-771009" /> 
  <set item="oparam:reqnumber" value="0" /> 
  <set conditionEx="0@{freeSession}" /> 
  </deliveryTemplate>
 <deliveryTemplate>
  <set item="oparam:dbresult" value="0" /> 
  <set item="oparam:bmsresult" value="${Result}" /> 
  <set item="oparam:reqnumber" value="0" /> 
  <set conditionEx="0@{freeSession}" /> 
  </deliveryTemplate>
 <input>
  <param name="customer" /> 
  <param name="bonuscode" /> 
  </input>
 <output>
  <param name="dbresult" type="3" value="-1" /> 
  <param name="bmsresult" type="3" value="-1" /> 
  <param name="reqnumber" type="3" value="-1" /> 
  </output>
  </template>
<template procedureName="DB_OrderBonusVoucherCheck_1" sessionLifetime="300">
 <receiveTemplate>
 <Message type="CustomerBonusRequest" initiator="ivrcon" id="@{newGuid}" session_id="${session_id}">
 <Item customer="${Msisdn}">
  <Attribute name="BonusCode" value="${sBonusCode}" /> 
  <Attribute name="language_id" value="1" /> 
  </Item>
  </Message>
  </receiveTemplate>
 <deliveryTemplate conditionEx="#{'${dbresult}'='0'}" call="OrderBonusVoucher_1">
  <set item="iparam:Msisdn" value="${Msisdn}" /> 
  <set item="iparam:FirstName" value="${FirstName}" /> 
  <set item="iparam:LastName" value="${LastName}" /> 
  <set item="iparam:OrganizationName" value="${OrganizationName}" /> 
  <set item="iparam:PANumber" value="${PANumber}" /> 
  <set item="iparam:TerminalDeviceID" value="${TerminalDeviceID}" /> 
  <set item="iparam:ResponsiblePerson" value="${ResponsiblePerson}" /> 
  <set item="iparam:ContactPhone" value="${ContactPhone}" /> 
  <set item="iparam:ZIP" value="${ZIP}" /> 
  <set item="iparam:City" value="${City}" /> 
  <set item="iparam:Street" value="${Street}" /> 
  <set item="iparam:House" value="${House}" /> 
  <set item="iparam:Flat" value="${Flat}" /> 
  <set item="iparam:District" value="${District}" /> 
  <set item="iparam:Region" value="${Region}" /> 
  <set item="iparam:Description" value="${Description}" /> 
  <set item="iparam:Code" value="${Code}" /> 
  <set item="iparam:Name" value="${Name}" /> 
  </deliveryTemplate>
 <deliveryTemplate>
  <set item="oparam:dbresult" value="${dbresult}" /> 
  <set item="oparam:bmsresult" value="" /> 
  <set item="oparam:reqnumber" value="0" /> 
  <set conditionEx="0@{freeSession}" /> 
  </deliveryTemplate>
 <input>
 <param name="customer" /> 
  <param name="bonuscode" /> 
  </input>
 <output>
  <param name="dbresult" type="3" value="-1" /> 
  <param name="bmsresult" /> 
  <param name="reqnumber" /> 
  </output>
  </template>
<template procedureName="OrderBonusVoucher_1" handler="DBCON_05" sessionLifetime="300">
 <receiveTemplate>
 <Message initiator="ivrcon" id="@{newGuid}" session_id="${session_id}">
 <Item procedureName="WEBAPP.INSERT_ORDER_VOUCHER">
  <Attribute name="i_addr_first_name" type="STRING" value="${FirstName}" /> 
  <Attribute name="i_addr_last_name" type="STRING" value="${LastName}" /> 
  <Attribute name="i_msisdn" type="STRING" value="${Msisdn}" /> 
  <Attribute name="i_acc_number" value="${PANumber}" /> 
  <Attribute name="i_phys_res_id" type="INT" value="${TerminalDeviceID}" /> 
  <Attribute name="i_vouch_desc" type="STRING" value="${Name}" /> 
  <Attribute name="i_vouch_type" type="STRING" value="${Code}" /> 
  <Attribute name="i_user_name" type="STRING" value="USSD" /> 
  <Attribute name="i_create_date" type="DATETIME" value="@{now}" /> 
  <Attribute name="i_date_process" type="DATETIME" value="" /> 
  <Attribute name="i_zip" type="STRING" value="${ZIP}" /> 
  <Attribute name="i_city" type="STRING" value="${City}" /> 
  <Attribute name="i_street" type="STRING" value="${Street}" /> 
  <Attribute name="i_house" type="STRING" value="${House}" /> 
  <Attribute name="i_float_addr" type="STRING" value="${Flat}" /> 
  <Attribute name="i_name_addr" type="STRING" value="${FirstName}" /> 
  <Attribute name="i_phone_addr" type="STRING" value="${Msisdn}" /> 
  <Attribute name="i_note_addr" type="STRING" value="" /> 
  <Attribute name="i_is_mail" type="INT" value="0" /> 
  <Attribute name="i_region" type="STRING" value="${Region}" /> 
  <Attribute name="i_district" type="STRING" value="${District}" /> 
  <Attribute name="i_user_proc" type="STRING" value="" /> 
  <Attribute name="i_amount" type="INT" value="1" /> 
  <Attribute name="i_cust_type" type="INT" value="0" /> 
  <Attribute name="i_request_id" type="INT" value="" /> 
  <Attribute name="reqnumber" type="out:INT" /> 
  </Item>
  </Message>
  </receiveTemplate>
 <deliveryTemplate>
  <set item="oparam:dbresult" value="${dbresult}" /> 
  <set item="oparam:reqnumber" value="${reqnumber}" /> 
  <set item="oparam:bmsresult" value="0" /> 
  <set conditionEx="0@{freeSession}" /> 
  </deliveryTemplate>
 <input>
  <param name="Msisdn" /> 
  <param name="FirstName" /> 
  <param name="LastName" /> 
  <param name="OrganizationName" /> 
  <param name="PANumber" /> 
  <param name="TerminalDeviceID" /> 
  <param name="ResponsiblePerson" /> 
  <param name="ContactPhone" /> 
  <param name="ZIP" /> 
  <param name="City" /> 
  <param name="Street" /> 
  <param name="House" /> 
  <param name="Flat" /> 
  <param name="District" /> 
  <param name="Region" /> 
  <param name="Description" /> 
  <param name="Code" /> 
  <param name="Name" /> 
  </input>
 <output>
  <param name="dbresult" type="3" value="-1" /> 
  <param name="reqnumber" type="3" value="-1" /> 
  <param name="bmsresult" type="3" value="-1" /> 
  </output>
  </template>
<template procedureName="DB_OrderBonusGift_1" handler="_BMSCON">
 <receiveTemplate>
 <Message type="ordergiftvalidation" initiator="soap" id="${guid}" session_id="${guid}">
 <Item procedureName="OrderGiftValidationSingle">
  <Attribute name="Msisdn" value="${Customer}" /> 
  <Attribute name="GiftCode" value="${Code}" /> 
  <Attribute name="isAvailable" /> 
  <Attribute name="Result" /> 
  </Item>
  </Message>
  </receiveTemplate>
 <deliveryTemplate conditionEx="#{'${Result}'='0' and '${isAvailable}'='1'}" call="DB_OrderBonusGiftCheck_1">
  <set item="iparam:Customer" value="${Msisdn}" /> 
  <set item="iparam:Code" value="${GiftCode}" /> 
  </deliveryTemplate>
 <deliveryTemplate conditionEx="#{'${Result}'='0'}">
  <set item="oparam:dbresult" value="0" /> 
  <set item="oparam:bmsresult" value="-771009" /> 
  <set item="oparam:reqnumber" value="0" /> 
  <set conditionEx="0@{freeSession}" /> 
  </deliveryTemplate>
 <deliveryTemplate>
  <set item="oparam:dbresult" value="0" /> 
  <set item="oparam:bmsresult" value="${Result}" /> 
  <set item="oparam:reqnumber" value="0" /> 
  <set conditionEx="0@{freeSession}" /> 
  </deliveryTemplate>
 <input>
  <param name="Customer" /> 
  <param name="Code" /> 
  </input>
 <output>
  <param name="dbresult" type="3" value="-1" /> 
  <param name="bmsresult" type="3" value="-1" /> 
  <param name="reqnumber" type="3" value="-1" /> 
  </output>
  </template>
<template procedureName="DB_OrderBonusGiftCheck_1" handler="DBCON_05">
 <receiveTemplate>
 <Message initiator="ivrcon" id="${guid}" session_id="@{newGuid}">
 <Item procedureName="WEBAPP.FRS_CUSTOMER_REQUEST.WRAPPER_INSERT_REQUEST_MSISDN">
  <Attribute name="I_MSISDN" type="STRING" value="${Customer}" /> 
  <Attribute name="I_FRS_SERVICE_CODE" type="STRING" value="${Code}" /> 
  <Attribute name="I_REQ_TYPE" type="INT" value="1" /> 
  <Attribute name="I_REQ_COMMENT" type="STRING" value="" /> 
  <Attribute name="I_REQ_PRIORITY" type="INT" value="0" /> 
  <Attribute name="I_REQ_PARAM" type="STRING" value="" /> 
  <Attribute name="I_REQ_USER" type="STRING" value="USSD" /> 
  <Attribute name="I_MARKET" type="INT" value="0" /> 
  <Attribute name="I_SALESMAN_ID" type="INT" value="" /> 
  <Attribute name="I_SALE_POINT_CODE" type="STRING" value="" /> 
  <Attribute name="RAISE_ERRORS_FLAG" type="STRING" value="False" /> 
  <Attribute name="reqnumber" type="out:INT" /> 
  </Item>
  </Message>
  </receiveTemplate>
 <deliveryTemplate>
  <set item="oparam:dbresult" value="${dbresult}" /> 
  <set item="oparam:reqnumber" value="${reqnumber}" /> 
  <set item="oparam:bmsresult" value="0" /> 
  </deliveryTemplate>
 <input>
  <param name="Customer" /> 
  <param name="Code" /> 
  </input>
 <output>
  <param name="dbresult" type="3" value="-1" /> 
  <param name="reqnumber" type="3" value="-1" /> 
  <param name="bmsresult" type="3" value="-1" /> 
  </output>
  </template>
   

</templateGroup>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            