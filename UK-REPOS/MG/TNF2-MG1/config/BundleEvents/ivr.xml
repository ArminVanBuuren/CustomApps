<templateGroup name="BundleEvents">
	<macros>
		<define name="_SMSCON" value="SMSCON_01" />
		<define name="_NEED_CONFIRMATION" value="false" />
	</macros>

	<template procedureName="AddServiceToOtherSubscriber" sessionStorage="Memory" sessionLifetime="30">
		<receiveTemplate>
			<Message type="possibilityaddsubbalanceanothercustomer" initiator="ivrcon" id="${guid}" session_id="@{setSessionId(${guid})}">
			    @{store(sInputCode,#{normalize-space('${servicecode}')})}
			    @{store(sSubbalanceCode,#{document('C:\Foris\Messaging Gateway\config\BundleEvents\subbalances.xml')/subbalances/subbalance[@ivr_code='${sInputCode}']/@crm_code})}
				<Item customer="${customer}" inputcode="${sInputCode}">
					<Service id="${sSubbalanceCode}" action="1">
						<Attribute name="msisdnrecipient" value="${msisdnrecipient}" />
						<Attribute name="confirmation" value="_NEED_CONFIRMATION" />
					</Service>
				</Item>
			</Message>
		</receiveTemplate>
		<deliveryTemplate direction="input" terminating="false">
			<set item="param:dbresult" value="0" />
		</deliveryTemplate>
		<deliveryTemplate direction="input" conditionEx="#{'${sSubbalanceCode}'=''}@{freeSession}" connector="_SMSCON" call="BundleEvents.NotifyAboutWrongServiceCode" />
		<deliveryTemplate dropReply="true" />
		<input>
			<param name="customer" />
			<param name="servicecode" />
			<param name="msisdnrecipient" />
		</input>
		<output>
			<param name="dbresult" type="3" value="0" />
		</output>
	</template>

</templateGroup>
